import{g as w,r as o,f as F,H as R,i as z,j as e,C as D,n as P,a5 as L,S as p,b as x,F as N,A as I,T as V,B as d,a6 as q,q as U,s as W,t as H,_ as M}from"./index-a08c4904.js";import"./index-e426b97a.js";import{u as O,A as Q}from"./index-befff5a2.js";import{C as _}from"./CustomTitle-d0e5d50c.js";import{E as K}from"./data-25edd064.js";import{p as Y}from"./eventAPI-701fc1aa.js";import{B as G}from"./Back-26c0fe57.js";import{T as J}from"./TextEditor-1dc3e576.js";import{A as X}from"./Autocomplete-62a3dcdf.js";import"./ArrowBackRounded-b2e199d9.js";import"./Chip-a33d5899.js";function pe(){const g=w(),{schoolSessionDispatch:c}=o.useContext(F),u=R(),[f,b]=o.useState(""),[m,j]=o.useState(""),[l,v]=o.useState(""),[i,h]=o.useState(null),{getRootProps:y,getInputProps:S,open:E}=O({noClick:!0,noKeyboard:!0,maxFiles:1,accept:{"image/*":[".jpeg",".png",".webp"]},maxSize:2e5,multiple:!1,onDrop:n=>{if(!M.isEmpty(n)){const t=new FileReader;t.onload=function(a){const r=a.target.result;h(r)},t.readAsDataURL(n[0])}}});o.useEffect(()=>{},[l]);const C={type:f,title:m,description:l,album:i},{mutateAsync:T,isLoading:A}=z({mutationFn:Y}),B=n=>{T(n,{onSettled:()=>{g.invalidateQueries(["events"])},onSuccess:()=>{c(W("Event Created")),u("/events")},onError:t=>{c(H(t))}})};return e.jsxs(D,{children:[e.jsx(G,{to:"/events",color:"primary.main"}),e.jsx(_,{title:"New Events",subtitle:" Send single and bulk SMS to students and parents",color:"text.main",backColor:"#012e54"}),e.jsx(P,{initialValues:C,onSubmit:B,enableReinitialize:!0,validationSchema:L,children:({values:n,errors:t,touched:a,handleSubmit:r})=>e.jsxs(p,{px:2,py:4,spacing:4,bgcolor:"#fff",children:[e.jsx(X,{freeSolo:!0,fullWidth:!0,size:"small",options:K,loadingText:"Please wait....",noOptionsText:"No Event available",getOptionLabel:s=>s||"",value:n==null?void 0:n.type,onChange:(s,k)=>b(k),renderInput:s=>e.jsx(x,{...s,label:"Select Event Type",fullWidth:!0,size:"small",error:!!(a.type&&t.type),helperText:a.type&&t.type})}),e.jsx(x,{label:"Event Title",fullWidth:!0,size:"small",row:3,maxRows:3,value:m,onChange:s=>j(s.target.value),error:!!(a.title&&t.title),helperText:a.title&&t.title}),e.jsx(J,{label:"Description",value:l,setValue:v,touched:a==null?void 0:a.description,errors:t==null?void 0:t.description}),e.jsxs("div",{children:[e.jsx(N,{style:{color:a.album&&t.album?"#B72136":"var(--primary)"},children:"Event Photo/Album"}),e.jsxs(p,{...y({className:"dropzone"}),sx:{borderRadius:1,border:a.album&&t.album?"1px solid #B72136":"1px dotted lightgray",py:8,px:4},children:[e.jsx(I,{variant:"square",src:i,sx:{width:{xs:i===null?120:"100%"},height:{xs:i===null?120:"100%"},objectFit:"contain",alignSelf:"center"}}),e.jsx("input",{...S()}),e.jsx(V,{textAlign:"center",paragraph:!0,children:"Drag & drop your photo here"}),e.jsx(d,{variant:"outlined",onClick:E,startIcon:e.jsx(Q,{}),children:"Upload Image"})]}),a.album&&t.album&&e.jsx(q,{sx:{color:"#B72136"},children:t.album})]}),e.jsxs(p,{direction:"row",justifyContent:"flex-end",spacing:2,children:[e.jsx(d,{onClick:()=>u("/events"),children:"Cancel"}),e.jsx(U,{loading:A,variant:"contained",color:"primary",onClick:r,children:"Create Event"})]})]})})]})}export{pe as default};
