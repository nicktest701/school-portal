import{r as b,U as C,S as j,u as y,h as f,j as e,i as R,C as I,l as T,F as L,bS as B,m as Q,T as g,v as k,Y as v,cI as E,a0 as F,w as _,x as $,R as A,O as N,P,Q as U,c0 as q,g as z,cJ as M,bL as O,V,X as G,G as J,q as W,J as Y,af as K,B as h}from"./index-97ebb758.js";import{d as X}from"./School-e184199c.js";import{b as H}from"./studentColumns-d0a36e3e.js";function Z(){const{userState:{session:n}}=b.useContext(C),{schoolSessionState:{addStudentResults:{open:o,data:c,grade:x}},schoolSessionDispatch:r}=b.useContext(j),a=y(),{mutateAsync:S,isLoading:i}=f({mutationFn:E}),p=s=>{const t=Number(s.classScore)+Number(s.examsScore),d=F(t,x),u={session:{sessionId:n==null?void 0:n.sessionId,termId:n==null?void 0:n.termId,levelId:n==null?void 0:n.levelId,studentId:s==null?void 0:s._id},scores:[{subject:s==null?void 0:s.subject,classScore:s==null?void 0:s.classScore,examsScore:s==null?void 0:s.examsScore,...d}]};S(u,{onSettled:()=>{a.invalidateQueries(["student-records"]),a.invalidateQueries(["exams-scores"]),a.invalidateQueries(["exams-details"]),a.invalidateQueries(["exams-reports"]),a.invalidateQueries(["exams-by-id"]),a.invalidateQueries(["subject-score"])},onSuccess:m=>{r(_(m)),l()},onError:m=>{r($(m))}})},l=()=>{r({type:"addStudentResults",payload:{open:!1,data:{_id:"",level:"",classScore:"",examsScore:"",totalScore:"",grade:"",remarks:""},grade:x}})};return e.jsxs(R,{open:o,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(I,{title:"Add Record",onClose:l}),e.jsx(T,{children:e.jsx(L,{initialValues:c,validationSchema:B,onSubmit:p,children:({values:s,errors:t,touched:d,handleChange:u,handleSubmit:m})=>e.jsx(e.Fragment,{children:e.jsxs(Q,{spacing:2,paddingY:2,children:[e.jsx(g,{label:"Subject",size:"small",value:s.subject,onChange:u("subject"),error:!!t.subject,helperText:d.subject&&t.subject}),e.jsx(g,{type:"number",label:"Class Score",size:"small",value:s.classScore,onChange:u("classScore"),error:!!t.classScore,helperText:d.classScore&&t.classScore}),e.jsx(g,{type:"number",label:"Exams Score",size:"small",value:s.examsScore,onChange:u("examsScore"),error:!!t.examsScore,helperText:d.examsScore&&t.examsScore}),e.jsx(k,{loading:i,variant:"contained",onClick:m,children:"Save Record"})]})})})}),i&&e.jsx(v,{value:"Saving Record..."})]})}function se(){const{schoolSessionDispatch:n}=b.useContext(j),{state:o}=A(),[c]=N(),x=P(),{level:r,levelId:a}=U(),{gradeSystem:S}=q(a),i=z({queryKey:["subject-score",a,c.get("sub")],queryFn:()=>M({id:a,subject:c.get("sub")}),enabled:!!a&&!!c.get("sub")}),p=()=>{x(`/examination/level/${a}/${r}/upload?sub=${c.get("sub")}`,{state:{prevPath:`/course/assign/${a}/${r}?sub=${c.get("sub")}`}})},l=t=>{n({type:"addStudentResults",payload:{open:!0,data:{_id:t==null?void 0:t._id,indexnumber:t==null?void 0:t.indexnumber,levelId:o==null?void 0:o.id,...t==null?void 0:t.course},grade:S}})};if(!a&&!c.get("sub"))return e.jsx(O,{to:"/course/assign"});const s=[...H,{field:null,title:"Action",render:t=>e.jsx(h,{variant:"outlined",onClick:()=>l(t),children:"Add Record"})}];return e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/course/assign",color:"primary.main"}),e.jsxs(G,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1,pr:2},children:[e.jsx(J,{title:"Manage Student Records",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(X,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(W,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:o==null?void 0:o.type})]}),e.jsx(Y,{search:!0,isLoading:i.isLoading,title:o==null?void 0:o.type,subtitle:c.get("sub"),exportFileName:`${r}-${c.get("sub")}`||"",columns:s,data:i.data,actions:[],icon:K,handleRefresh:i==null?void 0:i.refetch,autoCompleteComponent:e.jsx(h,{variant:"contained",onClick:p,children:"Import Records"})}),e.jsx(Z,{})]})}export{se as default};
