import{b as k,r as u,S as P,i as _,a1 as w,c as Q,d as D,j as e,l as b,L as V,ah as M,I as N,D as W,B as L,Y,H as F,f as $,g as E,h as q,X as H,C as K,e as U,x as X,ak as G,P as J,k as Z,T as R}from"./index-B8PQHtjc.js";import{u as ee}from"./useLevel-K9fH0Cop.js";import{B as te}from"./Back-D8wcFeGb.js";import{u as se}from"./useLevelById-K7PyoswH.js";import{d as ie,g as ne,p as re}from"./courseAPI-Dr0HRMDP.js";import{L as ae,A as B}from"./Autocomplete-Dw57Ihk7.js";import{L as S}from"./ListItemText-DzMM1D1F.js";import{R as oe}from"./RefreshRounded-DD-ja5GB.js";import{L as le}from"./ListItem-CQImyTSy.js";import{L as ce}from"./ListItemSecondaryAction-DOVMjMKm.js";import{D as de}from"./DialogActions-BmNk8sop.js";import"./Chip-DmEpgF7y.js";import"./listItemButtonClasses-DySKLRoc.js";function ue(){var p,h;const x=k(),{schoolSessionDispatch:o}=u.useContext(P),{id:m}=_(),{userState:{session:l}}=u.useContext(w),i=Q({queryKey:["courses",m],queryFn:()=>ne({teacher:m,session:l==null?void 0:l.sessionId,term:l==null?void 0:l.termId})}),{mutateAsync:r,isPending:j}=D({mutationFn:ie}),C=t=>{$.fire({title:"Remove",text:"Do you want to revoke course from teacher?",showCancelButton:!0}).then(y=>{y.isConfirmed&&r(t,{onSettled:()=>{x.invalidateQueries(["courses",m])},onSuccess:c=>{o(E(c))},onError:c=>{o(q(c))}})})};return i.isPending?e.jsx(b,{children:"Loading Courses"}):i.isError?e.jsx(b,{children:"An error has occurred!"}):e.jsxs(e.Fragment,{children:[e.jsx(V,{subheader:e.jsxs(ae,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsx(S,{primary:"Assign Courses",secondary:"List of assigned courses",primaryTypographyProps:{fontSize:18,color:"var(--secondary)"},sx:{py:2}}),e.jsx(M,{title:"Refresh Courses",children:e.jsx(N,{onClick:i.refetch,children:e.jsx(oe,{})})}),e.jsx(W,{})]}),sx:{pt:4},children:((p=i==null?void 0:i.data)==null?void 0:p.length)>0?(h=i==null?void 0:i.data)==null?void 0:h.map(t=>e.jsxs(le,{divider:!0,children:[e.jsx(S,{primary:t==null?void 0:t.level}),e.jsx(S,{primary:t==null?void 0:t.subject}),e.jsx(ce,{children:e.jsxs(L,{title:"Remove Course",color:"error",size:"small",endIcon:e.jsx(Y,{}),onClick:()=>C(t==null?void 0:t._id),children:[" ","Remove"]})})]},t==null?void 0:t._id)):e.jsx(b,{textAlign:"center",children:"No Course Available"})}),j&&e.jsx(F,{value:"Removing Course.Please wait..."})]})}const me=()=>{const{schoolSessionDispatch:x}=u.useContext(P),{userState:{session:o}}=u.useContext(w),m=k(),[l,i]=u.useState(""),[r,j]=u.useState({_id:"",type:""}),C={currentLevel:r,subject:l},{levelsOption:p,levelLoading:h}=ee(),{subjects:t,levelLoading:y}=se(r==null?void 0:r._id),{id:c}=_(),{mutateAsync:z,isPending:v}=D({mutationFn:re}),O=(n,d)=>{var g;const f={session:o==null?void 0:o.sessionId,term:o==null?void 0:o.termId,teacher:c,level:(g=n==null?void 0:n.currentLevel)==null?void 0:g._id,subject:n==null?void 0:n.subject};z(f,{onSettled:()=>{m.invalidateQueries(["courses",c]),d.setSubmitting(!1)},onSuccess:s=>{x(E(s)),d.resetForm()},onError:s=>{x(q(s))}})};return e.jsxs(K,{children:[e.jsx(te,{to:`/teacher/${c}`,color:"primary.main"}),e.jsx(U,{title:"Course Allocation Management",subtitle:" Assign courses to teachers, ensuring that everyone is aware of their responsibilities and schedules.",color:"primary.main"}),e.jsx(X,{initialValues:C,validationSchema:G,onSubmit:O,enableReinitialize:!0,children:({errors:n,touched:d,handleSubmit:f,handleReset:g})=>e.jsx(e.Fragment,{children:e.jsxs(J,{sx:{mt:4,py:4,px:2,border:"1px solid lightgray",bgcolor:"#fff"},children:[e.jsxs(Z,{spacing:3,children:[e.jsx(B,{size:"small",options:p,loading:h,loadingText:"Loading levels.Please wait...",getOptionLabel:s=>(s==null?void 0:s.type)||"",isOptionEqualToValue:(s,a)=>a._id===void 0||a._id===""||a._id===s._id,value:r,onChange:(s,a)=>{j(a),i("")},renderInput:s=>{var a,T,A,I;return e.jsx(R,{...s,label:"Select a level",error:!!((a=d.currentLevel)!=null&&a.type&&((T=n.currentLevel)!=null&&T.type)),helperText:((A=d.currentLevel)==null?void 0:A.type)&&((I=n.currentLevel)==null?void 0:I.type)})},sx:{marginY:2}}),e.jsx(B,{freeSolo:!0,fullWidth:!0,noOptionsText:"No subject available",loading:y,loadingText:"Please Wait...",options:t||[],closeText:" ",getOptionLabel:s=>s||"",value:l,onChange:(s,a)=>i(a),renderInput:s=>e.jsx(R,{...s,label:"Select Subject",size:"small",error:!!(d.subject&&n.subject),helperText:d.subject&&n.subject})})]}),e.jsxs(de,{children:[e.jsx(L,{onClick:g,children:"Cancel"}),e.jsx(L,{loading:v,variant:"contained",onClick:f,disabled:(r==null?void 0:r._id)===""&&(t==null?void 0:t.length)===0,children:"Assign Course"})]})]})})}),e.jsx(ue,{}),v&&e.jsx(F,{value:"Assigning Course.Please wait..."})]})},Ae=H.memo(me);export{Ae as default};
