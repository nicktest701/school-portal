import{b as y,r as o,S as C,a as L,c as A,d as B,j as e,e as I,M as E,l as _,m as l,T as w,B as T,L as k,E as q,_ as p,g as P,h as Q,ah as F}from"./index-ce442eb1.js";import{d as O}from"./SaveAltRounded-00a2bcdd.js";import{L as z,g as M}from"./subjectAPI-48d20281.js";import{u as R}from"./useLevelById-e09284f0.js";import{B as D}from"./Back-78662289.js";import{A as K,L as W}from"./Autocomplete-87c4b1e1.js";import"./DeleteOutline-78b9d3f1.js";import"./ListItem-2727fabf.js";import"./listItemButtonClasses-c7063ebe.js";import"./ListItemSecondaryAction-660d9daa.js";import"./ListItemText-b107adf9.js";import"./Chip-15117b24.js";const re=()=>{const i=y(),{schoolSessionDispatch:c}=o.useContext(C),[r,$]=L(),[u,d]=o.useState([]),[s,n]=o.useState([]),{subjects:m,levelLoading:j}=R(r.get("_id")),h=A({queryKey:["subjects"],queryFn:()=>M(),select:t=>p.map(t,"name")});o.useEffect(()=>{n(m)},[r.get("_id"),m]);const S=()=>{const t=p.uniq([...s,...u]);n(t),d([])},x=t=>{n(a=>a.filter(v=>v!==t))},{mutateAsync:b,isLoading:f}=B(F),g=()=>{const t={levelId:r.get("_id"),subjects:s};b(t,{onSettled:()=>{i.invalidateQueries(["subjects"]),i.invalidateQueries(["level",r.get("_id")])},onSuccess:a=>{c(P(a))},onError:a=>{c(Q(a))}})};return e.jsxs(e.Fragment,{children:[e.jsx(D,{to:"/level",color:"primary.main"}),e.jsx(I,{title:`Current Courses for ${r.get("type")}`,subtitle:"Add new subjects to the current level",color:"primary.main"}),e.jsxs(E,{children:[e.jsxs(_,{spacing:2,py:6,width:"100%",justifyContent:"center",alignItems:"flex-start",children:[e.jsx(l,{variant:"h6",children:"Please select one or multiple courses"}),e.jsx(K,{multiple:!0,freeSolo:!0,fullWidth:!0,options:h.data??[],disableCloseOnSelect:!0,getOptionLabel:t=>t||"",value:u,onChange:(t,a)=>d(a),renderInput:t=>e.jsx(w,{...t,label:"Select Course",size:"small",focused:!0})}),e.jsx(T,{variant:"contained",size:"small",onClick:S,sx:{px:4,py:2,alignSelf:"flex-end"},children:"Add Course"})]}),e.jsxs(k,{sx:{height:400,p:2,mt:4,overflow:"auto",bgcolor:"#fff"},subheader:e.jsxs(W,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsxs(l,{variant:"h4",children:[s.length," Course(s) Available"]}),e.jsx(q,{startIcon:e.jsx(O,{}),loading:f,variant:"contained",onClick:g,disabled:(s==null?void 0:s.length)===0,children:"Save Courses"})]}),children:[j&&e.jsx(l,{variant:"h6",children:"Loading.... "}),s==null?void 0:s.map(t=>e.jsx(z,{name:t,removeSubject:x},t))]})]})]})};export{re as default};
