import{b as O,u as Q,i as R,r as b,S as M,c as $,n as z,d as U,j as l,Y as q,C as Y,e as _,D as G,y as K,Z as V,M as Z,l as D,A as H,m as J,T as p,$ as L,B as X,E as c,Q as v,g as I,h as N}from"./index-ce442eb1.js";import{g as h,p as u}from"./teacherAPI-30a6d8ad.js";import{C as j}from"./CustomFormControl-7bbced0e.js";import{u as r}from"./sessionAPI-c946b457.js";import{C as aa}from"./CustomDatePicker-0001e585.js";import{T as ia,N as na}from"./nationality-728e96f8.js";import{C as la}from"./CustomImageChooser-841df1e5.js";import{B as ta}from"./Back-78662289.js";import{A as w}from"./Autocomplete-87c4b1e1.js";import{D as ea}from"./DialogActions-c9d7df2e.js";import"./AdapterMoment-20f157db.js";import"./useMediaQuery-5bcb3f64.js";import"./InputAdornment-92a613d9.js";import"./ListItem-2727fabf.js";import"./listItemButtonClasses-c7063ebe.js";import"./ListItemSecondaryAction-660d9daa.js";import"./Chip-15117b24.js";const ma=()=>{var W;const f=O(),A=Q(),{id:m}=R(),[T,C]=b.useState(null),[E,S]=b.useState(null),{schoolSessionDispatch:g}=b.useContext(M),t=$({queryKey:["teacher",m],queryFn:()=>h(m),initialData:(W=f.getQueryData(["teachers",m]))==null?void 0:W.find(n=>(n==null?void 0:n._id)===m),enabled:!!m});b.useEffect(()=>{var n,a;C(z((n=t==null?void 0:t.data)==null?void 0:n.dateofbirth)),S(`https://school-portal-aivn.onrender.com/api/frebbys/v1/images/users/${(a=t==null?void 0:t.data)==null?void 0:a.profile}`)},[t==null?void 0:t.data]);const{mutateAsync:d,isLoading:o}=U({mutationFn:u}),P=n=>{n==null||delete n.profile,n.dateofbirth=z(T).format("L"),d(n,{onSettled:()=>{f.invalidateQueries(["teachers"]),f.invalidateQueries(["teacher",m])},onSuccess:a=>{g(I(a)),B()},onError:a=>{g(N(a))}})},k=async n=>{var x;const a=(x=n.target)==null?void 0:x.files[0],i={_id:m,profile:a,type:"teachers"};try{const e=await r(i);g(I(e)),S(URL.createObjectURL(a))}catch(e){g(N(e))}f.invalidateQueries(["teachers"])},B=()=>{A(`/teacher/${m}`)};return t!=null&&t.isLoading?l.jsx(q,{}):l.jsxs(Y,{children:[l.jsx(ta,{to:`/teacher/${m}`,color:"primary.main"}),l.jsx(_,{title:"Edit Teacher",subtitle:"Manage teachers profile",color:"primary.main"}),l.jsx(G,{}),l.jsx(K,{initialValues:t==null?void 0:t.data,onSubmit:P,enableReinitialize:!0,validationSchema:V,children:({values:n,errors:a,touched:i,setFieldValue:x,handleChange:e,handleSubmit:F})=>l.jsx(l.Fragment,{children:l.jsx(Z,{sx:{bgcolor:"#fff"},children:l.jsxs(D,{padding:2,spacing:1,children:[l.jsx(D,{alignSelf:"center",children:l.jsx(la,{handleImageUpload:k,children:l.jsx(H,{srcSet:E,sx:{width:100,height:100,alignSelf:"center"}})})}),l.jsx(J,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),l.jsxs(j,{children:[l.jsx(p,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:(n==null?void 0:n.firstname)||"",onChange:e("firstname"),error:!!(i!=null&&i.firstname&&(a!=null&&a.firstname)),helperText:(i==null?void 0:i.firstname)&&(a==null?void 0:a.firstname)}),l.jsx(p,{label:"Surname",fullWidth:!0,size:"small",value:(n==null?void 0:n.surname)||"",onChange:e("surname"),error:!!(i!=null&&i.surname&&(a!=null&&a.surname)),helperText:(i==null?void 0:i.surname)&&(a==null?void 0:a.surname)})]}),l.jsx(p,{label:"Username",fullWidth:!0,size:"small",value:(n==null?void 0:n.username)||"",onChange:e("username"),error:!!(i!=null&&i.username&&(a!=null&&a.username)),helperText:(i==null?void 0:i.username)&&(a==null?void 0:a.username)}),l.jsxs(j,{children:[l.jsx(aa,{label:"Date of Birth",date:T,setDate:C,disableFuture:!0,touched:!!(i!=null&&i.dateofbirth&&(a!=null&&a.dateofbirth)),error:(i==null?void 0:i.dateofbirth)&&(a==null?void 0:a.dateofbirth)}),l.jsxs(p,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(n==null?void 0:n.gender)||"",onChange:e("gender"),error:!!(i!=null&&i.gender&&(a!=null&&a.gender)),helperText:(i==null?void 0:i.gender)&&(a==null?void 0:a.gender),children:[l.jsx(L,{value:"male",children:"male"}),l.jsx(L,{value:"female",children:"female"})]})]}),l.jsxs(j,{children:[l.jsx(p,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(n==null?void 0:n.email)||"",onChange:e("email"),error:!!(i!=null&&i.email&&(a!=null&&a.email)),helperText:(i==null?void 0:i.email)&&(a==null?void 0:a.email)}),l.jsx(p,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(n==null?void 0:n.phonenumber)||"",onChange:e("phonenumber"),error:!!(i!=null&&i.phonenumber&&(a!=null&&a.phonenumber)),helperText:(i==null?void 0:i.phonenumber)&&(a==null?void 0:a.phonenumber)})]}),l.jsx(p,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(n==null?void 0:n.address)||"",onChange:e("address"),error:!!(i!=null&&i.address&&(a!=null&&a.address)),helperText:(i==null?void 0:i.address)&&(a==null?void 0:a.address)}),l.jsxs(j,{children:[l.jsx(w,{freeSolo:!0,fullWidth:!0,size:"small",options:ia,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:s=>s||"",value:(n==null?void 0:n.residence)||"",onChange:(s,y)=>x("residence",y),renderInput:s=>l.jsx(p,{...s,label:"Residence",fullWidth:!0,size:"small",error:!!(i!=null&&i.residence&&(a!=null&&a.residence)),helperText:(i==null?void 0:i.residence)&&(a==null?void 0:a.residence)})}),l.jsx(w,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:na,noOptionsText:"No Nationality available",getOptionLabel:s=>s||"",value:(n==null?void 0:n.nationality)||"",onChange:(s,y)=>x("nationality",y),renderInput:s=>l.jsx(p,{...s,label:"Nationality",fullWidth:!0,size:"small",error:!!(i!=null&&i.nationality&&(a!=null&&a.nationality)),helperText:(i==null?void 0:i.nationality)&&(a==null?void 0:a.nationality)})})]}),l.jsxs(ea,{children:[l.jsx(X,{onClick:B,children:"Cancel"}),l.jsx(c,{loading:o,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:F,children:"Save Changes"})]})]})})})}),o&&l.jsx(v,{value:"Saving Changes.."})]})};ma.propTypes={};export{ma as default};
