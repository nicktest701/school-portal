import{b as d,u as Q,i as $,r as b,S as M,c as U,m as z,d as q,j as l,Z as _,C as G,e as H,D as K,x as V,$ as Y,P as Z,k as D,A as J,l as X,T as p,a0 as P,B as I,H as c,g as N,h as w}from"./index-B8PQHtjc.js";import{g as v,p as h}from"./teacherAPI-DE1r2ugK.js";import{C as j}from"./CustomFormControl-Duiznp8E.js";import{u}from"./sessionAPI-C-E5-YJ-.js";import{C as r}from"./CustomDatePicker-_ngoDY-2.js";import{T as ii,N as ai}from"./nationality-Dhsqpti8.js";import{C as ni}from"./CustomImageChooser-CGe9XgpC.js";import{B as li}from"./Back-D8wcFeGb.js";import{A}from"./Autocomplete-Dw57Ihk7.js";import{D as ti}from"./DialogActions-BmNk8sop.js";import"./AdapterMoment-BOypM_74.js";import"./index-BqG4A_N5.js";import"./useThemeProps-CEPKeDia.js";import"./generateUtilityClasses-BPC_uuYP.js";import"./createTheme-DxYQS8Dz.js";import"./createStyled-CJd69Mvg.js";import"./InputAdornment-DAOlZ4uj.js";import"./ListItem-CQImyTSy.js";import"./ListItemSecondaryAction-DOVMjMKm.js";import"./listItemButtonClasses-DySKLRoc.js";import"./Chip-DmEpgF7y.js";const ei=()=>{var W;const f=d(),k=Q(),{id:m}=$(),[T,C]=b.useState(null),[E,S]=b.useState(null),{schoolSessionDispatch:g}=b.useContext(M),t=U({queryKey:["teacher",m],queryFn:()=>v(m),initialData:(W=f.getQueryData(["teachers",m]))==null?void 0:W.find(n=>(n==null?void 0:n._id)===m),enabled:!!m});b.useEffect(()=>{var n,i;C(z((n=t==null?void 0:t.data)==null?void 0:n.dateofbirth)),S(`/images/users/${(i=t==null?void 0:t.data)==null?void 0:i.profile}`)},[t==null?void 0:t.data]);const{mutateAsync:L,isPending:o}=q({mutationFn:h}),F=n=>{n==null||delete n.profile,n.dateofbirth=z(T).format("L"),L(n,{onSettled:()=>{f.invalidateQueries(["teachers"]),f.invalidateQueries(["teacher",m])},onSuccess:i=>{g(N(i)),B()},onError:i=>{g(w(i))}})},O=async n=>{var x;const i=(x=n.target)==null?void 0:x.files[0],a={_id:m,profile:i,type:"teachers"};try{const e=await u(a);g(N(e)),S(URL.createObjectURL(i))}catch(e){g(w(e))}f.invalidateQueries(["teachers"])},B=()=>{k(`/teacher/${m}`)};return t!=null&&t.isPending?l.jsx(_,{}):l.jsxs(G,{children:[l.jsx(li,{to:`/teacher/${m}`,color:"primary.main"}),l.jsx(H,{title:"Edit Teacher",subtitle:"Manage teachers profile",color:"primary.main"}),l.jsx(K,{}),l.jsx(V,{initialValues:t==null?void 0:t.data,onSubmit:F,enableReinitialize:!0,validationSchema:Y,children:({values:n,errors:i,touched:a,setFieldValue:x,handleChange:e,handleSubmit:R})=>l.jsx(l.Fragment,{children:l.jsx(Z,{sx:{bgcolor:"#fff"},children:l.jsxs(D,{padding:2,spacing:1,children:[l.jsx(D,{alignSelf:"center",children:l.jsx(ni,{handleImageUpload:O,children:l.jsx(J,{srcSet:E,sx:{width:100,height:100,alignSelf:"center"}})})}),l.jsx(X,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),l.jsxs(j,{children:[l.jsx(p,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:(n==null?void 0:n.firstname)||"",onChange:e("firstname"),error:!!(a!=null&&a.firstname&&(i!=null&&i.firstname)),helperText:(a==null?void 0:a.firstname)&&(i==null?void 0:i.firstname)}),l.jsx(p,{label:"Surname",fullWidth:!0,size:"small",value:(n==null?void 0:n.surname)||"",onChange:e("surname"),error:!!(a!=null&&a.surname&&(i!=null&&i.surname)),helperText:(a==null?void 0:a.surname)&&(i==null?void 0:i.surname)})]}),l.jsx(p,{label:"Username",fullWidth:!0,size:"small",value:(n==null?void 0:n.username)||"",onChange:e("username"),error:!!(a!=null&&a.username&&(i!=null&&i.username)),helperText:(a==null?void 0:a.username)&&(i==null?void 0:i.username)}),l.jsxs(j,{children:[l.jsx(r,{label:"Date of Birth",date:T,setDate:C,disableFuture:!0,touched:!!(a!=null&&a.dateofbirth&&(i!=null&&i.dateofbirth)),error:(a==null?void 0:a.dateofbirth)&&(i==null?void 0:i.dateofbirth)}),l.jsxs(p,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(n==null?void 0:n.gender)||"",onChange:e("gender"),error:!!(a!=null&&a.gender&&(i!=null&&i.gender)),helperText:(a==null?void 0:a.gender)&&(i==null?void 0:i.gender),children:[l.jsx(P,{value:"male",children:"male"}),l.jsx(P,{value:"female",children:"female"})]})]}),l.jsxs(j,{children:[l.jsx(p,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(n==null?void 0:n.email)||"",onChange:e("email"),error:!!(a!=null&&a.email&&(i!=null&&i.email)),helperText:(a==null?void 0:a.email)&&(i==null?void 0:i.email)}),l.jsx(p,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(n==null?void 0:n.phonenumber)||"",onChange:e("phonenumber"),error:!!(a!=null&&a.phonenumber&&(i!=null&&i.phonenumber)),helperText:(a==null?void 0:a.phonenumber)&&(i==null?void 0:i.phonenumber)})]}),l.jsx(p,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(n==null?void 0:n.address)||"",onChange:e("address"),error:!!(a!=null&&a.address&&(i!=null&&i.address)),helperText:(a==null?void 0:a.address)&&(i==null?void 0:i.address)}),l.jsxs(j,{children:[l.jsx(A,{freeSolo:!0,fullWidth:!0,size:"small",options:ii,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:s=>s||"",value:(n==null?void 0:n.residence)||"",onChange:(s,y)=>x("residence",y),renderInput:s=>l.jsx(p,{...s,label:"Residence",fullWidth:!0,size:"small",error:!!(a!=null&&a.residence&&(i!=null&&i.residence)),helperText:(a==null?void 0:a.residence)&&(i==null?void 0:i.residence)})}),l.jsx(A,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:ai,noOptionsText:"No Nationality available",getOptionLabel:s=>s||"",value:(n==null?void 0:n.nationality)||"",onChange:(s,y)=>x("nationality",y),renderInput:s=>l.jsx(p,{...s,label:"Nationality",fullWidth:!0,size:"small",error:!!(a!=null&&a.nationality&&(i!=null&&i.nationality)),helperText:(a==null?void 0:a.nationality)&&(i==null?void 0:i.nationality)})})]}),l.jsxs(ti,{children:[l.jsx(I,{onClick:B,children:"Cancel"}),l.jsx(I,{loading:o,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:R,children:"Save Changes"})]})]})})})}),o&&l.jsx(c,{value:"Saving Changes.."})]})};ei.propTypes={};export{ei as default};
