import{U as N,g as R,r as m,f as L,aB as F,h as y,i as O,j as e,k as P,l as k,n as U,f7 as M,m as Q,S as T,Y as q,A as Y,T as G,b as i,Z as p,p as V,q as Z,s as C,t as W}from"./index-bb65b4bf.js";import{c as $}from"./studentAPI-ce3a75c6.js";import{C as H}from"./CustomDatePicker-05a8aa06.js";import{T as J,N as K}from"./nationality-728e96f8.js";import{M as B}from"./MenuItem-1edcf8db.js";import{A as z}from"./Autocomplete-95da27f3.js";import"./useMediaQuery-5f0ec7e9.js";import"./InputAdornment-321f8206.js";import"./ListItem-befde9c4.js";import"./listItemButtonClasses-9702db06.js";import"./ListItemSecondaryAction-c66bb893.js";import"./Chip-fa36c3a1.js";import"./listItemTextClasses-35ff90f6.js";const I=()=>{const x=R(),[c,b]=m.useState(null),[g,j]=m.useState(null),{schoolSessionDispatch:d}=m.useContext(L),{studentState:{editStudentData:u},studentDispatch:v}=m.useContext(F),o=u==null?void 0:u.data;m.useEffect(()=>{b(y(o==null?void 0:o.dateofbirth)),j(o==null?void 0:o.profile)},[o]);const S=()=>{v({type:"editStudent",payload:{open:!1,data:{}}})},{mutateAsync:D,isLoading:A}=O({mutationFn:$}),E=n=>{n.dateofbirth=y(c).format("L"),n.profile=g,D(n,{onSettled:()=>{x.invalidateQueries(["student-profile"])},onSuccess:t=>{d(C(t)),S()},onError:t=>{d(W(t))}})},w=async n=>{var a;const t=(a=n.target)==null?void 0:a.files[0];try{const r=new FileReader;r.onload=function(l){const f=l.target.result;j(f),d(C("Photo Updated"))},r.readAsDataURL(t)}catch(r){d(W(r))}x.invalidateQueries(["students"]),x.invalidateQueries(["student-by-id"])};return e.jsxs(P,{open:u.open,maxWidth:"md",fullWidth:!0,children:[e.jsx(k,{title:"Edit Student Information",onClose:S}),e.jsx(U,{initialValues:o,onSubmit:E,enableReinitialize:!0,validationSchema:M,children:({values:n,errors:t,touched:a,setFieldValue:r,handleChange:l,handleSubmit:f})=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{sx:{display:"flex",justifyContent:"center"},children:e.jsxs(T,{padding:2,spacing:1,children:[e.jsx(T,{alignSelf:"center",children:e.jsx(q,{handleImageUpload:w,children:e.jsx(Y,{srcSet:g,sx:{width:100,height:100,alignSelf:"center"}})})}),e.jsx(G,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),e.jsx(i,{label:"Student ID",type:"text",sx:{maxWidth:300},size:"small",value:n.indexnumber,onChange:l("indexnumber"),error:!!(a.indexnumber&&t.indexnumber),helperText:a.indexnumber&&t.indexnumber}),e.jsxs(p,{children:[e.jsx(i,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:n.firstname||"",onChange:l("firstname"),error:!!(a.firstname&&t.firstname),helperText:a.firstname&&t.firstname}),e.jsx(i,{label:"Surname",fullWidth:!0,size:"small",value:n.surname||"",onChange:l("surname"),error:!!(a.surname&&t.surname),helperText:a.surname&&t.surname}),e.jsx(i,{label:"Othername",fullWidth:!0,size:"small",value:n.othername||"",onChange:l("othername"),error:!!(a.othername&&t.othername),helperText:a.othername&&t.othername})]}),e.jsxs(p,{children:[e.jsx(H,{label:"Date of Birth",date:c,setDate:b,disableFuture:!0,error:!!(a.dateofbirth&&t.dateofbirth),helperText:a.dateofbirth&&t.dateofbirth}),e.jsxs(i,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:n.gender||"",onChange:l("gender"),error:!!(a.gender&&t.gender),helperText:a.gender&&t.gender,children:[e.jsx(B,{value:"male",children:"male"}),e.jsx(B,{value:"female",children:"female"})]})]}),e.jsxs(p,{children:[e.jsx(i,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:n.email||"",onChange:l("email"),error:!!(a.email&&t.email),helperText:a.email&&t.email}),e.jsx(i,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:n.phonenumber||"",onChange:l("phonenumber"),error:!!(a.phonenumber&&t.phonenumber),helperText:a.phonenumber&&t.phonenumber})]}),e.jsx(i,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:n.address||"",onChange:l("address"),error:!!(a.address&&t.address),helperText:a.address&&t.address}),e.jsxs(p,{children:[e.jsx(z,{freeSolo:!0,fullWidth:!0,size:"small",options:J,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:s=>s||"",value:n.residence||"",onChange:(s,h)=>r("residence",h),renderInput:s=>e.jsx(i,{...s,label:"Residence",fullWidth:!0,size:"small",error:!!(a.residence&&t.residence),helperText:a.residence&&t.residence})}),e.jsx(z,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:K,noOptionsText:"No Nationality available",getOptionLabel:s=>s||"",value:n.nationality||"",onChange:(s,h)=>r("nationality",h),renderInput:s=>e.jsx(i,{...s,label:"Nationality",fullWidth:!0,size:"small",error:!!(a.nationality&&t.nationality),helperText:a.nationality&&t.nationality})})]})]})}),e.jsx(V,{children:e.jsx(Z,{loading:A,variant:"contained",color:"primary",onClick:f,children:"Save Changes"})})]})})]})};I.propTypes={};const ue=N.memo(I);export{ue as default};
