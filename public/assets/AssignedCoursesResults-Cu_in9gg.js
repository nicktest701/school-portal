import{r as b,a1 as C,S as j,b as y,d as f,j as e,t as R,v as I,w as T,x as k,ao as B,k as v,T as g,B as h,H as E,g as N,h as P,n as Q,a as $,u as A,i as F,c as _,N as L,P as z,e as M,l as U}from"./index-B8PQHtjc.js";import{S as q}from"./School-F8mJoAwr.js";import{s as O}from"./student_ico-BGUw5C9J.js";import{B as V}from"./Back-D8wcFeGb.js";import{C as W}from"./CustomizedMaterialTable-BQoTtwVw.js";import{b as G}from"./studentColumns-mOrPrRKB.js";import{u as H,i as K}from"./ExaminationAPI-gfcTwHm9.js";import{u as Y}from"./useLevelById-K7PyoswH.js";import{g as J}from"./generateCustomGrade-DQ-rrl9K.js";import"./TabPanel-WHfZdNAn.js";import"./useThemeProps-CEPKeDia.js";import"./Toolbar-YM__bEFh.js";import"./Chip-DmEpgF7y.js";import"./Autocomplete-Dw57Ihk7.js";import"./Skeleton-DWRiBFRT.js";import"./ButtonGroup-ZC3qSltg.js";import"./ListItemText-DzMM1D1F.js";import"./InputAdornment-DAOlZ4uj.js";import"./index-BqG4A_N5.js";import"./DialogActions-BmNk8sop.js";import"./ListItem-CQImyTSy.js";import"./ListItemSecondaryAction-DOVMjMKm.js";import"./listItemButtonClasses-DySKLRoc.js";import"./Grid2-B2FVLpOz.js";import"./Link-kLE4_HTq.js";import"./ListItemButton-Di0YOqWQ.js";import"./Check-JB41DPzl.js";import"./DeleteOutline-BlPFLwFk.js";import"./images-B5fNBSni.js";import"./gradeColor-B1MTvGsq.js";import"./CircleRounded-YWo57tpF.js";function X(){const{userState:{session:r}}=b.useContext(C),{schoolSessionState:{addStudentResults:{open:i,data:a,grade:p}},schoolSessionDispatch:c}=b.useContext(j),o=y(),{mutateAsync:x,isPending:n}=f({mutationFn:H}),S=s=>{const t=Number(s.classScore)+Number(s.examsScore),d=J(t,p),m={session:{sessionId:r==null?void 0:r.sessionId,termId:r==null?void 0:r.termId,levelId:r==null?void 0:r.levelId,studentId:s==null?void 0:s._id},scores:[{subject:s==null?void 0:s.subject,classScore:s==null?void 0:s.classScore,examsScore:s==null?void 0:s.examsScore,...d}]};x(m,{onSettled:()=>{o.invalidateQueries(["student-records"]),o.invalidateQueries(["exams-scores"]),o.invalidateQueries(["exams-details"]),o.invalidateQueries(["exams-reports"]),o.invalidateQueries(["exams-by-id"]),o.invalidateQueries(["subject-score"])},onSuccess:u=>{c(N(u)),l()},onError:u=>{c(P(u))}})},l=()=>{c({type:"addStudentResults",payload:{open:!1,data:{_id:"",level:"",classScore:"",examsScore:"",totalScore:"",grade:"",remarks:""},grade:p}})};return e.jsxs(R,{open:i,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(I,{title:"Add Record",onClose:l}),e.jsx(T,{children:e.jsx(k,{initialValues:a,validationSchema:B,onSubmit:S,children:({values:s,errors:t,touched:d,handleChange:m,handleSubmit:u})=>e.jsx(e.Fragment,{children:e.jsxs(v,{spacing:2,paddingY:2,children:[e.jsx(g,{label:"Subject",size:"small",value:s.subject,onChange:m("subject"),error:!!t.subject,helperText:d.subject&&t.subject}),e.jsx(g,{type:"number",label:"Class Score",size:"small",value:s.classScore,onChange:m("classScore"),error:!!t.classScore,helperText:d.classScore&&t.classScore}),e.jsx(g,{type:"number",label:"Exams Score",size:"small",value:s.examsScore,onChange:m("examsScore"),error:!!t.examsScore,helperText:d.examsScore&&t.examsScore}),e.jsx(h,{loading:n,variant:"contained",onClick:u,children:"Save Record"})]})})})}),n&&e.jsx(E,{value:"Saving Record..."})]})}function ve(){const{schoolSessionDispatch:r}=b.useContext(j),{state:i}=Q(),[a]=$(),p=A(),{level:c,levelId:o}=F(),{gradeSystem:x}=Y(o),n=_({queryKey:["subject-score",o,a.get("sub")],queryFn:()=>K({id:o,subject:a.get("sub")}),enabled:!!o&&!!a.get("sub")}),S=()=>{p(`/examination/level/${o}/${c}/upload?sub=${a.get("sub")}`,{state:{prevPath:`/course/assign/${o}/${c}?sub=${a.get("sub")}`}})},l=t=>{r({type:"addStudentResults",payload:{open:!0,data:{_id:t==null?void 0:t._id,indexnumber:t==null?void 0:t.indexnumber,levelId:i==null?void 0:i.id,...t==null?void 0:t.course},grade:x}})};if(!o&&!a.get("sub"))return e.jsx(L,{to:"/course/assign"});const s=[...G,{field:null,title:"Action",render:t=>e.jsx(h,{variant:"outlined",onClick:()=>l(t),children:"Add Record"})}];return e.jsxs(e.Fragment,{children:[e.jsx(V,{to:"/course/assign",color:"primary.main"}),e.jsxs(z,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1,pr:2},children:[e.jsx(M,{title:"Manage Student Records",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(q,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(U,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:i==null?void 0:i.type})]}),e.jsx(W,{search:!0,isPending:n.isPending,title:i==null?void 0:i.type,subtitle:a.get("sub"),exportFileName:`${c}-${a.get("sub")}`||"",columns:s,data:n.data,actions:[],icon:O,handleRefresh:n==null?void 0:n.refetch,autoCompleteComponent:e.jsx(h,{variant:"contained",onClick:S,children:"Import Records"})}),e.jsx(X,{})]})}export{ve as default};
