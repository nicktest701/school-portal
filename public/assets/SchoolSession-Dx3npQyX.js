import{j as e,m as y,T as D,r as a,S as w,b as W,d as q,s as P,aj as V,t as $,w as z,fd as B,v as L,k as b,F as M,$ as A,D as Q,y as _,g as H,h as G,a0 as J,u as K,c as U,_ as X,N as Z,C as ee,B as v,aw as te,o as se,l as I}from"./index-DrgqF6h7.js";import{e as ae,g as re}from"./termAPI-DNGsRUlD.js";import{s as oe}from"./initialValues-D0lDlXZC.js";import{g as F,A as ne}from"./sessionColumns-0BrYivn4.js";import{C as E}from"./CustomDatePicker-D2bLCilT.js";import{D as Y}from"./react-datetime-JdjBJT77.js";import{D as ie}from"./DialogActions-Cx2GHHEW.js";import{A as le}from"./Autocomplete-D4vPEd6T.js";import"./currencyFormatter-DjBDW3hY.js";import"./CircleRounded-Bh8WmZqU.js";import"./ListItemText-Bwh_rzOL.js";import"./Chip-BcLQNplL.js";import"./AdapterMoment-Dv21LUiO.js";import"./index-_n9xtSlI.js";import"./useThemeProps-DLRF2U3R.js";import"./generateUtilityClasses-CIQngnWt.js";import"./createTheme-xb4osIQ4.js";import"./createStyled-CRj7xEq5.js";import"./InputAdornment-EcTjtcuD.js";import"./ListItem-yCsexoBs.js";import"./ListItemSecondaryAction-mmiMbVqP.js";import"./listItemButtonClasses-CLhmtlXH.js";const ce=Y.default?Y.default:Y,k=({label:m,year:d,setYear:s})=>e.jsx(ce,{dateFormat:"YYYY",timeFormat:!1,value:d,initialValue:y().format("YYYY"),onChange:i=>s(i.format("YYYY")),closeOnSelect:!0,renderInput:i=>e.jsx(D,{...i,label:m,size:"small",fullWidth:!0})}),me=({open:m,setOpen:d})=>{const{schoolSessionDispatch:s}=a.useContext(w),i=W(),[x,h]=a.useState(y()),[u,S]=a.useState(y()),[o,f]=a.useState(""),[l,g]=a.useState(""),{mutateAsync:j}=q({mutationFn:ae}),t=new Date().getFullYear(),r=(p,c)=>{p.academicYear=`${o||t}/${l||t}`,j(p,{onSettled:()=>{c.setSubmitting(!1),i.invalidateQueries(["terms"])},onSuccess:n=>{s(H(n)),T()},onError:n=>{s(G(n))}}),c.setSubmitting(!1)},T=()=>d(!1);return e.jsxs(P,{open:m,fullWidth:!0,maxWidth:"xs",TransitionComponent:V,children:[e.jsx($,{title:"Add Session",onClose:T}),e.jsx(z,{initialValues:{...oe,from:x.format("l"),to:u.format("l")},onSubmit:r,validationSchema:B,enableReinitialize:!0,children:({values:p,errors:c,touched:n,handleChange:O,handleSubmit:N,isSubmitting:R})=>e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsxs(b,{spacing:2,paddingY:2,children:[e.jsx(M,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(b,{direction:"row",columnGap:2,children:[e.jsx(k,{label:"From",year:o,setYear:f}),e.jsx(k,{label:"To",year:l,setYear:g})]}),e.jsx(E,{label:"Start of Academic Term/Semester",date:x,setDate:h,touched:n.from,error:c.from}),e.jsx(E,{label:"End of Academic Term/Semester",date:u,setDate:S,touched:n.to,error:c.to}),e.jsx(D,{select:!0,label:"Term/Semester",size:"small",value:p.term,onChange:O("term"),error:!!(n.term&&c.term),helperText:n.term&&c.term,children:F.length!==0?F.map(C=>e.jsx(A,{value:C,children:C},C)):e.jsx(A,{children:"No Term Available "})}),e.jsx(Q,{})]})}),e.jsx(ie,{sx:{padding:2},children:e.jsx(_,{loading:R,variant:"contained",onClick:N,children:"Save"})})]})})]})},Oe=()=>{const{schoolSessionDispatch:m}=a.useContext(w),{userDispatch:d,user:s}=a.useContext(J),i=K(),[x,h]=a.useState(!1),[u,S]=a.useState(""),[o,f]=a.useState({termId:"",academicYear:"",term:""}),l=U({queryKey:["terms"],queryFn:()=>re(),select:t=>(s==null?void 0:s.role)==="administrator"?t:t.filter(r=>!r.active)}),g=()=>{if(S(""),o.termId===""){S("Session is Required*");return}m({type:"setCurrentSession",payload:o}),localStorage.setItem("@school_session",JSON.stringify(o)),d({type:"setSession",payload:o}),i("/",{replace:!0})},j=()=>h(!0);return X.isEmpty(s==null?void 0:s.id)?e.jsx(Z,{to:"/login"}):e.jsx(ee,{maxWidth:"xs",sx:{height:"100vh",position:"relative",display:"flex",flexDirection:"column",gap:2,justifyContent:"center",alignItems:"center"},children:e.jsxs(b,{alignItems:"center",spacing:2,sx:{boxShadow:"0 2px 3px rgba(0,0,0,0.1)",p:4},children:[(s==null?void 0:s.role)==="administrator"&&e.jsx(v,{color:"primary",startIcon:e.jsx(te,{}),sx:{mb:4},onClick:j,children:"New School Session"}),e.jsx(se,{sx:{width:80,height:80}}),e.jsx(I,{variant:"h4",sx:{textAlign:"center"},children:"School Portal"}),e.jsx(I,{variant:"body2",paragraph:!0,sx:{textAlign:"center"},children:"Choose a session (academic term/semester) to begin with."}),e.jsx(le,{options:l!=null&&l.data?l.data:[],noOptionsText:"School Session not found",closeText:"",clearText:" ",disableClearable:!0,fullWidth:!0,value:o,onChange:(t,r)=>f(r),isOptionEqualToValue:(t,r)=>r.termId===""||r.termId===void 0||t.termId===r.termId,getOptionLabel:t=>(t==null?void 0:t.termId)!==""?`${t==null?void 0:t.academicYear},${t==null?void 0:t.term}`:"",renderInput:t=>e.jsx(D,{...t,label:"Select School Session",error:u!=="",helperText:u,FormHelperTextProps:{sx:{color:"error.main"}}})}),e.jsx(v,{variant:"contained",endIcon:e.jsx(ne,{}),fullWidth:!0,onClick:g,children:"Continue"}),e.jsx(me,{open:x,setOpen:h})]})})};export{Oe as default};
