import{b as R,r as u,S as _,i as k,a0 as w,c as Q,d as D,j as e,l as b,L as M,ad as V,I as W,D as N,B as F,X as $,Q as E,f as K,g as P,h as q,W as U,C as X,e as Y,w as G,ag as H,M as J,k as Z,T as I,y as ee}from"./index-DrgqF6h7.js";import{u as te}from"./useLevel-C3V49YPJ.js";import{B as se}from"./Back-CADpxW16.js";import{u as ie}from"./useLevelById-C5Sw-_pl.js";import{d as ne,g as re,p as ae}from"./courseAPI-DGDTWiBo.js";import{L as oe,A as B}from"./Autocomplete-D4vPEd6T.js";import{L}from"./ListItemText-Bwh_rzOL.js";import{R as le}from"./RefreshRounded-h_tq9q_G.js";import{L as ce}from"./ListItem-yCsexoBs.js";import{L as de}from"./ListItemSecondaryAction-mmiMbVqP.js";import{D as ue}from"./DialogActions-Cx2GHHEW.js";import"./Chip-BcLQNplL.js";import"./listItemButtonClasses-CLhmtlXH.js";function me(){var p,h;const x=R(),{schoolSessionDispatch:o}=u.useContext(_),{id:m}=k(),{userState:{session:l}}=u.useContext(w),i=Q({queryKey:["courses",m],queryFn:()=>re({teacher:m,session:l==null?void 0:l.sessionId,term:l==null?void 0:l.termId})}),{mutateAsync:r,isLoading:j}=D({mutationFn:ne}),C=t=>{K.fire({title:"Remove",text:"Do you want to revoke course from teacher?",showCancelButton:!0}).then(y=>{y.isConfirmed&&r(t,{onSettled:()=>{x.invalidateQueries(["courses",m])},onSuccess:c=>{o(P(c))},onError:c=>{o(q(c))}})})};return i.isLoading?e.jsx(b,{children:"Loading Courses"}):i.isError?e.jsx(b,{children:"An error has occurred!"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{subheader:e.jsxs(oe,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsx(L,{primary:"Assign Courses",secondary:"List of assigned courses",primaryTypographyProps:{fontSize:18,color:"var(--secondary)"},sx:{py:2}}),e.jsx(V,{title:"Refresh Courses",children:e.jsx(W,{onClick:i.refetch,children:e.jsx(le,{})})}),e.jsx(N,{})]}),sx:{pt:4},children:((p=i==null?void 0:i.data)==null?void 0:p.length)>0?(h=i==null?void 0:i.data)==null?void 0:h.map(t=>e.jsxs(ce,{divider:!0,children:[e.jsx(L,{primary:t==null?void 0:t.level}),e.jsx(L,{primary:t==null?void 0:t.subject}),e.jsx(de,{children:e.jsxs(F,{title:"Remove Course",color:"error",size:"small",endIcon:e.jsx($,{}),onClick:()=>C(t==null?void 0:t._id),children:[" ","Remove"]})})]},t==null?void 0:t._id)):e.jsx(b,{textAlign:"center",children:"No Course Available"})}),j&&e.jsx(E,{value:"Removing Course.Please wait..."})]})}const xe=()=>{const{schoolSessionDispatch:x}=u.useContext(_),{userState:{session:o}}=u.useContext(w),m=R(),[l,i]=u.useState(""),[r,j]=u.useState({_id:"",type:""}),C={currentLevel:r,subject:l},{levelsOption:p,levelLoading:h}=te(),{subjects:t,levelLoading:y}=ie(r==null?void 0:r._id),{id:c}=k(),{mutateAsync:z,isLoading:S}=D({mutationFn:ae}),O=(n,d)=>{var g;const f={session:o==null?void 0:o.sessionId,term:o==null?void 0:o.termId,teacher:c,level:(g=n==null?void 0:n.currentLevel)==null?void 0:g._id,subject:n==null?void 0:n.subject};z(f,{onSettled:()=>{m.invalidateQueries(["courses",c]),d.setSubmitting(!1)},onSuccess:s=>{x(P(s)),d.resetForm()},onError:s=>{x(q(s))}})};return e.jsxs(X,{children:[e.jsx(se,{to:`/teacher/${c}`,color:"primary.main"}),e.jsx(Y,{title:"Course Allocation Management",subtitle:" Assign courses to teachers, ensuring that everyone is aware of their responsibilities and schedules.",color:"primary.main"}),e.jsx(G,{initialValues:C,validationSchema:H,onSubmit:O,enableReinitialize:!0,children:({errors:n,touched:d,handleSubmit:f,handleReset:g})=>e.jsx(e.Fragment,{children:e.jsxs(J,{sx:{mt:4,py:4,px:2,border:"1px solid lightgray",bgcolor:"#fff"},children:[e.jsxs(Z,{spacing:3,children:[e.jsx(B,{size:"small",options:p,loading:h,loadingText:"Loading levels.Please wait...",getOptionLabel:s=>(s==null?void 0:s.type)||"",isOptionEqualToValue:(s,a)=>a._id===void 0||a._id===""||a._id===s._id,value:r,onChange:(s,a)=>{j(a),i("")},renderInput:s=>{var a,v,T,A;return e.jsx(I,{...s,label:"Select a level",error:!!((a=d.currentLevel)!=null&&a.type&&((v=n.currentLevel)!=null&&v.type)),helperText:((T=d.currentLevel)==null?void 0:T.type)&&((A=n.currentLevel)==null?void 0:A.type)})},sx:{marginY:2}}),e.jsx(B,{freeSolo:!0,fullWidth:!0,noOptionsText:"No subject available",loading:y,loadingText:"Please Wait...",options:t||[],closeText:" ",getOptionLabel:s=>s||"",value:l,onChange:(s,a)=>i(a),renderInput:s=>e.jsx(I,{...s,label:"Select Subject",size:"small",error:!!(d.subject&&n.subject),helperText:d.subject&&n.subject})})]}),e.jsxs(ue,{children:[e.jsx(F,{onClick:g,children:"Cancel"}),e.jsx(ee,{loading:S,variant:"contained",onClick:f,disabled:(r==null?void 0:r._id)===""&&(t==null?void 0:t.length)===0,children:"Assign Course"})]})]})})}),e.jsx(me,{}),S&&e.jsx(E,{value:"Assigning Course.Please wait..."})]})},Ie=U.memo(xe);export{Ie as default};
