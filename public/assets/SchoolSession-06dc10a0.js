import{r as a,f as F,g as N,h as A,i as R,j as e,k as W,ag as B,l as L,n as M,eS as P,m as V,S as b,F as $,b as k,D as z,p as H,q as Q,s as _,t as G,a0 as J,H as K,v as U,_ as X,N as Z,C as ee,B as T,a as te,T as D}from"./index-bb65b4bf.js";import{a as se,g as ae}from"./termAPI-7f1eaa7e.js";import{s as re}from"./initialValues-beb81292.js";import{f as v,A as oe}from"./sessionColumns-3b88387c.js";import{C as I}from"./CustomDatePicker-05a8aa06.js";import{C as Y}from"./CustomYearPicker-9b1101d3.js";import{M as E}from"./MenuItem-1edcf8db.js";import{A as ne}from"./Add-66663708.js";import{A as ie}from"./Autocomplete-95da27f3.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-3db5a545.js";import"./Edit-11e1ba9f.js";import"./Delete-97505065.js";import"./ListItemText-33ae0292.js";import"./listItemTextClasses-35ff90f6.js";import"./Chip-fa36c3a1.js";import"./useMediaQuery-5f0ec7e9.js";import"./InputAdornment-321f8206.js";import"./ListItem-befde9c4.js";import"./listItemButtonClasses-9702db06.js";import"./ListItemSecondaryAction-c66bb893.js";const le=({open:h,setOpen:S})=>{const{schoolSessionDispatch:s}=a.useContext(F),p=N(),[m,d]=a.useState(A()),[c,u]=a.useState(A()),[o,g]=a.useState(""),[i,f]=a.useState(""),{mutateAsync:j}=R({mutationFn:se}),t=new Date().getFullYear(),r=(x,l)=>{x.academicYear=`${o||t}/${i||t}`,j(x,{onSettled:()=>{l.setSubmitting(!1),p.invalidateQueries(["terms"])},onSuccess:n=>{s(_(n)),y()},onError:n=>{s(G(n))}}),l.setSubmitting(!1)},y=()=>S(!1);return e.jsxs(W,{open:h,fullWidth:!0,maxWidth:"xs",TransitionComponent:B,children:[e.jsx(L,{title:"Add Session",onClose:y}),e.jsx(M,{initialValues:{...re,from:m.format("l"),to:c.format("l")},onSubmit:r,validationSchema:P,enableReinitialize:!0,children:({values:x,errors:l,touched:n,handleChange:O,handleSubmit:w,isSubmitting:q})=>e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsxs(b,{spacing:2,paddingY:2,children:[e.jsx($,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(b,{direction:"row",columnGap:2,children:[e.jsx(Y,{label:"From",year:o,setYear:g}),e.jsx(Y,{label:"To",year:i,setYear:f})]}),e.jsx(I,{label:"Start of Academic Term/Semester",date:m,setDate:d,touched:n.from,error:l.from}),e.jsx(I,{label:"End of Academic Term/Semester",date:c,setDate:u,touched:n.to,error:l.to}),e.jsx(k,{select:!0,label:"Term/Semester",size:"small",value:x.term,onChange:O("term"),error:!!(n.term&&l.term),helperText:n.term&&l.term,children:v.length!==0?v.map(C=>e.jsx(E,{value:C,children:C},C)):e.jsx(E,{children:"No Term Available "})}),e.jsx(z,{})]})}),e.jsx(H,{sx:{padding:2},children:e.jsx(Q,{loading:q,variant:"contained",onClick:w,children:"Save"})})]})})]})},Fe=()=>{const{schoolSessionDispatch:h}=a.useContext(F),{userDispatch:S,user:s}=a.useContext(J),p=K(),[m,d]=a.useState(!1),[c,u]=a.useState(""),[o,g]=a.useState({termId:"",academicYear:"",term:""}),i=U({queryKey:["terms"],queryFn:()=>ae(),select:t=>(s==null?void 0:s.role)==="administrator"?t:t.filter(r=>!r.active)}),f=()=>{if(u(""),o.termId===""){u("Session is Required*");return}h({type:"setCurrentSession",payload:o}),localStorage.setItem("@school_session",JSON.stringify(o)),S({type:"setSession",payload:o}),p("/",{replace:!0})},j=()=>d(!0);return X.isEmpty(s==null?void 0:s.id)?e.jsx(Z,{to:"/login"}):e.jsx(ee,{maxWidth:"xs",sx:{height:"100vh",position:"relative",display:"flex",flexDirection:"column",gap:2,justifyContent:"center",alignItems:"center"},children:e.jsxs(b,{alignItems:"center",spacing:2,sx:{boxShadow:"0 2px 3px rgba(0,0,0,0.1)",p:4},children:[(s==null?void 0:s.role)==="administrator"&&e.jsx(T,{color:"primary",startIcon:e.jsx(ne,{}),sx:{mb:4},onClick:j,children:"New School Session"}),e.jsx(te,{sx:{width:80,height:80}}),e.jsx(D,{variant:"h4",sx:{textAlign:"center"},children:"School Portal"}),e.jsx(D,{variant:"body2",paragraph:!0,sx:{textAlign:"center"},children:"Choose a session (academic term/semester) to begin with."}),e.jsx(ie,{options:i!=null&&i.data?i.data:[],noOptionsText:"School Session not found",closeText:"",clearText:" ",disableClearable:!0,fullWidth:!0,value:o,onChange:(t,r)=>g(r),isOptionEqualToValue:(t,r)=>r.termId===""||r.termId===void 0||t.termId===r.termId,getOptionLabel:t=>(t==null?void 0:t.termId)!==""?`${t==null?void 0:t.academicYear},${t==null?void 0:t.term}`:"",renderInput:t=>e.jsx(k,{...t,label:"Select School Session",error:c!=="",helperText:c,FormHelperTextProps:{sx:{color:"error.main"}}})}),e.jsx(T,{variant:"contained",endIcon:e.jsx(oe,{}),fullWidth:!0,onClick:f,children:"Continue"}),e.jsx(le,{open:m,setOpen:d})]})})};export{Fe as default};
