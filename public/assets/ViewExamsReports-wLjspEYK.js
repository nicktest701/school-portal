import{p as le,j as d,er as ce,eu as q,r as v,aD as ue,_ as k,fl as J,t as de,e as ee,B as E,w as me,X as he,a1 as pe,S as fe,i as Se,c as ge,d as ve,C as ye,aL as Ie,k as xe,T as Ce,Z as be,l as B,V as H,f as Te}from"./index-B8PQHtjc.js";import{l as we}from"./index-DThQnLGZ.js";import{d as ze,e as Oe}from"./ExaminationAPI-gfcTwHm9.js";import{C as Re,S as Pe}from"./CustomizedMaterialTable-BQoTtwVw.js";import{s as je}from"./images-B5fNBSni.js";import{D as _e}from"./DialogActions-BmNk8sop.js";import{R as V}from"./ReportCard-RdGRC-ge.js";import{B as ke}from"./ButtonGroup-ZC3qSltg.js";import{N as Ee}from"./Note-Dty2gGWL.js";import{I as G}from"./InputAdornment-DAOlZ4uj.js";import"./TabPanel-WHfZdNAn.js";import"./useThemeProps-CEPKeDia.js";import"./Toolbar-YM__bEFh.js";import"./Chip-DmEpgF7y.js";import"./Autocomplete-Dw57Ihk7.js";import"./Skeleton-DWRiBFRT.js";import"./ListItemText-DzMM1D1F.js";import"./index-BqG4A_N5.js";import"./ListItem-CQImyTSy.js";import"./ListItemSecondaryAction-DOVMjMKm.js";import"./listItemButtonClasses-DySKLRoc.js";import"./Grid2-B2FVLpOz.js";import"./Link-kLE4_HTq.js";import"./ListItemButton-Di0YOqWQ.js";import"./Check-JB41DPzl.js";import"./DeleteOutline-BlPFLwFk.js";import"./ReportItemUnderline-MmYFOo6z.js";const Me=le(d.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var K=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function Ne(n,t){return!!(n===t||K(n)&&K(t))}function Ae(n,t){if(n.length!==t.length)return!1;for(var r=0;r<n.length;r++)if(!Ne(n[r],t[r]))return!1;return!0}function F(n,t){t===void 0&&(t=Ae);var r,m=[],c,S=!1;function T(){for(var x=[],y=0;y<arguments.length;y++)x[y]=arguments[y];return S&&r===this&&t(x,m)||(c=n.apply(this,x),S=!0,r=this,m=x),c}return T}var Fe=typeof performance=="object"&&typeof performance.now=="function",Q=Fe?function(){return performance.now()}:function(){return Date.now()};function X(n){cancelAnimationFrame(n.id)}function Le(n,t){var r=Q();function m(){Q()-r>=t?n.call(null):c.id=requestAnimationFrame(m)}var c={id:requestAnimationFrame(m)};return c}var L=-1;function Y(n){if(n===void 0&&(n=!1),L===-1||n){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),L=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return L}var j=null;function Z(n){if(n===void 0&&(n=!1),j===null||n){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var m=document.createElement("div"),c=m.style;return c.width="100px",c.height="100px",t.appendChild(m),document.body.appendChild(t),t.scrollLeft>0?j="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?j="negative":j="positive-ascending"),document.body.removeChild(t),j}return j}var We=150,De=function(t,r){return t};function Ue(n){var t,r=n.getItemOffset,m=n.getEstimatedTotalSize,c=n.getItemSize,S=n.getOffsetForIndexAndAlignment,T=n.getStartIndexForOffset,x=n.getStopIndexForStartIndex,y=n.initInstanceProps,O=n.shouldResetStyleCacheOnItemSizeChange,w=n.validateProps;return t=function(C){ce(b,C);function b(p){var e;return e=C.call(this,p)||this,e._instanceProps=y(e.props,q(e)),e._outerRef=void 0,e._resetIsScrollingTimeoutId=null,e.state={instance:q(e),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof e.props.initialScrollOffset=="number"?e.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},e._callOnItemsRendered=void 0,e._callOnItemsRendered=F(function(o,s,a,h){return e.props.onItemsRendered({overscanStartIndex:o,overscanStopIndex:s,visibleStartIndex:a,visibleStopIndex:h})}),e._callOnScroll=void 0,e._callOnScroll=F(function(o,s,a){return e.props.onScroll({scrollDirection:o,scrollOffset:s,scrollUpdateWasRequested:a})}),e._getItemStyle=void 0,e._getItemStyle=function(o){var s=e.props,a=s.direction,h=s.itemSize,g=s.layout,u=e._getItemStyleCache(O&&h,O&&g,O&&a),f;if(u.hasOwnProperty(o))f=u[o];else{var l=r(e.props,o,e._instanceProps),I=c(e.props,o,e._instanceProps),z=a==="horizontal"||g==="horizontal",R=a==="rtl",P=z?l:0;u[o]=f={position:"absolute",left:R?void 0:P,right:R?P:void 0,top:z?0:l,height:z?"100%":I,width:z?I:"100%"}}return f},e._getItemStyleCache=void 0,e._getItemStyleCache=F(function(o,s,a){return{}}),e._onScrollHorizontal=function(o){var s=o.currentTarget,a=s.clientWidth,h=s.scrollLeft,g=s.scrollWidth;e.setState(function(u){if(u.scrollOffset===h)return null;var f=e.props.direction,l=h;if(f==="rtl")switch(Z()){case"negative":l=-h;break;case"positive-descending":l=g-a-h;break}return l=Math.max(0,Math.min(l,g-a)),{isScrolling:!0,scrollDirection:u.scrollOffset<l?"forward":"backward",scrollOffset:l,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._onScrollVertical=function(o){var s=o.currentTarget,a=s.clientHeight,h=s.scrollHeight,g=s.scrollTop;e.setState(function(u){if(u.scrollOffset===g)return null;var f=Math.max(0,Math.min(g,h-a));return{isScrolling:!0,scrollDirection:u.scrollOffset<f?"forward":"backward",scrollOffset:f,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._outerRefSetter=function(o){var s=e.props.outerRef;e._outerRef=o,typeof s=="function"?s(o):s!=null&&typeof s=="object"&&s.hasOwnProperty("current")&&(s.current=o)},e._resetIsScrollingDebounced=function(){e._resetIsScrollingTimeoutId!==null&&X(e._resetIsScrollingTimeoutId),e._resetIsScrollingTimeoutId=Le(e._resetIsScrolling,We)},e._resetIsScrolling=function(){e._resetIsScrollingTimeoutId=null,e.setState({isScrolling:!1},function(){e._getItemStyleCache(-1,null)})},e}b.getDerivedStateFromProps=function(e,o){return $e(e,o),w(e),null};var i=b.prototype;return i.scrollTo=function(e){e=Math.max(0,e),this.setState(function(o){return o.scrollOffset===e?null:{scrollDirection:o.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},i.scrollToItem=function(e,o){o===void 0&&(o="auto");var s=this.props,a=s.itemCount,h=s.layout,g=this.state.scrollOffset;e=Math.max(0,Math.min(e,a-1));var u=0;if(this._outerRef){var f=this._outerRef;h==="vertical"?u=f.scrollWidth>f.clientWidth?Y():0:u=f.scrollHeight>f.clientHeight?Y():0}this.scrollTo(S(this.props,e,o,g,this._instanceProps,u))},i.componentDidMount=function(){var e=this.props,o=e.direction,s=e.initialScrollOffset,a=e.layout;if(typeof s=="number"&&this._outerRef!=null){var h=this._outerRef;o==="horizontal"||a==="horizontal"?h.scrollLeft=s:h.scrollTop=s}this._callPropsCallbacks()},i.componentDidUpdate=function(){var e=this.props,o=e.direction,s=e.layout,a=this.state,h=a.scrollOffset,g=a.scrollUpdateWasRequested;if(g&&this._outerRef!=null){var u=this._outerRef;if(o==="horizontal"||s==="horizontal")if(o==="rtl")switch(Z()){case"negative":u.scrollLeft=-h;break;case"positive-ascending":u.scrollLeft=h;break;default:var f=u.clientWidth,l=u.scrollWidth;u.scrollLeft=l-f-h;break}else u.scrollLeft=h;else u.scrollTop=h}this._callPropsCallbacks()},i.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&X(this._resetIsScrollingTimeoutId)},i.render=function(){var e=this.props,o=e.children,s=e.className,a=e.direction,h=e.height,g=e.innerRef,u=e.innerElementType,f=e.innerTagName,l=e.itemCount,I=e.itemData,z=e.itemKey,R=z===void 0?De:z,P=e.layout,M=e.outerElementType,N=e.outerTagName,re=e.style,ne=e.useIsScrolling,oe=e.width,W=this.state.isScrolling,A=a==="horizontal"||P==="horizontal",se=A?this._onScrollHorizontal:this._onScrollVertical,D=this._getRangeToRender(),ie=D[0],ae=D[1],U=[];if(l>0)for(var _=ie;_<=ae;_++)U.push(v.createElement(o,{data:I,key:R(_,I),index:_,isScrolling:ne?W:void 0,style:this._getItemStyle(_)}));var $=m(this.props,this._instanceProps);return v.createElement(M||N||"div",{className:s,onScroll:se,ref:this._outerRefSetter,style:ue({position:"relative",height:h,width:oe,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:a},re)},v.createElement(u||f||"div",{children:U,ref:g,style:{height:A?"100%":$,pointerEvents:W?"none":void 0,width:A?$:"100%"}}))},i._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var e=this.props.itemCount;if(e>0){var o=this._getRangeToRender(),s=o[0],a=o[1],h=o[2],g=o[3];this._callOnItemsRendered(s,a,h,g)}}if(typeof this.props.onScroll=="function"){var u=this.state,f=u.scrollDirection,l=u.scrollOffset,I=u.scrollUpdateWasRequested;this._callOnScroll(f,l,I)}},i._getRangeToRender=function(){var e=this.props,o=e.itemCount,s=e.overscanCount,a=this.state,h=a.isScrolling,g=a.scrollDirection,u=a.scrollOffset;if(o===0)return[0,0,0,0];var f=T(this.props,u,this._instanceProps),l=x(this.props,f,u,this._instanceProps),I=!h||g==="backward"?Math.max(1,s):1,z=!h||g==="forward"?Math.max(1,s):1;return[Math.max(0,f-I),Math.max(0,Math.min(o-1,l+z)),f,l]},b}(v.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var $e=function(t,r){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,r.instance},qe=Ue({getItemOffset:function(t,r){var m=t.itemSize;return r*m},getItemSize:function(t,r){var m=t.itemSize;return m},getEstimatedTotalSize:function(t){var r=t.itemCount,m=t.itemSize;return m*r},getOffsetForIndexAndAlignment:function(t,r,m,c,S,T){var x=t.direction,y=t.height,O=t.itemCount,w=t.itemSize,C=t.layout,b=t.width,i=x==="horizontal"||C==="horizontal",p=i?b:y,e=Math.max(0,O*w-p),o=Math.min(e,r*w),s=Math.max(0,r*w-p+w+T);switch(m==="smart"&&(c>=s-p&&c<=o+p?m="auto":m="center"),m){case"start":return o;case"end":return s;case"center":{var a=Math.round(s+(o-s)/2);return a<Math.ceil(p/2)?0:a>e+Math.floor(p/2)?e:a}case"auto":default:return c>=s&&c<=o?c:c<s?s:o}},getStartIndexForOffset:function(t,r){var m=t.itemCount,c=t.itemSize;return Math.max(0,Math.min(m-1,Math.floor(r/c)))},getStopIndexForStartIndex:function(t,r,m){var c=t.direction,S=t.height,T=t.itemCount,x=t.itemSize,y=t.layout,O=t.width,w=c==="horizontal"||y==="horizontal",C=r*x,b=w?O:S,i=Math.ceil((b+m-C)/x);return Math.max(0,Math.min(T-1,r+i-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}});const Be=n=>{const t=n.map(r=>({title:r,field:k.camelCase(r)}));return[{title:"No",render:r=>r.tableData.id+1},{title:"Student Name",field:"fullName",cellStyle:{width:400,color:"blue",whiteSpace:"nowrap",minWidth:300}},...t,{title:"Overall Score",field:"overallScore",cellStyle:{color:"red",fontWeight:"bold"}},{title:"Grade",field:"grade",cellStyle:{color:"blue",fontWeight:"bold"}},{title:"Position",field:"position",cellStyle:{color:"green",fontWeight:"bold"}}]},He=(n,t)=>{const r=t.map(c=>({[k.camelCase(c)]:0})),m=n.map(({fullName:c,scores:S,overallScore:T,grade:x,position:y})=>{const O=S.map(({subject:i,totalScore:p})=>({[k.camelCase(i)]:p})),w={};O.forEach(i=>{const p=Object.keys(i)[0];w[p]=i[p]});const C={};r.forEach(i=>{const p=Object.keys(i)[0];C[p]=i[p]});const b={...w};for(let i in C)b[i]===void 0&&(b[i]=C[i]);return{fullName:c,overallScore:T,grade:x,position:y,...b}});return k.orderBy(m,"overallScore","desc")},Ve=({open:n,setOpen:t})=>{const{studentState:{studentReportDetails:r}}=v.useContext(J),[m,c]=v.useState([]),[S,T]=v.useState([]);v.useEffect(()=>{if(r!=null&&r.subjects){const y=Be(r.subjects);c(y)}if(r!=null&&r.results){const y=He(r==null?void 0:r.results,r==null?void 0:r.subjects);T(y)}},[r]);const x=()=>{t(!1)};return d.jsxs(de,{open:n,maxWidth:"lg",fullScreen:!0,children:[d.jsx(ee,{title:"Score Sheet",subtitle:"Show details of student performance",color:"primary.main"}),d.jsx(_e,{children:d.jsx(E,{onClick:x,children:"Close"})}),d.jsx(me,{children:d.jsx(Re,{icon:je,title:"Exams Score Sheet",exportFileName:"Score Sheet",columns:m,data:S,actions:[],options:{pageSize:10}})})]})},te=()=>{var f;const{userState:{session:n}}=v.useContext(pe),[t,r]=v.useTransition(),{studentDispatch:m}=v.useContext(J),{schoolSessionDispatch:c}=v.useContext(fe),[S,T]=v.useState([]),[x,y]=v.useState(""),[O,w]=v.useState(!1),{levelId:C}=Se(),b=v.useRef(),i=ge({queryKey:["exams-reports",C,n.sessionId,n.termId],queryFn:()=>ze({sessionId:n.sessionId,termId:n.termId,levelId:C}),enabled:!!C&&!!n.sessionId&&!!n.termId,initialData:[]});v.useEffect(()=>{var l;m({type:"getReportDetails",payload:i==null?void 0:i.data}),T((l=i==null?void 0:i.data)==null?void 0:l.results)},[i.data]);const{mutateAsync:p,isPending:e}=ve({mutationFn:Oe}),o=()=>{var l,I;Te.fire({title:"Publishing Reports",text:`You are about to publish the report of ${((I=(l=i==null?void 0:i.data)==null?void 0:l.results)==null?void 0:I.length)||"all "} students.Do you wish to continue?`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:z})=>{if(z){c({type:"openGeneralAlert",payload:{message:"Publishing reports.This might take a while please wait....",severity:"info"}});const R={sessionId:n.sessionId,termId:n.termId,levelId:C};p(R,{onSuccess:()=>{c({type:"openGeneralAlert",payload:{message:"Results have been published Successfully!!!",severity:"success"}})},onError:()=>{c({type:"openGeneralAlert",payload:{message:"An error has occured.Couldnt Generate Reports.Try again later",severity:"error"}})}})}})},s=v.memo(({data:l,index:I,isScrolling:z,style:R})=>d.jsx(V,{student:l[I],style:R},I)),a=v.useCallback(l=>d.jsx(V,{student:l},l==null?void 0:l._id),[(f=i==null?void 0:i.data)==null?void 0:f.results]),h=()=>w(!0),g=we.useReactToPrint({documentTitle:"Student Report",contentRef:b}),u=v.useCallback(l=>{const I=l.target.value.toLowerCase();y(I),r(()=>{var R,P;const z=(P=(R=i.data)==null?void 0:R.results)==null?void 0:P.filter(M=>Object.values(M).some(N=>String(N).toLowerCase().includes(I)));T(z)})},[]);return d.jsxs(d.Fragment,{children:[d.jsxs(ye,{children:[d.jsx(Ie,{to:-1,style:{color:"var(--primary)"},children:d.jsx(Me,{})}),d.jsx(ee,{title:"Student Reports",subtitle:"Show details of student performance",color:"primary.main"}),d.jsxs(xe,{py:2,children:[d.jsxs(ke,{variant:"contained",sx:{mb:4,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none"},children:[d.jsx(E,{variant:"outlined",onClick:h,children:"View Score Sheet"}),d.jsx(E,{onClick:()=>g(),children:"Print Reports"}),d.jsx(E,{loading:e,loadingPosition:"start",startIcon:d.jsx(Ee,{}),onClick:o,color:"success",children:e?"Please Wait":"Publish Reports"})]}),d.jsx(Ce,{placeholder:"Search for Report",value:x,onChange:u,slotProps:{input:{startAdornment:d.jsx(G,{position:"start",children:d.jsx(Pe,{})}),endAdornment:d.jsx(G,{position:"end",children:t&&d.jsx("div",{className:"spinner-loader"})})}}})]})]}),i.isPending&&d.jsx(be,{}),i.isError&&d.jsx(B,{children:"Error loading report info....."}),S&&(S==null?void 0:S.length)===0&&d.jsx(B,{children:"No Report Available....."}),d.jsx(qe,{className:"report-container",height:1096,width:"215mm",itemSize:1200,itemCount:S==null?void 0:S.length,itemData:S,style:{marginInline:"auto"},children:s}),d.jsx("div",{ref:b,className:"print-container",children:S==null?void 0:S.map(l=>a(l))}),d.jsx(Ve,{open:O,setOpen:w})]})};te.propTypes={open:H.bool,setOpen:H.func};const It=he.memo(te);export{It as default};
