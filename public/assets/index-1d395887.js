import{r as i,f as O,g as M,h as j,i as v,j as e,k as L,ag as R,l as z,n as P,m as Q,S as k,b as F,T as G,D as V,p as q,q as _,s as T,t as A,eS as N,F as W,v as H,C as $,x as Y,_ as K}from"./index-bb65b4bf.js";import{s as B}from"./session_ico-19a9b5ce.js";import{f as U,g as J}from"./sessionColumns-3b88387c.js";import{p as X,a as Z,g as ee,d as te,b as se,c as ae}from"./termAPI-7f1eaa7e.js";import{C as oe}from"./CustomizedMaterialTable-266061d1.js";import{C as D}from"./CustomDatePicker-05a8aa06.js";import{E as ne}from"./images-0c291668.js";import{s as ie}from"./initialValues-beb81292.js";import{C as I}from"./CustomYearPicker-9b1101d3.js";import{M as re}from"./MenuItem-1edcf8db.js";import{C as le}from"./CustomTitle-ed47c53b.js";import{G as de}from"./GlobalSpinner-7eeaabc1.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-3db5a545.js";import"./Edit-11e1ba9f.js";import"./Delete-97505065.js";import"./ListItemText-33ae0292.js";import"./listItemTextClasses-35ff90f6.js";import"./Chip-fa36c3a1.js";import"./TabPanel-175e39ff.js";import"./Toolbar-36d77a55.js";import"./Autocomplete-95da27f3.js";import"./Skeleton-6cff8ea8.js";import"./ButtonGroup-83f2640f.js";import"./InputAdornment-321f8206.js";import"./CardContent-25ef3451.js";import"./ListItemSecondaryAction-c66bb893.js";import"./Grid-6a14669c.js";import"./useMediaQuery-5f0ec7e9.js";import"./ListItem-befde9c4.js";import"./listItemButtonClasses-9702db06.js";import"./ListItemButton-bf3e0355.js";import"./Check-7b95876f.js";import"./DeleteOutline-80e9f63f.js";import"./Add-66663708.js";import"./score_ico-e1082ac1.js";const ce=()=>{const{schoolSessionState:{editSession:{open:r,data:s}},schoolSessionDispatch:c}=i.useContext(O),x=M(),[d,m]=i.useState(null),[u,p]=i.useState(null),[f,S]=i.useState(null),[g,h]=i.useState(null);i.useEffect(()=>{m(j(new Date(s.from))),p(j(new Date(s.to))),S(j(new Date(s.vacationDate))),h(j(new Date(s.reOpeningDate)))},[s]);const y={id:s.termId,from:d,to:u,vacationDate:f,reOpeningDate:g,academicYear:s.academicYear,term:s.term,session:s.sessionId},{mutateAsync:C,isLoading:b}=v({mutationFn:X}),o=(t,n)=>{C(t,{onSettled:()=>{n.setSubmitting(!1),x.invalidateQueries(["terms"])},onSuccess:l=>{c(T(l)),a()},onError:l=>{c(A(l))}})},a=()=>{c({type:"editSession",payload:{open:!1,data:{}}})};return e.jsxs(L,{open:r,onClose:a,fullWidth:!0,maxWidth:"xs",TransitionComponent:R,children:[e.jsx(z,{title:"Edit Session",onClose:a}),e.jsx(P,{initialValues:y,onSubmit:o,enableReinitialize:!0,children:({values:t,touched:n,errors:l,handleChange:E,handleSubmit:w})=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(k,{spacing:2,paddingY:2,children:[e.jsx(F,{label:"Academic Year",InputProps:{readOnly:!0},value:t.academicYear,size:"small"}),e.jsx(D,{label:"Start of Academic Term",date:d,setDate:m,touched:n.from,error:l.from,readOnly:!0}),e.jsx(D,{label:"End of Academic Term",date:u,setDate:p,touched:n.to,error:l.to,readOnly:!0}),e.jsx(F,{label:"Term/Semester",size:"small",value:t.term,onChange:E("term"),InputProps:{readOnly:!0}}),e.jsx(G,{fontSize:13,children:"Vacation"}),e.jsx(D,{label:"Vacation Date",date:f,setDate:S}),e.jsx(D,{label:"Next Term Begins",date:g,setDate:h}),e.jsx(V,{})]})}),e.jsx(q,{sx:{padding:2},children:e.jsx(_,{loading:b,variant:"contained",onClick:w,children:b?"Please Wait..":"Save Changes"})})]})})]})},me=()=>{const{schoolSessionState:r,schoolSessionDispatch:s}=i.useContext(O),c=M(),[x,d]=i.useState(j()),[m,u]=i.useState(j()),[p,f]=i.useState(""),[S,g]=i.useState(""),{mutateAsync:h,isLoading:y}=v({mutationFn:Z}),C=new Date().getFullYear(),b=(a,t)=>{a.academicYear=`${p||C}/${S||C}`,h(a,{onSettled:()=>{t.setSubmitting(!1),c.invalidateQueries(["terms"])},onSuccess:n=>{s(T(n)),o()},onError:n=>{s(A(n))}})};function o(){s({type:"displayAddSession",payload:!1})}return e.jsxs(L,{open:r.displayAddSession,fullWidth:!0,maxWidth:"xs",TransitionComponent:R,children:[e.jsx(z,{title:"Add Session",onClose:o}),e.jsx(P,{initialValues:{...ie,from:x.format("l"),to:m.format("l")},onSubmit:b,validationSchema:N,enableReinitialize:!0,children:({values:a,errors:t,touched:n,handleChange:l,handleSubmit:E})=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(k,{spacing:2,paddingY:2,children:[e.jsx(W,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(k,{direction:"row",columnGap:2,children:[e.jsx(I,{label:"From",year:p,setYear:f}),e.jsx(I,{label:"To",year:S,setYear:g})]}),e.jsx(D,{label:"Start of Academic Term/Semester",date:x,setDate:d,touched:n.from,error:t.from}),e.jsx(D,{label:"End of Academic Term/Semester",date:m,setDate:u,touched:n.to,error:t.to}),e.jsx(F,{select:!0,label:"Term/Semester",size:"small",value:a.term,onChange:l("term"),error:!!(n.term&&t.term),helperText:n.term&&t.term,children:U.map(w=>e.jsx(re,{value:w,children:w},w))}),e.jsx(V,{})]})}),e.jsx(q,{sx:{padding:2},children:e.jsx(_,{loading:y,variant:"contained",onClick:E,children:y?"Saving":"Save"})})]})})]})},$e=()=>{const{schoolSessionDispatch:r}=i.useContext(O),s=M(),[c,x]=i.useState([]),d=H({queryKey:["terms"],queryFn:()=>ee(),initialData:[]}),{mutateAsync:m}=v({mutationFn:te}),u=o=>{Y.fire({title:"Removing Session",html:` <div style='text-align:left;display:flex;flex-direction:column;gap:8px;'>
    <p>  You are about to delete an entire academic term. This action is irreversible and will permanently remove all associated data,including:</p>
      <ul style='padding-block:8px;'>
 <li style='font-weight:bold;'>Class schedules</li>
<li style='font-weight:bold;'>Student enrollments</li>
<li style='font-weight:bold;'>Attendance records</li>
<li style='font-weight:bold;'>Grades and assignments</li>
</ul>

         <p>   Please proceed with caution. If you are certain you want to delete
            this academic year, click &apos;Confirm.&apos; Otherwise, click
            &apos;Cancel&apos; to keep the academic year intact.</p>
          <p style='color:var(--secondary);font-weight:bold;'>Are you sure you want to delete this academic term?</p>
        </div>`,showCancelButton:!0,backdrop:"rgba(0,0,0,0.2)"}).then(({isConfirmed:a})=>{a&&m(o,{onSettled:()=>{s.invalidateQueries(["terms"])},onSuccess:t=>{r(T(t))},onError:t=>{r(A(t))}})})},p=o=>{x(o)},{mutateAsync:f,isLoading:S}=v({mutationFn:se}),g=()=>{Y.fire({title:"Removing Session",text:"You are about to remove the selected sessions. Removing session will delete all of its related content.Changes cannot be undone. Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:o})=>{const a=K.map(c,"termId");o&&f(a,{onSettled:()=>{s.invalidateQueries(["terms"])},onSuccess:t=>{r(T(t))},onError:t=>{r(A(t))}})})},h=o=>{r({type:"editSession",payload:{open:!0,data:o}})},y=()=>{r({type:"displayAddSession",payload:!0})},{mutateAsync:C}=v({mutationFn:ae}),b=({_id:o,active:a})=>{Y.fire({title:a?"Do you want to disable this session":"Do you want to enable this session",text:a?"Disabling Session":"Enabling Session",showCancelButton:!0,backdrop:!1}).then(t=>{t.isConfirmed&&C({_id:o,active:!a},{onSuccess:l=>{s.invalidateQueries(["terms"]),r(T(l))},onError:l=>{r(A(l))}})})};return e.jsxs($,{children:[e.jsx(le,{title:"School Session",subtitle:"Create, update, and oversee academic sessions to ensure smooth academic operations",img:B,color:"primary.main"}),e.jsxs(e.Fragment,{children:[e.jsx(oe,{title:"Sessions",icon:B,isLoading:d.isLoading,columns:J(b,h,u),data:d.data?d.data:[],actions:[],showRowShadow:!1,handleEdit:h,handleDelete:u,addButtonImg:ne.session,addButtonMessage:"ðŸ˜‘ No School Session available!.Create a new one!",showAddButton:!0,addButtonText:"New Session",onAddButtonClicked:y,handleRefresh:d.refetch,onSelectionChange:p,onDeleteClicked:g,options:{search:!0}}),e.jsx(me,{}),e.jsx(ce,{}),S&&e.jsx(de,{})]})]})};export{$e as default};
