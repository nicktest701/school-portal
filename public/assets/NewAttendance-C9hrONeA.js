import{p as E,j as e,i as H,u as I,b as L,r as c,S as N,m as Q,c as w,_ as u,d as v,e as V,o as Y,P as m,Q as _,l as q,D as G,R as K,M as j,U as S,B as h,H as O,V as C,g as b,h as P}from"./index-B8PQHtjc.js";import{C as U}from"./CustomDatePicker-_ngoDY-2.js";import{C as W}from"./CustomizedMaterialTable-BQoTtwVw.js";import{p as J,a as X,g as Z}from"./attendanceAPI-Btk_MENf.js";import{s as ee}from"./student_ico-BGUw5C9J.js";import{S as te}from"./SaveAltRounded-BPZB2WiM.js";import{B as ne}from"./Back-D8wcFeGb.js";import{C as se}from"./Chip-DmEpgF7y.js";import{D as ae}from"./DialogActions-BmNk8sop.js";import"./AdapterMoment-BOypM_74.js";import"./index-BqG4A_N5.js";import"./useThemeProps-CEPKeDia.js";import"./generateUtilityClasses-BPC_uuYP.js";import"./createTheme-DxYQS8Dz.js";import"./createStyled-CJd69Mvg.js";import"./InputAdornment-DAOlZ4uj.js";import"./ListItem-CQImyTSy.js";import"./ListItemSecondaryAction-DOVMjMKm.js";import"./listItemButtonClasses-DySKLRoc.js";import"./TabPanel-WHfZdNAn.js";import"./Toolbar-YM__bEFh.js";import"./Autocomplete-Dw57Ihk7.js";import"./Skeleton-DWRiBFRT.js";import"./ButtonGroup-ZC3qSltg.js";import"./ListItemText-DzMM1D1F.js";import"./Grid2-B2FVLpOz.js";import"./Link-kLE4_HTq.js";import"./ListItemButton-Di0YOqWQ.js";import"./Check-JB41DPzl.js";import"./DeleteOutline-BlPFLwFk.js";import"./images-B5fNBSni.js";const oe=E(e.jsx("path",{d:"m20.41 6.41-2.83-2.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7.4l8.6-8.6V7.83c0-.53-.21-1.04-.59-1.42M12 18c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-9c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h7c.55 0 1 .45 1 1zm4.99 7.25 1.77 1.77-4.84 4.84c-.1.09-.23.14-.36.14H15.5c-.28 0-.5-.22-.5-.5v-1.06c0-.13.05-.26.15-.35zm3.26.26-.85.85-1.77-1.77.85-.85c.2-.2.51-.2.71 0l1.06 1.06c.2.2.2.52 0 .71"}),"SaveAsRounded");function re({to:f}){const{id:o,type:l}=H(),k=I(),g=L(),{schoolSessionDispatch:d}=c.useContext(N),[r,M]=c.useState(Q()),[s,y]=c.useState([]),i=w({queryKey:["attendance",o,r],queryFn:()=>Z(o,r.format("L")),enabled:!!o&&!!r});c.useEffect(()=>{var t;y((t=i==null?void 0:i.data)==null?void 0:t.status)},[i.data]);const p=c.useMemo(()=>{var a;const t=(a=u.filter(s,({status:D})=>["Present","Absent"].includes(D)))==null?void 0:a.length,n=parseInt(Number(t/(s==null?void 0:s.length))*100);return{done:t,percent:n}},[s]),R=(t,n)=>{n.status=t;const a=u.values(u.merge(u.keyBy([...s,n],"_id")));y(a)},{mutateAsync:z,isPending:x}=v({mutationFn:J}),F=()=>{const t={level:o,date:r.format("L"),status:s};z(t,{onSettled:()=>{g.invalidateQueries(["attendance-history"])},onSuccess:n=>{d(b(n))},onError:n=>{d(P(n))}})},{mutateAsync:$,isPending:A}=v({mutationFn:X}),T=t=>{const n={level:o,date:r.format("L"),status:t};$(n,{onSettled:()=>{g.invalidateQueries(["attendance-history"])},onSuccess:a=>{d(b(a))},onError:a=>{d(P(a))}})},B=()=>{k(`/level/attendance/${o}/${l}/history`)};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{to:f==="/course"?"/course/level":`${f}/${o}/${l}`,color:"primary.main"}),e.jsx(V,{title:"Track Attendance Records",subtitle:" Monitor and manage student and staff attendance to ensure accurate record-keeping and identify patterns or issues promptly.",icon:e.jsx(Y,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(m,{sx:{bgcolor:"#fff",p:2},children:e.jsxs(m,{sx:{display:"flex",justifyContent:"center",pt:3},children:[e.jsx(_,{variant:"determinate",value:p.percent,size:80,color:p.percent?"success":"secondary"}),e.jsxs(q,{variant:"h5",textAlign:"center",children:[p.done,"/",s==null?void 0:s.length,e.jsx("small",{style:{marginLeft:"4px"},children:"completed"})]})]})}),e.jsx(G,{textAlign:"center",sx:{py:4},children:e.jsx(se,{label:"Details",color:"secondary"})}),e.jsx(W,{search:!0,isPending:i.isPending,icon:ee,title:`Attendance for ${l}`,exportFileName:`Attendance for ${l} on ${r.format("dddd,Do MMMM YYYY")}`,columns:[{field:"_id",title:"ID",hidden:!0},{field:"fullName",title:"FullName",export:!0},{field:"gender",title:"Gender",export:!0},{field:"status",title:"Status",render:t=>e.jsxs(K,{row:!0,"aria-labelledby":"attendance-status",name:"status",value:t==null?void 0:t.status,onChange:n=>R(n.target.value,t),children:[e.jsx(j,{value:"Present",control:e.jsx(S,{size:"small"}),label:"Present"}),e.jsx(j,{value:"Absent",control:e.jsx(S,{size:"small"}),label:"Absent"})]}),export:!0},{field:null,title:"Action",render:t=>e.jsx(h,{size:"small",startIcon:e.jsx(te,{color:"secondary"}),onClick:()=>T(t),loading:A,children:"Save"})}],data:s,actions:[],autoCompleteComponent:e.jsxs(m,{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:"center",width:"100%",children:[e.jsx(m,{width:280,children:e.jsx(U,{label:"Date of Attendance",date:r,setDate:M,disableFuture:!0})}),e.jsxs(ae,{sx:{padding:2},children:[e.jsx(h,{variant:"contained",startIcon:e.jsx(oe,{}),onClick:F,loading:x,children:x?"Saving":"Save Attendance"}),e.jsx(h,{variant:"outlined",onClick:B,children:"View History"})]})]}),options:{pageSize:10,selection:!1},handleRefresh:i.refetch}),(A||x)&&e.jsx(O,{value:"Saving Attendance. Please Wait..."})]})}re.propTypes={open:C.bool,setOpen:C.func};export{re as default};
