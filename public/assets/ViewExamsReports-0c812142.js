import{a4 as J,j as f,ah as le,ai as D,r as y,aj as ce,_ as k,ak as Y,i as ue,G as X,l as de,J as he,al as me,am as fe,U as pe,S as ge,Q as Se,g as ve,an as Ie,h as ye,ae as xe,ao as Ce,m as be,ag as we,B as q,ap as ze,v as Te,aq as Oe,q as U,a7 as $,N as Re,ar as _e}from"./index-97ebb758.js";import{R as H}from"./Report-aeb368b3.js";const je=J(f.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),Pe=J(f.jsx("path",{d:"m22 10-6-6H4c-1.1 0-2 .9-2 2v12.01c0 1.1.9 1.99 2 1.99l16-.01c1.1 0 2-.89 2-1.99zm-7-4.5 5.5 5.5H15z"}),"Note");var B=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function ke(o,t){return!!(o===t||B(o)&&B(t))}function Ee(o,t){if(o.length!==t.length)return!1;for(var r=0;r<o.length;r++)if(!ke(o[r],t[r]))return!1;return!0}function M(o,t){t===void 0&&(t=Ee);var r,c=[],u,v=!1;function x(){for(var d=[],C=0;C<arguments.length;C++)d[C]=arguments[C];return v&&r===this&&t(d,c)||(u=o.apply(this,d),v=!0,r=this,c=d),u}return x}var Me=typeof performance=="object"&&typeof performance.now=="function",G=Me?function(){return performance.now()}:function(){return Date.now()};function V(o){cancelAnimationFrame(o.id)}function Ne(o,t){var r=G();function c(){G()-r>=t?o.call(null):u.id=requestAnimationFrame(c)}var u={id:requestAnimationFrame(c)};return u}var N=-1;function K(o){if(o===void 0&&(o=!1),N===-1||o){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),N=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return N}var _=null;function Q(o){if(o===void 0&&(o=!1),_===null||o){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var c=document.createElement("div"),u=c.style;return u.width="100px",u.height="100px",t.appendChild(c),document.body.appendChild(t),t.scrollLeft>0?_="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?_="negative":_="positive-ascending"),document.body.removeChild(t),_}return _}var We=150,Le=function(t,r){return t};function Fe(o){var t,r=o.getItemOffset,c=o.getEstimatedTotalSize,u=o.getItemSize,v=o.getOffsetForIndexAndAlignment,x=o.getStartIndexForOffset,d=o.getStopIndexForStartIndex,C=o.initInstanceProps,z=o.shouldResetStyleCacheOnItemSizeChange,w=o.validateProps;return t=function(T){le(b,T);function b(m){var e;return e=T.call(this,m)||this,e._instanceProps=C(e.props,D(e)),e._outerRef=void 0,e._resetIsScrollingTimeoutId=null,e.state={instance:D(e),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof e.props.initialScrollOffset=="number"?e.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},e._callOnItemsRendered=void 0,e._callOnItemsRendered=M(function(n,s,i,h){return e.props.onItemsRendered({overscanStartIndex:n,overscanStopIndex:s,visibleStartIndex:i,visibleStopIndex:h})}),e._callOnScroll=void 0,e._callOnScroll=M(function(n,s,i){return e.props.onScroll({scrollDirection:n,scrollOffset:s,scrollUpdateWasRequested:i})}),e._getItemStyle=void 0,e._getItemStyle=function(n){var s=e.props,i=s.direction,h=s.itemSize,S=s.layout,a=e._getItemStyleCache(z&&h,z&&S,z&&i),g;if(a.hasOwnProperty(n))g=a[n];else{var l=r(e.props,n,e._instanceProps),I=u(e.props,n,e._instanceProps),O=i==="horizontal"||S==="horizontal",R=i==="rtl",P=O?l:0;a[n]=g={position:"absolute",left:R?void 0:P,right:R?P:void 0,top:O?0:l,height:O?"100%":I,width:O?I:"100%"}}return g},e._getItemStyleCache=void 0,e._getItemStyleCache=M(function(n,s,i){return{}}),e._onScrollHorizontal=function(n){var s=n.currentTarget,i=s.clientWidth,h=s.scrollLeft,S=s.scrollWidth;e.setState(function(a){if(a.scrollOffset===h)return null;var g=e.props.direction,l=h;if(g==="rtl")switch(Q()){case"negative":l=-h;break;case"positive-descending":l=S-i-h;break}return l=Math.max(0,Math.min(l,S-i)),{isScrolling:!0,scrollDirection:a.scrollOffset<l?"forward":"backward",scrollOffset:l,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._onScrollVertical=function(n){var s=n.currentTarget,i=s.clientHeight,h=s.scrollHeight,S=s.scrollTop;e.setState(function(a){if(a.scrollOffset===S)return null;var g=Math.max(0,Math.min(S,h-i));return{isScrolling:!0,scrollDirection:a.scrollOffset<g?"forward":"backward",scrollOffset:g,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._outerRefSetter=function(n){var s=e.props.outerRef;e._outerRef=n,typeof s=="function"?s(n):s!=null&&typeof s=="object"&&s.hasOwnProperty("current")&&(s.current=n)},e._resetIsScrollingDebounced=function(){e._resetIsScrollingTimeoutId!==null&&V(e._resetIsScrollingTimeoutId),e._resetIsScrollingTimeoutId=Ne(e._resetIsScrolling,We)},e._resetIsScrolling=function(){e._resetIsScrollingTimeoutId=null,e.setState({isScrolling:!1},function(){e._getItemStyleCache(-1,null)})},e}b.getDerivedStateFromProps=function(e,n){return Ae(e,n),w(e),null};var p=b.prototype;return p.scrollTo=function(e){e=Math.max(0,e),this.setState(function(n){return n.scrollOffset===e?null:{scrollDirection:n.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},p.scrollToItem=function(e,n){n===void 0&&(n="auto");var s=this.props,i=s.itemCount,h=s.layout,S=this.state.scrollOffset;e=Math.max(0,Math.min(e,i-1));var a=0;if(this._outerRef){var g=this._outerRef;h==="vertical"?a=g.scrollWidth>g.clientWidth?K():0:a=g.scrollHeight>g.clientHeight?K():0}this.scrollTo(v(this.props,e,n,S,this._instanceProps,a))},p.componentDidMount=function(){var e=this.props,n=e.direction,s=e.initialScrollOffset,i=e.layout;if(typeof s=="number"&&this._outerRef!=null){var h=this._outerRef;n==="horizontal"||i==="horizontal"?h.scrollLeft=s:h.scrollTop=s}this._callPropsCallbacks()},p.componentDidUpdate=function(){var e=this.props,n=e.direction,s=e.layout,i=this.state,h=i.scrollOffset,S=i.scrollUpdateWasRequested;if(S&&this._outerRef!=null){var a=this._outerRef;if(n==="horizontal"||s==="horizontal")if(n==="rtl")switch(Q()){case"negative":a.scrollLeft=-h;break;case"positive-ascending":a.scrollLeft=h;break;default:var g=a.clientWidth,l=a.scrollWidth;a.scrollLeft=l-g-h;break}else a.scrollLeft=h;else a.scrollTop=h}this._callPropsCallbacks()},p.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&V(this._resetIsScrollingTimeoutId)},p.render=function(){var e=this.props,n=e.children,s=e.className,i=e.direction,h=e.height,S=e.innerRef,a=e.innerElementType,g=e.innerTagName,l=e.itemCount,I=e.itemData,O=e.itemKey,R=O===void 0?Le:O,P=e.layout,ee=e.outerElementType,te=e.outerTagName,re=e.style,oe=e.useIsScrolling,ne=e.width,W=this.state.isScrolling,E=i==="horizontal"||P==="horizontal",se=E?this._onScrollHorizontal:this._onScrollVertical,L=this._getRangeToRender(),ie=L[0],ae=L[1],F=[];if(l>0)for(var j=ie;j<=ae;j++)F.push(y.createElement(n,{data:I,key:R(j,I),index:j,isScrolling:oe?W:void 0,style:this._getItemStyle(j)}));var A=c(this.props,this._instanceProps);return y.createElement(ee||te||"div",{className:s,onScroll:se,ref:this._outerRefSetter,style:ce({position:"relative",height:h,width:ne,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:i},re)},y.createElement(a||g||"div",{children:F,ref:S,style:{height:E?"100%":A,pointerEvents:W?"none":void 0,width:E?A:"100%"}}))},p._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var e=this.props.itemCount;if(e>0){var n=this._getRangeToRender(),s=n[0],i=n[1],h=n[2],S=n[3];this._callOnItemsRendered(s,i,h,S)}}if(typeof this.props.onScroll=="function"){var a=this.state,g=a.scrollDirection,l=a.scrollOffset,I=a.scrollUpdateWasRequested;this._callOnScroll(g,l,I)}},p._getRangeToRender=function(){var e=this.props,n=e.itemCount,s=e.overscanCount,i=this.state,h=i.isScrolling,S=i.scrollDirection,a=i.scrollOffset;if(n===0)return[0,0,0,0];var g=x(this.props,a,this._instanceProps),l=d(this.props,g,a,this._instanceProps),I=!h||S==="backward"?Math.max(1,s):1,O=!h||S==="forward"?Math.max(1,s):1;return[Math.max(0,g-I),Math.max(0,Math.min(n-1,l+O)),g,l]},b}(y.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var Ae=function(t,r){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,r.instance},De=Fe({getItemOffset:function(t,r){var c=t.itemSize;return r*c},getItemSize:function(t,r){var c=t.itemSize;return c},getEstimatedTotalSize:function(t){var r=t.itemCount,c=t.itemSize;return c*r},getOffsetForIndexAndAlignment:function(t,r,c,u,v,x){var d=t.direction,C=t.height,z=t.itemCount,w=t.itemSize,T=t.layout,b=t.width,p=d==="horizontal"||T==="horizontal",m=p?b:C,e=Math.max(0,z*w-m),n=Math.min(e,r*w),s=Math.max(0,r*w-m+w+x);switch(c==="smart"&&(u>=s-m&&u<=n+m?c="auto":c="center"),c){case"start":return n;case"end":return s;case"center":{var i=Math.round(s+(n-s)/2);return i<Math.ceil(m/2)?0:i>e+Math.floor(m/2)?e:i}case"auto":default:return u>=s&&u<=n?u:u<s?s:n}},getStartIndexForOffset:function(t,r){var c=t.itemCount,u=t.itemSize;return Math.max(0,Math.min(c-1,Math.floor(r/u)))},getStopIndexForStartIndex:function(t,r,c){var u=t.direction,v=t.height,x=t.itemCount,d=t.itemSize,C=t.layout,z=t.width,w=u==="horizontal"||C==="horizontal",T=r*d,b=w?z:v,p=Math.ceil((b+c-T)/d);return Math.max(0,Math.min(x-1,r+p-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}});const qe=o=>{const t=o.map(r=>({title:r,field:k.camelCase(r)}));return[{title:"No",render:r=>r.tableData.id+1},{title:"Student Name",field:"fullName",cellStyle:{width:400,color:"blue",whiteSpace:"nowrap",minWidth:300}},...t,{title:"Overall Score",field:"overallScore",cellStyle:{color:"red",fontWeight:"bold"}},{title:"Grade",field:"grade",cellStyle:{color:"blue",fontWeight:"bold"}},{title:"Position",field:"position",cellStyle:{color:"green",fontWeight:"bold"}}]},Ue=(o,t)=>{const r=t.map(u=>({[k.camelCase(u)]:0})),c=o.map(({fullName:u,scores:v,overallScore:x,grade:d,position:C})=>{const z=v.map(({subject:p,totalScore:m})=>({[k.camelCase(p)]:m})),w={};z.forEach(p=>{const m=Object.keys(p)[0];w[m]=p[m]});const T={};r.forEach(p=>{const m=Object.keys(p)[0];T[m]=p[m]});const b={...w};for(let p in T)b[p]===void 0&&(b[p]=T[p]);return{fullName:u,overallScore:x,grade:d,position:C,...b}});return k.orderBy(c,"overallScore","desc")},$e=({open:o,setOpen:t})=>{const{studentState:{studentReportDetails:r}}=y.useContext(Y),[c,u]=y.useState([]),[v,x]=y.useState([]);return y.useEffect(()=>{if(r!=null&&r.subjects){const d=qe(r.subjects);u(d)}if(r!=null&&r.results){const d=Ue(r==null?void 0:r.results,r==null?void 0:r.subjects);x(d)}},[r]),f.jsxs(ue,{open:o,maxWidth:"lg",fullScreen:!0,children:[f.jsx(X,{title:"Score Sheet",subtitle:"Show details of student performance",color:"primary.main"}),f.jsx(de,{children:f.jsx(he,{icon:me,title:"Exams Score Sheet",exportFileName:"Score Sheet",columns:c,data:v,actions:[],options:{pageSize:10}})})]})},Z=()=>{var m,e,n,s,i,h,S,a,g;const{userState:{session:o}}=y.useContext(pe),{studentDispatch:t}=y.useContext(Y),{schoolSessionDispatch:r}=y.useContext(ge),[c,u]=y.useState(!1),{levelId:v}=Se(),x=y.useRef(),d=ve({queryKey:["exams-reports",v,o.sessionId,o.termId],queryFn:()=>Ie({sessionId:o.sessionId,termId:o.termId,levelId:v}),enabled:!!v&&!!o.sessionId&&!!o.termId,onSuccess:l=>{t({type:"getReportDetails",payload:l})}}),{mutateAsync:C,isLoading:z}=ye({mutationFn:_e}),w=()=>{var l,I;Re.fire({title:"Publishing Reports",text:`You are about to publish the report of ${((I=(l=d==null?void 0:d.data)==null?void 0:l.results)==null?void 0:I.length)||"all "} students.Do you wish to continue?`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:O})=>{if(O){r({type:"openGeneralAlert",payload:{message:"Publishing reports.This might take a while please wait....",severity:"info"}});const R={sessionId:o.sessionId,termId:o.termId,levelId:v};C(R,{onSuccess:()=>{r({type:"openGeneralAlert",payload:{message:"Results have been published Successfully!!!",severity:"success"}})},onError:()=>{r({type:"openGeneralAlert",payload:{message:"An error has occured.Couldnt Generate Reports.Try again later",severity:"error"}})}})}})},T=y.memo(({data:l,index:I,isScrolling:O,style:R})=>f.jsx(H,{student:l[I],style:R},I)),b=y.useCallback(l=>f.jsx(H,{student:l},l==null?void 0:l._id),[(m=d==null?void 0:d.data)==null?void 0:m.results]),p=()=>u(!0);return f.jsxs(f.Fragment,{children:[f.jsxs(xe,{children:[f.jsx(Ce,{to:-1,children:f.jsx(je,{})}),f.jsx(X,{title:"Student Reports",subtitle:"Show details of student performance",color:"primary.main"}),f.jsx(be,{py:2,direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",justifyContent:"center",children:f.jsxs(we,{variant:"contained",sx:{mb:4},children:[f.jsx(q,{onClick:p,color:"warning",children:"View Score Sheet"}),f.jsx(ze,{trigger:()=>f.jsx(q,{color:"info",children:"Print Reports"}),content:()=>x.current,documentTitle:"Report"}),f.jsx(Te,{loading:z,loadingPosition:"start",startIcon:f.jsx(Pe,{}),onClick:w,color:"success",children:z?"Please Wait":"Publish Reports"})]})})]}),d.isLoading&&f.jsx(Oe,{}),d.isError&&f.jsx(U,{children:"Error loading report info....."}),((e=d.data)==null?void 0:e.results)&&((s=(n=d.data)==null?void 0:n.results)==null?void 0:s.length)===0&&f.jsx(U,{children:"No Report Available....."}),f.jsx(De,{className:"report-container",height:1096,width:"215mm",itemSize:1200,itemCount:(h=(i=d.data)==null?void 0:i.results)==null?void 0:h.length,itemData:(S=d.data)==null?void 0:S.results,style:{marginInline:"auto"},children:T}),f.jsx("div",{ref:x,className:"print-container",children:(g=(a=d.data)==null?void 0:a.results)==null?void 0:g.map(l=>b(l))}),f.jsx($e,{open:c,setOpen:u})]})};Z.propTypes={open:$.bool,setOpen:$.func};const Ge=fe.memo(Z);export{Ge as default};
