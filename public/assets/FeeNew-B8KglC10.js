import{ay as W,r as m,az as ye,j as e,aA as ge,D as N,a0 as ie,b as H,S as D,c as Q,_ as b,d as Y,s as $,t as ae,w as oe,aB as ve,J as le,v as U,k as E,T as R,B as G,L as K,l as F,a8 as re,y as ce,Q as de,g as ue,h as me,aj as Se,aC as Ce,e as be,f as Fe}from"./index-DrgqF6h7.js";import{g as pe,p as Te,a as Ae,d as Le}from"./feeAPI-bCYYUBpy.js";import{L as ke,C as Ee}from"./CustomizedMaterialTable-sErZg5Gy.js";import{F as xe,e as Be}from"./sessionColumns-0BrYivn4.js";import{c as k}from"./currencyFormatter-DjBDW3hY.js";import{L as Oe}from"./ListItem-yCsexoBs.js";import{L as ee}from"./ListItemText-Bwh_rzOL.js";import{L as Pe}from"./ListItemSecondaryAction-mmiMbVqP.js";import{u as we}from"./useLevel-C3V49YPJ.js";import{A as I}from"./Autocomplete-D4vPEd6T.js";import{I as z}from"./InputAdornment-EcTjtcuD.js";import{D as fe}from"./DialogActions-Cx2GHHEW.js";import{E as _e}from"./images-B5fNBSni.js";import{b as Ve}from"./currentFeeAPI-Dph8Aqgk.js";import{c as Re,a as We}from"./createStyled-CRj7xEq5.js";import{c as Me,h as te,r as q,a as ze,d as De,m as qe,g as Ge,b as se}from"./createTheme-xb4osIQ4.js";import{u as Ie,e as Ne}from"./extendSxProp-DtuuWeaj.js";import{f as ne}from"./fee_ico-Dww4ulV8.js";import"./TabPanel-Bl8roboH.js";import"./useThemeProps-DLRF2U3R.js";import"./Toolbar-Bzx_LBRC.js";import"./Chip-BcLQNplL.js";import"./Skeleton-BUD-o5ar.js";import"./ButtonGroup-DQMwsk7A.js";import"./index-_n9xtSlI.js";import"./ListItemButton-BUsfko6u.js";import"./listItemButtonClasses-CLhmtlXH.js";import"./Check-CEGAxChF.js";import"./DeleteOutline-DM92K-00.js";import"./CircleRounded-Bh8WmZqU.js";function je(t,n){const s=W({},n);return Object.keys(t).forEach(i=>{if(i.toString().match(/^(components|slots)$/))s[i]=W({},t[i],s[i]);else if(i.toString().match(/^(componentsProps|slotProps)$/)){const r=t[i]||{},a=n[i];s[i]={},!a||!Object.keys(a)?s[i]=r:!r||!Object.keys(r)?s[i]=a:(s[i]=W({},a),Object.keys(r).forEach(h=>{s[i][h]=je(r[h],a[h])}))}else s[i]===void 0&&(s[i]=t[i])}),s}const He=Re();function Qe(t){const{theme:n,name:s,props:i}=t;return!n||!n.components||!n.components[s]||!n.components[s].defaultProps?i:je(n.components[s].defaultProps,i)}function Ye({props:t,name:n,defaultTheme:s,themeId:i}){let r=Ie(s);return i&&(r=r[i]||r),Qe({theme:r,name:n,props:t})}const $e=["component","direction","spacing","divider","children","className","useFlexGap"],Ue=Me(),Ke=He("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,n)=>n.root});function Je(t){return Ye({props:t,name:"MuiStack",defaultTheme:Ue})}function Xe(t,n){const s=m.Children.toArray(t).filter(Boolean);return s.reduce((i,r,a)=>(i.push(r),a<s.length-1&&i.push(m.cloneElement(n,{key:`separator-${a}`})),i),[])}const Ze=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],et=({ownerState:t,theme:n})=>{let s=W({display:"flex",flexDirection:"column"},te({theme:n},q({values:t.direction,breakpoints:n.breakpoints.values}),i=>({flexDirection:i})));if(t.spacing){const i=ze(n),r=Object.keys(n.breakpoints.values).reduce((p,d)=>((typeof t.spacing=="object"&&t.spacing[d]!=null||typeof t.direction=="object"&&t.direction[d]!=null)&&(p[d]=!0),p),{}),a=q({values:t.direction,base:r}),h=q({values:t.spacing,base:r});typeof a=="object"&&Object.keys(a).forEach((p,d,f)=>{if(!a[p]){const S=d>0?a[f[d-1]]:"column";a[p]=S}}),s=De(s,te({theme:n},h,(p,d)=>t.useFlexGap?{gap:se(i,p)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Ze(d?a[d]:t.direction)}`]:se(i,p)}}))}return s=qe(n.breakpoints,s),s};function tt(t={}){const{createStyledComponent:n=Ke,useThemeProps:s=Je,componentName:i="MuiStack"}=t,r=()=>We({root:["root"]},p=>Ge(i,p),{}),a=n(et);return m.forwardRef(function(p,d){const f=s(p),j=Ne(f),{component:S="div",direction:y="column",spacing:T=0,divider:L,children:A,className:B,useFlexGap:O=!1}=j,c=ye(j,$e),x={direction:y,spacing:T,useFlexGap:O},P=r();return e.jsx(a,W({as:S,ownerState:x,ref:d,className:ge(P.root,B)},c,{children:L?Xe(A,L):A}))})}const st=tt(),he=({data:t,removeFee:n})=>e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{children:[e.jsx(ee,{secondary:t==null?void 0:t.fee}),e.jsx(ee,{secondary:k(t.amount)}),e.jsx(Pe,{children:e.jsx(ke,{size:"small",sx:{cursor:"pointer"},onClick:()=>n(t==null?void 0:t.fee),children:"Remove"})})]}),e.jsx(N,{})]}),nt=({open:t,setOpen:n})=>{const{userState:{session:s}}=m.useContext(ie),i=H(),{schoolSessionDispatch:r}=m.useContext(D),[a,h]=m.useState({_id:"",type:""}),[g,p]=m.useState(""),[d,f]=m.useState(""),[j,S]=m.useState([]),[y,T]=m.useState(0),[L,A]=m.useState({severity:"",text:""}),{levelsOption:B}=we();Q(["fees"],()=>pe(s),{enabled:!!(s!=null&&s.sessionId),onSuccess:o=>p(o)});const O={level:a,fee:j},c=()=>{d===""||y===""||(S(o=>o!==void 0?b.values(b.merge(b.keyBy([...o,{fee:d,amount:Number(y)}],"fee"))):[{fee:d,amount:Number(y)}]),f(""),T(""))},x=o=>{S(l=>l.filter(({fee:_})=>_!==o))},P=m.useMemo(()=>k(b.sumBy(j,"amount")),[j]),{mutateAsync:w}=Y(Te),M=(o,l)=>{A({text:""});const C={session:s.sessionId,term:s.termId,level:o.level._id,levelType:o.level.type,amount:o.fee},_=g.find(({_id:u})=>u===C.level);if(!b.isEmpty(_)){A({severity:"error",text:`Fees for ${C.levelType} already exists.Please try updating it.`});return}w(C,{onSettled:()=>{i.invalidateQueries(["fees"]),l.setSubmitting(!1)},onSuccess:u=>{r(ue(u)),n(!1)},onError:u=>{r(me(u))}})};return e.jsxs($,{open:t,onClose:()=>n(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(ae,{title:"New Fees",onClose:()=>n(!1)}),e.jsx(oe,{initialValues:O,onSubmit:M,validationSchema:ve,enableReinitialize:!0,children:({errors:o,touched:l,handleSubmit:C,isSubmitting:_})=>e.jsxs(e.Fragment,{children:[L.text&&e.jsx(le,{sx:{marginY:1},severity:L.severity,onClose:()=>A({text:""}),children:L.text}),e.jsx(U,{children:e.jsxs(E,{spacing:2,paddingY:2,children:[e.jsx(I,{fullWidth:!0,options:B,isOptionEqualToValue:(u,v)=>v._id===void 0||v._id===""||u._id===v._id,getOptionLabel:u=>u.type||"",value:a,onChange:(u,v)=>h(v),renderInput:u=>{var v,J,X,Z;return e.jsx(R,{...u,label:"Select Level",size:"small",error:!!((v=l==null?void 0:l.level)!=null&&v.type&&((J=o==null?void 0:o.level)!=null&&J.type)),helperText:((X=l==null?void 0:l.level)==null?void 0:X.type)&&((Z=o==null?void 0:o.level)==null?void 0:Z.type)})}}),e.jsx(I,{freeSolo:!0,fullWidth:!0,options:xe,isOptionEqualToValue:(u,v)=>v===void 0||v===""||u===v,getOptionLabel:u=>u||"",value:d,onInputChange:(u,v)=>f(v),renderInput:u=>e.jsx(R,{...u,label:"Select Fee Type",size:"small",error:!!(l!=null&&l.fee&&(o!=null&&o.fee)),helperText:(l==null?void 0:l.fee)&&(o==null?void 0:o.fee)&&"Enter a least one fee type*"})}),e.jsx(R,{type:"number",label:"Enter Fee Amount",size:"small",InputProps:{startAdornment:e.jsx(z,{position:"start",children:"GHS"}),endAdornment:e.jsx(z,{position:"end",children:"p"})},value:y,onChange:u=>T(u.target.value),error:!!(l!=null&&l.fee&&(o!=null&&o.fee)),helperText:(l==null?void 0:l.fee)&&(o==null?void 0:o.fee)&&"Required*"}),e.jsx(G,{variant:"contained",size:"small",onClick:c,children:"Add"}),e.jsxs(K,{sx:{maxHeight:400},children:[e.jsx(F,{variant:"body1",sx:{fontWeight:"bold"},children:"Fees"}),b.isEmpty(j)?e.jsx(F,{children:"No Fee Available"}):j.map(u=>e.jsx(he,{data:u,removeFee:x},u.fee)),e.jsx(N,{}),e.jsxs(E,{direction:"row",justifyContent:"space-between",children:[e.jsx(F,{variant:"h6",sx:{fontWeight:"bold"},children:"Total Fees"}),e.jsx(F,{variant:"h6",sx:{fontWeight:"bold"},children:P})]})]}),o.fee&&e.jsx(re,{sx:{color:"error.main"},children:o.fee})]})}),e.jsx(fe,{sx:{padding:2},children:e.jsx(ce,{loading:_,variant:"contained",onClick:C,children:"Save"})}),_&&e.jsx(de,{value:"Adding New Fee..."})]})})]})},it=()=>{var B,O;const t=H(),{schoolSessionState:{feeEditData:n},schoolSessionDispatch:s}=m.useContext(D),[i,r]=m.useState(""),[a,h]=m.useState([]),[g,p]=m.useState(0),[d,f]=m.useState({severity:"",text:""});m.useEffect(()=>{var c;h((c=n==null?void 0:n.data)==null?void 0:c.amount)},[n]);const j=()=>{i===""||g===""||(h(c=>c!==void 0?b.values(b.merge(b.keyBy([...c,{fee:i,amount:Number(g)}],"fee"))):[{fee:i,amount:Number(g)}]),r(""),p(""))},S=c=>{h(x=>x.filter(({fee:w})=>w!==c))},y=m.useMemo(()=>k(b.sumBy(a,"amount")),[a]),{mutateAsync:T}=Y(Ae),L=(c,x)=>{f({text:""}),T({_id:c._id,amount:c.fee},{onSettled:()=>{t.invalidateQueries(["fees"]),x.setSubmitting(!1)},onSuccess:()=>{f({severity:"info",text:"Changes Saved!!!"})}})},A=()=>{s({type:"setFeeEditData",payload:{open:!1,data:{}}})};return e.jsxs($,{open:n.open,onClose:A,fullWidth:!0,maxWidth:"xs",TransitionComponent:Se,children:[e.jsx(Ce,{children:"Edit Fees"}),e.jsx(oe,{initialValues:{_id:(B=n==null?void 0:n.data)==null?void 0:B._id,level:(O=n==null?void 0:n.data)==null?void 0:O.level,fee:a},onSubmit:L,enableReinitialize:!0,children:({errors:c,touched:x,handleSubmit:P,isSubmitting:w})=>{var M,o;return e.jsxs(e.Fragment,{children:[d.text&&e.jsx(le,{sx:{marginY:1},severity:d.severity,onClose:()=>f({text:""}),children:d.text}),e.jsx(U,{children:e.jsxs(E,{spacing:2,paddingY:2,children:[e.jsx(R,{label:" Level",size:"small",InputProps:{readOnly:!0},value:((M=n==null?void 0:n.data)==null?void 0:M.level)!==void 0?(o=n==null?void 0:n.data)==null?void 0:o.level:""}),e.jsx(I,{freeSolo:!0,fullWidth:!0,options:xe,isOptionEqualToValue:(l,C)=>C===void 0||C===""||l===C,getOptionLabel:l=>l||"",value:i,onInputChange:(l,C)=>r(C),renderInput:l=>e.jsx(R,{...l,label:"Select Fee Type",size:"small",error:!!(x!=null&&x.fee&&(c!=null&&c.fee)),helperText:(x==null?void 0:x.fee)&&(c==null?void 0:c.fee)&&"Enter a least one fee type*"})}),e.jsx(R,{type:"number",label:"Enter Fee Amount",size:"small",InputProps:{startAdornment:e.jsx(z,{position:"start",children:"GHS"}),endAdornment:e.jsx(z,{position:"end",children:"p"})},value:g,onChange:l=>p(l.target.value),error:!!(x!=null&&x.fee&&(c!=null&&c.fee)),helperText:(x==null?void 0:x.fee)&&(c==null?void 0:c.fee)&&"Required*"}),e.jsx(G,{variant:"contained",size:"small",onClick:j,children:"Add"}),e.jsxs(K,{sx:{maxHeight:400},children:[e.jsx(F,{variant:"body1",sx:{fontWeight:"bold"},children:"Fees"}),b.isEmpty(a)?e.jsx(F,{children:"No Fee Available"}):a.map(l=>e.jsx(he,{data:l,removeFee:S},l.fee)),e.jsx(N,{}),e.jsxs(E,{direction:"row",justifyContent:"space-between",children:[e.jsx(F,{variant:"h6",sx:{fontWeight:"bold"},children:"Total Fees"}),e.jsx(F,{variant:"h6",sx:{fontWeight:"bold"},children:y})]})]}),c.fee&&e.jsx(re,{sx:{color:"error.main"},children:c.fee})]})}),e.jsxs(fe,{sx:{padding:2},children:[e.jsx(G,{onClick:A,children:"Cancel"}),e.jsx(ce,{loading:w,variant:"contained",onClick:P,children:"Save Changes"})]}),w&&e.jsx(de,{value:"Saving Changes..."})]})}})]})};function V({title:t,value:n}){return e.jsxs(st,{children:[e.jsx(F,{variant:"caption",color:"primary",children:t}),e.jsx(F,{variant:"body2",children:n})]})}function at(){var r,a,h,g,p,d,f,j,S;const{schoolSessionState:{levelFeeInfo:t},schoolSessionDispatch:n}=m.useContext(D);console.log(t);const s=Q({queryKey:["level-fee",t.data],queryFn:()=>Ve(t==null?void 0:t.data),enabled:!!((r=t==null?void 0:t.data)!=null&&r.term)&&!!((a=t==null?void 0:t.data)!=null&&a.level),onSuccess:y=>{console.log(y)}}),i=()=>{n({type:"viewLevelFeeInfo",payload:{open:!1,data:{}}})};return e.jsxs($,{open:t.open,fullWidth:!0,maxWidth:"xs",onClose:i,children:[e.jsx(ae,{title:"School Fees Details",onClose:i}),e.jsxs(U,{children:[(s==null?void 0:s.isLoading)&&e.jsx(F,{children:"Loading....."}),(s==null?void 0:s.data)!==void 0&&e.jsxs(E,{rowGap:2,children:[e.jsx(V,{title:"Level",value:(h=t==null?void 0:t.data)==null?void 0:h.levelName}),e.jsxs(E,{direction:"row",columnGap:2,children:[e.jsx(V,{title:" Total Fee",value:k((g=t==null?void 0:t.data)==null?void 0:g.fee)}),e.jsx(K,{children:t.data.amount&&t.data.amount.map(({fee:y,amount:T})=>e.jsxs(E,{paddingY:1,children:[e.jsx("small",{style:{color:"#00f"},children:y}),e.jsx("small",{children:k(T)})]},y))})]}),e.jsx(V,{title:"Number of Students",value:(p=t==null?void 0:t.data)==null?void 0:p.noOfStudents}),e.jsx(V,{title:"Total Expected Amount of Fees",value:k(((d=t==null?void 0:t.data)==null?void 0:d.fee)*((f=t==null?void 0:t.data)==null?void 0:f.noOfStudents))}),e.jsx(V,{title:"Total Amount of Fees Paid",value:k(s==null?void 0:s.data)}),e.jsx(V,{title:"Total Outstanding Fees",value:k(Number(((j=t==null?void 0:t.data)==null?void 0:j.fee)*((S=t==null?void 0:t.data)==null?void 0:S.noOfStudents))-Number(s==null?void 0:s.data))})]})]})]})}const Rt=()=>{const{userState:{session:t}}=m.useContext(ie),n=H(),{schoolSessionDispatch:s}=m.useContext(D),[i,r]=m.useState(!1),a=Q({queryKey:["fees"],queryFn:()=>pe(t),enabled:!!(t!=null&&t.sessionId)}),{mutateAsync:h}=Y(Le),g=f=>{Fe.fire({title:"Removing",text:"Do you want to remove Fee?",showCancelButton:!0}).then(({isConfirmed:j})=>{j&&h(f,{onSettled:()=>{n.invalidateQueries(["fees"])},onSuccess:()=>{s(ue("Fee has been removed successfully!!!"))},onError:()=>{s(me("Error removing Fee!!!"))}})})},p=f=>{s({type:"setFeeEditData",payload:{open:!0,data:f}})},d=({levelId:f,level:j,fee:S,noOfStudents:y,amount:T})=>{s({type:"viewLevelFeeInfo",payload:{open:!0,data:{noOfStudents:y,fee:S,level:f,levelName:j,term:t.termId,amount:T}}})};return e.jsxs(e.Fragment,{children:[e.jsxs(e.Fragment,{children:[e.jsx(be,{title:"New Fee",subtitle:"Add new TERM/SEMESTER fees for a particular level",img:ne,color:"primary.main"}),e.jsx(Ee,{title:"School Fees",icon:ne,columns:Be(d,p,g),data:a.data?a.data:[],isLoading:a.isLoading,actions:[],search:!0,showAddButton:!0,addButtonText:"New Fee",addButtonImg:_e.sms,addButtonMessage:"😑 No School Fees available!.Create a new one",onAddButtonClicked:()=>r(!0)})]}),e.jsx(nt,{open:i,setOpen:r}),e.jsx(it,{}),e.jsx(at,{})]})};export{Rt as default};
