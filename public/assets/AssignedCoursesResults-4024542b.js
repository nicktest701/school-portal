import{r as b,a0 as f,f as j,g as C,i as y,j as e,k as R,l as I,m as T,n as B,ah as k,S as L,b as g,q as v,O as E,s as N,t as Q,u as _,a1 as $,H as A,G as F,v as q,N as z,J as M,T as P,B as h}from"./index-bb65b4bf.js";import{d as U}from"./School-70756989.js";import{s as O}from"./student_ico-5882123b.js";import{B as G}from"./Back-0ebcc4f3.js";import{C as V}from"./CustomTitle-ed47c53b.js";import{C as W}from"./CustomizedMaterialTable-266061d1.js";import{b as H}from"./studentColumns-c5a50072.js";import{u as J,i as K}from"./ExaminationAPI-b9866df6.js";import{u as Y}from"./useLevelById-2106d452.js";import{g as X}from"./generateCustomGrade-93281c1e.js";import"./ArrowBackRounded-54858719.js";import"./TabPanel-175e39ff.js";import"./Toolbar-36d77a55.js";import"./MenuItem-1edcf8db.js";import"./listItemTextClasses-35ff90f6.js";import"./Chip-fa36c3a1.js";import"./Autocomplete-95da27f3.js";import"./Skeleton-6cff8ea8.js";import"./ButtonGroup-83f2640f.js";import"./ListItemText-33ae0292.js";import"./InputAdornment-321f8206.js";import"./CardContent-25ef3451.js";import"./ListItemSecondaryAction-c66bb893.js";import"./Grid-6a14669c.js";import"./useMediaQuery-5f0ec7e9.js";import"./ListItem-befde9c4.js";import"./listItemButtonClasses-9702db06.js";import"./ListItemButton-bf3e0355.js";import"./Check-7b95876f.js";import"./DeleteOutline-80e9f63f.js";import"./Delete-97505065.js";import"./Add-66663708.js";import"./gradeColor-6983157e.js";import"./CircleRounded-3db5a545.js";function Z(){const{userState:{session:r}}=b.useContext(f),{schoolSessionState:{addStudentResults:{open:a,data:i,grade:p}},schoolSessionDispatch:c}=b.useContext(j),o=C(),{mutateAsync:x,isLoading:n}=y({mutationFn:J}),S=s=>{const t=Number(s.classScore)+Number(s.examsScore),d=X(t,p),m={session:{sessionId:r==null?void 0:r.sessionId,termId:r==null?void 0:r.termId,levelId:r==null?void 0:r.levelId,studentId:s==null?void 0:s._id},scores:[{subject:s==null?void 0:s.subject,classScore:s==null?void 0:s.classScore,examsScore:s==null?void 0:s.examsScore,...d}]};x(m,{onSettled:()=>{o.invalidateQueries(["student-records"]),o.invalidateQueries(["exams-scores"]),o.invalidateQueries(["exams-details"]),o.invalidateQueries(["exams-reports"]),o.invalidateQueries(["exams-by-id"]),o.invalidateQueries(["subject-score"])},onSuccess:u=>{c(N(u)),l()},onError:u=>{c(Q(u))}})},l=()=>{c({type:"addStudentResults",payload:{open:!1,data:{_id:"",level:"",classScore:"",examsScore:"",totalScore:"",grade:"",remarks:""},grade:p}})};return e.jsxs(R,{open:a,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(I,{title:"Add Record",onClose:l}),e.jsx(T,{children:e.jsx(B,{initialValues:i,validationSchema:k,onSubmit:S,children:({values:s,errors:t,touched:d,handleChange:m,handleSubmit:u})=>e.jsx(e.Fragment,{children:e.jsxs(L,{spacing:2,paddingY:2,children:[e.jsx(g,{label:"Subject",size:"small",value:s.subject,onChange:m("subject"),error:!!t.subject,helperText:d.subject&&t.subject}),e.jsx(g,{type:"number",label:"Class Score",size:"small",value:s.classScore,onChange:m("classScore"),error:!!t.classScore,helperText:d.classScore&&t.classScore}),e.jsx(g,{type:"number",label:"Exams Score",size:"small",value:s.examsScore,onChange:m("examsScore"),error:!!t.examsScore,helperText:d.examsScore&&t.examsScore}),e.jsx(v,{loading:n,variant:"contained",onClick:u,children:"Save Record"})]})})})}),n&&e.jsx(E,{value:"Saving Record..."})]})}function Qe(){const{schoolSessionDispatch:r}=b.useContext(j),{state:a}=_(),[i]=$(),p=A(),{level:c,levelId:o}=F(),{gradeSystem:x}=Y(o),n=q({queryKey:["subject-score",o,i.get("sub")],queryFn:()=>K({id:o,subject:i.get("sub")}),enabled:!!o&&!!i.get("sub")}),S=()=>{p(`/examination/level/${o}/${c}/upload?sub=${i.get("sub")}`,{state:{prevPath:`/course/assign/${o}/${c}?sub=${i.get("sub")}`}})},l=t=>{r({type:"addStudentResults",payload:{open:!0,data:{_id:t==null?void 0:t._id,indexnumber:t==null?void 0:t.indexnumber,levelId:a==null?void 0:a.id,...t==null?void 0:t.course},grade:x}})};if(!o&&!i.get("sub"))return e.jsx(z,{to:"/course/assign"});const s=[...H,{field:null,title:"Action",render:t=>e.jsx(h,{variant:"outlined",onClick:()=>l(t),children:"Add Record"})}];return e.jsxs(e.Fragment,{children:[e.jsx(G,{to:"/course/assign",color:"primary.main"}),e.jsxs(M,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1,pr:2},children:[e.jsx(V,{title:"Manage Student Records",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(U,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(P,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:a==null?void 0:a.type})]}),e.jsx(W,{search:!0,isLoading:n.isLoading,title:a==null?void 0:a.type,subtitle:i.get("sub"),exportFileName:`${c}-${i.get("sub")}`||"",columns:s,data:n.data,actions:[],icon:O,handleRefresh:n==null?void 0:n.refetch,autoCompleteComponent:e.jsx(h,{variant:"contained",onClick:S,children:"Import Records"})}),e.jsx(Z,{})]})}export{Qe as default};
