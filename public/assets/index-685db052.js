import{c as oe,j as e,r as c,f as ne,a0 as ie,H as le,u as de,i as ce,C as pe,n as ue,S as g,T as L,Z as me,b as y,J as D,B as A,q as he,a6 as xe,O as fe,x as ge,s as je,t as ye,as as Ce,at as Se,_ as ve}from"./index-bb65b4bf.js";import{u as Te,A as Ie}from"./index-87137486.js";import{L as Le,C as Ee,r as _e,c as be}from"./CustomizedMaterialTable-266061d1.js";import{I as R,E as we}from"./images-0c291668.js";import{C as Pe}from"./CustomTitle-ed47c53b.js";import{I as Fe,c as Me}from"./sessionColumns-3b88387c.js";import{I as De}from"./studentColumns-c5a50072.js";import{I as Ae}from"./teacherColumn-af594c43.js";import{u as Re}from"./useLevel-2a56aacb.js";import{G as Be}from"./GlobalSpinner-7eeaabc1.js";import{M as m}from"./MenuItem-1edcf8db.js";import{A as Ne}from"./Autocomplete-95da27f3.js";import{A as Ue}from"./Add-66663708.js";import{v as Oe}from"./v4-4a60fe23.js";import"./TabPanel-175e39ff.js";import"./Toolbar-36d77a55.js";import"./Chip-fa36c3a1.js";import"./Skeleton-6cff8ea8.js";import"./ButtonGroup-83f2640f.js";import"./ListItemText-33ae0292.js";import"./listItemTextClasses-35ff90f6.js";import"./InputAdornment-321f8206.js";import"./CardContent-25ef3451.js";import"./ListItemSecondaryAction-c66bb893.js";import"./Grid-6a14669c.js";import"./useMediaQuery-5f0ec7e9.js";import"./ListItem-befde9c4.js";import"./listItemButtonClasses-9702db06.js";import"./ListItemButton-bf3e0355.js";import"./Check-7b95876f.js";import"./DeleteOutline-80e9f63f.js";import"./Delete-97505065.js";import"./score_ico-e1082ac1.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-3db5a545.js";import"./Edit-11e1ba9f.js";import"./gradeColor-6983157e.js";const ze=oe(e.jsx("path",{d:"m19.41 7.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.42M14.8 15H13v3c0 .55-.45 1-1 1s-1-.45-1-1v-3H9.21c-.45 0-.67-.54-.35-.85l2.8-2.79c.2-.19.51-.19.71 0l2.79 2.79c.3.31.08.85-.36.85M14 9c-.55 0-1-.45-1-1V3.5L18.5 9z"}),"UploadFileRounded");function Ve(h){switch(h){case"students":return De;case"teachers":return Ae;case"subjects":return Me;case"grades":return Fe;default:return[]}}const Lt=()=>{var M;const h="text/csv",E="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",_="application/vnd.ms-excel",B=`".csv",
    "application/vnd.ms-excel",
    "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"`,{schoolSessionDispatch:b}=c.useContext(ne),{userState:{session:u}}=c.useContext(ie),N=le(),{state:C}=de(),[x,U]=c.useState({_id:"",type:""}),[s,O]=c.useState("students"),[o,z]=c.useState("personal-data"),[S,V]=c.useState(""),[l,p]=c.useState([]),[k,v]=c.useState(!1),[G,w]=c.useState(!1),[P,H]=c.useState(""),{levelsOption:Y}=Re(),{getRootProps:W,getInputProps:X,open:q,acceptedFiles:J}=Te({noClick:!0,noKeyboard:!0,maxFiles:20,accept:o==="personal-data"?B:{"image/*":[".jpeg",".png",".webp"]},maxSize:2e5,multiple:!0,onDrop:a=>{w(!0),ve.isEmpty(a)||(o==="personal-data"&&K(a[0]),o==="photos"&&Z(a)),w(!1)}}),F=(M=J[0])==null?void 0:M.type,$={dataCategory:s,dataType:o,levelValue:x,data:l,gradeName:S};function K(a){try{const r=new FileReader;a.type===h?r.readAsBinaryString(a):r.readAsArrayBuffer(a),r.onload=async function(i){let t=[];if([E,_].includes(a.type)&&(t=_e(i.target.result)),a.type===h&&(t=be(i.target.result)),p([]),s==="grades"){const n=t==null?void 0:t.map(d=>({id:Oe(),...d}));p(n);return}if(s==="subjects"){const n=t==null?void 0:t.map(d=>({...d,isCore:!!["Yes","True",!0].includes(d==null?void 0:d.isCore)}));p(n);return}p(t)}}catch(r){H(r)}finally{v(!1)}}function Z(a){const i=Array.from(a).map(async t=>{var f;const d=await(()=>new Promise((j,re)=>{const T=new FileReader;T.onload=I=>{j(I.target.result)},T.onerror=I=>{re(I)},T.readAsDataURL(t)}))();return{id:(f=t.name)==null?void 0:f.split(".")[0],src:d}});Promise.all(i).then(t=>{p([]),p(t)}).catch(t=>{console.error("Error reading files: ",t)})}const{mutateAsync:Q,isLoading:ee}=ce({mutationFn:Se}),te=a=>{ge.fire({title:"Importing results",text:`You are about to import ${s} ${o}.Proceed with import?`,showCancelButton:!0}).then(({isConfirmed:r})=>{if(r){v(!0);let i;["students","teachers"].includes(s)&&(i={dataCategory:s,dataType:o,data:{session:{sessionId:u==null?void 0:u.sessionId,termId:u==null?void 0:u.termId,levelId:x==null?void 0:x._id},students:l,type:"file"}},console.log(i)),s==="grades"&&(i={dataCategory:s,dataType:o,data:{name:S,ratings:l}}),s==="subjects"&&(i={dataCategory:s,dataType:o,data:l}),Q(i,{onSettled:()=>{v(!1)},onSuccess:t=>{b(je(t)),N(C==null?void 0:C.prevPath)},onError:t=>{b(ye(t))}})}})},ae=async()=>{await Ce(s)},se=Ve(s);return e.jsxs(pe,{children:[e.jsx(Pe,{title:"Data Uploads (Bulk Data Management)",subtitle:"Upload large sets of data, such as student information,teacher information,subjects, grades, and attendance records, to streamline data entry and management processes.",color:"primary.main"}),e.jsx(ue,{initialValues:$,onSubmit:te,enableReinitialize:!0,children:({errors:a,touched:r,handleSubmit:i})=>e.jsxs(e.Fragment,{children:[e.jsxs(g,{spacing:2,py:4,px:2,my:4,border:"1px solid lightgray",children:[e.jsxs(L,{children:["Select an ",e.jsx("b",{children:"EXCEL"})," OR ",e.jsx("b",{children:"CSV"})," file containing student the data. Make sure the ",e.jsx("b",{children:"columns"})," matches the accepted fields. You can download a ",e.jsx("b",{children:"sample template"})," for your data."]}),e.jsxs(e.Fragment,{children:[e.jsxs(g,{py:2,children:[e.jsxs(me,{children:[e.jsx("div",{style:{width:"inherit"},children:e.jsxs(y,{label:"Choose Data Category",select:!0,fullWidth:!0,size:"small",value:s,onChange:t=>{O(t.target.value),p([])},error:!!(r.dataCategory&&a.dataCategory),helperText:r.dataCategory&&a.dataCategory,children:[e.jsx(m,{value:"students",children:"Students"}),e.jsx(m,{value:"teachers",children:"Teachers"}),e.jsx(m,{value:"subjects",children:"Subjects"}),e.jsx(m,{value:"grades",children:"Grades"})]})}),s==="students"&&e.jsx(Ne,{size:"small",fullWidth:!0,options:Y,noOptionsText:"No Level available",getOptionLabel:t=>t.type||"",isOptionEqualToValue:(t,n)=>n._id===void 0||n._id===""||n._id===t._id,value:x,onChange:(t,n)=>U(n),renderInput:t=>{var n,d,f,j;return e.jsx(y,{fullWidth:!0,...t,label:"Select Level",size:"small",error:!!((n=r.levelValue)!=null&&n._id&&((d=a.levelValue)!=null&&d._id)),helperText:((f=r.levelValue)==null?void 0:f._id)&&((j=a.levelValue)==null?void 0:j._id),required:!0,FormHelperTextProps:{sx:{color:"error.main"}}})}}),["students","teachers"].includes(s)&&e.jsxs(y,{label:"Choose Data Type to Upload",select:!0,fullWidth:!0,size:"small",value:o,onChange:t=>z(t.target.value),error:!!(r.dataType&&a.dataType),helperText:r.dataType&&a.dataType,children:[e.jsx(m,{value:"personal-data",children:"Personal Data"}),e.jsx(m,{value:"photos",children:"Photos"})]}),s==="grades"&&e.jsx(y,{label:"Name of Grade System",fullWidth:!0,size:"small",value:S,onChange:t=>V(t.target.value),error:!!(r.gradeName&&a.gradeName),helperText:r.gradeName&&a.gradeName})]}),e.jsxs(Le,{sx:{cursor:"pointer",width:180},onClick:ae,variant:"caption",children:["Download ",s," template here"]})]}),e.jsx(D,{pt:2,children:e.jsxs(g,{border:"1px dotted #333",p:2,...W({className:"dropzone"}),justifyContent:"center",alignItems:"center",children:[e.jsx("input",{...X()}),F===h?e.jsx("img",{alt:"csv file",src:R.csv,style:{width:48,height:48}}):[E,_].includes(F)?e.jsx("img",{alt:"excel file",src:R.excel,style:{width:48,height:48}}):e.jsx(Ue,{sx:{width:36,height:36,alignSelf:"center"}}),e.jsxs(L,{variant:"body2",textAlign:"center",pt:4,paragraph:!0,children:["Drag & drop your"," ",o==="personal-data"?"data File":"photos"," ","here"]}),e.jsxs(A,{variant:"outlined",onClick:q,startIcon:o==="personal-data"?e.jsx(ze,{}):e.jsx(Ie,{}),children:["Upload"," ",o==="personal-data"?"File":"Photos"]})]})})]})]}),(l==null?void 0:l.length)>0&&e.jsxs(g,{direction:"row",justifyContent:"flex-end",width:"50%",children:[e.jsx(A,{children:"Cancel"}),e.jsx(he,{variant:"contained",onClick:i,children:"Import Data"})]})]})}),e.jsxs(e.Fragment,{children:[P&&e.jsx(xe,{sx:{color:"red"},children:P}),o==="personal-data"?e.jsx(Ee,{icon:we.score,search:!0,title:s,columns:se,data:l,actions:[]}):e.jsx(D,{sx:{display:"flex",flexWrap:"wrap",gap:2,py:4,width:"100%"},children:l==null?void 0:l.map(a=>e.jsxs(g,{border:"1px solid #ccc",alignItems:"center",p:1,spacing:1,children:[e.jsx("img",{src:a==null?void 0:a.src,style:{width:100,height:100}}),e.jsx(L,{children:a==null?void 0:a.id})]},a==null?void 0:a.id))})]}),(k||G)&&e.jsx(fe,{}),ee&&e.jsx(Be,{})]})};export{Lt as default};
