import{O as M,j as e,r as d,U as E,bL as H,X as P,u as _,S as k,_ as z,h as B,i as b,z as F,t as N,B as O,v as q,l as T,q as y,cb as R,cc as $,K as S,w as U,x as W,P as Y,Q,cd as v,a7 as g,g as V,ce as G,y as K,C as X,a as r,p as J,L as Z,aL as ee,a0 as C,M as te,bU as se,cf as ae,J as ne,G as oe,a4 as ie,ai as re,$ as le,E as ce}from"./index-6e32062a.js";import{d as de}from"./School-9ca017bf.js";import{a as ue}from"./studentColumns-c42e0a80.js";import{a as pe}from"./studentAPI-decee1db.js";const me=M(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History");function xe(){var j;const{userState:{session:n}}=d.useContext(E),{state:o}=H();P();const l=_(),[s,i]=d.useState([]),[t,c]=d.useState(!0),{schoolSessionState:x,schoolSessionDispatch:p}=d.useContext(k),a=x.fileData;d.useEffect(()=>{if(a.data.length>0){const u=a.columns.map(m=>({title:z.upperCase(m),field:m}));i(u)}c(!1)},[a]);const A=()=>{S.fire({title:"Exiting",text:"Do you want to exit?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:u})=>{u&&p({type:"closeFileDialog"})})},{mutateAsync:I}=B({mutationFn:pe}),w=()=>{c(!0);const u={students:a.data,session:{sessionId:n.sessionId,termId:n.termId,levelId:o.levelId},type:a.type};S.fire({title:"Importing students",text:"Do you want to import ?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:m})=>{m&&I(u,{onSettled:()=>{l.invalidateQueries(["current-students"]),c(!1)},onSuccess:h=>{p(U(h))},onError:h=>{p(W(h))}}),c(!1)})};return e.jsxs(b,{open:a.open,fullScreen:!0,fullWidth:!0,children:[e.jsx(F,{children:"Preview"}),e.jsxs(N,{sx:{paddingX:3},children:[e.jsx(O,{onClick:A,children:"Cancel"}),e.jsx(q,{variant:"contained",loading:t,onClick:w,children:"Save"})]}),e.jsx(T,{children:((j=a.data)==null?void 0:j.length)===0?e.jsx(y,{children:"No data available"}):e.jsx(R,{title:"Students",isLoading:t,icons:$,columns:s,data:a.data,options:{pageSize:10,pageSizeOptions:[10,20,30,50]}})})]})}var f={},he=Q;Object.defineProperty(f,"__esModule",{value:!0});var L=f.default=void 0,ye=he(Y()),ge=e;L=f.default=(0,ye.default)((0,ge.jsx)("path",{d:"M15.59 3.59c-.38-.38-.89-.59-1.42-.59H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.41zM8 17c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m0-4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m0-4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m6 0V4.5l5.5 5.5H15c-.55 0-1-.45-1-1"}),"SummarizeRounded");function D({open:n,setOpen:o}){var i;const{id:l}=g(),s=V({queryKey:["attendance-history"],queryFn:()=>G(l),enabled:!!l});return e.jsxs(b,{open:n,fullWidth:!0,maxWidth:"md",TransitionComponent:K,children:[e.jsx(X,{title:"Attendance History",onClose:()=>o(!1)}),e.jsxs(T,{children:[s.isLoading&&e.jsx(y,{children:"Loading...."}),e.jsx(r,{primary:`Attendance - ${(i=s==null?void 0:s.data)==null?void 0:i.length} days`,primaryTypographyProps:{fontSize:20,fontWeight:"bold",textAlign:"right"}}),e.jsxs(J,{sx:{maxHeight:600},children:[e.jsxs(Z,{children:[e.jsx(r,{primary:"Date"}),e.jsx(r,{primary:"Present"}),e.jsx(r,{primary:"Absent"})]}),s.data&&s.data.map(t=>e.jsxs(ee,{divider:!0,children:[e.jsx(r,{primary:C(t.date).format("Do MMMM,YYYY"),secondary:C(t.date).format("dddd"),secondaryTypographyProps:{color:"primary.main",fontWeight:"bold"}}),e.jsx(r,{primary:t.present,primaryTypographyProps:{width:100}}),e.jsx(r,{primary:t.absent,primaryTypographyProps:{width:100}})]},t.date))]})]})]})}D.propTypes={open:v.PropTypes.bool,setOpen:v.PropTypes.func};const fe=()=>{const{id:n,type:o}=g(),l=te(),[s,i]=d.useState(!1),{students:t,rollNumber:c,levelLoading:x}=se(n),a=[{icon:()=>e.jsx(L,{}),position:"toolbar",tooltip:"New Attendance",onClick:()=>{l(`/level/attendance/${n}/${o}`)},isFreeAction:!0},{icon:()=>e.jsx(me,{}),position:"toolbar",tooltip:"Attendance History",onClick:()=>i(!0),isFreeAction:!0}];return e.jsxs(e.Fragment,{children:[(t==null?void 0:t.length)===0?e.jsx(ae,{img:ne.student,message:"ðŸ˜‘ No Student available.Add your first student to this level",buttonText:"New Student"}):e.jsx(oe,{search:!0,isLoading:x,title:o,subtitle:`${c} Students`,exportFileName:o||"",columns:ue,data:t,actions:[...a],icon:ie}),e.jsx(D,{open:s,setOpen:i}),e.jsx(xe,{})]})},be=()=>{const{type:n}=g();return e.jsxs(e.Fragment,{children:[e.jsx(re,{to:"/level",color:"primary.main"}),e.jsxs(le,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1},children:[e.jsx(ce,{title:"Current Level",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(de,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(y,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:n})]}),e.jsx(fe,{})]})};export{be as default};
