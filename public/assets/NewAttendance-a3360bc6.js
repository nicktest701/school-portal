import{c as H,j as e,G as N,H as E,g as I,r as l,f as _,h as q,v as D,_ as d,i as A,a as Q,J as p,p as Y,q as v,K as V,T as G,D as K,R as O,y as j,M as S,B as w,O as J,P as C,s as b,t as k}from"./index-a08c4904.js";import{C as W}from"./CustomDatePicker-c37da33c.js";import{C as U}from"./CustomizedMaterialTable-b0814305.js";import{g as X,p as Z,a as ee}from"./attendanceAPI-50e101c6.js";import{s as te}from"./student_ico-5882123b.js";import{d as se}from"./SaveAltRounded-71a0b191.js";import{B as ne}from"./Back-26c0fe57.js";import{C as ae}from"./CustomTitle-d0e5d50c.js";import{C as oe}from"./Chip-a33d5899.js";import"./useMediaQuery-dbbfc5b2.js";import"./InputAdornment-16e34158.js";import"./ListItem-559aef15.js";import"./listItemButtonClasses-628cfd1a.js";import"./ListItemSecondaryAction-33dcc31c.js";import"./TabPanel-3210be1c.js";import"./Toolbar-172ad7c3.js";import"./MenuItem-ddd79fe9.js";import"./listItemTextClasses-cdd81f8c.js";import"./Autocomplete-62a3dcdf.js";import"./Skeleton-f52aff28.js";import"./ButtonGroup-ed336fd9.js";import"./ListItemText-de69415f.js";import"./CardContent-8cf1caa6.js";import"./Grid-d7986873.js";import"./ListItemButton-b9f74f93.js";import"./Check-6932050c.js";import"./DeleteOutline-f3e83ed5.js";import"./images-ee905b8b.js";import"./Delete-ee750b69.js";import"./Add-3c6bb686.js";import"./ArrowBackRounded-b2e199d9.js";const re=H(e.jsx("path",{d:"m20.41 6.41-2.83-2.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7.4l8.6-8.6V7.83c0-.53-.21-1.04-.59-1.42M12 18c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-9c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h7c.55 0 1 .45 1 1zm4.99 7.25 1.77 1.77-4.84 4.84c-.1.09-.23.14-.36.14H15.5c-.28 0-.5-.22-.5-.5v-1.06c0-.13.05-.26.15-.35zm3.26.26-.85.85-1.77-1.77.85-.85c.2-.2.51-.2.71 0l1.06 1.06c.2.2.2.52 0 .71"}),"SaveAsRounded");function ie({to:x}){const{id:o,type:i}=N(),L=E(),h=I(),{schoolSessionDispatch:c}=l.useContext(_),[r,M]=l.useState(q()),[n,f]=l.useState([]),g=D({queryKey:["attendance",o,r],queryFn:()=>X(o,r.format("L")),enabled:!!o&&!!r,onSuccess:t=>{f(t==null?void 0:t.status)}}),u=l.useMemo(()=>{var a;const t=(a=d.filter(n,({status:B})=>["Present","Absent"].includes(B)))==null?void 0:a.length,s=parseInt(Number(t/(n==null?void 0:n.length))*100);return{done:t,percent:s}},[n]),P=(t,s)=>{s.status=t;const a=d.values(d.merge(d.keyBy([...n,s],"_id")));f(a)},{mutateAsync:R,isLoading:m}=A({mutationFn:Z}),z=()=>{const t={level:o,date:r.format("L"),status:n};R(t,{onSettled:()=>{h.invalidateQueries(["attendance-history"])},onSuccess:s=>{c(b(s))},onError:s=>{c(k(s))}})},{mutateAsync:F,isLoading:y}=A({mutationFn:ee}),T=t=>{const s={level:o,date:r.format("L"),status:t};F(s,{onSettled:()=>{h.invalidateQueries(["attendance-history"])},onSuccess:a=>{c(b(a))},onError:a=>{c(k(a))}})},$=()=>{L(`/level/attendance/${o}/${i}/history`)};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{to:x==="/course"?"/course/level":`${x}/${o}/${i}`,color:"primary.main"}),e.jsx(ae,{title:"Track Attendance Records",subtitle:" Monitor and manage student and staff attendance to ensure accurate record-keeping and identify patterns or issues promptly.",icon:e.jsx(Q,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsxs(p,{sx:{bgcolor:"#fff",p:2},children:[e.jsx(Y,{sx:{padding:2},children:e.jsx(v,{variant:"contained",startIcon:e.jsx(re,{}),onClick:z,loading:m,children:m?"Saving":"Save Attendance"})}),e.jsx(p,{display:"flex",justifyContent:"flex-start",width:280,children:e.jsx(W,{label:"Date of Attendance",date:r,setDate:M,disableFuture:!0})}),e.jsxs(p,{sx:{display:"flex",justifyContent:"center",pt:3},children:[e.jsx(V,{variant:"determinate",value:u.percent,size:80,color:u.percent?"success":"secondary"}),e.jsxs(G,{variant:"h5",textAlign:"center",children:[u.done,"/",n==null?void 0:n.length,e.jsx("small",{style:{marginLeft:"4px"},children:"completed"})]})]})]}),e.jsx(K,{textAlign:"center",sx:{py:4},children:e.jsx(oe,{label:"Details",color:"secondary"})}),e.jsx(U,{search:!0,isLoading:g.isLoading,icon:te,title:`Attendance for ${i}`,exportFileName:`Attendance for ${i} on ${r.format("dddd,Do MMMM YYYY")}`,columns:[{field:"_id",title:"ID",hidden:!0},{field:"fullName",title:"FullName",export:!0},{field:"status",title:"Status",render:t=>e.jsxs(O,{row:!0,"aria-labelledby":"attendance-status",name:"status",value:t==null?void 0:t.status,onChange:s=>P(s.target.value,t),children:[e.jsx(j,{value:"Present",control:e.jsx(S,{size:"small"}),label:"Present"}),e.jsx(j,{value:"Absent",control:e.jsx(S,{size:"small"}),label:"Absent"})]}),export:!0},{field:null,title:"Action",render:t=>e.jsx(v,{size:"small",startIcon:e.jsx(se,{color:"secondary"}),onClick:()=>T(t),loading:y,children:"Save"})}],data:n,actions:[],autoCompleteComponent:e.jsx(w,{variant:"contained",onClick:$,children:"View Attendance History"}),options:{pageSize:10,selection:!1},handleRefresh:g.refetch}),(y||m)&&e.jsx(J,{value:"Saving Attendance. Please Wait..."})]})}ie.propTypes={open:C.bool,setOpen:C.func};export{ie as default};
