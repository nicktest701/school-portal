import{r as b,a0 as y,S as j,b as C,d as f,j as e,v as R,w as I,x as T,y as B,am as E,l as L,T as g,E as Q,Q as k,g as v,h as N,o as _,a as $,u as A,i as F,c as M,N as z,M as P,e as U,m as q,B as h}from"./index-ce442eb1.js";import{d as O}from"./School-7b1f6025.js";import{s as V}from"./student_ico-5882123b.js";import{B as W}from"./Back-78662289.js";import{C as G}from"./CustomizedMaterialTable-06b57d17.js";import{b as K}from"./studentColumns-f452d38f.js";import{u as Y,i as H}from"./ExaminationAPI-efb57909.js";import{u as J}from"./useLevelById-e09284f0.js";import{g as X}from"./generateCustomGrade-93281c1e.js";import"./TabPanel-47a179c1.js";import"./Toolbar-8b116404.js";import"./Chip-15117b24.js";import"./Autocomplete-87c4b1e1.js";import"./Skeleton-b715010d.js";import"./ButtonGroup-ca857561.js";import"./ListItemText-b107adf9.js";import"./InputAdornment-92a613d9.js";import"./DialogActions-c9d7df2e.js";import"./ListItemSecondaryAction-660d9daa.js";import"./useMediaQuery-5bcb3f64.js";import"./ListItem-2727fabf.js";import"./listItemButtonClasses-c7063ebe.js";import"./ListItemButton-97ec9750.js";import"./Check-4cc8eef7.js";import"./DeleteOutline-78b9d3f1.js";import"./images-ee905b8b.js";import"./Delete-fb41f478.js";import"./gradeColor-6983157e.js";import"./CircleRounded-06f2dceb.js";function Z(){const{userState:{session:a}}=b.useContext(y),{schoolSessionState:{addStudentResults:{open:r,data:i,grade:p}},schoolSessionDispatch:c}=b.useContext(j),o=C(),{mutateAsync:x,isLoading:n}=f({mutationFn:Y}),S=s=>{const t=Number(s.classScore)+Number(s.examsScore),d=X(t,p),m={session:{sessionId:a==null?void 0:a.sessionId,termId:a==null?void 0:a.termId,levelId:a==null?void 0:a.levelId,studentId:s==null?void 0:s._id},scores:[{subject:s==null?void 0:s.subject,classScore:s==null?void 0:s.classScore,examsScore:s==null?void 0:s.examsScore,...d}]};x(m,{onSettled:()=>{o.invalidateQueries(["student-records"]),o.invalidateQueries(["exams-scores"]),o.invalidateQueries(["exams-details"]),o.invalidateQueries(["exams-reports"]),o.invalidateQueries(["exams-by-id"]),o.invalidateQueries(["subject-score"])},onSuccess:u=>{c(v(u)),l()},onError:u=>{c(N(u))}})},l=()=>{c({type:"addStudentResults",payload:{open:!1,data:{_id:"",level:"",classScore:"",examsScore:"",totalScore:"",grade:"",remarks:""},grade:p}})};return e.jsxs(R,{open:r,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(I,{title:"Add Record",onClose:l}),e.jsx(T,{children:e.jsx(B,{initialValues:i,validationSchema:E,onSubmit:S,children:({values:s,errors:t,touched:d,handleChange:m,handleSubmit:u})=>e.jsx(e.Fragment,{children:e.jsxs(L,{spacing:2,paddingY:2,children:[e.jsx(g,{label:"Subject",size:"small",value:s.subject,onChange:m("subject"),error:!!t.subject,helperText:d.subject&&t.subject}),e.jsx(g,{type:"number",label:"Class Score",size:"small",value:s.classScore,onChange:m("classScore"),error:!!t.classScore,helperText:d.classScore&&t.classScore}),e.jsx(g,{type:"number",label:"Exams Score",size:"small",value:s.examsScore,onChange:m("examsScore"),error:!!t.examsScore,helperText:d.examsScore&&t.examsScore}),e.jsx(Q,{loading:n,variant:"contained",onClick:u,children:"Save Record"})]})})})}),n&&e.jsx(k,{value:"Saving Record..."})]})}function Ee(){const{schoolSessionDispatch:a}=b.useContext(j),{state:r}=_(),[i]=$(),p=A(),{level:c,levelId:o}=F(),{gradeSystem:x}=J(o),n=M({queryKey:["subject-score",o,i.get("sub")],queryFn:()=>H({id:o,subject:i.get("sub")}),enabled:!!o&&!!i.get("sub")}),S=()=>{p(`/examination/level/${o}/${c}/upload?sub=${i.get("sub")}`,{state:{prevPath:`/course/assign/${o}/${c}?sub=${i.get("sub")}`}})},l=t=>{a({type:"addStudentResults",payload:{open:!0,data:{_id:t==null?void 0:t._id,indexnumber:t==null?void 0:t.indexnumber,levelId:r==null?void 0:r.id,...t==null?void 0:t.course},grade:x}})};if(!o&&!i.get("sub"))return e.jsx(z,{to:"/course/assign"});const s=[...K,{field:null,title:"Action",render:t=>e.jsx(h,{variant:"outlined",onClick:()=>l(t),children:"Add Record"})}];return e.jsxs(e.Fragment,{children:[e.jsx(W,{to:"/course/assign",color:"primary.main"}),e.jsxs(P,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1,pr:2},children:[e.jsx(U,{title:"Manage Student Records",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(O,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(q,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:r==null?void 0:r.type})]}),e.jsx(G,{search:!0,isLoading:n.isLoading,title:r==null?void 0:r.type,subtitle:i.get("sub"),exportFileName:`${c}-${i.get("sub")}`||"",columns:s,data:n.data,actions:[],icon:V,handleRefresh:n==null?void 0:n.refetch,autoCompleteComponent:e.jsx(h,{variant:"contained",onClick:S,children:"Import Records"})}),e.jsx(Z,{})]})}export{Ee as default};
