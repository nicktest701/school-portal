import{p as oe,j as a,i as K,b as X,r as w,S as J,d as D,av as ie,t as le,v as de,x as re,aw as ce,w as xe,k as S,T as L,B as x,H as Z,f as U,g as A,h as k,X as me,u as pe,c as he,ax as ue,e as fe,P as v,E as we,A as je,D as _,m as ge,ay as ye,az as be}from"./index-B8PQHtjc.js";import{M as Ce,P as s}from"./ProfileItem-D0GorG9a.js";import{D as Pe}from"./DialogActions-BmNk8sop.js";import{B as ve}from"./Back-D8wcFeGb.js";import{B as De}from"./ButtonGroup-ZC3qSltg.js";import{C as G}from"./Chip-DmEpgF7y.js";const ee=oe(a.jsx("path",{d:"M3 17h18c.55 0 1 .45 1 1s-.45 1-1 1H3c-.55 0-1-.45-1-1s.45-1 1-1m-.5-4.43c.36.21.82.08 1.03-.28l.47-.82.48.83c.21.36.67.48 1.03.28.36-.21.48-.66.28-1.02l-.49-.84h.95c.41 0 .75-.34.75-.75s-.34-.75-.75-.75H5.3l.47-.82c.21-.36.09-.82-.27-1.03-.36-.2-.82-.08-1.03.28L4 8.47l-.47-.82c-.21-.36-.67-.48-1.03-.28-.36.21-.48.67-.27 1.03l.47.82h-.95c-.41 0-.75.34-.75.75s.34.75.75.75h.95l-.48.83c-.2.36-.08.82.28 1.02m8 0c.36.21.82.08 1.03-.28l.47-.82.48.83c.21.36.67.48 1.03.28.36-.21.48-.66.28-1.02l-.48-.83h.95c.41 0 .75-.34.75-.75s-.34-.75-.75-.75h-.96l.47-.82c.21-.36.08-.82-.27-1.03-.36-.21-.82-.08-1.02.27l-.48.82-.47-.82c-.21-.36-.67-.48-1.02-.27-.36.21-.48.67-.27 1.03l.47.82h-.96c-.41-.01-.75.33-.75.74s.34.75.75.75h.95l-.48.83c-.2.36-.08.82.28 1.02M23 9.97c0-.41-.34-.75-.75-.75h-.95l.47-.82c.21-.36.08-.82-.27-1.03-.36-.21-.82-.08-1.02.27l-.48.83-.47-.82c-.21-.36-.67-.48-1.02-.27-.36.21-.48.67-.27 1.03l.47.82h-.95c-.42-.01-.76.33-.76.74s.34.75.75.75h.95l-.48.83c-.21.36-.08.82.28 1.02.36.21.82.08 1.03-.28l.47-.82.48.83c.21.36.67.48 1.03.28.36-.21.48-.66.28-1.02l-.48-.83h.95c.4-.01.74-.35.74-.76"}),"PasswordRounded");function Se({open:c,setOpen:d}){const{id:j}=K(),b=X(),{schoolSessionDispatch:m}=w.useContext(J),C={id:j,password:"",confirmPassword:""},{mutateAsync:g,isPending:n}=D({mutationFn:ie}),e=(r,o)=>{delete r.confirmPassword,U.fire({title:"Updating Password",text:"Do you wish to proceed?",showCancelButton:!0,allowOutsideClick:!1}).then(({isConfirmed:i,isDenied:p,isDismissed:h})=>{i&&g(r,{onSuccess:u=>{b.invalidateQueries(["user",j]),m(A(u)),o.setSubmitting(!1),y(),m({type:"viewUser",payload:{open:!1,data:{}}})},onError:u=>{m(k(u))}}),h&&o.setSubmitting(!1)})},y=()=>d(!1);return a.jsxs(le,{open:c,maxWidth:"xs",fullWidth:!0,children:[a.jsx(de,{title:"Password Reset",onClose:y}),a.jsx(re,{initialValues:C,onSubmit:e,enableReinitialize:!0,validationSchema:ce,children:({values:r,errors:o,touched:i,handleChange:p,handleSubmit:h})=>a.jsxs(a.Fragment,{children:[a.jsx(xe,{children:a.jsxs(S,{padding:2,spacing:1,children:[a.jsx(L,{type:"password",label:"Password",fullWidth:!0,size:"small",autoComplete:"no",value:r.password,onChange:p("password"),error:!!(i.password&&o.password),helperText:i.password&&o.password}),a.jsx(L,{type:"password",label:"Confirm Password",fullWidth:!0,size:"small",value:r.confirmPassword,onChange:p("confirmPassword"),error:!!(i.confirmPassword&&o.confirmPassword),helperText:i.confirmPassword&&o.confirmPassword})]})}),a.jsx(Pe,{children:a.jsx(x,{loading:n,variant:"contained",color:"primary",onClick:h,startIcon:a.jsx(ee,{}),children:"Update Password"})})]})}),n&&a.jsx(Z,{value:"Updating Password.Please wait..."})]})}const ae=()=>{var I,E,B,M,R,F,Q,T,O,$,V,W,Y,q,z;const c=X(),{id:d}=K(),j=pe(),[b,m]=w.useState(null),[C,g]=w.useState(null),{schoolSessionDispatch:n}=w.useContext(J),e=he({queryKey:["user",d],queryFn:()=>ue(d),initialData:(I=c.getQueryData(["users"]))==null?void 0:I.find(t=>(t==null?void 0:t._id)===d)});w.useEffect(()=>{var t;m(`/images/users/${(t=e==null?void 0:e.data)==null?void 0:t.profile}`)},[e==null?void 0:e.data]);const y=()=>{j(`/users/${d}/edit`)},{mutateAsync:r}=D({mutationFn:ye}),o=()=>{var t,l;U.fire({title:(t=e==null?void 0:e.data)!=null&&t.active?"Do you want to disable this account?":"Do you want to enable this account?",text:(l=e==null?void 0:e.data)!=null&&l.active?"Disabling Account":"Enabling Account",showCancelButton:!0}).then(f=>{var N,H;if(f.isConfirmed){const ne={id:(N=e==null?void 0:e.data)==null?void 0:N._id,active:(H=e==null?void 0:e.data)!=null&&H.active?0:1};r(ne,{onSuccess:P=>{c.invalidateQueries(["users"]),c.invalidateQueries(["user",d]),n(A(P)),i()},onError:P=>{n(k(P))}})}})},i=()=>{n({type:"viewUser",payload:{open:!1,data:{}}})},{mutateAsync:p,isPending:h}=D({mutationFn:be}),u=()=>{U.fire({title:"Deleting User",text:"Do you want to delete?",showCancelButton:!0}).then(t=>{var l;t.isConfirmed&&p((l=e==null?void 0:e.data)==null?void 0:l._id,{onSuccess:f=>{c.invalidateQueries(["users"]),n(A(f)),i()},onError:f=>{n(k(f))}})})},te=()=>{g(!0)},se=()=>{var t,l;n({type:"sendQuickMessage",payload:{open:!0,data:{email:(t=e==null?void 0:e.data)==null?void 0:t.email,phonenumber:(l=e==null?void 0:e.data)==null?void 0:l.phonenumber}}})};return a.jsxs(a.Fragment,{children:[a.jsxs(a.Fragment,{children:[a.jsx(ve,{color:"#012e54"}),a.jsx(fe,{title:"User Information",subtitle:"Track,manage and control courses assigned to you",color:"primary.main"}),a.jsxs(v,{children:[a.jsx(S,{width:"100%",justifyContent:"flex-end",alignItems:"flex-end",children:a.jsxs(De,{children:[a.jsx(x,{endIcon:a.jsx(ee,{}),onClick:te,children:"Update Password"}),a.jsx(x,{endIcon:a.jsx(we,{}),onClick:y,children:"Edit"})]})}),a.jsxs(v,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",paddingY:2,gap:4,children:[a.jsx(v,{sx:{p:1,border:"1px solid lightgray",borderRadius:"50%"},children:a.jsx(je,{srcSet:b,sx:{width:100,height:100}})}),a.jsx(x,{startIcon:a.jsx(Ce,{}),onClick:se,children:"Send Message"})]}),a.jsx(_,{flexItem:!0,children:a.jsx(G,{label:"Personal Information",color:"primary"})}),a.jsx(s,{label:"Name",text:`${(E=e==null?void 0:e.data)==null?void 0:E.fullname}`}),a.jsx(s,{label:"Username",text:`${(B=e==null?void 0:e.data)==null?void 0:B.username}`}),a.jsx(s,{label:"Role",text:(M=e==null?void 0:e.data)==null?void 0:M.role}),a.jsx(s,{label:"Date Of Birth",tex:!0,text:ge(new Date((R=e==null?void 0:e.data)==null?void 0:R.dateofbirth)).format("Do MMMM, YYYY.")}),a.jsx(s,{label:"Gender",text:(F=e==null?void 0:e.data)==null?void 0:F.gender}),a.jsx(s,{label:"Email Address",text:(Q=e==null?void 0:e.data)==null?void 0:Q.email}),a.jsx(s,{label:"Telephone No.",text:(T=e==null?void 0:e.data)==null?void 0:T.phonenumber}),a.jsx(s,{label:"Address",text:(O=e==null?void 0:e.data)==null?void 0:O.address}),a.jsx(s,{label:"Residence",text:($=e==null?void 0:e.data)==null?void 0:$.residence}),a.jsx(s,{label:"Nationality",text:(V=e==null?void 0:e.data)==null?void 0:V.nationality}),a.jsx(_,{flexItem:!0,children:a.jsx(G,{label:"Account Status",color:"primary"})}),a.jsx(s,{label:"Account",text:(W=e==null?void 0:e.data)!=null&&W.active?"Active":"Disabled",valueStyle:{color:(Y=e==null?void 0:e.data)!=null&&Y.active?"green":"red"}}),a.jsxs(S,{direction:"row",spacing:2,flexWrap:"wrap",justifyContent:"flex-end",py:2,children:[a.jsx(x,{variant:"contained",color:(q=e==null?void 0:e.data)!=null&&q.active?"primary":"warning",onClick:o,children:(z=e==null?void 0:e.data)!=null&&z.active?"Disable Account":"Enable Account"}),a.jsx(x,{variant:"contained",color:"error",onClick:u,children:"Delete Account"})]})]})]}),a.jsx(Se,{open:C,setOpen:g}),h&&a.jsx(Z,{value:"Removing user details"})]})};ae.propTypes={};const Me=me.memo(ae);export{Me as default};
