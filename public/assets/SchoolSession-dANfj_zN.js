import{j as e,m as D,T,r as a,S as O,b as W,d as q,t as P,am as V,v as z,x as $,fD as B,w as L,k as b,F as M,a0 as v,D as Q,B as y,g as _,h as H,a1 as G,u as J,c as K,_ as U,N as X,C as Z,aC as ee,o as te,l as I}from"./index-B8PQHtjc.js";import{e as se,g as ae}from"./termAPI-1V1q_gIm.js";import{s as re}from"./initialValues-Dm2HlPlg.js";import{g as F,A as oe}from"./sessionColumns-oq904N9H.js";import{C as E}from"./CustomDatePicker-_ngoDY-2.js";import{D as Y}from"./react-datetime-DNix1LeI.js";import{D as ne}from"./DialogActions-BmNk8sop.js";import{A as ie}from"./Autocomplete-Dw57Ihk7.js";import"./currencyFormatter-DjBDW3hY.js";import"./CircleRounded-YWo57tpF.js";import"./ListItemText-DzMM1D1F.js";import"./Chip-DmEpgF7y.js";import"./AdapterMoment-BOypM_74.js";import"./index-BqG4A_N5.js";import"./useThemeProps-CEPKeDia.js";import"./generateUtilityClasses-BPC_uuYP.js";import"./createTheme-DxYQS8Dz.js";import"./createStyled-CJd69Mvg.js";import"./InputAdornment-DAOlZ4uj.js";import"./ListItem-CQImyTSy.js";import"./ListItemSecondaryAction-DOVMjMKm.js";import"./listItemButtonClasses-DySKLRoc.js";const le=Y.default?Y.default:Y,k=({label:m,year:d,setYear:s})=>e.jsx(le,{dateFormat:"YYYY",timeFormat:!1,value:d,initialValue:D().format("YYYY"),onChange:i=>s(i.format("YYYY")),closeOnSelect:!0,renderInput:i=>e.jsx(T,{...i,label:m,size:"small",fullWidth:!0})}),ce=({open:m,setOpen:d})=>{const{schoolSessionDispatch:s}=a.useContext(O),i=W(),[x,h]=a.useState(D()),[u,S]=a.useState(D()),[o,f]=a.useState(""),[l,g]=a.useState(""),{mutateAsync:j}=q({mutationFn:se}),t=new Date().getFullYear(),r=(p,c)=>{p.academicYear=`${o||t}/${l||t}`,j(p,{onSettled:()=>{c.setSubmitting(!1),i.invalidateQueries(["terms"])},onSuccess:n=>{s(_(n)),A()},onError:n=>{s(H(n))}}),c.setSubmitting(!1)},A=()=>d(!1);return e.jsxs(P,{open:m,fullWidth:!0,maxWidth:"xs",TransitionComponent:V,children:[e.jsx(z,{title:"Add Session",onClose:A}),e.jsx($,{initialValues:{...re,from:x.format("l"),to:u.format("l")},onSubmit:r,validationSchema:B,enableReinitialize:!0,children:({values:p,errors:c,touched:n,handleChange:w,handleSubmit:N,isSubmitting:R})=>e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsxs(b,{spacing:2,paddingY:2,children:[e.jsx(M,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(b,{direction:"row",columnGap:2,children:[e.jsx(k,{label:"From",year:o,setYear:f}),e.jsx(k,{label:"To",year:l,setYear:g})]}),e.jsx(E,{label:"Start of Academic Term/Semester",date:x,setDate:h,touched:n.from,error:c.from}),e.jsx(E,{label:"End of Academic Term/Semester",date:u,setDate:S,touched:n.to,error:c.to}),e.jsx(T,{select:!0,label:"Term/Semester",size:"small",value:p.term,onChange:w("term"),error:!!(n.term&&c.term),helperText:n.term&&c.term,children:F.length!==0?F.map(C=>e.jsx(v,{value:C,children:C},C)):e.jsx(v,{children:"No Term Available "})}),e.jsx(Q,{})]})}),e.jsx(ne,{sx:{padding:2},children:e.jsx(y,{loading:R,variant:"contained",onClick:N,children:"Save"})})]})})]})},Oe=()=>{const{schoolSessionDispatch:m}=a.useContext(O),{userDispatch:d,user:s}=a.useContext(G),i=J(),[x,h]=a.useState(!1),[u,S]=a.useState(""),[o,f]=a.useState({termId:"",academicYear:"",term:""}),l=K({queryKey:["terms"],queryFn:()=>ae(),select:t=>(s==null?void 0:s.role)==="administrator"?t:t.filter(r=>!r.active)}),g=()=>{if(S(""),o.termId===""){S("Session is Required*");return}m({type:"setCurrentSession",payload:o}),localStorage.setItem("@school_session",JSON.stringify(o)),d({type:"setSession",payload:o}),i("/",{replace:!0})},j=()=>h(!0);return U.isEmpty(s==null?void 0:s.id)?e.jsx(X,{to:"/login"}):e.jsx(Z,{maxWidth:"xs",sx:{height:"100vh",position:"relative",display:"flex",flexDirection:"column",gap:2,justifyContent:"center",alignItems:"center"},children:e.jsxs(b,{alignItems:"center",spacing:2,sx:{boxShadow:"0 2px 3px rgba(0,0,0,0.1)",p:4},children:[(s==null?void 0:s.role)==="administrator"&&e.jsx(y,{color:"primary",startIcon:e.jsx(ee,{}),sx:{mb:4},onClick:j,children:"New School Session"}),e.jsx(te,{sx:{width:80,height:80}}),e.jsx(I,{variant:"h4",sx:{textAlign:"center"},children:"School Portal"}),e.jsx(I,{variant:"body2",paragraph:!0,sx:{textAlign:"center"},children:"Choose a session (academic term/semester) to begin with."}),e.jsx(ie,{options:l!=null&&l.data?l.data:[],noOptionsText:"School Session not found",closeText:"",clearText:" ",disableClearable:!0,fullWidth:!0,value:o,onChange:(t,r)=>f(r),isOptionEqualToValue:(t,r)=>r.termId===""||r.termId===void 0||t.termId===r.termId,getOptionLabel:t=>(t==null?void 0:t.termId)!==""?`${t==null?void 0:t.academicYear},${t==null?void 0:t.term}`:"",renderInput:t=>e.jsx(T,{...t,label:"Select School Session",error:u!=="",helperText:u,FormHelperTextProps:{sx:{color:"error.main"}}})}),e.jsx(y,{variant:"contained",endIcon:e.jsx(oe,{}),fullWidth:!0,onClick:g,children:"Continue"}),e.jsx(ce,{open:x,setOpen:h})]})})};export{Oe as default};
