import{r as p,S,b as T,i as C,d as b,ag as v,j as e,L as B,ah as I,I as w,D as k,B as y,Y as E,l as F,f as P,g as A,h as _,X as q,c as z,C as Q,e as N,x as V,ai as M,P as O,T as U,H as Y,aj as $}from"./index-B8PQHtjc.js";import{u as D}from"./useLevel-K9fH0Cop.js";import{B as H}from"./Back-D8wcFeGb.js";import{g as K}from"./teacherAPI-DE1r2ugK.js";import{L as X,A as G}from"./Autocomplete-Dw57Ihk7.js";import{L}from"./ListItemText-DzMM1D1F.js";import{R as J}from"./RefreshRounded-DD-ja5GB.js";import{L as W}from"./ListItem-CQImyTSy.js";import{L as Z}from"./ListItemSecondaryAction-DOVMjMKm.js";import{D as ee}from"./DialogActions-BmNk8sop.js";import"./Chip-DmEpgF7y.js";import"./listItemButtonClasses-DySKLRoc.js";function se(){const{schoolSessionDispatch:l}=p.useContext(S),m=T(),{id:n}=C(),{levelsOption:o}=D(),t=p.useMemo(()=>o==null?void 0:o.filter(s=>{var r;return((r=s==null?void 0:s.teacher)==null?void 0:r._id)===n}),[o,n]),{mutateAsync:x}=b({mutationFn:v}),g=s=>{P.fire({title:"Unassign Teacher",text:"Do you want to unassign teacher from this level?",showCancelButton:!0,backdrop:!1}).then(r=>{r.isConfirmed&&x(s,{onSuccess:c=>{m.invalidateQueries(["levels"]),l(A(c))},onError:c=>{l(_(c))}})})};return e.jsx(B,{subheader:e.jsxs(X,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsx(L,{primary:"Assign Levels",secondary:"List of assigned levels",primaryTypographyProps:{fontSize:18,color:"var(--secondary)"},sx:{py:2}}),e.jsx(I,{title:"Refresh Levels",children:e.jsx(w,{children:e.jsx(J,{})})}),e.jsx(k,{})]}),sx:{pt:4},children:(t==null?void 0:t.length)>0?t==null?void 0:t.map(s=>e.jsxs(W,{divider:!0,children:[e.jsx(L,{primary:s==null?void 0:s.type}),e.jsx(Z,{children:e.jsx(y,{title:"Remove Level",color:"error",size:"small",endIcon:e.jsx(E,{}),onClick:()=>g(s==null?void 0:s._id),children:"Remove"})})]},s==null?void 0:s._id)):e.jsx(F,{children:"No data available"})})}const te=()=>{var j;const{schoolSessionDispatch:l}=p.useContext(S),m=T(),[n,o]=p.useState({_id:"",type:""}),{id:t}=C(),{levelsOption:x,levelLoading:g}=D(),s=z({queryKey:["teacher",t],queryFn:()=>K(t),initialData:(j=m.getQueryData(["teachers",t]))==null?void 0:j.find(a=>(a==null?void 0:a._id)===t),enabled:!!t}),{mutateAsync:r,isPending:c}=b({mutationFn:$}),R=(a,u)=>{var h;const f={_id:a==null?void 0:a._id,teacher:{_id:t,fullName:(h=s==null?void 0:s.data)==null?void 0:h.fullName}};r(f,{onSettled:()=>{m.invalidateQueries(["levels"]),u.setSubmitting(!1)},onSuccess:i=>{l(A(i))},onError:i=>{l(_(i))}})};return e.jsxs(Q,{children:[e.jsx(H,{to:`/teacher/${t}`,color:"primary.main"}),e.jsx(N,{title:"Assign New Level",subtitle:"Allocate classrooms to teachers to facilitate organized and efficient learning environments.",color:"primary.main"}),e.jsx(V,{initialValues:n,validationSchema:M,onSubmit:R,enableReinitialize:!0,children:({errors:a,touched:u,handleSubmit:f,handleReset:h})=>e.jsx(e.Fragment,{children:e.jsxs(O,{sx:{mt:4,py:4,px:2,border:"1px solid lightgray",bgcolor:"#fff"},children:[e.jsx(G,{size:"small",options:x,loading:g,loadingText:"Loading levels.Please wait...",getOptionLabel:i=>(i==null?void 0:i.type)||"",isOptionEqualToValue:(i,d)=>d._id===void 0||d._id===""||d._id===i._id,value:n,onChange:(i,d)=>o(d),renderInput:i=>e.jsx(U,{...i,label:"Select a level",error:!!(u.type&&a.type),helperText:u.type&&a.type}),sx:{marginY:2}}),e.jsxs(ee,{children:[e.jsx(y,{onClick:h,children:"Cancel"}),e.jsx(y,{loading:c,variant:"contained",onClick:f,disabled:(n==null?void 0:n._id)==="",children:"Assign Level"})]})]})})}),e.jsx(se,{}),c&&e.jsx(Y,{value:"Assigning Level.Please wait..."})]})},xe=q.memo(te);export{xe as default};
