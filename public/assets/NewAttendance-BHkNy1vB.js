import{K as H,j as e,i as N,u as D,b as E,r as l,S as I,m as Q,c as Y,_ as d,d as A,e as _,o as q,M as p,y as v,O as V,l as G,D as K,R as O,H as S,P as j,B as w,Q as U,U as C,g as b,h as k}from"./index-DrgqF6h7.js";import{C as W}from"./CustomDatePicker-D2bLCilT.js";import{C as J}from"./CustomizedMaterialTable-sErZg5Gy.js";import{p as X,a as Z,g as ee}from"./attendanceAPI-C2rNEcJl.js";import{s as te}from"./student_ico-BGUw5C9J.js";import{S as se}from"./SaveAltRounded-J3aK1J30.js";import{B as ne}from"./Back-CADpxW16.js";import{D as oe}from"./DialogActions-Cx2GHHEW.js";import{C as ae}from"./Chip-BcLQNplL.js";import"./AdapterMoment-Dv21LUiO.js";import"./index-_n9xtSlI.js";import"./useThemeProps-DLRF2U3R.js";import"./generateUtilityClasses-CIQngnWt.js";import"./createTheme-xb4osIQ4.js";import"./createStyled-CRj7xEq5.js";import"./InputAdornment-EcTjtcuD.js";import"./ListItem-yCsexoBs.js";import"./ListItemSecondaryAction-mmiMbVqP.js";import"./listItemButtonClasses-CLhmtlXH.js";import"./TabPanel-Bl8roboH.js";import"./Toolbar-Bzx_LBRC.js";import"./Autocomplete-D4vPEd6T.js";import"./Skeleton-BUD-o5ar.js";import"./ButtonGroup-DQMwsk7A.js";import"./ListItemText-Bwh_rzOL.js";import"./ListItemButton-BUsfko6u.js";import"./Check-CEGAxChF.js";import"./DeleteOutline-DM92K-00.js";import"./images-B5fNBSni.js";const re=H(e.jsx("path",{d:"m20.41 6.41-2.83-2.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7.4l8.6-8.6V7.83c0-.53-.21-1.04-.59-1.42M12 18c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-9c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h7c.55 0 1 .45 1 1zm4.99 7.25 1.77 1.77-4.84 4.84c-.1.09-.23.14-.36.14H15.5c-.28 0-.5-.22-.5-.5v-1.06c0-.13.05-.26.15-.35zm3.26.26-.85.85-1.77-1.77.85-.85c.2-.2.51-.2.71 0l1.06 1.06c.2.2.2.52 0 .71"}),"SaveAsRounded");function ie({to:x}){const{id:a,type:i}=N(),L=D(),h=E(),{schoolSessionDispatch:c}=l.useContext(I),[r,M]=l.useState(Q()),[n,f]=l.useState([]),g=Y({queryKey:["attendance",a,r],queryFn:()=>ee(a,r.format("L")),enabled:!!a&&!!r,onSuccess:t=>{console.log(t.status),f(t==null?void 0:t.status)}}),u=l.useMemo(()=>{var o;const t=(o=d.filter(n,({status:T})=>["Present","Absent"].includes(T)))==null?void 0:o.length,s=parseInt(Number(t/(n==null?void 0:n.length))*100);return{done:t,percent:s}},[n]),P=(t,s)=>{s.status=t;const o=d.values(d.merge(d.keyBy([...n,s],"_id")));f(o)},{mutateAsync:R,isLoading:m}=A({mutationFn:X}),z=()=>{const t={level:a,date:r.format("L"),status:n};R(t,{onSettled:()=>{h.invalidateQueries(["attendance-history"])},onSuccess:s=>{c(b(s))},onError:s=>{c(k(s))}})},{mutateAsync:F,isLoading:y}=A({mutationFn:Z}),$=t=>{const s={level:a,date:r.format("L"),status:t};F(s,{onSettled:()=>{h.invalidateQueries(["attendance-history"])},onSuccess:o=>{c(b(o))},onError:o=>{c(k(o))}})},B=()=>{L(`/level/attendance/${a}/${i}/history`)};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{to:x==="/course"?"/course/level":`${x}/${a}/${i}`,color:"primary.main"}),e.jsx(_,{title:"Track Attendance Records",subtitle:" Monitor and manage student and staff attendance to ensure accurate record-keeping and identify patterns or issues promptly.",icon:e.jsx(q,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsxs(p,{sx:{bgcolor:"#fff",p:2},children:[e.jsx(oe,{sx:{padding:2},children:e.jsx(v,{variant:"contained",startIcon:e.jsx(re,{}),onClick:z,loading:m,children:m?"Saving":"Save Attendance"})}),e.jsx(p,{display:"flex",justifyContent:"flex-start",width:280,children:e.jsx(W,{label:"Date of Attendance",date:r,setDate:M,disableFuture:!0})}),e.jsxs(p,{sx:{display:"flex",justifyContent:"center",pt:3},children:[e.jsx(V,{variant:"determinate",value:u.percent,size:80,color:u.percent?"success":"secondary"}),e.jsxs(G,{variant:"h5",textAlign:"center",children:[u.done,"/",n==null?void 0:n.length,e.jsx("small",{style:{marginLeft:"4px"},children:"completed"})]})]})]}),e.jsx(K,{textAlign:"center",sx:{py:4},children:e.jsx(ae,{label:"Details",color:"secondary"})}),e.jsx(J,{search:!0,isLoading:g.isLoading,icon:te,title:`Attendance for ${i}`,exportFileName:`Attendance for ${i} on ${r.format("dddd,Do MMMM YYYY")}`,columns:[{field:"_id",title:"ID",hidden:!0},{field:"fullName",title:"FullName",export:!0},{field:"gender",title:"Gender",export:!0},{field:"status",title:"Status",render:t=>e.jsxs(O,{row:!0,"aria-labelledby":"attendance-status",name:"status",value:t==null?void 0:t.status,onChange:s=>P(s.target.value,t),children:[e.jsx(S,{value:"Present",control:e.jsx(j,{size:"small"}),label:"Present"}),e.jsx(S,{value:"Absent",control:e.jsx(j,{size:"small"}),label:"Absent"})]}),export:!0},{field:null,title:"Action",render:t=>e.jsx(v,{size:"small",startIcon:e.jsx(se,{color:"secondary"}),onClick:()=>$(t),loading:y,children:"Save"})}],data:n,actions:[],autoCompleteComponent:e.jsx(w,{variant:"contained",onClick:B,children:"View Attendance History"}),options:{pageSize:10,selection:!1},handleRefresh:g.refetch}),(y||m)&&e.jsx(U,{value:"Saving Attendance. Please Wait..."})]})}ie.propTypes={open:C.bool,setOpen:C.func};export{ie as default};
