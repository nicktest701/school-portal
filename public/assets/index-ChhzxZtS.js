import{j as e,T as o,V as w,r as i,a1 as S,a as T,b as R,S as $,d as _,a2 as A,t as L,v as O,x as V,a3 as v,w as G,k as m,A as E,l as W,B as j,g as C,h as P,C as y,e as Q,E as M}from"./index-B8PQHtjc.js";import{C as g}from"./CustomFormControl-Duiznp8E.js";import{u as q}from"./sessionAPI-C-E5-YJ-.js";import{C as H}from"./CustomImageChooser-CGe9XgpC.js";import{D as N}from"./DialogActions-BmNk8sop.js";function l({label:s,value:p}){return e.jsx(o,{label:s,value:p,fullWidth:!0,inputProps:{style:{backgroundColor:"whitesmoke",color:"var(--primary)",fontWeight:"bold",textTransform:"capitalize"}},InputProps:{readOnly:!0}})}const k=()=>{const{user:s}=i.useContext(S),[p,u]=T(),x=R(),[d,z]=i.useState(""),[B,b]=i.useState(null),{schoolSessionDispatch:f}=i.useContext($);i.useEffect(()=>{b(`/images/users/${s==null?void 0:s.profile}`)},[s]);const{mutateAsync:I}=_(A),U=(a,r)=>{if(a.confirmPassword!==a.password){z("Passwords do not match"),r.setSubmitting(!1);return}a.fullname=`${a==null?void 0:a.firstname} ${a==null?void 0:a.lastname}`,delete a.profile,delete a.confirmPassword,a._id=s==null?void 0:s.id,I(a,{onSettled:()=>{x.invalidateQueries(["user"]),r.setSubmitting(!1)},onSuccess:t=>{f(C(t)),h()},onError:t=>{f(P(t))}})},D=async a=>{var n;const r=(n=a.target)==null?void 0:n.files[0],t={_id:s==null?void 0:s.id,profile:r,type:"users"};try{const c=await q(t);f(C(c)),b(URL.createObjectURL(r))}catch(c){f(P(c))}x.invalidateQueries(["user"])},h=()=>{u(a=>(a.delete("e_p"),a))};return e.jsxs(L,{open:p.get("e_p"),maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{title:"Edit User",onClose:h}),e.jsx(V,{initialValues:{password:"",confirmPassword:"",...s},onSubmit:U,enableReinitialize:!0,validationSchema:v,children:({values:a,errors:r,touched:t,handleChange:n,handleSubmit:c,isSubmitting:F})=>e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs(m,{direction:{xs:"column",md:"row"},justifyContent:"center",columnGap:3,children:[e.jsx(m,{children:e.jsx(H,{handleImageUpload:D,children:e.jsx(E,{srcSet:B,sx:{width:100,height:100,alignSelf:"center"}})})}),e.jsxs(m,{padding:2,spacing:2,children:[e.jsx(W,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),e.jsx(o,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:a.firstname||"",onChange:n("firstname"),error:!!(t.firstname&&r.firstname),helperText:t.firstname&&r.firstname}),e.jsx(o,{label:"Lastname",type:"text",fullWidth:!0,size:"small",value:a.lastname||"",onChange:n("lastname"),error:!!(t.lastname&&r.lastname),helperText:t.lastname&&r.lastname}),e.jsx(o,{label:"Username",fullWidth:!0,size:"small",value:a.username||"",onChange:n("username"),error:!!(t.username&&r.username),helperText:t.username&&r.username}),e.jsx(o,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:a.email||"",onChange:n("email"),error:!!(t.email&&r.email),helperText:t.email&&r.email}),e.jsx(o,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:a.phonenumber||"",onChange:n("phonenumber"),error:!!(t.phonenumber&&r.phonenumber),helperText:t.phonenumber&&r.phonenumber}),e.jsxs(g,{children:[e.jsx(o,{type:"password",label:"Password",fullWidth:!0,size:"small",value:a.password,onChange:n("password"),error:!!(t.password&&r.password),helperText:t.password&&r.password}),e.jsx(o,{type:"password",label:"Confirm Password",fullWidth:!0,size:"small",value:a.confirmPassword,onChange:n("confirmPassword"),error:!!(t.confirmPassword&&r.confirmPassword),helperText:d||t.confirmPassword&&r.confirmPassword,FormHelperTextProps:{color:"error.main"}})]})]})]})}),e.jsxs(N,{children:[e.jsx(j,{onClick:h,children:"Cancel"}),e.jsx(j,{loading:F,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:c,children:"Save Changes"})]})]})})]})};k.propTypes={open:w.bool,setOpen:w.func};function ee(){const{user:s}=i.useContext(S),[p,u]=T(),x=()=>{u(d=>(d.set("e_p",!0),d))};return e.jsxs(y,{children:[e.jsx(Q,{title:"Profile",subtitle:"View and update your personal information to keep your profile accurate and current.",color:"text.main",backColor:"#012e54"}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column",alignItems:"start",py:4,gap:4,bgcolor:"#fff"},children:[e.jsx(j,{variant:"contained",startIcon:e.jsx(M,{}),onClick:x,sx:{alignSelf:"flex-end"},children:"Edit Profile"}),e.jsxs(m,{width:"100%",justifyContent:"center",alignItems:"center",rowGap:2,children:[e.jsx(m,{sx:{p:1,border:"1px solid lightgray",borderRadius:"50%"},children:e.jsx(E,{src:`/images/users/${s==null?void 0:s.profile}`,sx:{height:120,width:120}})}),e.jsx(W,{variant:"h6",color:"primary",sx:{paddingTop:2,textTransform:"capitalize"},children:s==null?void 0:s.fullname})]}),e.jsxs(m,{spacing:3,width:"100%",children:[e.jsxs(g,{children:[e.jsx(l,{label:"Firstname",value:s.firstname||""}),e.jsx(l,{label:"Lastname",value:s.lastname||""})]}),e.jsx(l,{label:"Username",value:s.username||""}),e.jsx(l,{label:"Email",value:s.email||""}),e.jsxs(g,{children:[e.jsx(l,{label:"Date of Birth",value:s.dob||""}),e.jsx(l,{label:"Gender",value:s.gender||""})]}),e.jsx(l,{label:"Role",value:s.role||""})]})]}),e.jsx(k,{})]})}export{ee as default};
