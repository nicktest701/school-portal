import{j as e,I as L,D as I,b,r as l,S as A,a as _,c as B,d as k,e as P,P as T,k as D,l as m,T as w,B as p,L as E,_ as d,al as F,g as O,h as Q}from"./index-B8PQHtjc.js";import{S as q}from"./SaveAltRounded-BPZB2WiM.js";import{D as z}from"./DeleteOutline-BlPFLwFk.js";import{L as R}from"./ListItem-CQImyTSy.js";import{L as W}from"./ListItemText-DzMM1D1F.js";import{L as K}from"./ListItemSecondaryAction-DOVMjMKm.js";import{g as M}from"./subjectAPI-BJJTWRfs.js";import{u as $}from"./useLevelById-K7PyoswH.js";import{B as G}from"./Back-D8wcFeGb.js";import{A as H,L as J}from"./Autocomplete-Dw57Ihk7.js";import"./listItemButtonClasses-DySKLRoc.js";import"./Chip-DmEpgF7y.js";const N=({subject:a,removeSubject:i})=>e.jsxs(e.Fragment,{children:[e.jsxs(R,{sx:{mt:3},children:[e.jsx(W,{secondary:a==null?void 0:a.name,secondaryTypographyProps:{fontSize:12,fontStyle:"italic",fontWeight:"bold"}}),e.jsx(K,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:e.jsx(L,{onClick:()=>i(a==null?void 0:a._id),children:e.jsx(z,{})})})]}),e.jsx(I,{})]}),de=()=>{const a=b(),{schoolSessionDispatch:i}=l.useContext(A),[n,U]=_(),[o,x]=l.useState([]),[s,c]=l.useState([]),{subjects:h,levelLoading:S}=$(n.get("_id")),f=B({queryKey:["subjects"],queryFn:()=>M(),initialData:[]});l.useEffect(()=>{c(h)},[n.get("_id"),h]);const g=()=>{const t=d.values(d.merge(d.keyBy([...s,...o],"_id")));console.log(s),c(t),x([])},y=t=>{c(r=>r.filter(u=>(u==null?void 0:u._id)!==t))},{mutateAsync:j,isPending:v}=k({mutationFn:F}),C=()=>{const t={levelId:n.get("_id"),subjects:d.map(s,"_id")};j(t,{onSettled:()=>{a.invalidateQueries(["subjects"]),a.invalidateQueries(["level",n.get("_id")])},onSuccess:r=>{i(O(r))},onError:r=>{i(Q(r))}})};return e.jsxs(e.Fragment,{children:[e.jsx(G,{to:"/level",color:"primary.main"}),e.jsx(P,{title:`Current Courses for ${n.get("type")}`,subtitle:"Add new subjects to the current level",color:"primary.main"}),e.jsxs(T,{children:[e.jsxs(D,{spacing:2,py:6,width:"100%",justifyContent:"center",alignItems:"flex-start",children:[e.jsx(m,{variant:"h6",children:"Please select one or multiple courses"}),e.jsx(H,{multiple:!0,freeSolo:!0,fullWidth:!0,options:f.data??[],disableCloseOnSelect:!0,getOptionLabel:t=>(t==null?void 0:t.name)||"",value:o,onChange:(t,r)=>x(r),renderInput:t=>e.jsx(w,{...t,label:"Select Course",size:"small",focused:!0})}),e.jsx(p,{variant:"contained",size:"small",onClick:g,sx:{px:4,py:2,alignSelf:"flex-end"},disabled:(o==null?void 0:o.length)===0,children:"Add Course"})]}),e.jsxs(E,{sx:{height:400,p:2,mt:4,overflow:"auto",bgcolor:"#fff"},subheader:e.jsxs(J,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsxs(m,{variant:"h4",children:[s.length," Course(s) Available"]}),e.jsx(p,{startIcon:e.jsx(q,{}),loading:v,variant:"contained",onClick:C,disabled:(s==null?void 0:s.length)===0,children:"Save Courses"})]}),children:[S&&e.jsx(m,{variant:"h6",children:"Loading.... "}),s==null?void 0:s.map(t=>e.jsx(N,{subject:t,removeSubject:y},t==null?void 0:t._id))]})]})]})};export{de as default};
