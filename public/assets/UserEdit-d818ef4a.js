import{b as F,i as U,u as k,r as c,S as w,c as I,at as L,n as y,d as P,j as t,e as R,D as A,y as Q,aw as $,M,l as u,A as q,m as N,T as o,$ as l,E as V,Q as _,g as S,h as C,a2 as G}from"./index-ce442eb1.js";import{C as x}from"./CustomFormControl-7bbced0e.js";import{u as K}from"./sessionAPI-c946b457.js";import{C as O}from"./CustomDatePicker-0001e585.js";import{C as H}from"./CustomImageChooser-841df1e5.js";import{B as J}from"./Back-78662289.js";import{D as X}from"./DialogActions-c9d7df2e.js";import"./AdapterMoment-20f157db.js";import"./useMediaQuery-5bcb3f64.js";import"./InputAdornment-92a613d9.js";import"./ListItem-2727fabf.js";import"./listItemButtonClasses-c7063ebe.js";import"./ListItemSecondaryAction-660d9daa.js";import"./Chip-15117b24.js";const Y=()=>{var b;const p=F(),{id:s}=U(),B=k(),[f,h]=c.useState(null),[T,j]=c.useState(null),{schoolSessionDispatch:d}=c.useContext(w),r=I({queryKey:["user",s],queryFn:()=>L(s),initialData:(b=p.getQueryData(["users"]))==null?void 0:b.find(e=>(e==null?void 0:e._id)===s)});c.useEffect(()=>{var e,a;h(y((e=r==null?void 0:r.data)==null?void 0:e.dateofbirth)),j(`https://school-portal-aivn.onrender.com/api/frebbys/v1/images/users/${(a=r==null?void 0:r.data)==null?void 0:a.profile}`)},[r==null?void 0:r.data]);const{mutateAsync:D,isLoading:g}=P({mutationFn:G}),W=(e,a)=>{delete e.profile,e.fullname=`${e==null?void 0:e.firstname} ${e==null?void 0:e.lastname}`,e.dateofbirth=y(f).format("L"),D(e,{onSettled:()=>{p.invalidateQueries(["users"]),a.setSubmitting(!1)},onSuccess:i=>{d(S(i)),B(`/users/${s}`)},onError:i=>{d(C(i))}})},z=async e=>{var n;const a=(n=e.target)==null?void 0:n.files[0],i={_id:s,profile:a,type:"users"};try{const m=await K(i);d(S(m)),j(URL.createObjectURL(a))}catch(m){d(C(m))}p.invalidateQueries(["users"])};return t.jsxs(t.Fragment,{children:[t.jsx(J,{color:"#012e54"}),t.jsx(R,{title:"Update User Information",subtitle:"Make Changes to user profile information",color:"primary.main"}),t.jsx(A,{}),t.jsx(Q,{initialValues:r==null?void 0:r.data,onSubmit:W,enableReinitialize:!0,validationSchema:$,children:({values:e,errors:a,touched:i,handleChange:n,handleSubmit:m,isSubmitting:E})=>t.jsxs(t.Fragment,{children:[t.jsx(M,{sx:{bgcolor:"#fff"},children:t.jsxs(u,{padding:2,spacing:2,children:[t.jsx(u,{alignSelf:"center",children:t.jsx(H,{handleImageUpload:z,children:t.jsx(q,{srcSet:T,sx:{width:100,height:100,alignSelf:"center"}})})}),t.jsx(N,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),t.jsxs(x,{children:[t.jsx(o,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:e.firstname,onChange:n("firstname"),error:!!(i.firstname&&a.firstname),helperText:i.firstname&&a.firstname}),t.jsx(o,{label:"Lastname",type:"text",fullWidth:!0,size:"small",value:e.lastname,onChange:n("lastname"),error:!!(i.lastname&&a.lastname),helperText:i.lastname&&a.lastname})]}),t.jsx(o,{label:"Username",fullWidth:!0,size:"small",value:(e==null?void 0:e.username)||"",onChange:n("username"),error:!!(i.username&&a.username),helperText:i.username&&a.username}),t.jsxs(x,{children:[t.jsx(O,{label:"Date of Birth",date:f,setDate:h,disableFuture:!0,error:!!(i.dateofbirth&&a.dateofbirth),helperText:i.dateofbirth&&a.dateofbirth}),t.jsxs(o,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(e==null?void 0:e.gender)||"",onChange:n("gender"),error:!!(i.gender&&a.gender),helperText:i.gender&&a.gender,children:[t.jsx(l,{value:"male",children:"male"}),t.jsx(l,{value:"female",children:"female"})]})]}),t.jsxs(o,{label:"Role",select:!0,fullWidth:!0,size:"small",value:(e==null?void 0:e.role)||"",onChange:n("role"),error:!!(i.role&&a.role),helperText:i.role&&a.role,children:[t.jsx(l,{value:"administrator",children:"Administrator"}),t.jsx(l,{value:"director",children:"Director"}),t.jsx(l,{value:"secretary",children:"Secretary"}),t.jsx(l,{value:"coordinator",children:"Exams Coordinator"}),t.jsx(l,{value:"teacher",children:"Facilitator"})]}),t.jsxs(x,{children:[t.jsx(o,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(e==null?void 0:e.email)||"",onChange:n("email"),error:!!(i.email&&a.email),helperText:i.email&&a.email}),t.jsx(o,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(e==null?void 0:e.phonenumber)||"",onChange:n("phonenumber"),error:!!(i.phonenumber&&a.phonenumber),helperText:i.phonenumber&&a.phonenumber})]}),t.jsx(o,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(e==null?void 0:e.address)||"",onChange:n("address"),error:!!(i.address&&a.address),helperText:i.address&&a.address}),t.jsxs(x,{children:[t.jsx(o,{label:"Place of Birth",type:"text",fullWidth:!0,size:"small",value:(e==null?void 0:e.residence)||"",onChange:n("residence"),error:!!(i.residence&&a.residence),helperText:i.residence&&a.residence}),t.jsx(o,{label:"Nationality",fullWidth:!0,size:"small",value:(e==null?void 0:e.nationality)||"",onChange:n("nationality"),error:!!(i.nationality&&a.nationality),helperText:i.nationality&&a.nationality})]}),t.jsx(X,{children:t.jsx(V,{loading:E||g,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:m,children:"Save Changes"})})]})}),g&&t.jsx(_,{value:"Saving Changes..."})]})})]})};Y.propTypes={};export{Y as default};
