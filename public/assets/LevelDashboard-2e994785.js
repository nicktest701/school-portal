import{r as v,a0 as Y,g as M,f as _,v as $,i as T,fe as ie,j as e,k as q,l as B,n as Q,ff as W,m as z,S as I,b as C,p as G,q as H,_ as R,t as w,s as O,ad as re,ae,E as ce,fg as de,H as me,et as pe,J as U,fh as ue,fi as fe,x as k,T as he,D as xe}from"./index-a08c4904.js";import{d as ge}from"./Class-ab495fe0.js";import{d as ve}from"./Subject-e14cac75.js";import{d as ye}from"./Person3-404ffae0.js";import{L as K,i as J,j as Le,k as je}from"./sessionColumns-7f037633.js";import{u as P}from"./useLevel-30b3786a.js";import{l as Se}from"./initialValues-b083bf80.js";import{b as X}from"./teacherAPI-16dbace5.js";import{A as b}from"./Autocomplete-62a3dcdf.js";import{C as Ce,L as F}from"./CustomizedMaterialTable-b0814305.js";import{E as be}from"./images-ee905b8b.js";import{L as A}from"./ListItemText-de69415f.js";import{G as we}from"./GlobalSpinner-41b13204.js";import{C as Ie}from"./CustomTitle-d0e5d50c.js";import{D as N}from"./DashboardCard-312d4cc7.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-fed72031.js";import"./Edit-d3e93a55.js";import"./Delete-ee750b69.js";import"./Chip-a33d5899.js";import"./TabPanel-3210be1c.js";import"./Toolbar-172ad7c3.js";import"./MenuItem-ddd79fe9.js";import"./listItemTextClasses-cdd81f8c.js";import"./Skeleton-f52aff28.js";import"./ButtonGroup-ed336fd9.js";import"./InputAdornment-16e34158.js";import"./CardContent-8cf1caa6.js";import"./ListItemSecondaryAction-33dcc31c.js";import"./Grid-d7986873.js";import"./useMediaQuery-dbbfc5b2.js";import"./ListItem-559aef15.js";import"./listItemButtonClasses-628cfd1a.js";import"./ListItemButton-b9f74f93.js";import"./Check-6932050c.js";import"./DeleteOutline-f3e83ed5.js";import"./Add-3c6bb686.js";const Ae=({open:r,setOpen:i})=>{const{userState:{session:h}}=v.useContext(Y),o=M(),{schoolSessionDispatch:c}=v.useContext(_),{levelsOption:x}=P(),j=$({queryKey:["teachers"],queryFn:()=>X(),select:n=>n==null?void 0:n.map(l=>({_id:l==null?void 0:l._id,fullName:l==null?void 0:l.fullName}))}),{mutateAsync:S,isLoading:y}=T({mutationFn:ie}),L=(n,a)=>{const l=`${n.level}${n.type}`,g=x.find(({type:t})=>t===l.toUpperCase());if(!R.isEmpty(g)){c(w("Level already exists!!!")),a.setSubmitting(!1);return}const d={session:h.sessionId,term:h.termId,level:{name:n.level,type:n.type},teacher:n.teacher};S(d,{onSettled:()=>{a.setSubmitting(!1),o.invalidateQueries(["levels"])},onSuccess:t=>{c(O(t)),i(!1)},onError:t=>{c(w(t))}})};return e.jsxs(q,{open:r,onClose:()=>i(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(B,{title:"New Level",onClose:()=>i(!1)}),e.jsx(Q,{initialValues:Se,onSubmit:L,validationSchema:W,children:({values:n,errors:a,touched:l,handleSubmit:g,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{sx:{p:1},children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(b,{freeSolo:!0,options:K,getOptionLabel:t=>t||"",value:n.level,onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(C,{...t,label:"Select Level",size:"small",error:!!(l.level&&a.level),helperText:l.level&&a.level})}),e.jsx(b,{freeSolo:!0,options:J,getOptionLabel:t=>t||"",value:n.type,onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(C,{...t,label:"Select Type",size:"small"})}),e.jsx(b,{options:j.data,loading:j.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",value:n.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(C,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(G,{sx:{padding:2},children:e.jsx(H,{loading:y,variant:"contained",onClick:g,children:"Add Level"})})]})})]})},Z="/assets/level_ico-a08a6fb9.svg";var V={},Te=ae;Object.defineProperty(V,"__esModule",{value:!0});var ee=V.default=void 0,Oe=Te(re()),_e=e;ee=V.default=(0,Oe.default)((0,_e.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");function Ee({viewProps:r,editProps:i,deleteProps:h,handleView:o,handleEdit:c,handleDelete:x}){return e.jsxs(I,{direction:"row",spacing:2,children:[o&&e.jsx(Le,{className:"ico",onClick:o,...r,sx:{color:"secondary.main !important"}}),c&&e.jsx(ce,{className:"ico",onClick:c,...i}),x&&e.jsx(ee,{className:"ico",onClick:x,...h})]})}const De=()=>{const r=M(),{schoolSessionState:{editLevel:{open:i,data:h}},schoolSessionDispatch:o}=v.useContext(_),{levelsOption:c}=P(),x=$({queryKey:["teachers"],queryFn:()=>X(),select:n=>n==null?void 0:n.map(l=>({_id:l==null?void 0:l._id,fullName:l==null?void 0:l.fullName}))}),{mutateAsync:j,isLoading:S}=T({mutationFn:de}),y=(n,a)=>{const l=`${n.level}${n.type}`,g=c.find(({type:t})=>t===l.toUpperCase());if(!R.isEmpty(g)){o(w("Level already exists!!!")),a.setSubmitting(!1);return}const d={_id:n==null?void 0:n._id,level:{name:n.level,type:n.type},teacher:n.teacher};console.log(d),j(d,{onSettled:()=>{a.setSubmitting(!1),r.invalidateQueries(["levels"])},onSuccess:t=>{o(O(t)),L()},onError:t=>{o(w(t))}})},L=()=>{o({type:"editLevel",payload:{open:!1,data:{}}})};return e.jsxs(q,{open:i,onClose:L,fullWidth:!0,maxWidth:"xs",children:[e.jsx(B,{title:"Edit Level",onClose:L}),e.jsx(Q,{initialValues:h,onSubmit:y,validationSchema:W,enableReinitialize:!0,children:({values:n,errors:a,touched:l,handleSubmit:g,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(b,{freeSolo:!0,options:K,getOptionLabel:t=>t||"",value:(n==null?void 0:n.level)||"",onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(C,{...t,label:"Level",size:"small",error:!!(l.level&&a.level),helperText:l.level&&a.level})}),e.jsx(b,{freeSolo:!0,options:J,getOptionLabel:t=>t||"",value:(n==null?void 0:n.type)||"",onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(C,{...t,label:"type",size:"small"})}),e.jsx(b,{options:x.data,loading:x.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",defaultValue:n==null?void 0:n.teacher,value:n==null?void 0:n.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(C,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(G,{sx:{padding:2},children:e.jsx(H,{loading:S,variant:"contained",onClick:g,children:"Save Changes"})})]})})]})};function ke(){var c;const{schoolSessionState:{viewLevel:{open:r,data:i}},schoolSessionDispatch:h}=v.useContext(_),o=()=>{h({type:"viewLevel",payload:{open:!1,data:{}}})};return e.jsxs(q,{open:r,onClose:o,fullWidth:!0,maxWidth:"xs",children:[e.jsx(B,{title:"Basic 1A Information",onClose:o}),e.jsx(z,{children:e.jsxs(I,{spacing:2,children:[e.jsx(A,{secondary:"Level",primary:i==null?void 0:i.type}),e.jsx(A,{secondary:"Number Of Students",primary:i==null?void 0:i.noOfStudents}),e.jsx(A,{secondary:"Number of Courses ",primary:i==null?void 0:i.noOfSubjects}),e.jsx(A,{secondary:"Class Teacher",primary:((c=i==null?void 0:i.teacher)==null?void 0:c.fullName)||"Not Assigned Yet"})]})})]})}const Ne=()=>{const{schoolSessionDispatch:r}=v.useContext(_),[i,h]=v.useState([]),{userState:{session:o}}=v.useContext(Y),c=me(),x=M(),[j,S]=v.useState(!1),y=$({queryKey:["levels",o.sessionId,o.termId],queryFn:()=>pe(o.sessionId,o.termId),enabled:!!o.sessionId&&!!(o!=null&&o.termId),initialData:[],select:s=>s==null?void 0:s.map(({_id:u,level:m,students:E,subjects:D,teacher:le})=>({_id:u,level:m,type:`${m==null?void 0:m.name}${m==null?void 0:m.type}`,noOfStudents:E==null?void 0:E.length,noOfSubjects:D==null?void 0:D.length,teacher:le}))}),{mutateAsync:L,isLoading:n}=T({mutationFn:ue}),a=s=>{const f={id:s,sessionId:o==null?void 0:o.sessionId,termId:o==null?void 0:o.termId};k.fire({title:"Removing Level",html:` <div style='text-align:left;display:flex;flex-direction:column;gap:8px;'>
      <p>  You are about to delete a level. This action is irreversible and will permanently remove all associated data,including:</p>
        <ul style='padding-block:8px;'>
   <li style='font-weight:bold;'>Class schedules</li>
  <li style='font-weight:bold;'>Student enrollments</li>
  <li style='font-weight:bold;'>Attendance records</li>
  <li style='font-weight:bold;'>Grades and assignments</li>
  <li style='font-weight:bold;'>Academic reports and records</li>
  </ul>
  
           <p>   Please proceed with caution. If you are certain you want to delete
              this academic year, click &apos;Confirm.&apos; Otherwise, click
              &apos;Cancel&apos; to keep the academic year intact.</p>
            <p style='color:var(--secondary);font-weight:bold;'>Are you sure you want to delete this level?</p>
          </div>`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:u})=>{u&&(k.showLoading(),L(f,{onSettled:()=>{x.invalidateQueries(["levels"])},onSuccess:m=>{r(O(m))},onError:m=>{r(w(m))}}))})},l=s=>{h(s)},{mutateAsync:g,isLoading:d}=T({mutationFn:fe}),t=()=>{k.fire({title:"Removing Session",text:"You are about to remove the selected sessions. Removing session will delete all of its related content.Changes cannot be undone. Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:s})=>{const f=R.map(i,"termId");s&&g(f,{onSettled:()=>{x.invalidateQueries(["terms"])},onSuccess:u=>{r(O(u))},onError:u=>{r(w(u))}})})},p=s=>{var u,m;const f={_id:s==null?void 0:s._id,level:(u=s==null?void 0:s.level)==null?void 0:u.name,type:(m=s==null?void 0:s.level)==null?void 0:m.type,teacher:s==null?void 0:s.teacher};r({type:"editLevel",payload:{open:!0,data:f}})},te=({_id:s,type:f})=>{const u=encodeURIComponent(f);c(`/level/course?_id=${s}&type=${u}`)},ne=({_id:s,type:f})=>{c(`/level/current/${s}/${f}`,{replace:!0,state:{levelId:s,levelName:f}})},se=s=>{r({type:"viewLevel",payload:{open:!0,data:s}})},oe=[...je,{field:null,title:"Class",width:"40%",render:s=>e.jsxs(I,{direction:"row",spacing:5,children:[e.jsx(F,{sx:{cursor:"pointer"},onClick:()=>ne(s),children:"Go to Class"}),e.jsx(F,{sx:{cursor:"pointer"},onClick:()=>te(s),children:"Add Subjects"})]})},{field:null,title:"Action",render:s=>e.jsx(Ee,{viewProps:{title:"View level information",titleAccess:"View level information"},editProps:{title:"Edit level information",titleAccess:"Edit level information"},deleteProps:{title:"Delete level information",titleAccess:"Delete level information"},handleView:()=>se(s),handleEdit:()=>p(s),handleDelete:()=>a(s==null?void 0:s._id)})}];return e.jsxs(U,{pt:2,children:[e.jsx(Ce,{title:"Levels",icon:Z,search:!0,isLoading:y.isLoading,columns:oe,data:y.data,actions:[],showAddButton:!0,addButtonText:"New Level",addButtonImg:be.level,addButtonMessage:"😑 Oops! It seems you don't have any level at the moment.Create a new one",onAddButtonClicked:()=>S(!0),handleRefresh:y.refetch,onSelectionChange:l,onDeleteClicked:t}),e.jsx(ke,{}),e.jsx(Ae,{open:j,setOpen:S}),e.jsx(De,{}),(n||d)&&e.jsx(we,{})]})},vt=()=>{const{levelSummary:r}=P();return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{title:"School Levels & Subjects",subtitle:"Organize and manage different educational levels to streamline curriculum and student progress tracking.",img:Z,color:"primary.main"}),e.jsx(he,{variant:"h5",py:2,children:"Level Details"}),e.jsx(xe,{}),e.jsxs(U,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:2,py:2},children:[e.jsx(N,{title:"Levels",value:r.noOfLevels,icon:e.jsx(ve,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(N,{title:"Courses Offered",value:r.noOfSubjects,icon:e.jsx(ge,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(N,{title:"Assigned Teachers",value:r.noOfAssignedTeachers,icon:e.jsx(ye,{sx:{width:30,height:30,color:"secondary.main"}})})]}),e.jsx(Ne,{})]})};export{vt as default};
