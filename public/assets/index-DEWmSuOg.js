import{K as oe,j as e,r as c,S as ne,a0 as ie,u as le,n as de,d as ce,C as pe,e as ue,w as me,k as g,l as L,T as y,$ as m,M as D,aw as he,B as A,y as xe,a8 as fe,Q as ge,f as je,g as ye,h as Ce,ax as Se,_ as ve}from"./index-DrgqF6h7.js";import{u as Te,A as Ie}from"./index-8Anm0BjK.js";import{L as Le,C as Ee,r as we,b as _e}from"./CustomizedMaterialTable-sErZg5Gy.js";import{I as R,E as be}from"./images-B5fNBSni.js";import{C as Pe}from"./CustomFormControl-BOFleHo6.js";import{I as Fe,d as Me}from"./sessionColumns-0BrYivn4.js";import{I as De}from"./studentColumns-Dev_8qkQ.js";import{I as Ae}from"./teacherColumn-B6aT-E-9.js";import{p as Re}from"./sessionAPI-DOHoXMTi.js";import{u as Be}from"./useLevel-C3V49YPJ.js";import{G as Ne}from"./GlobalSpinner-BW4FoSxW.js";import{A as Ue}from"./Autocomplete-D4vPEd6T.js";import{v as Oe}from"./v4-C6aID195.js";import"./TabPanel-Bl8roboH.js";import"./useThemeProps-DLRF2U3R.js";import"./Toolbar-Bzx_LBRC.js";import"./Chip-BcLQNplL.js";import"./Skeleton-BUD-o5ar.js";import"./ButtonGroup-DQMwsk7A.js";import"./ListItemText-Bwh_rzOL.js";import"./InputAdornment-EcTjtcuD.js";import"./index-_n9xtSlI.js";import"./DialogActions-Cx2GHHEW.js";import"./ListItem-yCsexoBs.js";import"./ListItemSecondaryAction-mmiMbVqP.js";import"./listItemButtonClasses-CLhmtlXH.js";import"./ListItemButton-BUsfko6u.js";import"./Check-CEGAxChF.js";import"./DeleteOutline-DM92K-00.js";import"./currencyFormatter-DjBDW3hY.js";import"./CircleRounded-Bh8WmZqU.js";import"./gradeColor-B1MTvGsq.js";const ze=oe(e.jsx("path",{d:"m19.41 7.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.42M14.8 15H13v3c0 .55-.45 1-1 1s-1-.45-1-1v-3H9.21c-.45 0-.67-.54-.35-.85l2.8-2.79c.2-.19.51-.19.71 0l2.79 2.79c.3.31.08.85-.36.85M14 9c-.55 0-1-.45-1-1V3.5L18.5 9z"}),"UploadFileRounded");function Ve(h){switch(h){case"students":return De;case"teachers":return Ae;case"subjects":return Me;case"grades":return Fe;default:return[]}}const Ct=()=>{var M;const h="text/csv",E="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",w="application/vnd.ms-excel",B=`".csv",
    "application/vnd.ms-excel",
    "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"`,{schoolSessionDispatch:_}=c.useContext(ne),{userState:{session:u}}=c.useContext(ie),N=le(),{state:C}=de(),[x,U]=c.useState({_id:"",type:""}),[r,O]=c.useState("students"),[o,z]=c.useState("personal-data"),[S,V]=c.useState(""),[i,p]=c.useState([]),[k,v]=c.useState(!1),[G,b]=c.useState(!1),[P,Y]=c.useState(""),{levelsOption:H}=Be(),{getRootProps:W,getInputProps:X,open:$,acceptedFiles:q}=Te({noClick:!0,noKeyboard:!0,maxFiles:20,accept:o==="personal-data"?B:{"image/*":[".jpeg",".png",".webp"]},maxSize:2e5,multiple:!0,onDrop:t=>{b(!0),ve.isEmpty(t)||(o==="personal-data"&&J(t[0]),o==="photos"&&Q(t)),b(!1)}}),F=(M=q[0])==null?void 0:M.type,K={dataCategory:r,dataType:o,levelValue:x,data:i,gradeName:S};function J(t){try{const s=new FileReader;t.type===h?s.readAsBinaryString(t):s.readAsArrayBuffer(t),s.onload=async function(d){let a=[];if([E,w].includes(t.type)&&(a=we(d.target.result)),t.type===h&&(a=_e(d.target.result)),p([]),r==="grades"){const n=a==null?void 0:a.map(l=>({id:Oe(),...l}));p(n);return}if(r==="subjects"){const n=a==null?void 0:a.map(l=>({...l,isCore:!!["Yes","True",!0].includes(l==null?void 0:l.isCore)}));p(n);return}p(a)}}catch(s){Y(s)}finally{v(!1)}}function Q(t){const d=Array.from(t).map(async a=>{var f;const l=await new Promise((j,re)=>{const T=new FileReader;T.onload=I=>{j(I.target.result)},T.onerror=I=>{re(I)},T.readAsDataURL(a)});return{id:(f=a.name)==null?void 0:f.split(".")[0],src:l}});Promise.all(d).then(a=>{p([]),p(a)}).catch(a=>{console.error("Error reading files: ",a)})}const{mutateAsync:Z,isLoading:ee}=ce({mutationFn:Re}),te=()=>{je.fire({title:"Importing results",text:`You are about to import ${r} ${o}.Proceed with import?`,showCancelButton:!0}).then(({isConfirmed:t})=>{if(t){v(!0);let s;["students","teachers"].includes(r)&&(s={dataCategory:r,dataType:o,data:{session:{sessionId:u==null?void 0:u.sessionId,termId:u==null?void 0:u.termId,levelId:x==null?void 0:x._id},students:i,type:"file"}},console.log(s)),r==="grades"&&(s={dataCategory:r,dataType:o,data:{name:S,ratings:i}}),r==="subjects"&&(s={dataCategory:r,dataType:o,data:i}),Z(s,{onSettled:()=>{v(!1)},onSuccess:d=>{_(ye(d)),N(C==null?void 0:C.prevPath)},onError:d=>{_(Ce(d))}})}})},ae=async()=>{await Se(r)},se=Ve(r);return e.jsxs(pe,{children:[e.jsx(ue,{title:"Data Uploads (Bulk Data Management)",subtitle:"Upload large sets of data, such as student information,teacher information,subjects, grades, and attendance records, to streamline data entry and management processes.",color:"primary.main"}),e.jsx(me,{initialValues:K,onSubmit:te,enableReinitialize:!0,children:({errors:t,touched:s,handleSubmit:d})=>e.jsxs(e.Fragment,{children:[e.jsxs(g,{spacing:2,py:4,px:2,my:4,border:"1px solid lightgray",children:[e.jsxs(L,{children:["Select an ",e.jsx("b",{children:"EXCEL"})," OR ",e.jsx("b",{children:"CSV"})," file containing student the data. Make sure the ",e.jsx("b",{children:"columns"})," matches the accepted fields. You can download a ",e.jsx("b",{children:"sample template"})," for your data."]}),e.jsxs(e.Fragment,{children:[e.jsxs(g,{py:2,children:[e.jsxs(Pe,{children:[e.jsx("div",{style:{width:"inherit"},children:e.jsxs(y,{label:"Choose Data Category",select:!0,fullWidth:!0,size:"small",value:r,onChange:a=>{O(a.target.value),p([])},error:!!(s.dataCategory&&t.dataCategory),helperText:s.dataCategory&&t.dataCategory,children:[e.jsx(m,{value:"students",children:"Students"}),e.jsx(m,{value:"teachers",children:"Teachers"}),e.jsx(m,{value:"subjects",children:"Subjects"}),e.jsx(m,{value:"grades",children:"Grades"})]})}),r==="students"&&e.jsx(Ue,{size:"small",fullWidth:!0,options:H,noOptionsText:"No Level available",getOptionLabel:a=>a.type||"",isOptionEqualToValue:(a,n)=>n._id===void 0||n._id===""||n._id===a._id,value:x,onChange:(a,n)=>U(n),renderInput:a=>{var n,l,f,j;return e.jsx(y,{fullWidth:!0,...a,label:"Select Level",size:"small",error:!!((n=s.levelValue)!=null&&n._id&&((l=t.levelValue)!=null&&l._id)),helperText:((f=s.levelValue)==null?void 0:f._id)&&((j=t.levelValue)==null?void 0:j._id),required:!0,FormHelperTextProps:{sx:{color:"error.main"}}})}}),["students","teachers"].includes(r)&&e.jsxs(y,{label:"Choose Data Type to Upload",select:!0,fullWidth:!0,size:"small",value:o,onChange:a=>z(a.target.value),error:!!(s.dataType&&t.dataType),helperText:s.dataType&&t.dataType,children:[e.jsx(m,{value:"personal-data",children:"Personal Data"}),e.jsx(m,{value:"photos",children:"Photos"})]}),r==="grades"&&e.jsx(y,{label:"Name of Grade System",fullWidth:!0,size:"small",value:S,onChange:a=>V(a.target.value),error:!!(s.gradeName&&t.gradeName),helperText:s.gradeName&&t.gradeName})]}),e.jsxs(Le,{sx:{cursor:"pointer",width:180},onClick:ae,variant:"caption",children:["Download ",r," template here"]})]}),e.jsx(D,{pt:2,children:e.jsxs(g,{border:"1px dotted #333",p:2,...W({className:"dropzone"}),justifyContent:"center",alignItems:"center",children:[e.jsx("input",{...X()}),F===h?e.jsx("img",{alt:"csv file",src:R.csv,style:{width:48,height:48}}):[E,w].includes(F)?e.jsx("img",{alt:"excel file",src:R.excel,style:{width:48,height:48}}):e.jsx(he,{sx:{width:36,height:36,alignSelf:"center"}}),e.jsxs(L,{variant:"body2",textAlign:"center",pt:4,paragraph:!0,children:["Drag & drop your"," ",o==="personal-data"?"data File":"photos"," ","here"]}),e.jsxs(A,{variant:"outlined",onClick:$,startIcon:o==="personal-data"?e.jsx(ze,{}):e.jsx(Ie,{}),children:["Upload"," ",o==="personal-data"?"File":"Photos"]})]})})]})]}),(i==null?void 0:i.length)>0&&e.jsxs(g,{direction:"row",justifyContent:"flex-end",width:"50%",children:[e.jsx(A,{children:"Cancel"}),e.jsx(xe,{variant:"contained",onClick:d,children:"Import Data"})]})]})}),e.jsxs(e.Fragment,{children:[P&&e.jsx(fe,{sx:{color:"red"},children:P}),o==="personal-data"?e.jsx(Ee,{icon:be.score,search:!0,title:r,columns:se,data:i,actions:[]}):e.jsx(D,{sx:{display:"flex",flexWrap:"wrap",gap:2,py:4,width:"100%"},children:i==null?void 0:i.map(t=>e.jsxs(g,{border:"1px solid #ccc",alignItems:"center",p:1,spacing:1,children:[e.jsx("img",{src:t==null?void 0:t.src,style:{width:100,height:100}}),e.jsx(L,{children:t==null?void 0:t.id})]},t==null?void 0:t.id))})]}),(k||G)&&e.jsx(ge,{}),ee&&e.jsx(Ne,{})]})};export{Ct as default};
