import{r as h,S as j,b as S,i as T,d as C,ac as v,j as e,L as B,ad as w,I,D as k,B as b,X as E,l as F,f as Q,g as A,h as _,W as q,c as z,C as N,e as P,w as M,ae as V,M as O,T as U,y as $,Q as K,af as W}from"./index-DrgqF6h7.js";import{u as D}from"./useLevel-C3V49YPJ.js";import{B as X}from"./Back-CADpxW16.js";import{g as Y}from"./teacherAPI-CExmebEp.js";import{L as G,A as H}from"./Autocomplete-D4vPEd6T.js";import{L}from"./ListItemText-Bwh_rzOL.js";import{R as J}from"./RefreshRounded-h_tq9q_G.js";import{L as Z}from"./ListItem-yCsexoBs.js";import{L as ee}from"./ListItemSecondaryAction-mmiMbVqP.js";import{D as se}from"./DialogActions-Cx2GHHEW.js";import"./Chip-BcLQNplL.js";import"./listItemButtonClasses-CLhmtlXH.js";function te(){const{schoolSessionDispatch:l}=h.useContext(j),m=S(),{id:n}=T(),{levelsOption:o}=D(),t=h.useMemo(()=>o==null?void 0:o.filter(s=>{var r;return((r=s==null?void 0:s.teacher)==null?void 0:r._id)===n}),[o,n]),{mutateAsync:x}=C({mutationFn:v}),g=s=>{Q.fire({title:"Unassign Teacher",text:"Do you want to unassign teacher from this level?",showCancelButton:!0,backdrop:!1}).then(r=>{r.isConfirmed&&x(s,{onSuccess:c=>{m.invalidateQueries(["levels"]),l(A(c))},onError:c=>{l(_(c))}})})};return e.jsx(B,{subheader:e.jsxs(G,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsx(L,{primary:"Assign Levels",secondary:"List of assigned levels",primaryTypographyProps:{fontSize:18,color:"var(--secondary)"},sx:{py:2}}),e.jsx(w,{title:"Refresh Levels",children:e.jsx(I,{children:e.jsx(J,{})})}),e.jsx(k,{})]}),sx:{pt:4},children:(t==null?void 0:t.length)>0?t==null?void 0:t.map(s=>e.jsxs(Z,{divider:!0,children:[e.jsx(L,{primary:s==null?void 0:s.type}),e.jsx(ee,{children:e.jsx(b,{title:"Remove Level",color:"error",size:"small",endIcon:e.jsx(E,{}),onClick:()=>g(s==null?void 0:s._id),children:"Remove"})})]},s==null?void 0:s._id)):e.jsx(F,{children:"No data available"})})}const ae=()=>{var y;const{schoolSessionDispatch:l}=h.useContext(j),m=S(),[n,o]=h.useState({_id:"",type:""}),{id:t}=T(),{levelsOption:x,levelLoading:g}=D(),s=z({queryKey:["teacher",t],queryFn:()=>Y(t),initialData:(y=m.getQueryData(["teachers",t]))==null?void 0:y.find(i=>(i==null?void 0:i._id)===t),enabled:!!t}),{mutateAsync:r,isLoading:c}=C({mutationFn:W}),R=(i,u)=>{var p;const f={_id:i==null?void 0:i._id,teacher:{_id:t,fullName:(p=s==null?void 0:s.data)==null?void 0:p.fullName}};r(f,{onSettled:()=>{m.invalidateQueries(["levels"]),u.setSubmitting(!1)},onSuccess:a=>{l(A(a))},onError:a=>{l(_(a))}})};return e.jsxs(N,{children:[e.jsx(X,{to:`/teacher/${t}`,color:"primary.main"}),e.jsx(P,{title:"Assign New Level",subtitle:"Allocate classrooms to teachers to facilitate organized and efficient learning environments.",color:"primary.main"}),e.jsx(M,{initialValues:n,validationSchema:V,onSubmit:R,enableReinitialize:!0,children:({errors:i,touched:u,handleSubmit:f,handleReset:p})=>e.jsx(e.Fragment,{children:e.jsxs(O,{sx:{mt:4,py:4,px:2,border:"1px solid lightgray",bgcolor:"#fff"},children:[e.jsx(H,{size:"small",options:x,loading:g,loadingText:"Loading levels.Please wait...",getOptionLabel:a=>(a==null?void 0:a.type)||"",isOptionEqualToValue:(a,d)=>d._id===void 0||d._id===""||d._id===a._id,value:n,onChange:(a,d)=>o(d),renderInput:a=>e.jsx(U,{...a,label:"Select a level",error:!!(u.type&&i.type),helperText:u.type&&i.type}),sx:{marginY:2}}),e.jsxs(se,{children:[e.jsx(b,{onClick:p,children:"Cancel"}),e.jsx($,{loading:c,variant:"contained",onClick:f,disabled:(n==null?void 0:n._id)==="",children:"Assign Level"})]})]})})}),e.jsx(te,{}),c&&e.jsx(K,{value:"Assigning Level.Please wait..."})]})},ge=q.memo(ae);export{ge as default};
