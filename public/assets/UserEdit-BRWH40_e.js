import{b as E,i as U,u as k,r as p,S as w,c as I,ar as L,m as y,d as P,j as t,e as R,D as A,w as Q,au as $,M,k as u,A as q,l as N,T as o,$ as l,y as V,Q as _,a1 as G,g as S,h as C}from"./index-DrgqF6h7.js";import{C as x}from"./CustomFormControl-BOFleHo6.js";import{u as K}from"./sessionAPI-DOHoXMTi.js";import{C as O}from"./CustomDatePicker-D2bLCilT.js";import{C as H}from"./CustomImageChooser-B_xkuEqQ.js";import{B as J}from"./Back-CADpxW16.js";import{D as X}from"./DialogActions-Cx2GHHEW.js";import"./AdapterMoment-Dv21LUiO.js";import"./index-_n9xtSlI.js";import"./useThemeProps-DLRF2U3R.js";import"./generateUtilityClasses-CIQngnWt.js";import"./createTheme-xb4osIQ4.js";import"./createStyled-CRj7xEq5.js";import"./InputAdornment-EcTjtcuD.js";import"./ListItem-yCsexoBs.js";import"./ListItemSecondaryAction-mmiMbVqP.js";import"./listItemButtonClasses-CLhmtlXH.js";import"./Chip-BcLQNplL.js";const Y=()=>{var b;const c=E(),{id:s}=U(),B=k(),[f,h]=p.useState(null),[T,j]=p.useState(null),{schoolSessionDispatch:d}=p.useContext(w),n=I({queryKey:["user",s],queryFn:()=>L(s),initialData:(b=c.getQueryData(["users"]))==null?void 0:b.find(e=>(e==null?void 0:e._id)===s)});p.useEffect(()=>{var e,a;h(y((e=n==null?void 0:n.data)==null?void 0:e.dateofbirth)),j(`/images/users/${(a=n==null?void 0:n.data)==null?void 0:a.profile}`)},[n==null?void 0:n.data]);const{mutateAsync:D,isLoading:g}=P({mutationFn:G}),W=(e,a)=>{delete e.profile,e.fullname=`${e==null?void 0:e.firstname} ${e==null?void 0:e.lastname}`,e.dateofbirth=y(f).format("L"),D(e,{onSettled:()=>{c.invalidateQueries(["users"]),a.setSubmitting(!1)},onSuccess:i=>{d(S(i)),B(`/users/${s}`)},onError:i=>{d(C(i))}})},z=async e=>{var r;const a=(r=e.target)==null?void 0:r.files[0],i={_id:s,profile:a,type:"users"};try{const m=await K(i);d(S(m)),j(URL.createObjectURL(a))}catch(m){d(C(m))}c.invalidateQueries(["users"])};return t.jsxs(t.Fragment,{children:[t.jsx(J,{color:"#012e54"}),t.jsx(R,{title:"Update User Information",subtitle:"Make Changes to user profile information",color:"primary.main"}),t.jsx(A,{}),t.jsx(Q,{initialValues:n==null?void 0:n.data,onSubmit:W,enableReinitialize:!0,validationSchema:$,children:({values:e,errors:a,touched:i,handleChange:r,handleSubmit:m,isSubmitting:F})=>t.jsxs(t.Fragment,{children:[t.jsx(M,{sx:{bgcolor:"#fff"},children:t.jsxs(u,{padding:2,spacing:2,children:[t.jsx(u,{alignSelf:"center",children:t.jsx(H,{handleImageUpload:z,children:t.jsx(q,{srcSet:T,sx:{width:100,height:100,alignSelf:"center"}})})}),t.jsx(N,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),t.jsxs(x,{children:[t.jsx(o,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:e.firstname,onChange:r("firstname"),error:!!(i.firstname&&a.firstname),helperText:i.firstname&&a.firstname}),t.jsx(o,{label:"Lastname",type:"text",fullWidth:!0,size:"small",value:e.lastname,onChange:r("lastname"),error:!!(i.lastname&&a.lastname),helperText:i.lastname&&a.lastname})]}),t.jsx(o,{label:"Username",fullWidth:!0,size:"small",value:(e==null?void 0:e.username)||"",onChange:r("username"),error:!!(i.username&&a.username),helperText:i.username&&a.username}),t.jsxs(x,{children:[t.jsx(O,{label:"Date of Birth",date:f,setDate:h,disableFuture:!0,error:!!(i.dateofbirth&&a.dateofbirth),helperText:i.dateofbirth&&a.dateofbirth}),t.jsxs(o,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(e==null?void 0:e.gender)||"",onChange:r("gender"),error:!!(i.gender&&a.gender),helperText:i.gender&&a.gender,children:[t.jsx(l,{value:"male",children:"male"}),t.jsx(l,{value:"female",children:"female"})]})]}),t.jsxs(o,{label:"Role",select:!0,fullWidth:!0,size:"small",value:(e==null?void 0:e.role)||"",onChange:r("role"),error:!!(i.role&&a.role),helperText:i.role&&a.role,children:[t.jsx(l,{value:"administrator",children:"Administrator"}),t.jsx(l,{value:"director",children:"Director"}),t.jsx(l,{value:"secretary",children:"Secretary"}),t.jsx(l,{value:"coordinator",children:"Exams Coordinator"}),t.jsx(l,{value:"teacher",children:"Facilitator"})]}),t.jsxs(x,{children:[t.jsx(o,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(e==null?void 0:e.email)||"",onChange:r("email"),error:!!(i.email&&a.email),helperText:i.email&&a.email}),t.jsx(o,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(e==null?void 0:e.phonenumber)||"",onChange:r("phonenumber"),error:!!(i.phonenumber&&a.phonenumber),helperText:i.phonenumber&&a.phonenumber})]}),t.jsx(o,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(e==null?void 0:e.address)||"",onChange:r("address"),error:!!(i.address&&a.address),helperText:i.address&&a.address}),t.jsxs(x,{children:[t.jsx(o,{label:"Place of Birth",type:"text",fullWidth:!0,size:"small",value:(e==null?void 0:e.residence)||"",onChange:r("residence"),error:!!(i.residence&&a.residence),helperText:i.residence&&a.residence}),t.jsx(o,{label:"Nationality",fullWidth:!0,size:"small",value:(e==null?void 0:e.nationality)||"",onChange:r("nationality"),error:!!(i.nationality&&a.nationality),helperText:i.nationality&&a.nationality})]}),t.jsx(X,{children:t.jsx(V,{loading:F||g,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:m,children:"Save Changes"})})]})}),g&&t.jsx(_,{value:"Saving Changes..."})]})})]})};Y.propTypes={};export{Y as default};
