import{r as L,a0 as V,b as M,S as E,c as $,d as T,fJ as le,j as e,v as B,w as q,y as Q,fK as Y,x as z,l as I,T as C,E as W,Q as G,_ as P,h as w,g as O,k as ie,fL as re,fM as ae,u as ce,f0 as de,M as K,fN as me,fO as pe,f as k,e as ue,m as fe,D as he}from"./index-ce442eb1.js";import{d as xe}from"./Class-614aa5d4.js";import{d as ge}from"./Subject-d60fab2e.js";import{d as ye}from"./Person3-1da9e9a8.js";import{L as U,i as H,j as ve,k as Le}from"./sessionColumns-a7ba1da8.js";import{u as F}from"./useLevel-0efe41ff.js";import{l as je}from"./initialValues-876203b9.js";import{b as J}from"./teacherAPI-30a6d8ad.js";import{A as b}from"./Autocomplete-87c4b1e1.js";import{D as X}from"./DialogActions-c9d7df2e.js";import{C as Se,L as R}from"./CustomizedMaterialTable-06b57d17.js";import{E as Ce}from"./images-ee905b8b.js";import{L as A}from"./ListItemText-b107adf9.js";import{G as be}from"./GlobalSpinner-9c6fc1be.js";import{D as N}from"./DashboardCard-fffc64d2.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-06f2dceb.js";import"./Edit-009e8578.js";import"./Delete-fb41f478.js";import"./Chip-15117b24.js";import"./TabPanel-47a179c1.js";import"./Toolbar-8b116404.js";import"./Skeleton-b715010d.js";import"./ButtonGroup-ca857561.js";import"./InputAdornment-92a613d9.js";import"./ListItemSecondaryAction-660d9daa.js";import"./useMediaQuery-5bcb3f64.js";import"./ListItem-2727fabf.js";import"./listItemButtonClasses-c7063ebe.js";import"./ListItemButton-97ec9750.js";import"./Check-4cc8eef7.js";import"./DeleteOutline-78b9d3f1.js";const we=({open:r,setOpen:i})=>{const{userState:{session:h}}=L.useContext(V),o=M(),{schoolSessionDispatch:c}=L.useContext(E),{levelsOption:x}=F(),y=$({queryKey:["teachers"],queryFn:()=>J(),initialData:[],select:n=>n==null?void 0:n.map(l=>({_id:l==null?void 0:l._id,fullName:l==null?void 0:l.fullName}))}),{mutateAsync:j,isLoading:v}=T({mutationFn:le}),S=(n,a)=>{const l=`${n.level}${n.type}`,g=x.find(({type:t})=>t===l.toUpperCase());if(!P.isEmpty(g)){c(w("Level already exists!!!")),a.setSubmitting(!1);return}const d={session:h.sessionId,term:h.termId,level:{name:n.level,type:n.type},teacher:n.teacher};j(d,{onSettled:()=>{a.setSubmitting(!1),o.invalidateQueries(["levels"])},onSuccess:t=>{c(O(t)),i(!1)},onError:t=>{c(w(t))}})};return e.jsxs(B,{open:r,onClose:()=>i(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(q,{title:"New Level",onClose:()=>i(!1)}),e.jsx(Q,{initialValues:je,onSubmit:S,validationSchema:Y,children:({values:n,errors:a,touched:l,handleSubmit:g,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{sx:{p:1},children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(b,{freeSolo:!0,options:U,getOptionLabel:t=>t||"",value:n.level,onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(C,{...t,label:"Select Level",size:"small",error:!!(l.level&&a.level),helperText:l.level&&a.level})}),e.jsx(b,{freeSolo:!0,options:H,getOptionLabel:t=>t||"",value:n.type,onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(C,{...t,label:"Select Type",size:"small"})}),e.jsx(b,{options:y==null?void 0:y.data,loading:y.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",value:n==null?void 0:n.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(C,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(X,{sx:{padding:2},children:e.jsx(W,{loading:v,variant:"contained",onClick:g,children:"Add Level"})})]})}),v&&e.jsx(G,{value:"Creating New Level. Please wait..."})]})},Z="/assets/level_ico-a08a6fb9.svg";function Ie({viewProps:r,editProps:i,deleteProps:h,handleView:o,handleEdit:c,handleDelete:x}){return e.jsxs(I,{direction:"row",spacing:2,children:[o&&e.jsx(ve,{className:"ico",onClick:o,...r,sx:{color:"secondary.main !important"}}),c&&e.jsx(ie,{className:"ico",onClick:c,...i}),x&&e.jsx(re,{className:"ico",onClick:x,...h})]})}const Ae=()=>{const r=M(),{schoolSessionState:{editLevel:{open:i,data:h}},schoolSessionDispatch:o}=L.useContext(E),{levelsOption:c}=F(),x=$({queryKey:["teachers"],queryFn:()=>J(),select:n=>n==null?void 0:n.map(l=>({_id:l==null?void 0:l._id,fullName:l==null?void 0:l.fullName}))}),{mutateAsync:y,isLoading:j}=T({mutationFn:ae}),v=(n,a)=>{const l=`${n.level}${n.type}`,g=c.find(({type:t})=>t===l.toUpperCase());if(!P.isEmpty(g)){o(w("Level already exists!!!")),a.setSubmitting(!1);return}const d={_id:n==null?void 0:n._id,level:{name:n.level,type:n.type},teacher:n.teacher};console.log(d),y(d,{onSettled:()=>{a.setSubmitting(!1),r.invalidateQueries(["levels"])},onSuccess:t=>{o(O(t)),S()},onError:t=>{o(w(t))}})},S=()=>{o({type:"editLevel",payload:{open:!1,data:{}}})};return e.jsxs(B,{open:i,onClose:S,fullWidth:!0,maxWidth:"xs",children:[e.jsx(q,{title:"Edit Level",onClose:S}),e.jsx(Q,{initialValues:h,onSubmit:v,validationSchema:Y,enableReinitialize:!0,children:({values:n,errors:a,touched:l,handleSubmit:g,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(b,{freeSolo:!0,options:U,getOptionLabel:t=>t||"",value:(n==null?void 0:n.level)||"",onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(C,{...t,label:"Level",size:"small",error:!!(l.level&&a.level),helperText:l.level&&a.level})}),e.jsx(b,{freeSolo:!0,options:H,getOptionLabel:t=>t||"",value:(n==null?void 0:n.type)||"",onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(C,{...t,label:"type",size:"small"})}),e.jsx(b,{options:x.data,loading:x.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",defaultValue:n==null?void 0:n.teacher,value:n==null?void 0:n.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(C,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(X,{sx:{padding:2},children:e.jsx(W,{loading:j,variant:"contained",onClick:g,children:"Save Changes"})})]})}),j&&e.jsx(G,{value:"Saving Changes..."})]})};function Te(){var c;const{schoolSessionState:{viewLevel:{open:r,data:i}},schoolSessionDispatch:h}=L.useContext(E),o=()=>{h({type:"viewLevel",payload:{open:!1,data:{}}})};return e.jsxs(B,{open:r,onClose:o,fullWidth:!0,maxWidth:"xs",children:[e.jsx(q,{title:"Basic 1A Information",onClose:o}),e.jsx(z,{children:e.jsxs(I,{spacing:2,children:[e.jsx(A,{secondary:"Level",primary:i==null?void 0:i.type}),e.jsx(A,{secondary:"Number Of Students",primary:i==null?void 0:i.noOfStudents}),e.jsx(A,{secondary:"Number of Courses ",primary:i==null?void 0:i.noOfSubjects}),e.jsx(A,{secondary:"Class Teacher",primary:((c=i==null?void 0:i.teacher)==null?void 0:c.fullName)||"Not Assigned Yet"})]})})]})}const Oe=()=>{const{schoolSessionDispatch:r}=L.useContext(E),[i,h]=L.useState([]),{userState:{session:o}}=L.useContext(V),c=ce(),x=M(),[y,j]=L.useState(!1),v=$({queryKey:["levels",o.sessionId,o.termId],queryFn:()=>de(o.sessionId,o.termId),enabled:!!o.sessionId&&!!(o!=null&&o.termId),initialData:[],select:s=>s==null?void 0:s.map(({_id:u,level:m,students:D,subjects:_,teacher:oe})=>({_id:u,level:m,type:`${m==null?void 0:m.name}${m==null?void 0:m.type}`,noOfStudents:D==null?void 0:D.length,noOfSubjects:_==null?void 0:_.length,teacher:oe}))}),{mutateAsync:S,isLoading:n}=T({mutationFn:me}),a=s=>{const f={id:s,sessionId:o==null?void 0:o.sessionId,termId:o==null?void 0:o.termId};k.fire({title:"Removing Level",html:` <div style='text-align:left;display:flex;flex-direction:column;gap:8px;'>
      <p>  You are about to delete a level. This action is irreversible and will permanently remove all associated data,including:</p>
        <ul style='padding-block:8px;'>
   <li style='font-weight:bold;'>Class schedules</li>
  <li style='font-weight:bold;'>Student enrollments</li>
  <li style='font-weight:bold;'>Attendance records</li>
  <li style='font-weight:bold;'>Grades and assignments</li>
  <li style='font-weight:bold;'>Academic reports and records</li>
  </ul>
  
           <p>   Please proceed with caution. If you are certain you want to delete
              this academic year, click &apos;Confirm.&apos; Otherwise, click
              &apos;Cancel&apos; to keep the academic year intact.</p>
            <p style='color:var(--secondary);font-weight:bold;'>Are you sure you want to delete this level?</p>
          </div>`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:u})=>{u&&(k.showLoading(),S(f,{onSettled:()=>{x.invalidateQueries(["levels"])},onSuccess:m=>{r(O(m))},onError:m=>{r(w(m))}}))})},l=s=>{h(s)},{mutateAsync:g,isLoading:d}=T({mutationFn:pe}),t=()=>{k.fire({title:"Removing Session",text:"You are about to remove the selected sessions. Removing session will delete all of its related content.Changes cannot be undone. Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:s})=>{const f=P.map(i,"termId");s&&g(f,{onSettled:()=>{x.invalidateQueries(["terms"])},onSuccess:u=>{r(O(u))},onError:u=>{r(w(u))}})})},p=s=>{var u,m;const f={_id:s==null?void 0:s._id,level:(u=s==null?void 0:s.level)==null?void 0:u.name,type:(m=s==null?void 0:s.level)==null?void 0:m.type,teacher:s==null?void 0:s.teacher};r({type:"editLevel",payload:{open:!0,data:f}})},ee=({_id:s,type:f})=>{const u=encodeURIComponent(f);c(`/level/course?_id=${s}&type=${u}`)},te=({_id:s,type:f})=>{c(`/level/current/${s}/${f}`,{replace:!0,state:{levelId:s,levelName:f}})},ne=s=>{r({type:"viewLevel",payload:{open:!0,data:s}})},se=[...Le,{field:null,title:"Class",width:"40%",render:s=>e.jsxs(I,{direction:"row",spacing:5,children:[e.jsx(R,{sx:{cursor:"pointer"},onClick:()=>te(s),children:"Go to Class"}),e.jsx(R,{sx:{cursor:"pointer"},onClick:()=>ee(s),children:"Add Subjects"})]})},{field:null,title:"Action",render:s=>e.jsx(Ie,{viewProps:{title:"View level information",titleAccess:"View level information"},editProps:{title:"Edit level information",titleAccess:"Edit level information"},deleteProps:{title:"Delete level information",titleAccess:"Delete level information"},handleView:()=>ne(s),handleEdit:()=>p(s),handleDelete:()=>a(s==null?void 0:s._id)})}];return e.jsxs(K,{pt:2,children:[e.jsx(Se,{title:"Levels",icon:Z,search:!0,isLoading:v.isLoading,columns:se,data:v.data,actions:[],showAddButton:!0,addButtonText:"New Level",addButtonImg:Ce.level,addButtonMessage:"😑 Oops! It seems you don't have any level at the moment.Create a new one",onAddButtonClicked:()=>j(!0),handleRefresh:v.refetch,onSelectionChange:l,onDeleteClicked:t}),e.jsx(Te,{}),e.jsx(we,{open:y,setOpen:j}),e.jsx(Ae,{}),(n||d)&&e.jsx(be,{})]})},at=()=>{const{levelSummary:r}=F();return e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"School Levels & Subjects",subtitle:"Organize and manage different educational levels to streamline curriculum and student progress tracking.",img:Z,color:"primary.main"}),e.jsx(fe,{variant:"h5",py:2,children:"Level Details"}),e.jsx(he,{}),e.jsxs(K,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:2,py:2},children:[e.jsx(N,{title:"Levels",value:r.noOfLevels,icon:e.jsx(ge,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(N,{title:"Courses Offered",value:r.noOfSubjects,icon:e.jsx(xe,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(N,{title:"Assigned Teachers",value:r.noOfAssignedTeachers,icon:e.jsx(ye,{sx:{width:30,height:30,color:"secondary.main"}})})]}),e.jsx(Oe,{})]})};export{at as default};
