import{r as a,S as O,u as k,a0 as j,h as A,j as e,i as L,y as R,C as z,F as V,l as q,m as Y,T as F,aX as D,q as N,D as P,t as Q,v as _,w as E,x as v,aY as W,aB as G,aZ as $,aI as H,X as K,g as X,a2 as J,E as U,a_ as B,G as Z,a$ as ee,J as te,K as I}from"./index-c7bc4969.js";import{p as se,a as ae,g as ne,d as oe,b as ie}from"./termAPI-d4ccc502.js";import{s as re}from"./initialValues-3197b278.js";import{C as M}from"./CustomYearPicker-ff534cfb.js";const le=()=>{const{schoolSessionState:{editSession:{open:i,data:t}},schoolSessionDispatch:r}=a.useContext(O),p=k(),[h,c]=a.useState(null),[g,x]=a.useState(null),[f,n]=a.useState(null),[l,d]=a.useState(null);a.useEffect(()=>{c(j(new Date(t.from))),x(j(new Date(t.to))),n(j(new Date(t.vacationDate))),d(j(new Date(t.reOpeningDate)))},[t]);const C={id:t.termId,from:h,to:g,vacationDate:f,reOpeningDate:l,academicYear:t.academicYear,term:t.term,session:t.sessionId},{mutateAsync:u,isLoading:b}=A({mutationFn:se}),T=(o,s)=>{u(o,{onSettled:()=>{s.setSubmitting(!1),p.invalidateQueries(["terms"])},onSuccess:S=>{r(E(S)),m()},onError:S=>{r(v(S))}})},m=()=>{r({type:"editSession",payload:{open:!1,data:{}}})};return e.jsxs(L,{open:i,onClose:m,fullWidth:!0,maxWidth:"xs",TransitionComponent:R,children:[e.jsx(z,{title:"Edit Session",onClose:m}),e.jsx(V,{initialValues:C,onSubmit:T,enableReinitialize:!0,children:({values:o,touched:s,errors:S,handleChange:w,handleSubmit:y})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs(Y,{spacing:2,paddingY:2,children:[e.jsx(F,{label:"Academic Year",InputProps:{readOnly:!0},value:o.academicYear,size:"small"}),e.jsx(D,{label:"Start of Academic Term",date:h,setDate:c,touched:s.from,error:S.from,readOnly:!0}),e.jsx(D,{label:"End of Academic Term",date:g,setDate:x,touched:s.to,error:S.to,readOnly:!0}),e.jsx(F,{label:"Term/Semester",size:"small",value:o.term,onChange:w("term"),InputProps:{readOnly:!0}}),e.jsx(N,{fontSize:13,children:"Vacation"}),e.jsx(D,{label:"Vacation Date",date:f,setDate:n}),e.jsx(D,{label:"Next Term Begins",date:l,setDate:d}),e.jsx(P,{})]})}),e.jsx(Q,{sx:{padding:2},children:e.jsx(_,{loading:b,variant:"contained",onClick:y,children:b?"Please Wait..":"Save Changes"})})]})})]})},de=()=>{const{schoolSessionState:i,schoolSessionDispatch:t}=a.useContext(O),r=k(),[p,h]=a.useState(j()),[c,g]=a.useState(j()),[x,f]=a.useState(""),[n,l]=a.useState(""),{mutateAsync:d,isLoading:C}=A({mutationFn:ae}),u=new Date().getFullYear(),b=(m,o)=>{m.academicYear=`${x||u}/${n||u}`,d(m,{onSettled:()=>{o.setSubmitting(!1),r.invalidateQueries(["terms"])},onSuccess:s=>{t(E(s)),T()},onError:s=>{t(v(s))}})};function T(){t({type:"displayAddSession",payload:!1})}return e.jsxs(L,{open:i.displayAddSession,fullWidth:!0,maxWidth:"xs",TransitionComponent:R,children:[e.jsx(z,{title:"Add Session",onClose:T}),e.jsx(V,{initialValues:{...re,from:p.format("l"),to:c.format("l")},onSubmit:b,validationSchema:W,enableReinitialize:!0,children:({values:m,errors:o,touched:s,handleChange:S,handleSubmit:w})=>e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsxs(Y,{spacing:2,paddingY:2,children:[e.jsx(G,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(Y,{direction:"row",columnGap:2,children:[e.jsx(M,{label:"From",year:x,setYear:f}),e.jsx(M,{label:"To",year:n,setYear:l})]}),e.jsx(D,{label:"Start of Academic Term/Semester",date:p,setDate:h,touched:s.from,error:o.from}),e.jsx(D,{label:"End of Academic Term/Semester",date:c,setDate:g,touched:s.to,error:o.to}),e.jsx(F,{select:!0,label:"Term/Semester",size:"small",value:m.term,onChange:S("term"),error:!!(s.term&&o.term),helperText:s.term&&o.term,children:$.map(y=>e.jsx(H,{value:y,children:y},y))}),e.jsx(P,{})]})}),e.jsx(Q,{sx:{padding:2},children:e.jsx(_,{loading:C,variant:"contained",onClick:w,children:C?"Saving":"Save"})})]})})]})},he=()=>{K();const{schoolSessionDispatch:i}=a.useContext(O),t=k(),r=X({queryKey:["terms"],queryFn:()=>ne()}),{mutateAsync:p}=A({mutationFn:oe}),h=n=>{I.fire({title:"Removing Session",text:"Removing session will delete all of its related content.Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:l})=>{l&&p(n,{onSettled:()=>{t.invalidateQueries(["terms"])},onSuccess:d=>{i(E(d))},onError:d=>{i(v(d))}})})},c=n=>{i({type:"editSession",payload:{open:!0,data:n}})},g=()=>{i({type:"displayAddSession",payload:!0})},{mutateAsync:x}=A({mutationFn:ie}),f=({_id:n,active:l})=>{I.fire({title:l?"Do you want to disable this session":"Do you want to enable this session",text:l?"Disabling Session":"Enabling Session",showCancelButton:!0,backdrop:!1}).then(d=>{d.isConfirmed&&x({_id:n,active:!l},{onSuccess:u=>{t.invalidateQueries(["terms"]),i(E(u))},onError:u=>{i(v(u))}})})};return e.jsxs(J,{sx:{bgcolor:"whitesmoke"},children:[e.jsx(U,{title:"School Session",subtitle:"  Track,manage and control academic and class activities",img:B,color:"primary.main"}),e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Sessions",icon:B,isLoading:r.isLoading,columns:ee(f,c,h),data:r.data?r.data:[],actions:[],showRowShadow:!1,handleEdit:c,handleDelete:h,showAddButton:!0,addButtonImg:te.session,addButtonMessage:"ðŸ˜‘ No School Session available!.Create a new one!",addButtonText:"New Session",onAddButtonClicked:g,handleRefresh:r.refetch,options:{search:!0}}),e.jsx(de,{}),e.jsx(le,{})]})]})};export{he as default};
