import{b as O,u as Q,i as R,r as b,S as M,c as $,m as z,d as U,j as l,Y as q,C as Y,e as _,D as G,w as K,Z as V,M as Z,k as D,A as H,l as J,T as p,$ as L,B as X,y as c,Q as v,g as w,h as I}from"./index-DrgqF6h7.js";import{g as h,p as u}from"./teacherAPI-CExmebEp.js";import{C as j}from"./CustomFormControl-BOFleHo6.js";import{u as r}from"./sessionAPI-DOHoXMTi.js";import{C as ii}from"./CustomDatePicker-D2bLCilT.js";import{T as ai,N as ni}from"./nationality-Dhsqpti8.js";import{C as li}from"./CustomImageChooser-B_xkuEqQ.js";import{B as ti}from"./Back-CADpxW16.js";import{A as N}from"./Autocomplete-D4vPEd6T.js";import{D as ei}from"./DialogActions-Cx2GHHEW.js";import"./AdapterMoment-Dv21LUiO.js";import"./index-_n9xtSlI.js";import"./useThemeProps-DLRF2U3R.js";import"./generateUtilityClasses-CIQngnWt.js";import"./createTheme-xb4osIQ4.js";import"./createStyled-CRj7xEq5.js";import"./InputAdornment-EcTjtcuD.js";import"./ListItem-yCsexoBs.js";import"./ListItemSecondaryAction-mmiMbVqP.js";import"./listItemButtonClasses-CLhmtlXH.js";import"./Chip-BcLQNplL.js";const mi=()=>{var W;const f=O(),A=Q(),{id:m}=R(),[T,C]=b.useState(null),[k,S]=b.useState(null),{schoolSessionDispatch:g}=b.useContext(M),t=$({queryKey:["teacher",m],queryFn:()=>h(m),initialData:(W=f.getQueryData(["teachers",m]))==null?void 0:W.find(n=>(n==null?void 0:n._id)===m),enabled:!!m});b.useEffect(()=>{var n,i;C(z((n=t==null?void 0:t.data)==null?void 0:n.dateofbirth)),S(`/images/users/${(i=t==null?void 0:t.data)==null?void 0:i.profile}`)},[t==null?void 0:t.data]);const{mutateAsync:E,isLoading:o}=U({mutationFn:u}),P=n=>{n==null||delete n.profile,n.dateofbirth=z(T).format("L"),E(n,{onSettled:()=>{f.invalidateQueries(["teachers"]),f.invalidateQueries(["teacher",m])},onSuccess:i=>{g(w(i)),B()},onError:i=>{g(I(i))}})},d=async n=>{var x;const i=(x=n.target)==null?void 0:x.files[0],a={_id:m,profile:i,type:"teachers"};try{const e=await r(a);g(w(e)),S(URL.createObjectURL(i))}catch(e){g(I(e))}f.invalidateQueries(["teachers"])},B=()=>{A(`/teacher/${m}`)};return t!=null&&t.isLoading?l.jsx(q,{}):l.jsxs(Y,{children:[l.jsx(ti,{to:`/teacher/${m}`,color:"primary.main"}),l.jsx(_,{title:"Edit Teacher",subtitle:"Manage teachers profile",color:"primary.main"}),l.jsx(G,{}),l.jsx(K,{initialValues:t==null?void 0:t.data,onSubmit:P,enableReinitialize:!0,validationSchema:V,children:({values:n,errors:i,touched:a,setFieldValue:x,handleChange:e,handleSubmit:F})=>l.jsx(l.Fragment,{children:l.jsx(Z,{sx:{bgcolor:"#fff"},children:l.jsxs(D,{padding:2,spacing:1,children:[l.jsx(D,{alignSelf:"center",children:l.jsx(li,{handleImageUpload:d,children:l.jsx(H,{srcSet:k,sx:{width:100,height:100,alignSelf:"center"}})})}),l.jsx(J,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),l.jsxs(j,{children:[l.jsx(p,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:(n==null?void 0:n.firstname)||"",onChange:e("firstname"),error:!!(a!=null&&a.firstname&&(i!=null&&i.firstname)),helperText:(a==null?void 0:a.firstname)&&(i==null?void 0:i.firstname)}),l.jsx(p,{label:"Surname",fullWidth:!0,size:"small",value:(n==null?void 0:n.surname)||"",onChange:e("surname"),error:!!(a!=null&&a.surname&&(i!=null&&i.surname)),helperText:(a==null?void 0:a.surname)&&(i==null?void 0:i.surname)})]}),l.jsx(p,{label:"Username",fullWidth:!0,size:"small",value:(n==null?void 0:n.username)||"",onChange:e("username"),error:!!(a!=null&&a.username&&(i!=null&&i.username)),helperText:(a==null?void 0:a.username)&&(i==null?void 0:i.username)}),l.jsxs(j,{children:[l.jsx(ii,{label:"Date of Birth",date:T,setDate:C,disableFuture:!0,touched:!!(a!=null&&a.dateofbirth&&(i!=null&&i.dateofbirth)),error:(a==null?void 0:a.dateofbirth)&&(i==null?void 0:i.dateofbirth)}),l.jsxs(p,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(n==null?void 0:n.gender)||"",onChange:e("gender"),error:!!(a!=null&&a.gender&&(i!=null&&i.gender)),helperText:(a==null?void 0:a.gender)&&(i==null?void 0:i.gender),children:[l.jsx(L,{value:"male",children:"male"}),l.jsx(L,{value:"female",children:"female"})]})]}),l.jsxs(j,{children:[l.jsx(p,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(n==null?void 0:n.email)||"",onChange:e("email"),error:!!(a!=null&&a.email&&(i!=null&&i.email)),helperText:(a==null?void 0:a.email)&&(i==null?void 0:i.email)}),l.jsx(p,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(n==null?void 0:n.phonenumber)||"",onChange:e("phonenumber"),error:!!(a!=null&&a.phonenumber&&(i!=null&&i.phonenumber)),helperText:(a==null?void 0:a.phonenumber)&&(i==null?void 0:i.phonenumber)})]}),l.jsx(p,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(n==null?void 0:n.address)||"",onChange:e("address"),error:!!(a!=null&&a.address&&(i!=null&&i.address)),helperText:(a==null?void 0:a.address)&&(i==null?void 0:i.address)}),l.jsxs(j,{children:[l.jsx(N,{freeSolo:!0,fullWidth:!0,size:"small",options:ai,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:s=>s||"",value:(n==null?void 0:n.residence)||"",onChange:(s,y)=>x("residence",y),renderInput:s=>l.jsx(p,{...s,label:"Residence",fullWidth:!0,size:"small",error:!!(a!=null&&a.residence&&(i!=null&&i.residence)),helperText:(a==null?void 0:a.residence)&&(i==null?void 0:i.residence)})}),l.jsx(N,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:ni,noOptionsText:"No Nationality available",getOptionLabel:s=>s||"",value:(n==null?void 0:n.nationality)||"",onChange:(s,y)=>x("nationality",y),renderInput:s=>l.jsx(p,{...s,label:"Nationality",fullWidth:!0,size:"small",error:!!(a!=null&&a.nationality&&(i!=null&&i.nationality)),helperText:(a==null?void 0:a.nationality)&&(i==null?void 0:i.nationality)})})]}),l.jsxs(ei,{children:[l.jsx(X,{onClick:B,children:"Cancel"}),l.jsx(c,{loading:o,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:F,children:"Save Changes"})]})]})})})}),o&&l.jsx(v,{value:"Saving Changes.."})]})};mi.propTypes={};export{mi as default};
