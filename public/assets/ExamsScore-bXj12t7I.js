import{p as J,j as e,X as ne,r as p,a1 as Z,S as M,d as ee,t as ce,am as ie,v as le,B as y,w as de,f as xe,g as se,h as te,an as me,I as re,Y as he,i as pe,b as je,a as oe,x as ue,ao as Se,O as ge,k as D,ap as G,l as a,T as H,_ as z,n as be,c as fe,e as ye,Q as V,aq as ve,ar as Ce,P as i,as as Re,D as Q}from"./index-B8PQHtjc.js";import{l as Te}from"./index-DThQnLGZ.js";import{p as Pe,u as Ie,g as ke}from"./ExaminationAPI-gfcTwHm9.js";import{R as we}from"./ReportCard-RdGRC-ge.js";import{D as Ee}from"./DialogActions-BmNk8sop.js";import{g as Ae}from"./generateCustomGrade-DQ-rrl9K.js";import{u as Be}from"./useLevelById-K7PyoswH.js";import{T as Le,a as ze,b as De,c as Y,d as N,e as Fe,C as Ge,L as He}from"./CustomizedMaterialTable-BQoTtwVw.js";import{A as Ve}from"./Autocomplete-Dw57Ihk7.js";import{s as Ne}from"./student_ico-BGUw5C9J.js";import{g as F}from"./gradeColor-B1MTvGsq.js";import{S as Me}from"./School-F8mJoAwr.js";import{G as $}from"./Group-BzuzwgJj.js";import{A as _e}from"./AssignmentTurnedIn-BpA451nf.js";import{B as Oe}from"./Back-D8wcFeGb.js";import{P as We}from"./Person-mhly5Vw0.js";import{R as qe}from"./RefreshRounded-DD-ja5GB.js";import{G as L}from"./Grid2-B2FVLpOz.js";import{N as Qe}from"./NoteAltRounded-B38TZnH0.js";import{T as Ye,a as $e,b as K,c as U}from"./TabPanel-WHfZdNAn.js";import"./ReportItemUnderline-MmYFOo6z.js";import"./Link-kLE4_HTq.js";import"./Toolbar-YM__bEFh.js";import"./Chip-DmEpgF7y.js";import"./useThemeProps-CEPKeDia.js";import"./Skeleton-DWRiBFRT.js";import"./ButtonGroup-ZC3qSltg.js";import"./ListItemText-DzMM1D1F.js";import"./InputAdornment-DAOlZ4uj.js";import"./index-BqG4A_N5.js";import"./ListItem-CQImyTSy.js";import"./ListItemSecondaryAction-DOVMjMKm.js";import"./listItemButtonClasses-DySKLRoc.js";import"./ListItemButton-Di0YOqWQ.js";import"./Check-JB41DPzl.js";import"./DeleteOutline-BlPFLwFk.js";import"./images-B5fNBSni.js";const Ke=J(e.jsx("path",{d:"M17.5 13.5H16v-3h1.5zM16 2c-.55 0-1 .45-1 1v1H9V3c0-.55-.45-1-1-1s-1 .45-1 1v1H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3V3c0-.55-.45-1-1-1M9.5 14.25c0 .41-.34.75-.75.75H6c-.55 0-1-.45-1-1v-1.5c0-.55.45-1 1-1h2v-1H5.75c-.41 0-.75-.34-.75-.75S5.34 9 5.75 9H8.5c.55 0 1 .45 1 1v1.5c0 .55-.45 1-1 1h-2v1h2.25c.41 0 .75.34.75.75M19 14c0 .55-.45 1-1 1h-2.5c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1H18c.55 0 1 .45 1 1zm-6.25-7.25c0 .41-.34.75-.75.75s-.75-.34-.75-.75S11.59 6 12 6s.75.34.75.75m0 3.5c0 .41-.34.75-.75.75s-.75-.34-.75-.75.34-.75.75-.75.75.34.75.75m0 3.5c0 .41-.34.75-.75.75s-.75-.34-.75-.75.34-.75.75-.75.75.34.75.75m0 3.5c0 .41-.34.75-.75.75s-.75-.34-.75-.75.34-.75.75-.75.75.34.75.75"}),"ScoreboardRounded"),Ue=J(e.jsx("path",{d:"m19.41 7.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.42m-9.18 9.88-2.12-2.12a.996.996 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0l1.41 1.41 3.54-3.54c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41l-4.24 4.24c-.38.4-1.02.4-1.41.01M14 9c-.55 0-1-.45-1-1V3.5L18.5 9z"}),"TaskRounded"),Xe=({student:t})=>{const{userState:{session:x}}=p.useContext(Z),{schoolSessionState:c,schoolSessionDispatch:o}=p.useContext(M),l=p.useRef(),s=c.viewReport.open,d=()=>{o({type:"closeViewReport"})},{mutateAsync:v,isPending:m}=ee({mutationFn:Pe}),S=()=>{xe.fire({title:"Publishing Reports",text:`You are about to publish the report of ${(t==null?void 0:t.fullName)||"student"}.Do you wish to continue?`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:C})=>{if(C){o({type:"openGeneralAlert",payload:{message:"Publishing reports.This might take a while please wait....",severity:"info"}});const R={sessionId:x.sessionId,termId:x.termId,student:t==null?void 0:t._id,level:t==null?void 0:t.levelId};v(R,{onSuccess:()=>{o(se("Results have been published Successfully!!!"))},onError:()=>{o(te("An error has occured.Couldnt Generate Reports.Try again later"))}})}})},j=Te.useReactToPrint({documentTitle:t==null?void 0:t.fullName,contentRef:l});return e.jsx(e.Fragment,{children:e.jsxs(ce,{open:s,onClose:d,fullWidth:!0,maxWidth:"md",TransitionComponent:ie,children:[e.jsx(le,{title:"Report Card",onClose:d}),e.jsxs(Ee,{children:[e.jsx(y,{loading:m,onClick:S,children:m?"Please Wait....":"Publish Report"}),e.jsx(y,{variant:"contained",onClick:()=>j(),children:"Print Report"})]}),e.jsx(de,{children:e.jsx(we,{student:t,ref:l})})]})})},Je=ne.memo(Xe),X={subject:"Subject",classScore:"Class",examsScore:"Exams",totalScore:"Total",grade:"Grade",remarks:"Remarks"},Ze=({data:t,setData:x})=>{const c=o=>{x(l=>l.filter(({subject:d})=>(d==null?void 0:d._id)!==o))};return e.jsx(Le,{component:me,children:e.jsxs(ze,{children:[e.jsx(De,{children:e.jsx(Y,{children:Object.values(X).map((o,l)=>e.jsx(N,{children:o},l))})}),e.jsx(Fe,{children:t.map((o,l)=>e.jsxs(Y,{children:[Object.keys(X).map(s=>e.jsx(N,{children:o[s]},s)),e.jsx(N,{children:e.jsx(re,{onClick:()=>c(o._id),children:e.jsx(he,{color:"error"})})})]},l))})]})})},es=({setTab:t})=>{const{userState:{session:x}}=p.useContext(Z),{schoolSessionDispatch:c}=p.useContext(M),{levelId:o}=pe(),l=je(),[s]=oe(),[d,v]=p.useState({severity:"",text:""}),[m,S]=p.useState([]),{gradeSystem:j,subjects:C}=Be(o),R={subject:{_id:"",name:""},classScore:0,examsScore:0},I=(r,n)=>{var b,f;const u=Number(r.classScore)+Number(r.examsScore),T=Ae(u,j==null?void 0:j.ratings),P={_id:(b=r==null?void 0:r.subject)==null?void 0:b._id,subject:(f=r==null?void 0:r.subject)==null?void 0:f.name,classScore:r.classScore,examsScore:r.examsScore,...T},g=z.merge(z.keyBy([...m,P],"_id"));S(z.values(g)),n.resetForm()},{mutateAsync:k,isPending:w}=ee({mutationFn:Ie}),E=()=>{const r={session:{levelId:o,studentId:s.get("sid"),sessionId:x.sessionId,termId:x.termId},scores:m};k(r,{onSettled:()=>{l.invalidateQueries(["exams-by-id",s.get("eid")])},onSuccess:n=>{c(se(n)),t("1")},onError:n=>{c(te(n))}})},A=()=>c({type:"openAddExamsScore",payload:{open:!1,data:{}}});return e.jsx(ue,{initialValues:R,validationSchema:Se,onSubmit:I,children:({values:r,errors:n,touched:u,isValid:T,dirty:P,handleChange:g,handleSubmit:b,setFieldValue:f})=>e.jsxs(e.Fragment,{children:[d.text&&e.jsx(ge,{sx:{marginY:1},severity:d.severity,onClose:()=>v({text:""}),children:d.text}),e.jsxs(e.Fragment,{children:[e.jsxs(D,{spacing:2,direction:"row",justifyContent:"flex-end",children:[e.jsx(y,{onClick:A,children:"Cancel"}),e.jsx(y,{variant:"contained",disabled:m.length===0,onClick:E,loading:w,children:"Save Results"})]}),e.jsxs(G,{container:!0,spacing:2,rowGap:2,sx:{minHeight:"60svh"},children:[e.jsx(G,{item:!0,xs:12,md:5,padding:2,children:e.jsxs(D,{spacing:2,py:2,children:[e.jsx(a,{children:"Add Subject Score"}),e.jsx(Ve,{options:C,loadingText:"Loading Subjects.Please Wait...",getOptionLabel:h=>(h==null?void 0:h.name)||"",value:r.subject,onChange:(h,B)=>f("subject",B),renderInput:h=>e.jsx(H,{...h,label:"Subject",size:"small",error:!!n.subject,helperText:u.subject&&n.subject})}),e.jsx(H,{type:"number",label:"Class Score",size:"small",value:r.classScore,onChange:g("classScore"),error:!!n.classScore,helperText:u.classScore&&n.classScore}),e.jsx(H,{type:"number",label:"Exams Score",size:"small",value:r.examsScore,onChange:g("examsScore"),error:!!n.examsScore,helperText:u.examsScore&&n.examsScore}),e.jsx(y,{variant:"contained",onClick:b,disabled:!T||!P,children:"Add Score"})]})}),e.jsxs(G,{item:!0,xs:12,md:7,padding:2,children:[e.jsx(a,{children:"Scores Preview"}),e.jsx(Ze,{data:m||[],setData:S})]})]})]})]})})};function ss({details:t}){const x=[{field:"subject",title:"Subject"},{field:"classScore",title:"Class Score"},{field:"examsScore",title:"Exams Score"},{field:"totalScore",title:"Total Score",cellStyle:{color:"red"}},{field:"grade",title:"Grade"},{field:"remarks",title:"Remarks",cellStyle:{color:"green"},render:({totalScore:c,remarks:o})=>e.jsx(y,{size:"small",sx:{width:"100%",color:F(c).color,bgcolor:F(c).bg},children:o})}];return e.jsx(Ge,{icon:(t==null?void 0:t.profile)||e.jsx(Me,{}),title:(t==null?void 0:t.fullName)||"Student",columns:x,data:t==null?void 0:t.scores,actions:[],search:!1,addButtonImg:Ne,addButtonMessage:"No Exams Score available"})}function Ns(){var v,m,S,j,C,R,I,k,w,E,A,r,n,u,T,P,g,b,f,h,B,_,O,W,q;const{state:t}=be(),{schoolSessionDispatch:x}=p.useContext(M),[c]=oe(),[o,l]=p.useState("1"),s=fe({queryKey:["exams-by-id",c.get("eid")],queryFn:()=>ke(c.get("eid")),enabled:!!c.get("eid")}),d=()=>{x({type:"openViewReport"})};return e.jsxs(e.Fragment,{children:[e.jsxs(e.Fragment,{children:[e.jsx(Oe,{to:t==null?void 0:t.prevPath,color:"primary.main"}),e.jsx(ye,{title:"Student Assessment",subtitle:"View and manipulate results of student",color:"primary.main"}),s.isPending?e.jsx(D,{justifyContent:"center",alignItems:"center",children:e.jsx(V,{})}):s!=null&&s.isError?e.jsx(D,{justifyContent:"center",alignItems:"center",children:e.jsx(a,{children:"An error has occurred!"})}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{sx:{margin:"auto",padding:2},children:e.jsxs(Ce,{children:[e.jsxs(i,{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",children:[e.jsxs(i,{display:"flex",alignItems:"center",gap:2,flex:1,children:[e.jsxs(i,{children:[e.jsxs(i,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(V,{variant:"determinate",value:100,size:90,thickness:3,sx:{color:"lightgray"}}),e.jsx(V,{variant:"determinate",value:((v=s.data)==null?void 0:v.scorePercentage)??0,size:90,thickness:3,sx:{color:F((m=s.data)==null?void 0:m.scorePercentage).bg,position:"absolute",left:0}}),e.jsx(i,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(a,{variant:"h6",component:"div",color:"text.primary",children:[(S=s==null?void 0:s.data)==null?void 0:S.scorePercentage,"%"]})})]}),e.jsx(a,{children:"Performance "})]}),e.jsxs(i,{children:[e.jsxs(a,{variant:"h3",children:[(j=s==null?void 0:s.data)==null?void 0:j.fullName,e.jsx(Re,{color:"success",variant:"dot",overlap:"circular",sx:{marginLeft:1},children:e.jsx(We,{color:"success"})})]}),e.jsxs(a,{variant:"body2",color:"text.secondary",textTransform:"uppercase",children:[s.data.indexnumber," | ",(C=s.data)==null?void 0:C.level]})]})]}),e.jsx(re,{sx:{justifySelf:"flex-end"},onClick:s.refetch,children:e.jsx(qe,{sx:{width:{xs:24,md:40},height:{xs:24,md:40}}})})]}),e.jsxs(i,{mt:2,children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"Below is the state of school results by distinct academic year and semesters."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Only 5 academic year/semester results out of 6 have been approved."}),e.jsx(i,{mt:2,display:"flex",alignItems:"center",gap:1,children:e.jsx(a,{variant:"body2",fontWeight:"bold",color:"primary",children:"Result Entry Progress"})}),e.jsx(He,{variant:"determinate",value:(I=(R=s==null?void 0:s.data)==null?void 0:R.entry)==null?void 0:I.percent,color:(E=F((w=(k=s==null?void 0:s.data)==null?void 0:k.entry)==null?void 0:w.percent).bg)==null?void 0:E.split(".")[0],sx:{height:8,borderRadius:1,mt:1}}),e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(a,{variant:"body2",color:"text.secondary",mt:.5,children:["Progress: ",(r=(A=s==null?void 0:s.data)==null?void 0:A.entry)==null?void 0:r.percent,"%"]}),e.jsxs(a,{textAlign:"center",fontSize:11,children:[(u=(n=s==null?void 0:s.data)==null?void 0:n.entry)==null?void 0:u.completed,"/",(P=(T=s==null?void 0:s.data)==null?void 0:T.entry)==null?void 0:P.total," completed"]})]})]}),e.jsx(Q,{sx:{my:2}}),e.jsxs(L,{container:!0,spacing:2,children:[e.jsx(L,{size:4,children:e.jsxs(i,{textAlign:"center",children:[e.jsx($,{color:"info"}),e.jsx(a,{variant:"h6",color:"info.main",children:z.sumBy((g=s==null?void 0:s.data)==null?void 0:g.scores,"totalScore")??0}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Total Score"})]})}),e.jsx(L,{item:!0,size:4,children:e.jsxs(i,{textAlign:"center",children:[e.jsx($,{color:"success"}),e.jsxs(a,{variant:"h6",color:"success",children:[(f=(b=s.data.entry)==null?void 0:b.bestScoreSubject)==null?void 0:f.subject,"(",(B=(h=s.data.entry)==null?void 0:h.bestScoreSubject)==null?void 0:B.totalScore,")"]}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Best Scoring Subject"})]})}),e.jsx(L,{item:!0,size:4,children:e.jsxs(i,{textAlign:"center",children:[e.jsx(_e,{color:"error"}),e.jsxs(a,{variant:"h6",color:"error",children:[(O=(_=s.data.entry)==null?void 0:_.worstScoreSubject)==null?void 0:O.subject,"(",(q=(W=s.data.entry)==null?void 0:W.worstScoreSubject)==null?void 0:q.totalScore,")"]}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Least Scoring Subject"})]})})]}),e.jsx(Q,{sx:{my:2}}),e.jsx(i,{py:2,display:"flex",justifyContent:"flex-end",children:e.jsx(y,{variant:"contained",startIcon:e.jsx(Qe,{}),onClick:d,children:"View Report"})})]})}),e.jsx(i,{children:e.jsxs(Ye,{value:o,children:[e.jsxs($e,{onChange:(ts,ae)=>l(ae),children:[e.jsx(K,{label:"Exams Score",value:"1",icon:e.jsx(Ke,{}),iconPosition:"start"}),e.jsx(K,{label:"New Exams Score",value:"2",icon:e.jsx(Ue,{}),iconPosition:"start"})]}),e.jsx(U,{value:"1",sx:{px:0},children:e.jsx(ss,{details:s.data})}),e.jsx(U,{value:"2",sx:{px:0},children:e.jsx(es,{setTab:l})})]})})]})]}),e.jsx(Je,{student:s.data})]})}export{Ns as default};
