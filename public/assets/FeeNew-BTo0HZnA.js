import{aD as W,r as m,aE as ye,j as e,aF as he,D as I,a1 as ie,b as N,S as z,c as Y,_ as F,d as $,t as Q,v as ae,x as oe,aG as ge,O as le,w as U,k as E,T as R,B as M,L as K,l as b,a9 as re,H as ce,g as de,h as ue,am as ve,aH as Se,e as Ce,f as Fe}from"./index-B8PQHtjc.js";import{g as me,p as be,a as Te,d as Ae}from"./feeAPI-BhT-PJz_.js";import{C as Le}from"./CustomizedMaterialTable-BQoTtwVw.js";import{F as pe,e as ke}from"./sessionColumns-oq904N9H.js";import{c as k}from"./currencyFormatter-DjBDW3hY.js";import{L as Ee}from"./ListItem-CQImyTSy.js";import{L as ee}from"./ListItemText-DzMM1D1F.js";import{L as Oe}from"./ListItemSecondaryAction-DOVMjMKm.js";import{L as Be}from"./Link-kLE4_HTq.js";import{u as Pe}from"./useLevel-K9fH0Cop.js";import{A as H}from"./Autocomplete-Dw57Ihk7.js";import{I as D}from"./InputAdornment-DAOlZ4uj.js";import{D as xe}from"./DialogActions-BmNk8sop.js";import{E as we}from"./images-B5fNBSni.js";import{b as _e}from"./currentFeeAPI-CpZ1DJJI.js";import{c as Ve,a as Re}from"./createStyled-CJd69Mvg.js";import{c as We,h as te,r as G,a as Me,d as qe,m as De,g as ze,b as se}from"./createTheme-DxYQS8Dz.js";import{u as Ge,e as He}from"./extendSxProp-CRL7S0jW.js";import{f as ne}from"./fee_ico-Dww4ulV8.js";import"./TabPanel-WHfZdNAn.js";import"./useThemeProps-CEPKeDia.js";import"./Toolbar-YM__bEFh.js";import"./Chip-DmEpgF7y.js";import"./Skeleton-DWRiBFRT.js";import"./ButtonGroup-ZC3qSltg.js";import"./index-BqG4A_N5.js";import"./Grid2-B2FVLpOz.js";import"./ListItemButton-Di0YOqWQ.js";import"./listItemButtonClasses-DySKLRoc.js";import"./Check-JB41DPzl.js";import"./DeleteOutline-BlPFLwFk.js";import"./CircleRounded-YWo57tpF.js";function fe(t,n){const s=W({},n);return Object.keys(t).forEach(i=>{if(i.toString().match(/^(components|slots)$/))s[i]=W({},t[i],s[i]);else if(i.toString().match(/^(componentsProps|slotProps)$/)){const r=t[i]||{},a=n[i];s[i]={},!a||!Object.keys(a)?s[i]=r:!r||!Object.keys(r)?s[i]=a:(s[i]=W({},a),Object.keys(r).forEach(y=>{s[i][y]=fe(r[y],a[y])}))}else s[i]===void 0&&(s[i]=t[i])}),s}const Ie=Ve();function Ne(t){const{theme:n,name:s,props:i}=t;return!n||!n.components||!n.components[s]||!n.components[s].defaultProps?i:fe(n.components[s].defaultProps,i)}function Ye({props:t,name:n,defaultTheme:s,themeId:i}){let r=Ge(s);return i&&(r=r[i]||r),Ne({theme:r,name:n,props:t})}const $e=["component","direction","spacing","divider","children","className","useFlexGap"],Qe=We(),Ue=Ie("div",{name:"MuiStack",slot:"Root",overridesResolver:(t,n)=>n.root});function Ke(t){return Ye({props:t,name:"MuiStack",defaultTheme:Qe})}function Je(t,n){const s=m.Children.toArray(t).filter(Boolean);return s.reduce((i,r,a)=>(i.push(r),a<s.length-1&&i.push(m.cloneElement(n,{key:`separator-${a}`})),i),[])}const Xe=t=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[t],Ze=({ownerState:t,theme:n})=>{let s=W({display:"flex",flexDirection:"column"},te({theme:n},G({values:t.direction,breakpoints:n.breakpoints.values}),i=>({flexDirection:i})));if(t.spacing){const i=Me(n),r=Object.keys(n.breakpoints.values).reduce((p,d)=>((typeof t.spacing=="object"&&t.spacing[d]!=null||typeof t.direction=="object"&&t.direction[d]!=null)&&(p[d]=!0),p),{}),a=G({values:t.direction,base:r}),y=G({values:t.spacing,base:r});typeof a=="object"&&Object.keys(a).forEach((p,d,f)=>{if(!a[p]){const S=d>0?a[f[d-1]]:"column";a[p]=S}}),s=qe(s,te({theme:n},y,(p,d)=>t.useFlexGap?{gap:se(i,p)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Xe(d?a[d]:t.direction)}`]:se(i,p)}}))}return s=De(n.breakpoints,s),s};function et(t={}){const{createStyledComponent:n=Ue,useThemeProps:s=Ke,componentName:i="MuiStack"}=t,r=()=>Re({root:["root"]},p=>ze(i,p),{}),a=n(Ze);return m.forwardRef(function(p,d){const f=s(p),j=He(f),{component:S="div",direction:h="column",spacing:T=0,divider:L,children:A,className:O,useFlexGap:B=!1}=j,c=ye(j,$e),x={direction:h,spacing:T,useFlexGap:B},P=r();return e.jsx(a,W({as:S,ownerState:x,ref:d,className:he(P.root,O)},c,{children:L?Je(A,L):A}))})}const tt=et(),je=({data:t,removeFee:n})=>e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{children:[e.jsx(ee,{secondary:t==null?void 0:t.fee}),e.jsx(ee,{secondary:k(t.amount)}),e.jsx(Oe,{children:e.jsx(Be,{size:"small",sx:{cursor:"pointer"},onClick:()=>n(t==null?void 0:t.fee),children:"Remove"})})]}),e.jsx(I,{})]}),st=({open:t,setOpen:n})=>{const{userState:{session:s}}=m.useContext(ie),i=N(),{schoolSessionDispatch:r}=m.useContext(z),[a,y]=m.useState({_id:"",type:""}),[g,p]=m.useState(""),[d,f]=m.useState(""),[j,S]=m.useState([]),[h,T]=m.useState(0),[L,A]=m.useState({severity:"",text:""}),{levelsOption:O}=Pe();Y({queryKey:["fees"],queryFn:()=>me(s),enabled:!!(s!=null&&s.sessionId),onSuccess:o=>p(o)});const B={level:a,fee:j},c=()=>{d===""||h===""||(S(o=>o!==void 0?F.values(F.merge(F.keyBy([...o,{fee:d,amount:Number(h)}],"fee"))):[{fee:d,amount:Number(h)}]),f(""),T(""))},x=o=>{S(l=>l.filter(({fee:_})=>_!==o))},P=m.useMemo(()=>k(F.sumBy(j,"amount")),[j]),{mutateAsync:w}=$(be),q=(o,l)=>{A({text:""});const C={session:s.sessionId,term:s.termId,level:o.level._id,levelType:o.level.type,amount:o.fee},_=g.find(({_id:u})=>u===C.level);if(!F.isEmpty(_)){A({severity:"error",text:`Fees for ${C.levelType} already exists.Please try updating it.`});return}w(C,{onSettled:()=>{i.invalidateQueries(["fees"]),l.setSubmitting(!1)},onSuccess:u=>{r(de(u)),n(!1)},onError:u=>{r(ue(u))}})};return e.jsxs(Q,{open:t,onClose:()=>n(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(ae,{title:"New Fees",onClose:()=>n(!1)}),e.jsx(oe,{initialValues:B,onSubmit:q,validationSchema:ge,enableReinitialize:!0,children:({errors:o,touched:l,handleSubmit:C,isSubmitting:_})=>e.jsxs(e.Fragment,{children:[L.text&&e.jsx(le,{sx:{marginY:1},severity:L.severity,onClose:()=>A({text:""}),children:L.text}),e.jsx(U,{children:e.jsxs(E,{spacing:2,paddingY:2,children:[e.jsx(H,{fullWidth:!0,options:O,isOptionEqualToValue:(u,v)=>v._id===void 0||v._id===""||u._id===v._id,getOptionLabel:u=>u.type||"",value:a,onChange:(u,v)=>y(v),renderInput:u=>{var v,J,X,Z;return e.jsx(R,{...u,label:"Select Level",size:"small",error:!!((v=l==null?void 0:l.level)!=null&&v.type&&((J=o==null?void 0:o.level)!=null&&J.type)),helperText:((X=l==null?void 0:l.level)==null?void 0:X.type)&&((Z=o==null?void 0:o.level)==null?void 0:Z.type)})}}),e.jsx(H,{freeSolo:!0,fullWidth:!0,options:pe,isOptionEqualToValue:(u,v)=>v===void 0||v===""||u===v,getOptionLabel:u=>u||"",value:d,onInputChange:(u,v)=>f(v),renderInput:u=>e.jsx(R,{...u,label:"Select Fee Type",size:"small",error:!!(l!=null&&l.fee&&(o!=null&&o.fee)),helperText:(l==null?void 0:l.fee)&&(o==null?void 0:o.fee)&&"Enter a least one fee type*"})}),e.jsx(R,{type:"number",label:"Enter Fee Amount",size:"small",InputProps:{startAdornment:e.jsx(D,{position:"start",children:"GHS"}),endAdornment:e.jsx(D,{position:"end",children:"p"})},value:h,onChange:u=>T(u.target.value),error:!!(l!=null&&l.fee&&(o!=null&&o.fee)),helperText:(l==null?void 0:l.fee)&&(o==null?void 0:o.fee)&&"Required*"}),e.jsx(M,{variant:"contained",size:"small",onClick:c,children:"Add"}),e.jsxs(K,{sx:{maxHeight:400},children:[e.jsx(b,{variant:"body1",sx:{fontWeight:"bold"},children:"Fees"}),F.isEmpty(j)?e.jsx(b,{children:"No Fee Available"}):j.map(u=>e.jsx(je,{data:u,removeFee:x},u.fee)),e.jsx(I,{}),e.jsxs(E,{direction:"row",justifyContent:"space-between",children:[e.jsx(b,{variant:"h6",sx:{fontWeight:"bold"},children:"Total Fees"}),e.jsx(b,{variant:"h6",sx:{fontWeight:"bold"},children:P})]})]}),o.fee&&e.jsx(re,{sx:{color:"error.main"},children:o.fee})]})}),e.jsx(xe,{sx:{padding:2},children:e.jsx(M,{loading:_,variant:"contained",onClick:C,children:"Save"})}),_&&e.jsx(ce,{value:"Adding New Fee..."})]})})]})},nt=()=>{var O,B;const t=N(),{schoolSessionState:{feeEditData:n},schoolSessionDispatch:s}=m.useContext(z),[i,r]=m.useState(""),[a,y]=m.useState([]),[g,p]=m.useState(0),[d,f]=m.useState({severity:"",text:""});m.useEffect(()=>{var c;y((c=n==null?void 0:n.data)==null?void 0:c.amount)},[n]);const j=()=>{i===""||g===""||(y(c=>c!==void 0?F.values(F.merge(F.keyBy([...c,{fee:i,amount:Number(g)}],"fee"))):[{fee:i,amount:Number(g)}]),r(""),p(""))},S=c=>{y(x=>x.filter(({fee:w})=>w!==c))},h=m.useMemo(()=>k(F.sumBy(a,"amount")),[a]),{mutateAsync:T}=$(Te),L=(c,x)=>{f({text:""}),T({_id:c._id,amount:c.fee},{onSettled:()=>{t.invalidateQueries(["fees"]),x.setSubmitting(!1)},onSuccess:()=>{f({severity:"info",text:"Changes Saved!!!"})}})},A=()=>{s({type:"setFeeEditData",payload:{open:!1,data:{}}})};return e.jsxs(Q,{open:n.open,onClose:A,fullWidth:!0,maxWidth:"xs",TransitionComponent:ve,children:[e.jsx(Se,{children:"Edit Fees"}),e.jsx(oe,{initialValues:{_id:(O=n==null?void 0:n.data)==null?void 0:O._id,level:(B=n==null?void 0:n.data)==null?void 0:B.level,fee:a},onSubmit:L,enableReinitialize:!0,children:({errors:c,touched:x,handleSubmit:P,isSubmitting:w})=>{var q,o;return e.jsxs(e.Fragment,{children:[d.text&&e.jsx(le,{sx:{marginY:1},severity:d.severity,onClose:()=>f({text:""}),children:d.text}),e.jsx(U,{children:e.jsxs(E,{spacing:2,paddingY:2,children:[e.jsx(R,{label:" Level",size:"small",InputProps:{readOnly:!0},value:((q=n==null?void 0:n.data)==null?void 0:q.level)!==void 0?(o=n==null?void 0:n.data)==null?void 0:o.level:""}),e.jsx(H,{freeSolo:!0,fullWidth:!0,options:pe,isOptionEqualToValue:(l,C)=>C===void 0||C===""||l===C,getOptionLabel:l=>l||"",value:i,onInputChange:(l,C)=>r(C),renderInput:l=>e.jsx(R,{...l,label:"Select Fee Type",size:"small",error:!!(x!=null&&x.fee&&(c!=null&&c.fee)),helperText:(x==null?void 0:x.fee)&&(c==null?void 0:c.fee)&&"Enter a least one fee type*"})}),e.jsx(R,{type:"number",label:"Enter Fee Amount",size:"small",InputProps:{startAdornment:e.jsx(D,{position:"start",children:"GHS"}),endAdornment:e.jsx(D,{position:"end",children:"p"})},value:g,onChange:l=>p(l.target.value),error:!!(x!=null&&x.fee&&(c!=null&&c.fee)),helperText:(x==null?void 0:x.fee)&&(c==null?void 0:c.fee)&&"Required*"}),e.jsx(M,{variant:"contained",size:"small",onClick:j,children:"Add"}),e.jsxs(K,{sx:{maxHeight:400},children:[e.jsx(b,{variant:"body1",sx:{fontWeight:"bold"},children:"Fees"}),F.isEmpty(a)?e.jsx(b,{children:"No Fee Available"}):a.map(l=>e.jsx(je,{data:l,removeFee:S},l.fee)),e.jsx(I,{}),e.jsxs(E,{direction:"row",justifyContent:"space-between",children:[e.jsx(b,{variant:"h6",sx:{fontWeight:"bold"},children:"Total Fees"}),e.jsx(b,{variant:"h6",sx:{fontWeight:"bold"},children:h})]})]}),c.fee&&e.jsx(re,{sx:{color:"error.main"},children:c.fee})]})}),e.jsxs(xe,{sx:{padding:2},children:[e.jsx(M,{onClick:A,children:"Cancel"}),e.jsx(M,{loading:w,variant:"contained",onClick:P,children:"Save Changes"})]}),w&&e.jsx(ce,{value:"Saving Changes..."})]})}})]})};function V({title:t,value:n}){return e.jsxs(tt,{children:[e.jsx(b,{variant:"caption",color:"primary",children:t}),e.jsx(b,{variant:"body2",children:n})]})}function it(){var r,a,y,g,p,d,f,j,S;const{schoolSessionState:{levelFeeInfo:t},schoolSessionDispatch:n}=m.useContext(z);console.log(t);const s=Y({queryKey:["level-fee",t.data],queryFn:()=>_e(t==null?void 0:t.data),enabled:!!((r=t==null?void 0:t.data)!=null&&r.term)&&!!((a=t==null?void 0:t.data)!=null&&a.level),onSuccess:h=>{console.log(h)}}),i=()=>{n({type:"viewLevelFeeInfo",payload:{open:!1,data:{}}})};return e.jsxs(Q,{open:t.open,fullWidth:!0,maxWidth:"xs",onClose:i,children:[e.jsx(ae,{title:"School Fees Details",onClose:i}),e.jsxs(U,{children:[(s==null?void 0:s.isPending)&&e.jsx(b,{children:"Loading....."}),(s==null?void 0:s.data)!==void 0&&e.jsxs(E,{rowGap:2,children:[e.jsx(V,{title:"Level",value:(y=t==null?void 0:t.data)==null?void 0:y.levelName}),e.jsxs(E,{direction:"row",columnGap:2,children:[e.jsx(V,{title:" Total Fee",value:k((g=t==null?void 0:t.data)==null?void 0:g.fee)}),e.jsx(K,{children:t.data.amount&&t.data.amount.map(({fee:h,amount:T})=>e.jsxs(E,{paddingY:1,children:[e.jsx("small",{style:{color:"#00f"},children:h}),e.jsx("small",{children:k(T)})]},h))})]}),e.jsx(V,{title:"Number of Students",value:(p=t==null?void 0:t.data)==null?void 0:p.noOfStudents}),e.jsx(V,{title:"Total Expected Amount of Fees",value:k(((d=t==null?void 0:t.data)==null?void 0:d.fee)*((f=t==null?void 0:t.data)==null?void 0:f.noOfStudents))}),e.jsx(V,{title:"Total Amount of Fees Paid",value:k(s==null?void 0:s.data)}),e.jsx(V,{title:"Total Outstanding Fees",value:k(Number(((j=t==null?void 0:t.data)==null?void 0:j.fee)*((S=t==null?void 0:t.data)==null?void 0:S.noOfStudents))-Number(s==null?void 0:s.data))})]})]})]})}const Wt=()=>{const{userState:{session:t}}=m.useContext(ie),n=N(),{schoolSessionDispatch:s}=m.useContext(z),[i,r]=m.useState(!1),a=Y({queryKey:["fees"],queryFn:()=>me(t),enabled:!!(t!=null&&t.sessionId)}),{mutateAsync:y}=$(Ae),g=f=>{Fe.fire({title:"Removing",text:"Do you want to remove Fee?",showCancelButton:!0}).then(({isConfirmed:j})=>{j&&y(f,{onSettled:()=>{n.invalidateQueries(["fees"])},onSuccess:()=>{s(de("Fee has been removed successfully!!!"))},onError:()=>{s(ue("Error removing Fee!!!"))}})})},p=f=>{s({type:"setFeeEditData",payload:{open:!0,data:f}})},d=({levelId:f,level:j,fee:S,noOfStudents:h,amount:T})=>{s({type:"viewLevelFeeInfo",payload:{open:!0,data:{noOfStudents:h,fee:S,level:f,levelName:j,term:t.termId,amount:T}}})};return e.jsxs(e.Fragment,{children:[e.jsxs(e.Fragment,{children:[e.jsx(Ce,{title:"New Fee",subtitle:"Add new TERM/SEMESTER fees for a particular level",img:ne,color:"primary.main"}),e.jsx(Le,{title:"School Fees",icon:ne,columns:ke(d,p,g),data:a.data?a.data:[],isPending:a.isPending,actions:[],search:!0,showAddButton:!0,addButtonText:"New Fee",addButtonImg:we.sms,addButtonMessage:"😑 No School Fees available!.Create a new one",onAddButtonClicked:()=>r(!0)})]}),e.jsx(st,{open:i,setOpen:r}),e.jsx(nt,{}),e.jsx(it,{})]})};export{Wt as default};
