import{r as b,a0 as f,f as j,g as C,i as y,j as e,k as R,l as I,m as T,n as B,ah as k,S as L,b as g,q as v,O as E,s as N,t as Q,u as _,a1 as $,H as A,G as F,v as q,N as z,J as M,T as P,B as h}from"./index-a08c4904.js";import{d as U}from"./School-ed618523.js";import{s as O}from"./student_ico-5882123b.js";import{B as G}from"./Back-26c0fe57.js";import{C as V}from"./CustomTitle-d0e5d50c.js";import{C as W}from"./CustomizedMaterialTable-b0814305.js";import{b as H}from"./studentColumns-89e76406.js";import{u as J,i as K}from"./ExaminationAPI-bc627310.js";import{u as Y}from"./useLevelById-ba5e9072.js";import{g as X}from"./generateCustomGrade-93281c1e.js";import"./ArrowBackRounded-b2e199d9.js";import"./TabPanel-3210be1c.js";import"./Toolbar-172ad7c3.js";import"./MenuItem-ddd79fe9.js";import"./listItemTextClasses-cdd81f8c.js";import"./Chip-a33d5899.js";import"./Autocomplete-62a3dcdf.js";import"./Skeleton-f52aff28.js";import"./ButtonGroup-ed336fd9.js";import"./ListItemText-de69415f.js";import"./InputAdornment-16e34158.js";import"./CardContent-8cf1caa6.js";import"./ListItemSecondaryAction-33dcc31c.js";import"./Grid-d7986873.js";import"./useMediaQuery-dbbfc5b2.js";import"./ListItem-559aef15.js";import"./listItemButtonClasses-628cfd1a.js";import"./ListItemButton-b9f74f93.js";import"./Check-6932050c.js";import"./DeleteOutline-f3e83ed5.js";import"./images-ee905b8b.js";import"./Delete-ee750b69.js";import"./Add-3c6bb686.js";import"./gradeColor-6983157e.js";import"./CircleRounded-fed72031.js";function Z(){const{userState:{session:r}}=b.useContext(f),{schoolSessionState:{addStudentResults:{open:i,data:a,grade:p}},schoolSessionDispatch:c}=b.useContext(j),o=C(),{mutateAsync:x,isLoading:n}=y({mutationFn:J}),S=s=>{const t=Number(s.classScore)+Number(s.examsScore),d=X(t,p),m={session:{sessionId:r==null?void 0:r.sessionId,termId:r==null?void 0:r.termId,levelId:r==null?void 0:r.levelId,studentId:s==null?void 0:s._id},scores:[{subject:s==null?void 0:s.subject,classScore:s==null?void 0:s.classScore,examsScore:s==null?void 0:s.examsScore,...d}]};x(m,{onSettled:()=>{o.invalidateQueries(["student-records"]),o.invalidateQueries(["exams-scores"]),o.invalidateQueries(["exams-details"]),o.invalidateQueries(["exams-reports"]),o.invalidateQueries(["exams-by-id"]),o.invalidateQueries(["subject-score"])},onSuccess:u=>{c(N(u)),l()},onError:u=>{c(Q(u))}})},l=()=>{c({type:"addStudentResults",payload:{open:!1,data:{_id:"",level:"",classScore:"",examsScore:"",totalScore:"",grade:"",remarks:""},grade:p}})};return e.jsxs(R,{open:i,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(I,{title:"Add Record",onClose:l}),e.jsx(T,{children:e.jsx(B,{initialValues:a,validationSchema:k,onSubmit:S,children:({values:s,errors:t,touched:d,handleChange:m,handleSubmit:u})=>e.jsx(e.Fragment,{children:e.jsxs(L,{spacing:2,paddingY:2,children:[e.jsx(g,{label:"Subject",size:"small",value:s.subject,onChange:m("subject"),error:!!t.subject,helperText:d.subject&&t.subject}),e.jsx(g,{type:"number",label:"Class Score",size:"small",value:s.classScore,onChange:m("classScore"),error:!!t.classScore,helperText:d.classScore&&t.classScore}),e.jsx(g,{type:"number",label:"Exams Score",size:"small",value:s.examsScore,onChange:m("examsScore"),error:!!t.examsScore,helperText:d.examsScore&&t.examsScore}),e.jsx(v,{loading:n,variant:"contained",onClick:u,children:"Save Record"})]})})})}),n&&e.jsx(E,{value:"Saving Record..."})]})}function _e(){const{schoolSessionDispatch:r}=b.useContext(j),{state:i}=_(),[a]=$(),p=A(),{level:c,levelId:o}=F(),{gradeSystem:x}=Y(o),n=q({queryKey:["subject-score",o,a.get("sub")],queryFn:()=>K({id:o,subject:a.get("sub")}),enabled:!!o&&!!a.get("sub")}),S=()=>{p(`/examination/level/${o}/${c}/upload?sub=${a.get("sub")}`,{state:{prevPath:`/course/assign/${o}/${c}?sub=${a.get("sub")}`}})},l=t=>{r({type:"addStudentResults",payload:{open:!0,data:{_id:t==null?void 0:t._id,indexnumber:t==null?void 0:t.indexnumber,levelId:i==null?void 0:i.id,...t==null?void 0:t.course},grade:x}})};if(!o&&!a.get("sub"))return e.jsx(z,{to:"/course/assign"});const s=[...H,{field:null,title:"Action",render:t=>e.jsx(h,{variant:"outlined",onClick:()=>l(t),children:"Add Record"})}];return e.jsxs(e.Fragment,{children:[e.jsx(G,{to:"/course/assign",color:"primary.main"}),e.jsxs(M,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1,pr:2},children:[e.jsx(V,{title:"Manage Student Records",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(U,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(P,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:i==null?void 0:i.type})]}),e.jsx(W,{search:!0,isLoading:n.isLoading,title:i==null?void 0:i.type,subtitle:a.get("sub"),exportFileName:`${c}-${a.get("sub")}`||"",columns:s,data:n.data,actions:[],icon:O,handleRefresh:n==null?void 0:n.refetch,autoCompleteComponent:e.jsx(h,{variant:"contained",onClick:S,children:"Import Records"})}),e.jsx(Z,{})]})}export{_e as default};
