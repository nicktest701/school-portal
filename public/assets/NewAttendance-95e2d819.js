import{q as E,j as e,i as N,u as D,b as H,r as l,S as I,n as Q,c as _,_ as d,d as A,e as q,p as Y,M as p,E as v,O as V,m as G,D as O,R as w,J as j,P as S,B as J,Q as K,U as C,g as b,h as k}from"./index-ce442eb1.js";import{C as U}from"./CustomDatePicker-0001e585.js";import{C as W}from"./CustomizedMaterialTable-06b57d17.js";import{g as X,p as Z,a as ee}from"./attendanceAPI-b05fc2c1.js";import{s as te}from"./student_ico-5882123b.js";import{d as se}from"./SaveAltRounded-00a2bcdd.js";import{B as ne}from"./Back-78662289.js";import{D as ae}from"./DialogActions-c9d7df2e.js";import{C as oe}from"./Chip-15117b24.js";import"./AdapterMoment-20f157db.js";import"./useMediaQuery-5bcb3f64.js";import"./InputAdornment-92a613d9.js";import"./ListItem-2727fabf.js";import"./listItemButtonClasses-c7063ebe.js";import"./ListItemSecondaryAction-660d9daa.js";import"./TabPanel-47a179c1.js";import"./Toolbar-8b116404.js";import"./Autocomplete-87c4b1e1.js";import"./Skeleton-b715010d.js";import"./ButtonGroup-ca857561.js";import"./ListItemText-b107adf9.js";import"./ListItemButton-97ec9750.js";import"./Check-4cc8eef7.js";import"./DeleteOutline-78b9d3f1.js";import"./images-ee905b8b.js";import"./Delete-fb41f478.js";const re=E(e.jsx("path",{d:"m20.41 6.41-2.83-2.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7.4l8.6-8.6V7.83c0-.53-.21-1.04-.59-1.42M12 18c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-9c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1V7c0-.55.45-1 1-1h7c.55 0 1 .45 1 1zm4.99 7.25 1.77 1.77-4.84 4.84c-.1.09-.23.14-.36.14H15.5c-.28 0-.5-.22-.5-.5v-1.06c0-.13.05-.26.15-.35zm3.26.26-.85.85-1.77-1.77.85-.85c.2-.2.51-.2.71 0l1.06 1.06c.2.2.2.52 0 .71"}),"SaveAsRounded");function ie({to:x}){const{id:o,type:i}=N(),L=D(),h=H(),{schoolSessionDispatch:c}=l.useContext(I),[r,M]=l.useState(Q()),[n,f]=l.useState([]),g=_({queryKey:["attendance",o,r],queryFn:()=>X(o,r.format("L")),enabled:!!o&&!!r,onSuccess:t=>{console.log(t.status),f(t==null?void 0:t.status)}}),u=l.useMemo(()=>{var a;const t=(a=d.filter(n,({status:T})=>["Present","Absent"].includes(T)))==null?void 0:a.length,s=parseInt(Number(t/(n==null?void 0:n.length))*100);return{done:t,percent:s}},[n]),P=(t,s)=>{s.status=t;const a=d.values(d.merge(d.keyBy([...n,s],"_id")));f(a)},{mutateAsync:R,isLoading:m}=A({mutationFn:Z}),z=()=>{const t={level:o,date:r.format("L"),status:n};R(t,{onSettled:()=>{h.invalidateQueries(["attendance-history"])},onSuccess:s=>{c(b(s))},onError:s=>{c(k(s))}})},{mutateAsync:F,isLoading:y}=A({mutationFn:ee}),$=t=>{const s={level:o,date:r.format("L"),status:t};F(s,{onSettled:()=>{h.invalidateQueries(["attendance-history"])},onSuccess:a=>{c(b(a))},onError:a=>{c(k(a))}})},B=()=>{L(`/level/attendance/${o}/${i}/history`)};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{to:x==="/course"?"/course/level":`${x}/${o}/${i}`,color:"primary.main"}),e.jsx(q,{title:"Track Attendance Records",subtitle:" Monitor and manage student and staff attendance to ensure accurate record-keeping and identify patterns or issues promptly.",icon:e.jsx(Y,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsxs(p,{sx:{bgcolor:"#fff",p:2},children:[e.jsx(ae,{sx:{padding:2},children:e.jsx(v,{variant:"contained",startIcon:e.jsx(re,{}),onClick:z,loading:m,children:m?"Saving":"Save Attendance"})}),e.jsx(p,{display:"flex",justifyContent:"flex-start",width:280,children:e.jsx(U,{label:"Date of Attendance",date:r,setDate:M,disableFuture:!0})}),e.jsxs(p,{sx:{display:"flex",justifyContent:"center",pt:3},children:[e.jsx(V,{variant:"determinate",value:u.percent,size:80,color:u.percent?"success":"secondary"}),e.jsxs(G,{variant:"h5",textAlign:"center",children:[u.done,"/",n==null?void 0:n.length,e.jsx("small",{style:{marginLeft:"4px"},children:"completed"})]})]})]}),e.jsx(O,{textAlign:"center",sx:{py:4},children:e.jsx(oe,{label:"Details",color:"secondary"})}),e.jsx(W,{search:!0,isLoading:g.isLoading,icon:te,title:`Attendance for ${i}`,exportFileName:`Attendance for ${i} on ${r.format("dddd,Do MMMM YYYY")}`,columns:[{field:"_id",title:"ID",hidden:!0},{field:"fullName",title:"FullName",export:!0},{field:"gender",title:"Gender",export:!0},{field:"status",title:"Status",render:t=>e.jsxs(w,{row:!0,"aria-labelledby":"attendance-status",name:"status",value:t==null?void 0:t.status,onChange:s=>P(s.target.value,t),children:[e.jsx(j,{value:"Present",control:e.jsx(S,{size:"small"}),label:"Present"}),e.jsx(j,{value:"Absent",control:e.jsx(S,{size:"small"}),label:"Absent"})]}),export:!0},{field:null,title:"Action",render:t=>e.jsx(v,{size:"small",startIcon:e.jsx(se,{color:"secondary"}),onClick:()=>$(t),loading:y,children:"Save"})}],data:n,actions:[],autoCompleteComponent:e.jsx(J,{variant:"contained",onClick:B,children:"View Attendance History"}),options:{pageSize:10,selection:!1},handleRefresh:g.refetch}),(y||m)&&e.jsx(K,{value:"Saving Attendance. Please Wait..."})]})}ie.propTypes={open:C.bool,setOpen:C.func};export{ie as default};
