import{r as a,S as F,u as R,b0 as T,h as L,j as e,i as N,y as P,C as W,F as B,b4 as M,b5 as V,l as $,m as C,aD as z,b3 as D,T as w,b6 as A,aM as v,D as Q,t as _,v as H,w as U,x as G,U as J,P as K,g as X,_ as Z,bL as ee,ae as te,B as I,bt as se,bq as ae,q as Y,n as re,bu as ne}from"./index-97ebb758.js";import{a as oe,g as ie}from"./termAPI-510d896e.js";import{C as E}from"./CustomYearPicker-1922a2a1.js";const le=({open:h,setOpen:S})=>{const{schoolSessionDispatch:s}=a.useContext(F),g=R(),[d,m]=a.useState(T()),[c,u]=a.useState(T()),[n,j]=a.useState(""),[i,p]=a.useState(""),{mutateAsync:b}=L({mutationFn:oe}),t=new Date().getFullYear(),r=(x,l)=>{x.academicYear=`${n||t}/${i||t}`,b(x,{onSettled:()=>{l.setSubmitting(!1),g.invalidateQueries(["terms"])},onSuccess:o=>{s(U(o)),y()},onError:o=>{s(G(o))}}),l.setSubmitting(!1)},y=()=>S(!1);return e.jsxs(N,{open:h,fullWidth:!0,maxWidth:"xs",TransitionComponent:P,children:[e.jsx(W,{title:"Add Session",onClose:y}),e.jsx(B,{initialValues:{...M,from:d.format("l"),to:c.format("l")},onSubmit:r,validationSchema:V,enableReinitialize:!0,children:({values:x,errors:l,touched:o,handleChange:O,handleSubmit:k,isSubmitting:q})=>e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsxs(C,{spacing:2,paddingY:2,children:[e.jsx(z,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(C,{direction:"row",columnGap:2,children:[e.jsx(E,{label:"From",year:n,setYear:j}),e.jsx(E,{label:"To",year:i,setYear:p})]}),e.jsx(D,{label:"Start of Academic Term/Semester",date:d,setDate:m,touched:o.from,error:l.from}),e.jsx(D,{label:"End of Academic Term/Semester",date:c,setDate:u,touched:o.to,error:l.to}),e.jsx(w,{select:!0,label:"Term/Semester",size:"small",value:x.term,onChange:O("term"),error:!!(o.term&&l.term),helperText:o.term&&l.term,children:A.length!==0?A.map(f=>e.jsx(v,{value:f,children:f},f)):e.jsx(v,{children:"No Term Available "})}),e.jsx(Q,{})]})}),e.jsx(_,{sx:{padding:2},children:e.jsx(H,{loading:q,variant:"contained",onClick:k,children:"Save"})})]})})]})},ue=()=>{const{schoolSessionDispatch:h}=a.useContext(F),{userDispatch:S,user:s}=a.useContext(J),g=K(),[d,m]=a.useState(!1),[c,u]=a.useState(""),[n,j]=a.useState({termId:"",academicYear:"",term:""}),i=X({queryKey:["terms"],queryFn:()=>ie(),select:t=>(s==null?void 0:s.role)==="administrator"?t:t.filter(r=>!r.active)}),p=()=>{if(u(""),n.termId===""){u("Session is Required*");return}h({type:"setCurrentSession",payload:n}),localStorage.setItem("@school_session",JSON.stringify(n)),S({type:"setSession",payload:n}),g("/",{replace:!0})},b=()=>m(!0);return Z.isEmpty(s==null?void 0:s.id)?e.jsx(ee,{to:"/login"}):e.jsx(te,{maxWidth:"xs",sx:{height:"100vh",position:"relative",display:"flex",flexDirection:"column",gap:2,justifyContent:"center",alignItems:"center"},children:e.jsxs(C,{alignItems:"center",spacing:2,sx:{boxShadow:"0 2px 3px rgba(0,0,0,0.1)",p:4},children:[(s==null?void 0:s.role)==="administrator"&&e.jsx(I,{color:"primary",startIcon:e.jsx(se,{}),sx:{mb:4},onClick:b,children:"New School Session"}),e.jsx(ae,{sx:{width:80,height:80}}),e.jsx(Y,{variant:"h4",sx:{textAlign:"center"},children:"School Portal"}),e.jsx(Y,{variant:"body2",paragraph:!0,sx:{textAlign:"center"},children:"Choose a session (academic term/semester) to begin with."}),e.jsx(re,{options:i!=null&&i.data?i.data:[],noOptionsText:"School Session not found",closeText:"",clearText:" ",disableClearable:!0,fullWidth:!0,value:n,onChange:(t,r)=>j(r),isOptionEqualToValue:(t,r)=>r.termId===""||r.termId===void 0||t.termId===r.termId,getOptionLabel:t=>(t==null?void 0:t.termId)!==""?`${t==null?void 0:t.academicYear},${t==null?void 0:t.term}`:"",renderInput:t=>e.jsx(w,{...t,label:"Select School Session",error:c!=="",helperText:c,FormHelperTextProps:{sx:{color:"error.main"}}})}),e.jsx(I,{variant:"contained",endIcon:e.jsx(ne,{}),fullWidth:!0,onClick:p,children:"Continue"}),e.jsx(le,{open:d,setOpen:m})]})})};export{ue as default};
