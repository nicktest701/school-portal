import{c as xe,j as e,S as w,F as C,B as L,I as ne,d as me,e as R,r as b,f as M,g as T,i as B,k as N,l as F,m as O,b as G,n as Y,o as ae,D as Q,L as _,p as q,q as V,s as E,t as z,v as $,_ as f,w as je,T as P,x as re,y as ie,z as ge,E as pe,C as Se}from"./index-bb65b4bf.js";import{s as be}from"./session_ico-19a9b5ce.js";import{C as fe}from"./CustomTitle-ed47c53b.js";import{a as K,C as le,L as Ce}from"./CustomizedMaterialTable-266061d1.js";import{E as H}from"./images-0c291668.js";import{g as Z}from"./gradeColor-6983157e.js";import{L as I}from"./ListItem-befde9c4.js";import{L as W}from"./ListItemSecondaryAction-c66bb893.js";import{G as oe,R as de,S as ee,a as ye}from"./sessionColumns-3b88387c.js";import{A as D}from"./Autocomplete-95da27f3.js";import{C as ce}from"./Chip-fa36c3a1.js";import{v as ue}from"./v4-4a60fe23.js";import{L as ke,p as ve,a as Ge,g as we,d as Le}from"./subjectAPI-221b4718.js";import{u as Ae}from"./useLevel-2a56aacb.js";import{L as J}from"./ListItemText-33ae0292.js";import{E as Me}from"./Edit-11e1ba9f.js";import{d as he}from"./DeleteOutline-80e9f63f.js";import{T as Te,a as Be,b as se,c as te}from"./TabPanel-175e39ff.js";import"./Toolbar-36d77a55.js";import"./MenuItem-1edcf8db.js";import"./listItemTextClasses-35ff90f6.js";import"./Skeleton-6cff8ea8.js";import"./ButtonGroup-83f2640f.js";import"./InputAdornment-321f8206.js";import"./CardContent-25ef3451.js";import"./Grid-6a14669c.js";import"./useMediaQuery-5f0ec7e9.js";import"./ListItemButton-bf3e0355.js";import"./listItemButtonClasses-9702db06.js";import"./Check-7b95876f.js";import"./Delete-97505065.js";import"./Add-66663708.js";import"./score_ico-e1082ac1.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-3db5a545.js";const Ee=xe(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline");function X({id:a,highestMark:t,lowestMark:u,grade:x,remarks:r,removeGrade:i}){return e.jsx(I,{divider:!0,children:e.jsxs(w,{direction:"row",spacing:4,width:"80%",children:[e.jsx(C,{sx:{width:"15%"},children:t}),e.jsx(C,{sx:{width:"15%"},children:"-"}),e.jsx(C,{sx:{width:"15%"},children:u}),e.jsx(C,{sx:{width:"15%"},children:x}),e.jsxs(W,{children:[e.jsx(L,{size:"small",sx:{px:2,mr:4,bgcolor:Z(t).bg,color:Z(t).color},children:r}),i&&e.jsx(ne,{onClick:()=>i(a),children:e.jsx(me,{})})]})]})})}const ze=async()=>{try{return(await R({method:"GET",url:"/grades"})).data}catch(a){return a.response.data}},Ie=async a=>{try{return(await R({method:"GET",url:`/grades/${a}`})).data}catch(t){return t.response.data}},De=async a=>{try{return(await R({method:"POST",url:"/grades",data:a})).data}catch(t){return t.response.data}},Ne=async a=>{try{return(await R({method:"PUT",url:"/grades",data:a})).data}catch(t){return t.response.data}},Fe=async a=>{try{return(await R({method:"DELETE",url:`/grades/${a}`})).data}catch(t){return t.response.data}};function Oe({open:a,setOpen:t}){const{schoolSessionDispatch:u}=b.useContext(M),x=T(),[r,i]=b.useState([]),[g,p]=b.useState(""),o={lowestMark:0,highestMark:0,grade:"",remarks:""},m=(c,n)=>{c.id=ue(),i(l=>[...l,c]),n.resetForm()},j=c=>{const n=r.filter(({id:l})=>l!==c);i(n)},{mutateAsync:k,isLoading:d}=B({mutationFn:De}),A=()=>{k({name:g,ratings:r},{onSettled:()=>{x.invalidateQueries(["grades"])},onSuccess:n=>{u(E(n)),i([]),t(!1)},onError:n=>{u(z(n))}})};return e.jsxs(N,{open:a,children:[e.jsx(F,{title:"New Grading System",subtitle:"Add new grades and remarks",onClose:()=>t(!1)}),e.jsxs(O,{children:[e.jsxs(w,{spacing:3,py:2,children:[e.jsx(G,{label:"Name of Grading System",size:"small",value:g,onChange:c=>p(c.target.value)}),e.jsx(Y,{initialValues:o,validationSchema:ae,onSubmit:m,children:({values:c,errors:n,touched:l,setFieldValue:s,handleChange:h,handleSubmit:S})=>e.jsxs(w,{direction:"row",spacing:1,children:[e.jsx(G,{label:"Lowest Mark",type:"number",inputMode:"numeric",size:"small",value:c.lowestMark,onChange:h("lowestMark"),error:!!(l.lowestMark&&n.lowestMark),helperText:n.lowestMark}),e.jsx(G,{label:"Highest Mark",type:"number",inputMode:"numeric",size:"small",value:c.highestMark,onChange:h("highestMark"),error:!!(l.highestMark&&n.highestMark),helperText:n.highestMark}),e.jsx(D,{freeSolo:!0,options:oe,getOptionLabel:y=>y||"",defaultValue:c.grade,value:c.grade,onChange:(y,v)=>s("grade",v),renderInput:y=>e.jsx(G,{...y,label:"Grade",size:"small",error:!!(l.grade&&n.grade),helperText:l.grade&&n.grade})}),e.jsx(D,{freeSolo:!0,fullWidth:!0,options:de,getOptionLabel:y=>y||"",defaultValue:c.remarks,value:c.remarks,onChange:(y,v)=>s("remarks",v),renderInput:y=>e.jsx(G,{...y,label:"remarks",size:"small",error:!!(l.remarks&&n.remarks),helperText:l.remarks&&n.remarks})}),e.jsx(L,{size:"small",variant:"contained",onClick:S,children:"Add"})]})}),e.jsx(Q,{children:e.jsx(ce,{label:"Grades"})})]}),e.jsxs(_,{children:[e.jsx(I,{divider:!0,children:e.jsxs(w,{direction:"row",spacing:2,justifyContent:"space-between",width:"80%",children:[e.jsx(C,{children:"Highest Mark"}),e.jsx(C,{children:"Lowest Mark"}),e.jsx(C,{children:"Grade"}),e.jsx(C,{children:"Remarks"}),e.jsx(W,{children:e.jsx(C,{children:"Action"})})]})}),r.map(c=>e.jsx(X,{...c,removeGrade:j},c==null?void 0:c.id))]})]}),e.jsxs(q,{children:[e.jsx(L,{onClick:()=>t(!1),children:"Cancel"}),e.jsx(V,{loading:d,variant:"contained",disabled:r.length===0,onClick:A,children:"Submit"})]})]})}function Re(){const{schoolSessionState:{viewGrades:{open:a,ratings:t}},schoolSessionDispatch:u}=b.useContext(M),x=()=>{u({type:"viewGrade",payload:{open:!1,data:[]}})};return e.jsxs(N,{open:a,maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{title:"Grade",onClose:x}),e.jsx(O,{children:e.jsxs(_,{children:[e.jsxs(I,{sx:{display:"flex",columnGap:8},width:"80%",children:[e.jsx(C,{children:"Highest Mark"}),e.jsx(C,{children:"Lowest Mark"}),e.jsx(C,{children:"Grade"}),e.jsx(W,{children:e.jsx(C,{children:"Remarks"})})]}),t.map(r=>e.jsx(X,{...r},r==null?void 0:r.id))]})})]})}function _e(){const{schoolSessionState:{editGrades:{open:a,data:t}},schoolSessionDispatch:u}=b.useContext(M),x=T(),[r,i]=b.useState([]),[g,p]=b.useState(""),o={lowestMark:0,highestMark:0,grade:"",remarks:""};$({queryKey:["grade",t==null?void 0:t._id],queryFn:()=>Ie(t==null?void 0:t._id),enabled:!!(t!=null&&t._id),initialData:t,onSuccess:n=>{p(n==null?void 0:n.name),i(n==null?void 0:n.ratings)}});const m=(n,l)=>{n.id=ue();const s=f.values(f.merge(f.keyBy([...r,n],"remarks")));i(s),l.resetForm()},j=n=>{const l=r.filter(({id:s})=>s!==n);i(l)},{mutateAsync:k,isLoading:d}=B({mutationFn:Ne}),A=()=>{const n={_id:t==null?void 0:t._id,name:g,ratings:r};k(n,{onSettled:()=>{x.invalidateQueries(["grades"])},onSuccess:l=>{u(E(l)),i([]),c()},onError:l=>{u(z(l))}})},c=()=>{u({type:"editGrade",payload:{open:!1,data:{}}})};return e.jsxs(N,{open:a,children:[e.jsx(F,{title:"New Grading System",subtitle:"Add new grades and remarks",onClose:c}),e.jsxs(O,{children:[e.jsxs(w,{spacing:3,py:2,children:[e.jsx(G,{label:"Name of Grading System",size:"small",value:g,onChange:n=>p(n.target.value)}),e.jsx(Y,{initialValues:o,validationSchema:ae,onSubmit:m,children:({values:n,errors:l,touched:s,setFieldValue:h,handleChange:S,handleSubmit:y})=>e.jsxs(w,{direction:"row",spacing:1,children:[e.jsx(G,{label:"Lowest Mark",type:"number",inputMode:"numeric",size:"small",value:n.lowestMark,onChange:S("lowestMark"),error:!!(s.lowestMark&&l.lowestMark),helperText:l.lowestMark}),e.jsx(G,{label:"Highest Mark",type:"number",inputMode:"numeric",size:"small",value:n.highestMark,onChange:S("highestMark"),error:!!(s.highestMark&&l.highestMark),helperText:l.highestMark}),e.jsx(D,{freeSolo:!0,options:oe,getOptionLabel:v=>v||"",defaultValue:n.grade,value:n.grade,onChange:(v,U)=>h("grade",U),renderInput:v=>e.jsx(G,{...v,label:"Grade",size:"small",error:!!(s.grade&&l.grade),helperText:s.grade&&l.grade})}),e.jsx(D,{freeSolo:!0,fullWidth:!0,options:de,getOptionLabel:v=>v||"",defaultValue:n.remarks,value:n.remarks,onChange:(v,U)=>h("remarks",U),renderInput:v=>e.jsx(G,{...v,label:"remarks",size:"small",error:!!(s.remarks&&l.remarks),helperText:s.remarks&&l.remarks})}),e.jsx(L,{size:"small",variant:"contained",onClick:y,children:"Add"})]})}),e.jsx(Q,{children:e.jsx(ce,{label:"Grades"})})]}),e.jsxs(_,{children:[e.jsx(I,{divider:!0,children:e.jsxs(w,{direction:"row",spacing:2,justifyContent:"space-between",width:"80%",children:[e.jsx(C,{children:"Highest Mark"}),e.jsx(C,{children:"Lowest Mark"}),e.jsx(C,{children:"Grade"}),e.jsx(C,{children:"Remarks"}),e.jsx(W,{children:e.jsx(C,{children:"Action"})})]})}),r.map(n=>e.jsx(X,{...n,removeGrade:j},n==null?void 0:n.id))]})]}),e.jsxs(q,{children:[e.jsx(L,{onClick:c,children:"Cancel"}),e.jsx(V,{loading:d,variant:"contained",disabled:r.length===0,onClick:A,children:"Save Changes"})]})]})}const qe=()=>{const{schoolSessionState:{assignGrades:{open:a,data:{name:t,ratings:u}}},schoolSessionDispatch:x}=b.useContext(M),r=T(),[i,g]=b.useState([]),[p,o]=b.useState([]),{levelsOption:m,levelLoading:j}=Ae(),k=()=>{const s=f.values(f.merge(f.keyBy([...p,...i],"_id")));o(s),g([])},d=s=>{o(h=>h.filter(({type:y})=>y!==s))},{mutateAsync:A,isLoading:c}=B({mutationFn:je}),n=()=>{const s=f.map(p,"_id");A({grade:u,levels:s},{onSettled:()=>{r.invalidateQueries(["levels"])},onSuccess:S=>{x(E(S)),o([]),l()},onError:S=>{x(z(S))}})},l=()=>{x({type:"assignGrade",payload:{open:!1,data:{}}})};return e.jsxs(N,{open:a,onClose:l,maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{title:"Assign Grade",subtitle:"Add the selected grading system to your levels",onClose:l}),e.jsx(O,{children:e.jsxs(w,{spacing:2,paddingY:2,children:[e.jsx(P,{variant:"h6",color:"secondary",children:t}),e.jsxs(w,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(D,{multiple:!0,freeSolo:!0,fullWidth:!0,defaultValue:[],loading:j,loadingText:"Loading Levels.Please Wait...",options:m,disableCloseOnSelect:!0,getOptionLabel:s=>(s==null?void 0:s.type)||"",renderOption:(s,h,S)=>e.jsxs(I,{...s,sx:{display:"flex",alignItems:"center"},children:[e.jsx(K,{checked:S==null?void 0:S.selected}),e.jsx(J,{primary:h==null?void 0:h.type})]}),value:i,onChange:(s,h)=>g(h),renderInput:s=>e.jsx(G,{...s,label:"Select Level to assign",size:"small"})}),e.jsx(L,{variant:"contained",size:"small",onClick:k,children:"Add"})]}),e.jsx(_,{sx:{maxHeight:400},children:f.isEmpty(p)?e.jsx(P,{children:"No Level selected"}):p.map(({_id:s,type:h})=>e.jsx(ke,{name:h,removeSubject:d},s))})]})}),e.jsxs(q,{sx:{padding:2},children:[e.jsx(L,{onClick:l,children:"Cancel"}),e.jsx(V,{disabled:p.length===0,variant:"contained",onClick:n,loading:c,children:c?"Please wait":"Assign Grade"})]})]})};function Ve(){const[a,t]=b.useState(!1),u=()=>t(!0),x=T(),{schoolSessionDispatch:r}=b.useContext(M),i=$({queryKey:["grades"],queryFn:()=>ze(),initialData:[]}),g=d=>{r({type:"editGrade",payload:{open:!0,data:d}})},p=d=>{r({type:"viewGrade",payload:{open:!0,data:d}})},o=d=>{r({type:"assignGrade",payload:{open:!0,data:d}})},{mutateAsync:m}=B({mutationFn:Fe}),j=d=>{re.fire({title:"Removing Grade",text:"Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:A})=>{A&&m(d,{onSettled:()=>{x.invalidateQueries(["grades"])},onSuccess:c=>{r(E(c))},onError:c=>{r(z(c))}})})},k=[{field:"_id",title:"ID",hidden:!0},{field:"name",title:"Name"},{field:null,title:"View Grade",render:d=>e.jsx(L,{sx:{bgcolor:"info.lighter",color:"info.darker"},onClick:()=>p(d==null?void 0:d.ratings),children:"View"})},{field:null,title:"Assign",render:d=>e.jsx(Ce,{sx:{cursor:"pointer"},onClick:()=>o(d),children:"Assign"})},{title:"Action",field:null,render:d=>e.jsxs(w,{direction:"row",spacing:2,children:[e.jsx(Me,{className:"ico",onClick:()=>g(d),title:"Edit",titleAccess:"Edit"}),e.jsx(Ee,{className:"ico",onClick:()=>j(d==null?void 0:d._id),title:"Delete",titleAccess:"Delete"})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(le,{title:"Grading System",icon:H.grade,isLoading:i.isLoading,columns:k,data:i==null?void 0:i.data,actions:[],showAddButton:!0,addButtonImg:H.session,addButtonMessage:"ðŸ˜‘ No Grading system available!.Create a new one!",addButtonText:"New Grades",onAddButtonClicked:u,handleRefresh:i.refetch,options:{paginationPosition:"bottom"}}),e.jsx(Oe,{open:a,setOpen:t}),e.jsx(Re,{}),e.jsx(_e,{}),e.jsx(qe,{})]})}const We=({name:a,code:t,isCore:u,removeSubject:x,appendCode:r,handleIsCore:i})=>{const[g,p]=b.useState(t);return e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:[e.jsx(G,{placeholder:"code ",size:"small",sx:{width:100,mr:2},value:g,onChange:o=>p(o.target.value),onBlur:()=>r({name:a,isCore:u,code:g})}),e.jsx(J,{secondary:a,secondaryTypographyProps:{fontSize:12,fontStyle:"italic"}}),e.jsxs(W,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(ie,{label:"Core",control:e.jsx(K,{title:"Core",checked:u,value:u,onChange:o=>i(a,!u)})}),e.jsx(ne,{onClick:()=>x(a),children:e.jsx(he,{})})]})]}),e.jsx(Q,{})]})},Pe=({open:a,setOpen:t})=>{const{schoolSessionDispatch:u}=b.useContext(M),x=T(),[r,i]=b.useState([]),[g,p]=b.useState({severity:"",text:""}),[o,m]=b.useState([]),j=s=>{const h=f.values(f.merge(f.keyBy([...o,s],"name")));m(h)},k=()=>{const s=f.values(f.merge(f.keyBy([...o,...r],"name")));m(s),i([])},d=s=>{m(h=>h.filter(({name:y})=>y!==s))},A=(s,h)=>{const S=o.find(({name:v})=>v===s);S.isCore=h;const y=f.values(f.merge(f.keyBy([...o,S],"name")));m(y)},{mutateAsync:c,isLoading:n}=B({mutationFn:ve}),l=()=>{p({text:""}),c(o,{onSettled:()=>{x.invalidateQueries(["subjects"])},onSuccess:s=>{u(E(s)),m([]),t(!1)},onError:s=>{u(z(s))}})};return e.jsxs(N,{open:a,onClose:()=>t(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(F,{title:"New Subjects",subtitle:"Add new subjects",onClose:()=>t(!1)}),e.jsxs(O,{children:[g.text&&e.jsx(ge,{severity:g.severity,children:g.text}),e.jsxs(w,{spacing:2,paddingY:2,children:[e.jsx(P,{variant:"h5",sx:{textAlign:"right"}}),e.jsx(Q,{}),e.jsxs(w,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(D,{multiple:!0,freeSolo:!0,fullWidth:!0,defaultValue:ee,options:ee,disableCloseOnSelect:!0,getOptionLabel:s=>(s==null?void 0:s.name)||"",renderOption:(s,h,S)=>e.jsxs(I,{...s,sx:{display:"flex",alignItems:"center"},children:[e.jsx(K,{checked:S==null?void 0:S.selected}),e.jsx(J,{primary:h==null?void 0:h.name})]}),value:r,onChange:(s,h)=>i(h),renderInput:s=>e.jsx(G,{...s,label:"Select Subject",size:"small"})}),e.jsx(L,{variant:"contained",size:"small",onClick:k,children:"Add"})]}),e.jsx(_,{sx:{maxHeight:400},children:f.isEmpty(o)?e.jsx(P,{children:"No Subject selected"}):o.map(s=>e.jsx(We,{...s,removeSubject:d,appendCode:j,handleIsCore:A},s==null?void 0:s.name))})]})]}),e.jsxs(q,{sx:{padding:2},children:[e.jsx(L,{onClick:()=>t(!1),children:"Cancel"}),e.jsx(V,{disabled:o.length===0,variant:"contained",onClick:l,loading:n,children:n?"Please wait":"Save Changes"})]})]})};function He(){const{schoolSessionState:{editSubject:{open:a,data:t}},schoolSessionDispatch:u}=b.useContext(M),x=T(),{mutateAsync:r,isLoading:i}=B({mutationFn:Ge}),g=o=>{r(o,{onSettled:()=>{x.invalidateQueries(["subjects"])},onSuccess:m=>{u(E(m)),p()},onError:m=>{u(z(m))}})},p=()=>{u({type:"editSubject",payload:{open:!1,data:{}}})};return e.jsxs(N,{open:a,fullWidth:!0,maxWidth:"xs",children:[e.jsx(F,{title:"Edit Subject",onClose:p}),e.jsx(Y,{initialValues:t,onSubmit:g,enableReinitialize:!0,children:({values:o,errors:m,touched:j,handleChange:k,handleSubmit:d})=>e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsxs(w,{spacing:2,paddingY:2,children:[e.jsx(ie,{sx:{alignSelf:"flex-end"},label:"Core Subject",control:e.jsx(K,{value:o.isCore||!1,checked:o==null?void 0:o.isCore,onChange:k("isCore")})}),e.jsx(G,{label:"Code",size:"small",value:o.code||"",onChange:k("code"),error:!!(j.code&&m.code),helperText:j.code&&m.code}),e.jsx(G,{label:"Name",size:"small",value:o.name||"",onChange:k("name"),error:!!(j.name&&m.name),helperText:j.name&&m.name,InputProps:{readOnly:!0}})]})}),e.jsx(q,{sx:{padding:2},children:e.jsx(V,{loading:i,variant:"contained",onClick:d,children:i?"Saving":"Save Changes"})})]})})]})}function Qe(){const a=T(),{schoolSessionDispatch:t}=b.useContext(M),[u,x]=b.useState(!1),r=()=>x(!0),i=$({queryKey:["subjects"],queryFn:()=>we(),initialData:[]}),g=j=>{t({type:"editSubject",payload:{open:!0,data:j}})},{mutateAsync:p}=B({mutationFn:Le}),o=j=>{re.fire({title:"Removing Subject",text:"Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:k})=>{k&&p(j,{onSettled:()=>{a.invalidateQueries(["subjects"])},onSuccess:d=>{t(E(d))},onError:d=>{t(z(d))}})})},m=[...ye,{title:"Action",field:null,render:j=>e.jsxs(w,{direction:"row",spacing:2,children:[e.jsx(pe,{className:"ico edit",onClick:()=>g(j),title:"Edit",titleAccess:"Edit"}),e.jsx(he,{className:"ico delete",onClick:()=>o(j==null?void 0:j._id),title:"Delete",titleAccess:"Delete"})]})}];return e.jsxs("div",{children:[e.jsx(le,{search:!0,title:"Subjects",icon:H.subject,isLoading:i.isLoading,columns:m,data:i==null?void 0:i.data,actions:[],showRowShadow:!1,showAddButton:!0,addButtonImg:H.session,addButtonMessage:"ðŸ˜‘ No Subjects system available!.Create a new one!",addButtonText:"New Subject",onAddButtonClicked:r,handleRefresh:i.refetch,options:{paginationPosition:"bottom"}}),e.jsx(Pe,{open:u,setOpen:x}),e.jsx(He,{})]})}function As(){const[a,t]=b.useState("1");return e.jsxs(Se,{children:[e.jsx(fe,{title:"Subjects & Grading System",subtitle:" Manage subjects offered and their corresponding grading systems to maintain academic standards.",img:be,color:"primary.main"}),e.jsxs(Te,{value:a,children:[e.jsxs(Be,{onChange:(u,x)=>t(x),children:[e.jsx(se,{label:"Subjects",value:"1"}),e.jsx(se,{label:"Grades",value:"2"})]}),e.jsx(te,{value:"1",sx:{px:0},children:e.jsx(Qe,{})}),e.jsx(te,{value:"2",sx:{px:0},children:e.jsx(Ve,{})})]})]})}export{As as default};
