import{r as v,U as Y,u as M,S as _,f as $,g as q,bI as Q,h as T,c8 as ie,j as e,i as B,C as z,F as W,c9 as ae,ca as G,l as R,m as I,n as C,cb as U,T as b,cc as H,t as K,v as J,_ as P,x as w,w as O,a5 as re,a6 as ce,cd as de,ce as ue,cf as pe,a as A,P as me,cg as he,X,J as xe,M as fe,b9 as ge,ch as ve,ci as ye,N,cj as je,e as V,G as Le,q as Se,D as Ce}from"./index-97ebb758.js";import{d as be}from"./Class-5d851d48.js";import{d as we}from"./Subject-77cd7b74.js";import{d as Ie}from"./Person3-293e1cd8.js";import{D as k}from"./DashboardCard-37617a2c.js";const Ae=({open:a,setOpen:i})=>{const{userState:{session:x}}=v.useContext(Y),l=M(),{schoolSessionDispatch:c}=v.useContext(_),{levelsOption:f}=$(),L=q({queryKey:["teachers"],queryFn:()=>Q(),select:n=>n==null?void 0:n.map(o=>({_id:o==null?void 0:o._id,fullName:o==null?void 0:o.fullName}))}),{mutateAsync:S,isLoading:y}=T({mutationFn:ie}),j=(n,r)=>{const o=`${n.level}${n.type}`,g=f.find(({type:t})=>t===o.toUpperCase());if(!P.isEmpty(g)){c(w("Level already exists!!!")),r.setSubmitting(!1);return}const d={session:x.sessionId,term:x.termId,level:{name:n.level,type:n.type},teacher:n.teacher};S(d,{onSettled:()=>{r.setSubmitting(!1),l.invalidateQueries(["levels"])},onSuccess:t=>{c(O(t)),i(!1)},onError:t=>{c(w(t))}})};return e.jsxs(B,{open:a,onClose:()=>i(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(z,{title:"New Level",onClose:()=>i(!1)}),e.jsx(W,{initialValues:ae,onSubmit:j,validationSchema:G,children:({values:n,errors:r,touched:o,handleSubmit:g,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(R,{sx:{p:1},children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(C,{freeSolo:!0,options:U,getOptionLabel:t=>t||"",value:n.level,onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(b,{...t,label:"Select Level",size:"small",error:!!(o.level&&r.level),helperText:o.level&&r.level})}),e.jsx(C,{freeSolo:!0,options:H,getOptionLabel:t=>t||"",value:n.type,onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(b,{...t,label:"Select Type",size:"small"})}),e.jsx(C,{options:L.data,loading:L.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",value:n.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(b,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(K,{sx:{padding:2},children:e.jsx(J,{loading:y,variant:"contained",onClick:g,children:"Add Level"})})]})})]})},Z="/assets/level_ico-a08a6fb9.svg";var F={},Te=ce;Object.defineProperty(F,"__esModule",{value:!0});var ee=F.default=void 0,Oe=Te(re()),_e=e;ee=F.default=(0,Oe.default)((0,_e.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");function De({viewProps:a,editProps:i,deleteProps:x,handleView:l,handleEdit:c,handleDelete:f}){return e.jsxs(I,{direction:"row",spacing:2,children:[l&&e.jsx(de,{className:"ico",onClick:l,...a,sx:{color:"secondary.main !important"}}),c&&e.jsx(ue,{className:"ico",onClick:c,...i}),f&&e.jsx(ee,{className:"ico",onClick:f,...x})]})}const Ee=()=>{const a=M(),{schoolSessionState:{editLevel:{open:i,data:x}},schoolSessionDispatch:l}=v.useContext(_),{levelsOption:c}=$(),f=q({queryKey:["teachers"],queryFn:()=>Q(),select:n=>n==null?void 0:n.map(o=>({_id:o==null?void 0:o._id,fullName:o==null?void 0:o.fullName}))}),{mutateAsync:L,isLoading:S}=T({mutationFn:pe}),y=(n,r)=>{const o=`${n.level}${n.type}`,g=c.find(({type:t})=>t===o.toUpperCase());if(!P.isEmpty(g)){l(w("Level already exists!!!")),r.setSubmitting(!1);return}const d={_id:n==null?void 0:n._id,level:{name:n.level,type:n.type},teacher:n.teacher};console.log(d),L(d,{onSettled:()=>{r.setSubmitting(!1),a.invalidateQueries(["levels"])},onSuccess:t=>{l(O(t)),j()},onError:t=>{l(w(t))}})},j=()=>{l({type:"editLevel",payload:{open:!1,data:{}}})};return e.jsxs(B,{open:i,onClose:j,fullWidth:!0,maxWidth:"xs",children:[e.jsx(z,{title:"Edit Level",onClose:j}),e.jsx(W,{initialValues:x,onSubmit:y,validationSchema:G,enableReinitialize:!0,children:({values:n,errors:r,touched:o,handleSubmit:g,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(C,{freeSolo:!0,options:U,getOptionLabel:t=>t||"",value:(n==null?void 0:n.level)||"",onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(b,{...t,label:"Level",size:"small",error:!!(o.level&&r.level),helperText:o.level&&r.level})}),e.jsx(C,{freeSolo:!0,options:H,getOptionLabel:t=>t||"",value:(n==null?void 0:n.type)||"",onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(b,{...t,label:"type",size:"small"})}),e.jsx(C,{options:f.data,loading:f.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",defaultValue:n==null?void 0:n.teacher,value:n==null?void 0:n.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(b,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(K,{sx:{padding:2},children:e.jsx(J,{loading:S,variant:"contained",onClick:g,children:"Save Changes"})})]})})]})};function Ne(){var c;const{schoolSessionState:{viewLevel:{open:a,data:i}},schoolSessionDispatch:x}=v.useContext(_),l=()=>{x({type:"viewLevel",payload:{open:!1,data:{}}})};return e.jsxs(B,{open:a,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(z,{title:"Basic 1A Information",onClose:l}),e.jsx(R,{children:e.jsxs(I,{spacing:2,children:[e.jsx(A,{secondary:"Level",primary:i==null?void 0:i.type}),e.jsx(A,{secondary:"Number Of Students",primary:i==null?void 0:i.noOfStudents}),e.jsx(A,{secondary:"Number of Courses ",primary:i==null?void 0:i.noOfSubjects}),e.jsx(A,{secondary:"Class Teacher",primary:((c=i==null?void 0:i.teacher)==null?void 0:c.fullName)||"Not Assigned Yet"})]})})]})}const ke=()=>{const{schoolSessionDispatch:a}=v.useContext(_),[i,x]=v.useState([]),{userState:{session:l}}=v.useContext(Y),c=me(),f=M(),[L,S]=v.useState(!1),y=q({queryKey:["levels",l.sessionId,l.termId],queryFn:()=>he(l.sessionId,l.termId),enabled:!!l.sessionId&&!!(l!=null&&l.termId),initialData:[],select:s=>s==null?void 0:s.map(({_id:m,level:u,students:D,subjects:E,teacher:oe})=>({_id:m,level:u,type:`${u==null?void 0:u.name}${u==null?void 0:u.type}`,noOfStudents:D==null?void 0:D.length,noOfSubjects:E==null?void 0:E.length,teacher:oe}))}),{mutateAsync:j,isLoading:n}=T({mutationFn:ve}),r=s=>{const h={id:s,sessionId:l==null?void 0:l.sessionId,termId:l==null?void 0:l.termId};N.fire({title:"Removing Level",html:` <div style='text-align:left;display:flex;flex-direction:column;gap:8px;'>
      <p>  You are about to delete a level. This action is irreversible and will permanently remove all associated data,including:</p>
        <ul style='padding-block:8px;'>
   <li style='font-weight:bold;'>Class schedules</li>
  <li style='font-weight:bold;'>Student enrollments</li>
  <li style='font-weight:bold;'>Attendance records</li>
  <li style='font-weight:bold;'>Grades and assignments</li>
  <li style='font-weight:bold;'>Academic reports and records</li>
  </ul>
  
           <p>   Please proceed with caution. If you are certain you want to delete
              this academic year, click &apos;Confirm.&apos; Otherwise, click
              &apos;Cancel&apos; to keep the academic year intact.</p>
            <p style='color:var(--secondary);font-weight:bold;'>Are you sure you want to delete this level?</p>
          </div>`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:m})=>{m&&(N.showLoading(),j(h,{onSettled:()=>{f.invalidateQueries(["levels"])},onSuccess:u=>{a(O(u))},onError:u=>{a(w(u))}}))})},o=s=>{x(s)},{mutateAsync:g,isLoading:d}=T({mutationFn:ye}),t=()=>{N.fire({title:"Removing Session",text:"You are about to remove the selected sessions. Removing session will delete all of its related content.Changes cannot be undone. Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:s})=>{const h=P.map(i,"termId");s&&g(h,{onSettled:()=>{f.invalidateQueries(["terms"])},onSuccess:m=>{a(O(m))},onError:m=>{a(w(m))}})})},p=s=>{var m,u;const h={_id:s==null?void 0:s._id,level:(m=s==null?void 0:s.level)==null?void 0:m.name,type:(u=s==null?void 0:s.level)==null?void 0:u.type,teacher:s==null?void 0:s.teacher};a({type:"editLevel",payload:{open:!0,data:h}})},te=({_id:s,type:h})=>{const m=encodeURIComponent(h);c(`/level/course?_id=${s}&type=${m}`)},ne=({_id:s,type:h})=>{c(`/level/current/${s}/${h}`,{replace:!0,state:{levelId:s,levelName:h}})},se=s=>{a({type:"viewLevel",payload:{open:!0,data:s}})},le=[...je,{field:null,title:"Class",width:"40%",render:s=>e.jsxs(I,{direction:"row",spacing:5,children:[e.jsx(V,{sx:{cursor:"pointer"},onClick:()=>ne(s),children:"Go to Class"}),e.jsx(V,{sx:{cursor:"pointer"},onClick:()=>te(s),children:"Add Subjects"})]})},{field:null,title:"Action",render:s=>e.jsx(De,{viewProps:{title:"View level information",titleAccess:"View level information"},editProps:{title:"Edit level information",titleAccess:"Edit level information"},deleteProps:{title:"Delete level information",titleAccess:"Delete level information"},handleView:()=>se(s),handleEdit:()=>p(s),handleDelete:()=>r(s==null?void 0:s._id)})}];return e.jsxs(X,{pt:2,children:[e.jsx(xe,{title:"Levels",icon:Z,search:!0,isLoading:y.isLoading,columns:le,data:y.data,actions:[],showAddButton:!0,addButtonText:"New Level",addButtonImg:fe.level,addButtonMessage:"ðŸ˜‘ Oops! It seems you don't have any level at the moment.Create a new one",onAddButtonClicked:()=>S(!0),handleRefresh:y.refetch,onSelectionChange:o,onDeleteClicked:t}),e.jsx(Ne,{}),e.jsx(Ae,{open:L,setOpen:S}),e.jsx(Ee,{}),n||d&&e.jsx(ge,{})]})},Re=()=>{const{levelSummary:a}=$();return e.jsxs(e.Fragment,{children:[e.jsx(Le,{title:"School Levels & Subjects",subtitle:"Organize and manage different educational levels to streamline curriculum and student progress tracking.",img:Z,color:"primary.main"}),e.jsx(Se,{variant:"h5",py:2,children:"Level Details"}),e.jsx(Ce,{}),e.jsxs(X,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:2,py:2},children:[e.jsx(k,{title:"Levels",value:a.noOfLevels,icon:e.jsx(we,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(k,{title:"Courses Offered",value:a.noOfSubjects,icon:e.jsx(be,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(k,{title:"Assigned Teachers",value:a.noOfAssignedTeachers,icon:e.jsx(Ie,{sx:{width:30,height:30,color:"secondary.main"}})})]}),e.jsx(ke,{})]})};export{Re as default};
