import{g as I,G as N,r as n,f as Q,H as _,v,i as U,j as e,C as W,n as H,a5 as K,S as p,b as T,F as B,a6 as A,A as M,T as O,B as R,q as G,s as Y,t as J,_ as X}from"./index-a08c4904.js";import{R as Z}from"./index-e426b97a.js";import{u as $,A as tt}from"./index-befff5a2.js";import{C as et}from"./CustomTitle-d0e5d50c.js";import{E as at}from"./data-25edd064.js";import{a as it,b as st}from"./eventAPI-701fc1aa.js";import{B as ot}from"./Back-26c0fe57.js";import{A as lt}from"./Autocomplete-62a3dcdf.js";import"./ArrowBackRounded-b2e199d9.js";import"./Chip-a33d5899.js";function ht(){var j;const c=I(),{id:l}=N(),{schoolSessionDispatch:d}=n.useContext(Q),u=_(),[D,m]=n.useState(""),[x,g]=n.useState(""),[y,h]=n.useState(""),[b,f]=n.useState(null),s=v({queryKey:["event",l],queryFn:()=>it(l),initialData:(j=c.getQueryData(["events",l]))==null?void 0:j.find(t=>(t==null?void 0:t._id)===l),enabled:!!l,onSuccess:t=>{g(t==null?void 0:t.title),m(t==null?void 0:t.type),h(t==null?void 0:t.description),f(t==null?void 0:t.album)}}),{getRootProps:k,getInputProps:w,open:F}=$({noClick:!0,noKeyboard:!0,maxFiles:1,accept:{"image/*":[".jpeg",".png",".webp"]},maxSize:2e5,multiple:!1,onDrop:t=>{if(!X.isEmpty(t)){const a=new FileReader;a.onload=function(i){const r=i.target.result;f(r)},a.readAsDataURL(t[0])}}}),P={_id:l,type:D,title:x,description:y,album:b},{mutateAsync:z,isLoading:L}=U({mutationFn:st}),V=t=>{z(t,{onSettled:()=>{c.invalidateQueries(["events"])},onSuccess:a=>{d(Y(a)),u("/events")},onError:a=>{d(J(a))}})};return e.jsxs(W,{children:[e.jsx(ot,{to:"/events",color:"primary.main"}),e.jsx(et,{title:"New Events",subtitle:" Send single and bulk SMS to students and parents",color:"text.main",backColor:"#012e54"}),e.jsx(H,{initialValues:P,onSubmit:V,enableReinitialize:!0,validationSchema:K,children:({values:t,errors:a,touched:i,handleSubmit:r})=>{var S,C,E;return e.jsxs(p,{px:2,py:4,spacing:4,bgcolor:"#fff",children:[e.jsx(lt,{freeSolo:!0,fullWidth:!0,size:"small",options:at,loadingText:"Please wait....",noOptionsText:"No Event available",getOptionLabel:o=>o||"",value:t==null?void 0:t.type,defaultValue:(S=s==null?void 0:s.data)==null?void 0:S.type,onChange:(o,q)=>m(q),renderInput:o=>e.jsx(T,{...o,label:"Select Event Type",fullWidth:!0,size:"small",error:!!(i.type&&a.type),helperText:i.type&&a.type})}),e.jsx(T,{label:"Event Title",fullWidth:!0,size:"small",row:3,maxRows:3,defaultValue:(C=s==null?void 0:s.data)==null?void 0:C.title,value:x,onChange:o=>g(o.target.value),error:!!(i.title&&a.title),helperText:i.title&&a.title}),e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsx(B,{style:{color:i.description&&a.description?"#B72136":"var(--primary)"},children:"Event Description"}),e.jsx(Z,{theme:"snow",value:y,onChange:o=>h(o),defaultValue:(E=s==null?void 0:s.data)==null?void 0:E.description,placeholder:"Description here",style:{borderRadius:2,border:i.description&&a.description?"1px solid #B72136":"none"}}),i.description&&a.description&&e.jsx(A,{sx:{color:"#B72136"},children:a.description})]}),e.jsxs("div",{children:[e.jsx(B,{style:{color:i.album&&a.album?"#B72136":"var(--primary)"},children:"Event Photo/Album"}),e.jsxs(p,{...k({className:"dropzone"}),sx:{borderRadius:1,border:i.album&&a.album?"1px solid #B72136":"1px dotted lightgray",py:8,px:4},children:[e.jsx(M,{variant:"square",src:b,sx:{width:{xs:120,md:480},height:{xs:120,md:480},objectFit:"contain",alignSelf:"center"}}),e.jsx("input",{...w()}),e.jsx(O,{textAlign:"center",paragraph:!0,children:"Drag & drop your photo here"}),e.jsx(R,{variant:"outlined",onClick:F,startIcon:e.jsx(tt,{}),children:"Upload Image"})]}),i.album&&a.album&&e.jsx(A,{sx:{color:"#B72136"},children:a.album})]}),e.jsxs(p,{direction:"row",justifyContent:"flex-end",spacing:2,children:[e.jsx(R,{onClick:()=>u("/events"),children:"Cancel"}),e.jsx(G,{loading:L,variant:"contained",color:"primary",onClick:r,children:"Save Changes"})]})]})}})]})}export{ht as default};
