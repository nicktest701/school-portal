import{c as je,j as e,r as S,a0 as it,f as be,v as Ce,h as ue,f0 as Tt,k as we,aw as Ct,m as Ie,S as T,b as f,p as Pt,B as G,aB as $,n as Se,f1 as wt,q as X,T as I,Z as L,f2 as It,A as U,f3 as vt,y as zt,M as At,g as rt,i as st,l as ot,J as lt,a as Wt,_ as ge,s as pt,t as dt,f4 as Bt,af as Dt,I as Lt,F as Nt,ax as Rt,C as mt,O as Ft,as as kt,P as Ot,f5 as Et,f6 as Mt,x as tt,z as Vt}from"./index-a08c4904.js";import{b as _t,S as qt,e as Gt,r as Ht,c as Ut,C as $t}from"./CustomizedMaterialTable-b0814305.js";import{g as Yt}from"./termAPI-fc6d41ec.js";import{A as R}from"./Autocomplete-62a3dcdf.js";import{C as Kt}from"./CustomDatePicker-c37da33c.js";import{T as fe,N as Pe}from"./nationality-728e96f8.js";import{a as Qt,p as Xt,b as Jt}from"./studentAPI-65ddac9a.js";import{M as Q}from"./MenuItem-ddd79fe9.js";import{h as nt,A as Zt}from"./sessionColumns-7f037633.js";import{M as Y}from"./MedicalAllergy-672b4f6e.js";import{u as ct}from"./useLevel-30b3786a.js";import{R as en}from"./index-aa1164af.js";import{G as yt}from"./GlobalSpinner-41b13204.js";import{L as b}from"./ListItemText-de69415f.js";import{u as xt,A as tn}from"./index-befff5a2.js";import{A as nn}from"./Add-3c6bb686.js";import{C as ht}from"./CustomTitle-d0e5d50c.js";import{u as an}from"./useMediaQuery-dbbfc5b2.js";import{S as rn}from"./School-e5a890f8.js";import{A as sn}from"./ArrowBackRounded-b2e199d9.js";import{B as on}from"./ButtonGroup-ed336fd9.js";import{N as ln}from"./NoteRounded-799b387a.js";import{I as pn}from"./studentColumns-89e76406.js";import{E as dn}from"./images-ee905b8b.js";import"./TabPanel-3210be1c.js";import"./Toolbar-172ad7c3.js";import"./Chip-a33d5899.js";import"./Skeleton-f52aff28.js";import"./listItemTextClasses-cdd81f8c.js";import"./InputAdornment-16e34158.js";import"./CardContent-8cf1caa6.js";import"./ListItemSecondaryAction-33dcc31c.js";import"./Grid-d7986873.js";import"./ListItem-559aef15.js";import"./listItemButtonClasses-628cfd1a.js";import"./ListItemButton-b9f74f93.js";import"./Check-6932050c.js";import"./DeleteOutline-f3e83ed5.js";import"./Delete-ee750b69.js";import"./currencyFormatter-1910a788.js";import"./CircleRounded-fed72031.js";import"./Edit-d3e93a55.js";import"./gradeColor-6983157e.js";const mn=je(e.jsx("path",{d:"M20 21v-3h3v-2h-3v-3h-2v3h-3v2h3v3zm-4.97.5H5.66c-.72 0-1.38-.38-1.73-1l-2.36-4.1c-.36-.62-.35-1.38.01-2L7.92 3.49c.36-.61 1.02-.99 1.73-.99h4.7c.71 0 1.37.38 1.73.99l4.48 7.71c-.5-.13-1.02-.2-1.56-.2-.28 0-.56.02-.84.06L14.35 4.5h-4.7L3.31 15.41l2.35 4.09h7.89c.35.77.85 1.45 1.48 2M13.34 15c-.22.63-.34 1.3-.34 2H7.25l-.73-1.27 4.58-7.98h1.8l2.53 4.42c-.56.42-1.05.93-1.44 1.51l-2-3.49L9.25 15z"}),"AddToDrive"),ve=je(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),cn=je(e.jsx("path",{d:"M9 16.17 5.53 12.7a.9959.9959 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71c.39-.39.39-1.02 0-1.41a.9959.9959 0 0 0-1.41 0z"}),"CheckRounded"),yn=je(e.jsx("path",{d:"M9 3 5 6.99h3V14h2V6.99h3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99z"}),"ImportExport");function xn({open:y,setOpen:p}){const{userState:{session:j}}=S.useContext(it),{schoolSessionDispatch:w}=S.useContext(be),[t,n]=S.useState({_id:"",levelType:"",students:[]}),[i,o]=S.useState({termId:"",sessionId:"",label:""}),a=Ce({queryKey:["terms"],queryFn:()=>Yt(),enabled:!!(j!=null&&j.sessionId),select:r=>r.filter(({to:s})=>ue(new Date(j.to))>ue(new Date(s))).map(({termId:s,sessionId:l,academicYear:m,term:g})=>({termId:s,sessionId:l,label:`${m},${g}`}))}),c=Ce({queryKey:["previous-levels",i==null?void 0:i.termId],queryFn:()=>Tt(i),enabled:!!(i!=null&&i.termId),select:r=>r.map(({_id:u,level:s,students:l})=>({_id:u,levelType:`${s.name}${s.type}`,students:l}))}),d=()=>{var r;((r=t==null?void 0:t.students)==null?void 0:r.length)!==0&&w({type:"openAddStudentFileDialog",payload:{data:t==null?void 0:t.students,type:"previous"}})};return e.jsxs(we,{open:y,maxWidth:"xs",fullWidth:!0,children:[e.jsx(Ct,{children:" Students from Session"}),e.jsx(Ie,{children:e.jsxs(T,{spacing:2,paddingY:2,children:[e.jsx(R,{size:"small",options:a.data??[],noOptionsText:"No session available",disableClearable:!0,fullWidth:!0,value:i,onChange:(r,u)=>{n({_id:"",levelType:"",students:[]}),o(u)},isOptionEqualToValue:(r,u)=>r.termId===u.termId||u.termId===""||u.termId===null||u.termId===void 0,getOptionLabel:r=>r.label||"",renderInput:r=>e.jsx(f,{...r,label:"Select School Session"})}),e.jsx(R,{size:"small",options:(c==null?void 0:c.data)??[],noOptionsText:"No level available",disableClearable:!0,fullWidth:!0,value:t,onChange:(r,u)=>n(u),isOptionEqualToValue:(r,u)=>r._id===u._id||u._id===""||u._id===null||u._id===void 0,getOptionLabel:r=>r.levelType||"",renderInput:r=>e.jsx(f,{...r,label:"Select Level"})})]})}),e.jsxs(Pt,{children:[e.jsx(G,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(G,{variant:"contained",onClick:d,disabled:!(t!=null&&t._id),children:"Load Students"})]})]})}const ut=({setMode:y})=>{const{studentState:{newStudent:{personal:p}},studentDispatch:j}=S.useContext($),[w,t]=S.useState(""),[n,i]=S.useState(ue(p==null?void 0:p.dateofbirth)),o=Ce({queryKey:["student-exist",w],queryFn:()=>Qt(w),enabled:!!w,refetchOnMount:!0,refetchOnWindowFocus:!0}),a=(c,d)=>{c.dateofbirth=ue(n).format("L"),j({type:"addNewStudent",payload:{personal:{...c,isCompleted:!0}}}),d.setSubmitting(!1),y("photo-info")};return e.jsx(Se,{initialValues:p,onSubmit:a,enableReinitialize:!0,validationSchema:wt,children:({values:c,errors:d,touched:r,setFieldValue:u,handleChange:s,handleSubmit:l,isSubmitting:m})=>e.jsxs(T,{py:2,spacing:2,children:[e.jsx(T,{direction:"row",justifyContent:"flex-end",spacing:2,children:e.jsx(X,{loading:m,variant:"contained",color:"primary",onClick:l,endIcon:e.jsx(ve,{}),disabled:o==null?void 0:o.isError,children:"Continue"})}),e.jsx(I,{variant:"h5",color:"primary.main",bgcolor:"whitesmoke",p:1,sx:{fontWeight:"bold"},children:"Personal Details"}),e.jsx(f,{label:"Student ID",type:"text",sx:{maxWidth:300},size:"small",value:c.indexnumber,onChange:g=>{u("indexnumber",g.target.value),t(g.target.value)},error:o.isError||!!(r!=null&&r.indexnumber&&(d!=null&&d.indexnumber)),helperText:(o==null?void 0:o.error)||(r==null?void 0:r.indexnumber)&&(d==null?void 0:d.indexnumber)}),e.jsxs(L,{children:[e.jsx(f,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:c.firstname,onChange:s("firstname"),error:!!(r.firstname&&d.firstname),helperText:r.firstname&&d.firstname}),e.jsx(f,{label:"Surname",fullWidth:!0,size:"small",value:c.surname,onChange:s("surname"),error:!!(r.surname&&d.surname),helperText:r.surname&&d.surname}),e.jsx(f,{label:"Othername",fullWidth:!0,size:"small",value:c.othername,onChange:s("othername"),error:!!(r.othername&&d.othername),helperText:r.othername&&d.othername})]}),e.jsxs(L,{children:[e.jsx(Kt,{label:"Date of Birth",date:n,setDate:i,disableFuture:!0,error:!!(r.dateofbirth&&d.dateofbirth),helperText:r.dateofbirth&&d.dateofbirth}),e.jsxs(f,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:c.gender,onChange:s("gender"),error:!!(r.gender&&d.gender),helperText:r.gender&&d.gender,children:[e.jsx(Q,{value:"male",children:"Male"}),e.jsx(Q,{value:"female",children:"Female"})]})]}),e.jsxs(L,{children:[e.jsx(f,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:c.email,onChange:s("email"),error:!!(r.email&&d.email),helperText:r.email&&d.email}),e.jsx(f,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:c.phonenumber,onChange:s("phonenumber"),error:!!(r.phonenumber&&d.phonenumber),helperText:r.phonenumber&&d.phonenumber})]}),e.jsx(f,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:c.address,onChange:s("address"),error:!!(r.address&&d.address),helperText:r.address&&d.address}),e.jsxs(L,{children:[e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",options:fe,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:g=>g||"",value:c.residence,onChange:(g,v)=>u("residence",v),renderInput:g=>e.jsx(f,{...g,label:"Residence",fullWidth:!0,size:"small",error:!!(r.residence&&d.residence),helperText:r.residence&&d.residence})}),e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:Pe,noOptionsText:"No Nationality available",getOptionLabel:g=>g||"",value:c.nationality,onChange:(g,v)=>u("nationality",v),renderInput:g=>e.jsx(f,{...g,label:"Nationality",fullWidth:!0,size:"small",error:!!(r.nationality&&d.nationality),helperText:r.nationality&&d.nationality})})]})]})})};ut.propTypes={};const hn=({setMode:y})=>{const{studentState:{newStudent:{parent:p}},studentDispatch:j}=S.useContext($),w=(t,n)=>{j({type:"addNewStudent",payload:{parent:{...t,isCompleted:!0}}}),n.setSubmitting(!1),y("medical-info")};return e.jsx(Se,{initialValues:p,onSubmit:w,enableReinitialize:!0,validationSchema:It,children:({values:t,errors:n,touched:i,setFieldValue:o,handleChange:a,handleSubmit:c,isSubmitting:d})=>{var r,u,s,l,m,g,v,M,_,V,x,h,N,F,q,A,z,k,O,E,J,Z,ee,te,ne,ae,ie,re,se,oe,le,pe,de,me,ce,ye,xe,Te,H,ze,Ae,We,Be,De,Le,Ne,Re,Fe,ke,Oe,Ee,Me,Ve,_e,qe,Ge,He,Ue,$e,Ye,Ke,Qe,Xe,Je,Ze,et;return e.jsxs(T,{py:2,spacing:1,children:[e.jsxs("div",{style:{maxHeight:350,overflowY:"auto"},children:[e.jsxs(T,{py:2,spacing:1,children:[e.jsxs(T,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(I,{variant:"h5",color:"primary.main",bgcolor:"whitesmoke",p:1,sx:{fontWeight:"bold"},children:"Parent/Guardian Information"}),e.jsx(U,{sx:{width:30,height:30,bgcolor:"primary.main"},children:"1"})]}),e.jsxs(L,{children:[e.jsx(f,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:(r=t==null?void 0:t.parent1)==null?void 0:r.firstname,onChange:a("parent1.firstname"),error:!!((u=i.parent1)!=null&&u.firstname&&((s=n.parent1)!=null&&s.firstname)),helperText:((l=i.parent1)==null?void 0:l.firstname)&&((m=n.parent1)==null?void 0:m.firstname)}),e.jsx(f,{label:"Surname",fullWidth:!0,size:"small",value:(g=t==null?void 0:t.parent1)==null?void 0:g.surname,onChange:a("parent1.surname"),error:!!((v=i.parent1)!=null&&v.surname&&((M=n.parent1)!=null&&M.surname)),helperText:((_=i.parent1)==null?void 0:_.surname)&&((V=n.parent1)==null?void 0:V.surname)})]}),e.jsxs(L,{children:[e.jsxs(f,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(x=t==null?void 0:t.parent1)==null?void 0:x.gender,onChange:a("parent1.gender"),error:!!((h=i.parent1)!=null&&h.gender&&((N=n.parent1)!=null&&N.gender)),helperText:((F=i.parent1)==null?void 0:F.gender)&&((q=n.parent1)==null?void 0:q.gender),children:[e.jsx(Q,{value:"male",children:"Male"}),e.jsx(Q,{value:"female",children:"Female"})]}),e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",options:nt,loadingText:"Please wait....",noOptionsText:"No Relationship available",getOptionLabel:C=>C||"",value:(A=t==null?void 0:t.parent1)==null?void 0:A.relationship,onInputChange:(C,P)=>o("parent1.relationship",P),renderInput:C=>{var P,W,B,D;return e.jsx(f,{...C,label:"Relationship",fullWidth:!0,size:"small",error:!!((P=i.parent1)!=null&&P.relationship&&((W=n.parent1)!=null&&W.relationship)),helperText:((B=i.parent1)==null?void 0:B.relationship)&&((D=n.parent1)==null?void 0:D.relationship)})}})]}),e.jsxs(L,{children:[e.jsx(f,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(z=t==null?void 0:t.parent1)==null?void 0:z.email,onChange:a("parent1.email"),error:!!((k=i.parent1)!=null&&k.email&&((O=n.parent1)!=null&&O.email)),helperText:((E=i.parent1)==null?void 0:E.email)&&((J=n.parent1)==null?void 0:J.email)}),e.jsx(f,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(Z=t==null?void 0:t.parent1)==null?void 0:Z.phonenumber,onChange:a("parent1.phonenumber"),error:!!((ee=i.parent1)!=null&&ee.phonenumber&&((te=n.parent1)!=null&&te.phonenumber)),helperText:((ne=i.parent1)==null?void 0:ne.phonenumber)&&((ae=n.parent1)==null?void 0:ae.phonenumber)})]}),e.jsx(f,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,multiline:!0,value:(ie=t==null?void 0:t.parent1)==null?void 0:ie.address,onChange:a("parent1.address"),error:!!((re=i.parent1)!=null&&re.address&&((se=n.parent1)!=null&&se.address)),helperText:((oe=i.parent1)==null?void 0:oe.address)&&((le=n.parent1)==null?void 0:le.address)}),e.jsxs(L,{children:[e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",options:fe,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:C=>C||"",value:(pe=t==null?void 0:t.parent1)==null?void 0:pe.residence,onChange:(C,P)=>o("parent1.residence",P),renderInput:C=>{var P,W,B,D;return e.jsx(f,{...C,label:"Residence",fullWidth:!0,size:"small",error:!!((P=i.parent1)!=null&&P.residence&&((W=n.parent1)!=null&&W.residence)),helperText:((B=i.parent1)==null?void 0:B.residence)&&((D=n.parent1)==null?void 0:D.residence)})}}),e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:Pe,noOptionsText:"No Nationality available",getOptionLabel:C=>C||"",value:(de=t==null?void 0:t.parent1)==null?void 0:de.nationality,onChange:(C,P)=>o("parent1.nationality",P),renderInput:C=>{var P,W,B,D;return e.jsx(f,{...C,label:"Nationality",fullWidth:!0,size:"small",error:!!((P=i.parent1)!=null&&P.nationality&&((W=n.parent1)!=null&&W.nationality)),helperText:((B=i.parent1)==null?void 0:B.nationality)&&((D=n.parent1)==null?void 0:D.nationality)})}})]})]}),e.jsxs(T,{py:2,spacing:1,children:[e.jsxs(T,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:2,children:[e.jsx(I,{variant:"h5",color:"primary.main",bgcolor:"whitesmoke",p:1,sx:{fontWeight:"bold"},children:"Parent/Guardian Information"}),e.jsx(U,{sx:{width:30,height:30,bgcolor:"primary.main"},children:"2"})]}),e.jsxs(L,{children:[e.jsx(f,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:(me=t==null?void 0:t.parent2)==null?void 0:me.firstname,onChange:a("parent2.firstname"),error:!!((ce=i.parent2)!=null&&ce.firstname&&((ye=n.parent2)!=null&&ye.firstname)),helperText:((xe=i.parent2)==null?void 0:xe.firstname)&&((Te=n.parent2)==null?void 0:Te.firstname)}),e.jsx(f,{label:"Surname",fullWidth:!0,size:"small",value:(H=t==null?void 0:t.parent2)==null?void 0:H.surname,onChange:a("parent2.surname"),error:!!((ze=i.parent2)!=null&&ze.surname&&((Ae=n.parent2)!=null&&Ae.surname)),helperText:((We=i.parent2)==null?void 0:We.surname)&&((Be=n.parent2)==null?void 0:Be.surname)})]}),e.jsxs(L,{children:[e.jsxs(f,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(De=t==null?void 0:t.parent2)==null?void 0:De.gender,onChange:a("parent2.gender"),error:!!((Le=i.parent2)!=null&&Le.gender&&((Ne=n.parent2)!=null&&Ne.gender)),helperText:((Re=i.parent2)==null?void 0:Re.gender)&&((Fe=n.parent2)==null?void 0:Fe.gender),children:[e.jsx(Q,{value:"male",children:"Male"}),e.jsx(Q,{value:"female",children:"Female"})]}),e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",options:nt,loadingText:"Please wait....",noOptionsText:"No Relationship available",getOptionLabel:C=>C||"",value:(ke=t==null?void 0:t.parent2)==null?void 0:ke.relationship,onInputChange:(C,P)=>o("parent2.relationship",P),renderInput:C=>{var P,W,B,D;return e.jsx(f,{...C,label:"Relationship",fullWidth:!0,size:"small",error:!!((P=i.parent2)!=null&&P.relationship&&((W=n.parent2)!=null&&W.relationship)),helperText:((B=i.parent2)==null?void 0:B.relationship)&&((D=n.parent2)==null?void 0:D.relationship)})}})]}),e.jsxs(L,{children:[e.jsx(f,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(Oe=t==null?void 0:t.parent2)==null?void 0:Oe.email,onChange:a("parent2.email"),error:!!((Ee=i.parent2)!=null&&Ee.email&&((Me=n.parent2)!=null&&Me.email)),helperText:((Ve=i.parent2)==null?void 0:Ve.email)&&((_e=n.parent2)==null?void 0:_e.email)}),e.jsx(f,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(qe=t==null?void 0:t.parent2)==null?void 0:qe.phonenumber,onChange:a("parent2.phonenumber"),error:!!((Ge=i.parent2)!=null&&Ge.phonenumber&&((He=n.parent2)!=null&&He.phonenumber)),helperText:((Ue=i.parent2)==null?void 0:Ue.phonenumber)&&(($e=n.parent2)==null?void 0:$e.phonenumber)})]}),e.jsx(f,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,multiline:!0,value:(Ye=t==null?void 0:t.parent2)==null?void 0:Ye.address,onChange:a("parent2.address"),error:!!((Ke=i.parent2)!=null&&Ke.address&&((Qe=n.parent2)!=null&&Qe.address)),helperText:((Xe=i.parent2)==null?void 0:Xe.address)&&((Je=n.parent2)==null?void 0:Je.address)}),e.jsxs(L,{children:[e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",options:fe,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:C=>C||"",value:(Ze=t==null?void 0:t.parent2)==null?void 0:Ze.residence,onChange:(C,P)=>o("parent2.residence",P),renderInput:C=>{var P,W,B,D;return e.jsx(f,{...C,label:"Residence",fullWidth:!0,size:"small",error:!!((P=i.parent2)!=null&&P.residence&&((W=n.parent2)!=null&&W.residence)),helperText:((B=i.parent2)==null?void 0:B.residence)&&((D=n.parent2)==null?void 0:D.residence)})}}),e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:Pe,noOptionsText:"No Nationality available",getOptionLabel:C=>C||"",value:(et=t==null?void 0:t.parent2)==null?void 0:et.nationality,onChange:(C,P)=>o("parent2.nationality",P),renderInput:C=>{var P,W,B,D;return e.jsx(f,{...C,label:"Nationality",fullWidth:!0,size:"small",error:!!((P=i.parent2)!=null&&P.nationality&&((W=n.parent2)!=null&&W.nationality)),helperText:((B=i.parent2)==null?void 0:B.nationality)&&((D=n.parent2)==null?void 0:D.nationality)})}})]})]})]}),e.jsx(T,{direction:"row",justifyContent:"flex-end",spacing:2,children:e.jsx(X,{loading:d,variant:"contained",color:"primary",onClick:c,children:"Save & Continue"})})]})}})},gt=({setMode:y})=>{const{studentState:{newStudent:{medical:p}},studentDispatch:j}=S.useContext($),w=(t,n)=>{j({type:"addNewStudent",payload:{medical:{...t,isCompleted:!0}}}),n.setSubmitting(!1),y("academic-info")};return e.jsx(Se,{initialValues:p,onSubmit:w,enableReinitialize:!0,validationSchema:vt,children:({values:t,errors:n,touched:i,handleChange:o,handleSubmit:a,isSubmitting:c})=>{var d,r,u,s,l,m,g,v,M,_,V,x,h,N,F;return e.jsxs(T,{padding:2,spacing:1,children:[e.jsx(T,{direction:"row",justifyContent:"flex-end",spacing:2,children:e.jsx(X,{loading:c,variant:"contained",color:"primary",onClick:a,endIcon:e.jsx(ve,{}),children:"Continue"})}),e.jsx(I,{variant:"h5",color:"primary.main",bgcolor:"whitesmoke",p:1,sx:{fontWeight:"bold"},children:"Medical Records"}),e.jsx(I,{variant:"body2",color:"primary.main",children:"(Kindly note that this section, even though required, will not affect your child’s admission into the school)."}),e.jsxs(T,{width:{xs:"100%",md:"80%"},py:5,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(Y,{title:"1. Heart Disease",value:t.heartDisease,setValue:o("heartDisease")}),e.jsx(Y,{title:"2. Visual Impairment",value:t.visualImpairment,setValue:o("visualImpairment")})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(Y,{title:"3. Asthma",value:t.asthma,setValue:o("asthma")}),e.jsx(Y,{title:"4. Hearing Impairment",value:t.hearingImpairment,setValue:o("hearingImpairment")})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(Y,{title:"5. Siezures",value:t.siezures,setValue:o("siezures")}),e.jsx(Y,{title:"6. Physical Disability",value:t.physicalDisability,setValue:o("physicalDisability")})]})]}),e.jsxs(T,{py:2,spacing:1,children:[e.jsx(I,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Emergency Contact"}),e.jsxs(L,{children:[e.jsx(f,{label:"Fullname",type:"text",fullWidth:!0,size:"small",value:(d=t==null?void 0:t.emergencyContact)==null?void 0:d.fullname,onChange:o("emergencyContact.fullname"),error:!!((r=i==null?void 0:i.emergencyContact)!=null&&r.fullname&&((u=n==null?void 0:n.emergencyContact)!=null&&u.fullname)),helperText:((s=i==null?void 0:i.emergencyContact)==null?void 0:s.fullname)&&((l=n==null?void 0:n.emergencyContact)==null?void 0:l.fullname)}),e.jsx(f,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(m=t==null?void 0:t.emergencyContact)==null?void 0:m.phonenumber,onChange:o("emergencyContact.phonenumber"),error:!!((g=i==null?void 0:i.emergencyContact)!=null&&g.phonenumber&&((v=n==null?void 0:n.emergencyContact)!=null&&v.phonenumber)),helperText:((M=i==null?void 0:i.emergencyContact)==null?void 0:M.phonenumber)&&((_=n==null?void 0:n.emergencyContact)==null?void 0:_.phonenumber)})]}),e.jsx(L,{children:e.jsx(f,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(V=t==null?void 0:t.emergencyContact)==null?void 0:V.address,onChange:o("emergencyContact.address"),error:!!((x=i==null?void 0:i.emergencyContact)!=null&&x.address&&((h=n==null?void 0:n.emergencyContact)!=null&&h.address)),helperText:((N=i==null?void 0:i.emergencyContact)==null?void 0:N.address)&&((F=n==null?void 0:n.emergencyContact)==null?void 0:F.address)})})]})]})}})};gt.propTypes={};function K({title:y,value:p}){return e.jsxs(T,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:3,pr:6,children:[e.jsx(I,{textAlign:"right",fontSize:11,children:y}),e.jsx(zt,{sx:{fontSize:11},value:p,control:e.jsx(At,{size:"small",checked:!0}),label:p,slotProps:{typography:{sx:{fontSize:11}}}})]})}function un({open:y,setOpen:p,setMode:j}){var F,q,A,z,k,O,E,J,Z,ee,te,ne,ae,ie,re,se,oe,le,pe,de,me,ce,ye,xe;const w=rt(),t=JSON.parse(localStorage.getItem("@school_info")),{studentState:{newStudent:{personal:n,photo:i,medical:o,parent:a,academic:c},studentDispatch:d}}=S.useContext($),{schoolSessionDispatch:r}=S.useContext(be),u=S.useRef(),[s,l]=S.useState(""),[m,g]=S.useState(!1),{mutateAsync:v,isLoading:M}=st({mutationFn:Xt}),_=()=>{n.profile=i==null?void 0:i.profile,v({personal:n,medical:o,parent:a,academic:c},{onSettled:()=>{w.invalidateQueries(["students-by-current-level"]),w.invalidateQueries(["all-students"])},onSuccess:H=>{H&&(r(pt("New Student Added")),g(!0),l(H),localStorage.removeItem("@student"))},onError:H=>{r(dt(H))}})},V=()=>{s?(j("personal-info"),p(!1),d({type:"addNewStudent",payload:{}})):p(!1)},x={fontSize:12,color:"primary",fontWeight:"700"},h={fontSize:10},N={width:"100%",borderBottom:"1px solid black",backgroundColor:"black",color:"#fff",padding:"2px"};return e.jsxs(we,{open:y,fullWidth:!0,maxWidth:"lg",onClose:()=>p(!1),children:[e.jsx(ot,{title:"Admission Form",subtitle:"Preview of student information. Please check before saving your information.",onClose:V}),e.jsxs(lt,{display:"flex",gap:2,justifyContent:"center",alignItems:"center",pt:2,children:[e.jsx(en,{trigger:()=>e.jsx(G,{variant:"outlined",children:"Print Form"}),content:()=>u.current,documentTitle:"Admission"}),e.jsx(X,{loading:M,variant:"contained",color:"primary",onClick:_,children:"Save Student Data"})]}),e.jsx(Ie,{children:e.jsxs("div",{ref:u,children:[e.jsxs(T,{justifyContent:"center",alignItems:"center",sx:{maxWidth:"8.5in",minHeight:"11in",margin:"auto",padding:"16px",border:"1px solid lightgray",position:"relative",backgroundSize:"contain",backgroundPosition:"center center !important"},children:[e.jsx(I,{variant:"body1",sx:{justifySelf:"start",py:4},children:"Admission Form"}),t!=null&&t.badge?e.jsx(U,{alt:"school logo",loading:"lazy",srcSet:`/images/users/${t==null?void 0:t.badge}`,sx:{width:100,height:100}}):e.jsx(Wt,{sx:{width:100,height:100}}),e.jsxs(T,{justifyContent:"center",alignItems:"center",width:"100%",children:[e.jsx(I,{variant:"h4",children:ge.startCase(t==null?void 0:t.name)}),e.jsx(I,{variant:"caption",children:t==null?void 0:t.address}),e.jsx(I,{variant:"caption",children:t==null?void 0:t.location}),e.jsx(I,{variant:"caption",fontStyle:"italic",children:t==null?void 0:t.motto})]}),e.jsx(I,{variant:"h3",textTransform:"uppercase",my:2,children:`${n==null?void 0:n.surname} ${n==null?void 0:n.firstname} ${n==null?void 0:n.othername}`})]}),e.jsxs(T,{className:"admission-form",spacing:1,sx:{maxWidth:"8.5in",minHeight:"11in",margin:"auto",padding:"16px",border:"1px solid lightgray",position:"relative",backgroundSize:"contain",backgroundPosition:"center center !important"},children:[s&&e.jsx("small",{style:{position:"absolute",bottom:"0",right:0,paddingRight:"8px",paddingBottom:"8px"},children:s}),e.jsx("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(U,{variant:"square",src:i==null?void 0:i.profile,sx:{alignSelf:"center",width:80,height:80}})}),e.jsxs("div",{style:{paddingBottom:"8px"},children:[e.jsx("legend",{style:N,children:"Personal Data"}),e.jsx(b,{secondary:"Student ID",primary:n==null?void 0:n.indexnumber,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(b,{secondary:"Full Name",primary:`${n==null?void 0:n.surname} ${n==null?void 0:n.firstname} ${n==null?void 0:n.othername}`,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Date of Birth",primary:ue(new Date(n==null?void 0:n.dateofbirth)).format("LL"),primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Gender",primary:n==null?void 0:n.gender,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Email Address",primary:n==null?void 0:n.email,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Phone Number",primary:n==null?void 0:n.phonenumber,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Residence",primary:n==null?void 0:n.residence,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Nationality",primary:n==null?void 0:n.nationality,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Address",primary:n==null?void 0:n.address,primaryTypographyProps:x,secondaryTypographyProps:h})]})]}),e.jsxs("div",{style:{paddingBottom:"8px"},children:[e.jsx("legend",{style:N,children:"Parent/Guardian Information"}),e.jsxs(T,{children:[e.jsx(I,{color:"primary.main",sx:{fontWeight:"bold",fontSize:11},children:"Parent 1 / Guardian 1"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(b,{secondary:"Surname",primary:(F=a==null?void 0:a.parent1)==null?void 0:F.surname,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"First Name",primary:(q=a==null?void 0:a.parent1)==null?void 0:q.firstname,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Relationship",primary:(A=a==null?void 0:a.parent1)==null?void 0:A.relationship,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Gender",primary:(z=a==null?void 0:a.parent1)==null?void 0:z.gender,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Email Address",primary:(k=a==null?void 0:a.parent1)==null?void 0:k.email,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Phone Number",primary:(O=a==null?void 0:a.parent1)==null?void 0:O.phonenumber,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Residence",primary:(E=a==null?void 0:a.parent1)==null?void 0:E.residence,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Nationality",primary:(J=a==null?void 0:a.parent1)==null?void 0:J.nationality,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Address",primary:(Z=a==null?void 0:a.parent1)==null?void 0:Z.address,primaryTypographyProps:x,secondaryTypographyProps:h})]})]}),e.jsxs(T,{children:[e.jsx(I,{color:"primary.main",sx:{fontWeight:"bold",fontSize:11},children:"Parent 2 / Guardian 2"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(b,{secondary:"Surname",primary:(ee=a==null?void 0:a.parent2)==null?void 0:ee.surname,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"First Name",primary:(te=a==null?void 0:a.parent2)==null?void 0:te.firstname,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Relationship",primary:(ne=a==null?void 0:a.parent2)==null?void 0:ne.relationship,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Gender",primary:(ae=a==null?void 0:a.parent2)==null?void 0:ae.gender,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Email Address",primary:(ie=a==null?void 0:a.parent2)==null?void 0:ie.email,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Phone Number",primary:(re=a==null?void 0:a.parent2)==null?void 0:re.phonenumber,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Residence",primary:(se=a==null?void 0:a.parent2)==null?void 0:se.residence,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Nationality",primary:(oe=a==null?void 0:a.parent2)==null?void 0:oe.nationality,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Address",primary:(le=a==null?void 0:a.parent2)==null?void 0:le.address,primaryTypographyProps:x,secondaryTypographyProps:h})]})]})]}),e.jsxs("div",{style:{paddingBottom:"8px"},children:[e.jsx("legend",{style:N,children:"Medical Records"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(K,{title:"1. Heart Disease",value:o.heartDisease}),e.jsx(K,{title:"2. Asthma",value:o.asthma}),e.jsx(K,{title:"3. Siezures",value:o.siezures}),e.jsx(K,{title:"4. Visual Impairment",value:o.visualImpairment}),e.jsx(K,{title:"5. Hearing Impairment",value:o.hearingImpairment}),e.jsx(K,{title:"6. Physical Disability",value:o.physicalDisability})]}),e.jsx(I,{color:"primary.main",sx:{fontWeight:"bold",fontSize:11},children:"Emergency Contact"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(b,{secondary:"Fullname",primary:(pe=o==null?void 0:o.emergencyContact)==null?void 0:pe.fullname,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Phone Number",primary:(de=o==null?void 0:o.emergencyContact)==null?void 0:de.phonenumber,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Address",primary:(me=o==null?void 0:o.emergencyContact)==null?void 0:me.address,primaryTypographyProps:x,secondaryTypographyProps:h})]})]}),e.jsxs("div",{style:{paddingBottom:"8px"},children:[e.jsx("legend",{style:N,children:"Academic Records"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))"},children:[e.jsx(b,{secondary:"Current Level",primary:(ce=c==null?void 0:c.level)==null?void 0:ce.type,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Previous School Name",primary:(ye=c==null?void 0:c.previousSchool)==null?void 0:ye.name,primaryTypographyProps:x,secondaryTypographyProps:h}),e.jsx(b,{secondary:"Location",primary:(xe=c==null?void 0:c.previousSchool)==null?void 0:xe.location,primaryTypographyProps:x,secondaryTypographyProps:h})]})]})]})]})}),M&&e.jsx(yt,{})]})}const ft=({setMode:y})=>{var u;const{studentState:{newStudent:{academic:p}},studentDispatch:j}=S.useContext($),[w,t]=S.useState(!1),[n,i]=S.useState((u=p==null?void 0:p.previousSchool)==null?void 0:u.report),{levelsOption:o}=ct(),{getRootProps:a,getInputProps:c,open:d}=xt({noClick:!0,noKeyboard:!0,maxFiles:1,accept:{"image/*":[".jpeg",".png",".webp"],"application/pdf":[".pdf"]},multiple:!1,onDrop:s=>{if(!ge.isEmpty(s)){const l=new FileReader;l.onload=function(m){const g=m.target.result;i(g)},l.readAsDataURL(s[0])}}}),r=(s,l)=>{s.previousSchool.report=n,j({type:"addNewStudent",payload:{academic:{...s,isCompleted:!0}}}),l.setSubmitting(!1),t(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{initialValues:p,onSubmit:r,enableReinitialize:!0,validationSchema:Bt,children:({values:s,errors:l,touched:m,setFieldValue:g,handleChange:v,handleSubmit:M,isSubmitting:_})=>{var V,x,h,N,F,q;return e.jsxs(T,{py:2,spacing:1,children:[e.jsx(T,{direction:"row",justifyContent:"flex-end",spacing:2,children:e.jsx(X,{loading:_,variant:"contained",color:"primary",onClick:M,endIcon:e.jsx(ve,{}),children:"Continue"})}),e.jsx(I,{variant:"h5",color:"primary.main",bgcolor:"whitesmoke",p:1,sx:{fontWeight:"bold"},children:"Academic Records"}),e.jsx(L,{children:e.jsx(R,{fullWidth:!0,size:"small",options:o,noOptionsText:"No Level available",getOptionLabel:A=>A.type||"",isOptionEqualToValue:(A,z)=>z._id===void 0||z._id===""||z._id===A._id,value:s.level,onChange:(A,z)=>g("level",z),renderInput:A=>{var z,k,O,E;return e.jsx(f,{...A,label:"Current Level",fullWidth:!0,size:"small",error:!!((z=m==null?void 0:m.level)!=null&&z.type&&((k=l==null?void 0:l.level)!=null&&k.type)),helperText:((O=m==null?void 0:m.level)==null?void 0:O.type)&&((E=l==null?void 0:l.level)==null?void 0:E.type)})}})}),e.jsx(I,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Previous School Records"}),e.jsxs(L,{children:[e.jsx(f,{label:"School Name",type:"text",fullWidth:!0,size:"small",value:(V=s==null?void 0:s.previousSchool)==null?void 0:V.name,onChange:v("previousSchool.name"),error:!!((x=m==null?void 0:m.previousSchool)!=null&&x.name&&((h=l==null?void 0:l.previousSchool)!=null&&h.name)),helperText:((N=m==null?void 0:m.previousSchool)==null?void 0:N.name)&&((F=l==null?void 0:l.previousSchool)==null?void 0:F.name)}),e.jsx(R,{freeSolo:!0,fullWidth:!0,size:"small",options:fe,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:A=>A||"",value:(q=s==null?void 0:s.previousSchool)==null?void 0:q.location,onInputChange:(A,z)=>g("previousSchool.location",z),renderInput:A=>{var z,k,O,E;return e.jsx(f,{...A,label:"Location",fullWidth:!0,size:"small",error:!!((z=m==null?void 0:m.previousSchool)!=null&&z.location&&((k=l==null?void 0:l.previousSchool)!=null&&k.location)),helperText:((O=m==null?void 0:m.previousSchool)==null?void 0:O.location)&&((E=l==null?void 0:l.previousSchool)==null?void 0:E.location)})}})]}),e.jsx(I,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"A copy of the most recent school report"}),e.jsx(T,{padding:2,spacing:1,...a({className:"dropzone"}),style:{border:"1px dashed black"},children:e.jsxs(T,{spacing:2,justifyContent:"center",alignItems:"center",paddingY:1,children:[e.jsx(U,{variant:"square",src:n,sx:{width:120,height:120},children:e.jsx(nn,{})}),e.jsxs(T,{children:[e.jsx("input",{...c()}),e.jsx(I,{textAlign:"center",paragraph:!0,children:"Drag & drop your report here"}),e.jsx(G,{variant:"outlined",onClick:d,startIcon:e.jsx(mn,{}),children:"Upload Report"})]}),!ge.isEmpty(n)&&e.jsx("iframe",{style:{width:"100%",height:"5in"},src:n})]})})]})}}),e.jsx(un,{open:w,setOpen:t,setMode:y})]})};ft.propTypes={};const jt=({setMode:y})=>{const{studentState:{newStudent:{photo:p}},studentDispatch:j}=S.useContext($),[w,t]=S.useState(p==null?void 0:p.profile),{getRootProps:n,getInputProps:i,open:o}=xt({noClick:!0,noKeyboard:!0,maxFiles:1,accept:{"image/*":[".jpeg",".png"]},maxSize:2e5,multiple:!1,onDrop:c=>{if(!ge.isEmpty(c)){const d=new FileReader;d.onload=function(r){const u=r.target.result;t(u)},d.readAsDataURL(c[0])}}});S.useEffect(()=>{var d;const c=JSON.parse(localStorage.getItem("@student"));if(c){t((d=c==null?void 0:c.photo)==null?void 0:d.profile);return}},[]);const a=()=>{j({type:"addNewStudent",payload:{photo:{profile:w,isCompleted:!0}}}),y("parent-info")};return e.jsxs(T,{padding:2,spacing:1,...n({className:"dropzone"}),style:{border:"1px dashed black"},children:[e.jsx(T,{direction:"row",justifyContent:"flex-end",spacing:2,children:e.jsx(X,{variant:"contained",onClick:a,endIcon:e.jsx(Zt,{}),children:"Continue"})}),e.jsx(I,{variant:"h5",color:"primary.main",bgcolor:"whitesmoke",p:1,sx:{fontWeight:"bold"},children:"Upload Photo"}),e.jsxs(T,{spacing:2,justifyContent:"center",alignItems:"center",paddingY:1,children:[e.jsx(U,{variant:"square",src:w,sx:{width:120,height:120}}),e.jsxs(T,{children:[e.jsx("input",{...i()}),e.jsx(I,{textAlign:"center",paragraph:!0,children:"Drag & drop your photo here"}),e.jsx(G,{variant:"outlined",onClick:o,startIcon:e.jsx(tn,{}),children:"Upload Image"})]})]})]})};jt.propTypes={};function he({initValue:y,title:p,isCompleted:j,showProgress:w}){return e.jsxs(e.Fragment,{children:[e.jsxs(T,{justifyContent:"center",alignItems:"çenter",children:[e.jsx(U,{sx:{alignSelf:"center",mb:1,bgcolor:j?"success.main":null},children:j?e.jsx(cn,{}):y}),e.jsx(I,{variant:"caption",textAlign:"center",children:p})]}),w&&e.jsx(_t,{variant:"determinate",sx:{width:80,borderRadius:1,bgcolor:j?"success.main":null},color:j?"success":"primary",value:j?100:0})]})}const gn=()=>{var p,j,w,t,n;const{studentState:{newStudent:y}}=S.useContext($);return e.jsxs(qt,{sx:{width:"100%",display:"flex",justifyContent:"center",py:2},children:[e.jsx(he,{initValue:1,title:"Personal Details",showProgress:!0,isCompleted:(p=y==null?void 0:y.personal)==null?void 0:p.isCompleted}),e.jsx(he,{initValue:2,title:"Upload Photo",showProgress:!0,isCompleted:(j=y==null?void 0:y.photo)==null?void 0:j.isCompleted}),e.jsx(he,{initValue:3,title:"Guardian Information",showProgress:!0,isCompleted:(w=y==null?void 0:y.parent)==null?void 0:w.isCompleted}),e.jsx(he,{initValue:4,title:"Medical Records",showProgress:!0,isCompleted:(t=y==null?void 0:y.medical)==null?void 0:t.isCompleted}),e.jsx(he,{initValue:5,title:"Academic Records",showProgress:!1,isCompleted:(n=y==null?void 0:y.academic)==null?void 0:n.isCompleted})]})},at="text/csv",fn="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",jn="application/vnd.ms-excel",bt=()=>{const{schoolSessionDispatch:y}=S.useContext(be),[p,j]=S.useState("personal-info"),[w,t]=S.useState(!1),[n,i]=S.useState(!1),o=Dt(),a=an(o.breakpoints.up("md")),c="Are you sure you want to leave this page? Your changes may not be saved.";S.useEffect(()=>{const s=l=>{l.preventDefault(),l.returnValue=c};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]);function d(s){t(!0);const l=s.target.files[0];try{const m=new FileReader;l.type===at?m.readAsBinaryString(l):m.readAsArrayBuffer(l),m.onload=function(g){let v=[];(l.type===fn||l.type===jn)&&(v=Ht(g.target.result)),l.type===at&&(v=Ut(g.target.result)),v.length!==0&&y({type:"openAddStudentFileDialog",payload:{data:v,type:"file"}}),t(!1)}}catch{}}const r=()=>{let s=p;switch(p){case"photo-info":s="personal-info";break;case"parent-info":s="photo-info";break;case"medical-info":s="parent-info";break;case"academic-info":s="medical-info";break;default:s="photo-info"}return s},u=async()=>{await kt("students")};return e.jsxs(e.Fragment,{children:[e.jsxs(e.Fragment,{children:[e.jsx(ht,{title:"New Student",subtitle:"  Track,manage and control academic and class activities",icon:e.jsx(rn,{sx:{width:30,height:30}}),color:"primary.main"}),a&&e.jsx(gn,{}),e.jsxs(lt,{children:[p!=="personal-info"&&e.jsx(Lt,{onClick:()=>j(r()),children:e.jsx(sn,{})}),e.jsxs(on,{variant:"contained",size:"small",sx:{display:"flex",justifyContent:"flex-end",py:2},children:[e.jsx(G,{onClick:u,children:"Download Student Template"}),e.jsx(G,{sx:{bgcolor:"var(--secondary)"},children:e.jsxs(Nt,{htmlFor:"studentFile",title:"Import students",sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1,color:"primary.main",fontSize:11,cursor:"pointer"},children:[e.jsx(ln,{htmlColor:"#fff"}),e.jsx(I,{variant:"caption",color:"#fff",children:"Student From file"}),e.jsx(Rt,{type:"file",id:"studentFile",name:"studentFile",hidden:!0,inputProps:{accept:".xlsx,.xls,.csv"},onChange:d,onClick:s=>{s.target.value=null,s.currentTarget.value=null}})]})}),e.jsx(G,{startIcon:e.jsx(Gt,{}),onClick:()=>i(!0),children:"Student From Previous Sessions"})]})]}),e.jsxs(mt,{sx:{py:4,mb:4,border:"1px solid lightgray",bgcolor:"#fff"},children:[p==="personal-info"&&e.jsx(ut,{mode:p,setMode:j}),p==="photo-info"&&e.jsx(jt,{mode:p,setMode:j}),p==="parent-info"&&e.jsx(hn,{mode:p,setMode:j}),p==="medical-info"&&e.jsx(gt,{mode:p,setMode:j}),p==="academic-info"&&e.jsx(ft,{setMode:j})]})]}),e.jsx(xn,{open:n,setOpen:i}),w&&e.jsx(Ft,{value:"Loading data.."})]})};bt.propTypes={};const St=({children:y})=>e.jsx(Et,{mode:"wait",children:e.jsx(Mt.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},exit:{y:-10,opacity:0},transition:{duration:.2},children:y})});St.propTypes={children:Ot.node};function bn(){var l;const{userState:{session:y}}=S.useContext(it),p=rt(),[j,w]=S.useState(""),[t,n]=S.useState({_id:"",type:""}),{schoolSessionState:i,schoolSessionDispatch:o}=S.useContext(be),a=i.addStudentFileData,{levelsOption:c}=ct(),d=()=>{tt.fire({title:"Exiting",text:"Unsaved Changes will be lost. Are you sure?",showCancelButton:!0}).then(({isConfirmed:m})=>{m&&o({type:"closeAddStudentFileDialog"})})},{mutateAsync:r,isLoading:u}=st({mutationFn:Jt}),s=()=>{if(w(""),t._id===""){w("Please select a level!");return}const m={students:a==null?void 0:a.data,session:{sessionId:y.sessionId,termId:y.termId,levelId:t._id},type:a.type};tt.fire({title:"Importing students",text:`Do you want to import students in ${t.type}?`,showCancelButton:!0}).then(({isConfirmed:g})=>{g&&r(m,{onSettled:()=>{p.invalidateQueries(["all-students"])},onSuccess:v=>{o(pt(v)),o({type:"closeAddStudentFileDialog"})},onError:v=>{o(dt(v))}})})};return e.jsxs(we,{open:a.open,fullScreen:!0,fullWidth:!0,children:[e.jsx(ot,{onClose:d}),e.jsxs(mt,{children:[e.jsx(ht,{title:"Import Students",subtitle:"Enroll new students by adding their personal and academic details to the system for accurate record-keeping and future reference by importing Student data from excel or csv files.",color:"primary.main"}),e.jsx(T,{spacing:2,py:4,px:2,my:4,border:"1px solid lightgray",children:e.jsxs(I,{children:["Select an ",e.jsx("b",{children:"EXCEL"})," OR ",e.jsx("b",{children:"CSV"})," file containing students information. Make sure the columns matches the accepted fields."]})})]}),e.jsx(Ie,{children:((l=a.data)==null?void 0:l.length)===0?e.jsx(I,{children:"No data available"}):e.jsx($t,{title:(t==null?void 0:t.type)||"Students",icon:dn.student,columns:pn,data:a==null?void 0:a.data,options:{pageSize:10,pageSizeOptions:[10,20,30,50]},actions:[],autoCompleteComponent:e.jsx(R,{size:"small",options:c,noOptionsText:"No Level available",getOptionLabel:m=>m.type||"",isOptionEqualToValue:(m,g)=>g._id===void 0||g._id===""||g._id===m._id,value:t,onChange:(m,g)=>n(g),renderInput:m=>e.jsx(f,{...m,label:"Select Level",size:"small",error:!!j,helperText:j,required:!0,FormHelperTextProps:{sx:{color:"error.main"}}}),sx:{width:250,marginLeft:3}}),showAddButton:!0,addButtonText:"Import Students Data",addButtonIcon:e.jsx(yn,{}),onAddButtonClicked:s})}),u&&e.jsx(yt,{})]})}const Sn=()=>{const[y,p]=S.useState({severity:"",text:""});return e.jsxs(e.Fragment,{children:[y.text&&e.jsx(Vt,{severity:y.severity,onClose:()=>p({text:""}),children:y.text}),e.jsx(e.Fragment,{children:e.jsx(St,{children:e.jsx(bt,{msg:y,setMsg:p})})}),e.jsx(bn,{})]})};Sn.propTypes={};export{Sn as default};
