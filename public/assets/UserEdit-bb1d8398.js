import{g as E,G as U,H as k,r as x,f as I,v as P,an as R,h as b,i as w,j as t,D as A,n as L,aq as $,J as q,S as y,Y as M,A as Q,T as N,Z as c,b as o,p as G,q as V,s as u,t as S,$ as _,ar as H}from"./index-a08c4904.js";import{C as J}from"./CustomDatePicker-c37da33c.js";import{B as K}from"./Back-26c0fe57.js";import{C as O}from"./CustomTitle-d0e5d50c.js";import{M as l}from"./MenuItem-ddd79fe9.js";import"./useMediaQuery-dbbfc5b2.js";import"./InputAdornment-16e34158.js";import"./ListItem-559aef15.js";import"./listItemButtonClasses-628cfd1a.js";import"./ListItemSecondaryAction-33dcc31c.js";import"./Chip-a33d5899.js";import"./ArrowBackRounded-b2e199d9.js";import"./listItemTextClasses-cdd81f8c.js";const Y=()=>{var g;const p=E(),{id:s}=U(),B=k(),[f,h]=x.useState(null),[C,j]=x.useState(null),{schoolSessionDispatch:d}=x.useContext(I),r=P({queryKey:["user",s],queryFn:()=>R(s),initialData:(g=p.getQueryData(["users"]))==null?void 0:g.find(e=>(e==null?void 0:e._id)===s)});x.useEffect(()=>{var e,a;h(b((e=r==null?void 0:r.data)==null?void 0:e.dateofbirth)),j(`/images/users/${(a=r==null?void 0:r.data)==null?void 0:a.profile}`)},[r==null?void 0:r.data]);const{mutateAsync:T,isLoading:W}=w({mutationFn:H}),z=(e,a)=>{delete e.profile,e.fullname=`${e==null?void 0:e.firstname} ${e==null?void 0:e.lastname}`,e.dateofbirth=b(f).format("L"),T(e,{onSettled:()=>{p.invalidateQueries(["users"]),a.setSubmitting(!1)},onSuccess:i=>{d(u(i)),B(`/users/${s}`)},onError:i=>{d(S(i))}})},D=async e=>{var n;const a=(n=e.target)==null?void 0:n.files[0],i={_id:s,profile:a,type:"users"};try{const m=await _(i);d(u(m)),j(URL.createObjectURL(a))}catch(m){d(S(m))}p.invalidateQueries(["users"])};return t.jsxs(t.Fragment,{children:[t.jsx(K,{color:"#012e54"}),t.jsx(O,{title:"Update User Information",subtitle:"Make Changes to user profile information",color:"primary.main"}),t.jsx(A,{}),t.jsx(L,{initialValues:r==null?void 0:r.data,onSubmit:z,enableReinitialize:!0,validationSchema:$,children:({values:e,errors:a,touched:i,handleChange:n,handleSubmit:m,isSubmitting:F})=>t.jsx(t.Fragment,{children:t.jsx(q,{sx:{bgcolor:"#fff"},children:t.jsxs(y,{padding:2,spacing:2,children:[t.jsx(y,{alignSelf:"center",children:t.jsx(M,{handleImageUpload:D,children:t.jsx(Q,{srcSet:C,sx:{width:100,height:100,alignSelf:"center"}})})}),t.jsx(N,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),t.jsxs(c,{children:[t.jsx(o,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:e.firstname,onChange:n("firstname"),error:!!(i.firstname&&a.firstname),helperText:i.firstname&&a.firstname}),t.jsx(o,{label:"Lastname",type:"text",fullWidth:!0,size:"small",value:e.lastname,onChange:n("lastname"),error:!!(i.lastname&&a.lastname),helperText:i.lastname&&a.lastname})]}),t.jsx(o,{label:"Username",fullWidth:!0,size:"small",value:(e==null?void 0:e.username)||"",onChange:n("username"),error:!!(i.username&&a.username),helperText:i.username&&a.username}),t.jsxs(c,{children:[t.jsx(J,{label:"Date of Birth",date:f,setDate:h,disableFuture:!0,error:!!(i.dateofbirth&&a.dateofbirth),helperText:i.dateofbirth&&a.dateofbirth}),t.jsxs(o,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:(e==null?void 0:e.gender)||"",onChange:n("gender"),error:!!(i.gender&&a.gender),helperText:i.gender&&a.gender,children:[t.jsx(l,{value:"male",children:"male"}),t.jsx(l,{value:"female",children:"female"})]})]}),t.jsxs(o,{label:"Role",select:!0,fullWidth:!0,size:"small",value:(e==null?void 0:e.role)||"",onChange:n("role"),error:!!(i.role&&a.role),helperText:i.role&&a.role,children:[t.jsx(l,{value:"administrator",children:"Administrator"}),t.jsx(l,{value:"director",children:"Director"}),t.jsx(l,{value:"secretary",children:"Secretary"}),t.jsx(l,{value:"coordinator",children:"Exams Coordinator"}),t.jsx(l,{value:"teacher",children:"Facilitator"})]}),t.jsxs(c,{children:[t.jsx(o,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:(e==null?void 0:e.email)||"",onChange:n("email"),error:!!(i.email&&a.email),helperText:i.email&&a.email}),t.jsx(o,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:(e==null?void 0:e.phonenumber)||"",onChange:n("phonenumber"),error:!!(i.phonenumber&&a.phonenumber),helperText:i.phonenumber&&a.phonenumber})]}),t.jsx(o,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:(e==null?void 0:e.address)||"",onChange:n("address"),error:!!(i.address&&a.address),helperText:i.address&&a.address}),t.jsxs(c,{children:[t.jsx(o,{label:"Place of Birth",type:"text",fullWidth:!0,size:"small",value:(e==null?void 0:e.residence)||"",onChange:n("residence"),error:!!(i.residence&&a.residence),helperText:i.residence&&a.residence}),t.jsx(o,{label:"Nationality",fullWidth:!0,size:"small",value:(e==null?void 0:e.nationality)||"",onChange:n("nationality"),error:!!(i.nationality&&a.nationality),helperText:i.nationality&&a.nationality})]}),t.jsx(G,{children:t.jsx(V,{loading:F||W,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:m,children:"Save Changes"})})]})})})})]})};Y.propTypes={};export{Y as default};
