import{W as A,u as F,r as d,S as L,an as N,a0 as S,h as O,j as e,i as P,C as k,F as Q,ci as U,l as M,m as T,V as q,b5 as V,q as G,T as i,b6 as x,aX as X,aI as C,n as W,b7 as Y,b8 as $,t as H,v as J,w as v,x as z}from"./index-6e32062a.js";import{c as K}from"./studentAPI-decee1db.js";const B=()=>{const p=F(),[c,b]=d.useState(null),[g,j]=d.useState(null),{schoolSessionDispatch:m}=d.useContext(L),{studentState:{editStudentData:u},studentDispatch:I}=d.useContext(N),o=u==null?void 0:u.data;d.useEffect(()=>{b(S(o==null?void 0:o.dateofbirth)),j(o==null?void 0:o.profile)},[o]);const y=()=>{I({type:"editStudent",payload:{open:!1,data:{}}})},{mutateAsync:D,isLoading:w}=O({mutationFn:K}),E=n=>{n.dateofbirth=S(c).format("L"),n.profile=g,D(n,{onSettled:()=>{p.invalidateQueries(["student-profile"])},onSuccess:t=>{m(v(t)),y()},onError:t=>{m(z(t))}})},R=async n=>{var a;const t=(a=n.target)==null?void 0:a.files[0];try{const r=new FileReader;r.onload=function(l){const h=l.target.result;j(h),m(v("Photo Updated"))},r.readAsDataURL(t)}catch(r){m(z(r))}p.invalidateQueries(["students"]),p.invalidateQueries(["student-by-id"])};return e.jsxs(P,{open:u.open,maxWidth:"md",fullWidth:!0,children:[e.jsx(k,{title:"Edit Student Information",onClose:y}),e.jsx(Q,{initialValues:o,onSubmit:E,enableReinitialize:!0,validationSchema:U,children:({values:n,errors:t,touched:a,setFieldValue:r,handleChange:l,handleSubmit:h})=>e.jsxs(e.Fragment,{children:[e.jsx(M,{sx:{display:"flex",justifyContent:"center"},children:e.jsxs(T,{padding:2,spacing:1,children:[e.jsxs(T,{sx:{position:"relative"},children:[e.jsx(q,{srcSet:g,sx:{width:100,height:100,alignSelf:"center"}}),e.jsx(V,{handleImageUpload:R})]}),e.jsx(G,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),e.jsx(i,{label:"Student ID",type:"text",sx:{maxWidth:300},size:"small",value:n.indexnumber,onChange:l("indexnumber"),error:!!(a.indexnumber&&t.indexnumber),helperText:a.indexnumber&&t.indexnumber}),e.jsxs(x,{children:[e.jsx(i,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:n.firstname||"",onChange:l("firstname"),error:!!(a.firstname&&t.firstname),helperText:a.firstname&&t.firstname}),e.jsx(i,{label:"Surname",fullWidth:!0,size:"small",value:n.surname||"",onChange:l("surname"),error:!!(a.surname&&t.surname),helperText:a.surname&&t.surname}),e.jsx(i,{label:"Othername",fullWidth:!0,size:"small",value:n.othername||"",onChange:l("othername"),error:!!(a.othername&&t.othername),helperText:a.othername&&t.othername})]}),e.jsxs(x,{children:[e.jsx(X,{label:"Date of Birth",date:c,setDate:b,disableFuture:!0,error:!!(a.dateofbirth&&t.dateofbirth),helperText:a.dateofbirth&&t.dateofbirth}),e.jsxs(i,{label:"Gender",select:!0,fullWidth:!0,size:"small",value:n.gender||"",onChange:l("gender"),error:!!(a.gender&&t.gender),helperText:a.gender&&t.gender,children:[e.jsx(C,{value:"male",children:"male"}),e.jsx(C,{value:"female",children:"female"})]})]}),e.jsxs(x,{children:[e.jsx(i,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:n.email||"",onChange:l("email"),error:!!(a.email&&t.email),helperText:a.email&&t.email}),e.jsx(i,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:n.phonenumber||"",onChange:l("phonenumber"),error:!!(a.phonenumber&&t.phonenumber),helperText:a.phonenumber&&t.phonenumber})]}),e.jsx(i,{label:"Address",fullWidth:!0,size:"small",row:3,maxRows:3,value:n.address||"",onChange:l("address"),error:!!(a.address&&t.address),helperText:a.address&&t.address}),e.jsxs(x,{children:[e.jsx(W,{freeSolo:!0,fullWidth:!0,size:"small",options:Y,loadingText:"Please wait....",noOptionsText:"No Town available",getOptionLabel:s=>s||"",value:n.residence||"",onChange:(s,f)=>r("residence",f),renderInput:s=>e.jsx(i,{...s,label:"Residence",fullWidth:!0,size:"small",error:!!(a.residence&&t.residence),helperText:a.residence&&t.residence})}),e.jsx(W,{freeSolo:!0,fullWidth:!0,size:"small",loadingText:"Please wait....",options:$,noOptionsText:"No Nationality available",getOptionLabel:s=>s||"",value:n.nationality||"",onChange:(s,f)=>r("nationality",f),renderInput:s=>e.jsx(i,{...s,label:"Nationality",fullWidth:!0,size:"small",error:!!(a.nationality&&t.nationality),helperText:a.nationality&&t.nationality})})]})]})}),e.jsx(H,{children:e.jsx(J,{loading:w,variant:"contained",color:"primary",onClick:h,children:"Save Changes"})})]})})]})};B.propTypes={};const ee=A.memo(B);export{ee as default};
