import{b as q,i as W,r as n,S as _,u as U,c as K,aa as M,d as O,j as a,C as H,e as Y,y as v,a7 as G,l as p,T as c,F as R,a8 as w,A as J,m as X,B as A,E as Z,g as $,h as tt,ab as at,_ as et}from"./index-ce442eb1.js";import{R as it}from"./index-6da26ac2.js";import{u as st,A as ot}from"./index-05708911.js";import{E as lt}from"./data-25edd064.js";import{B as nt}from"./Back-78662289.js";import{A as rt}from"./Autocomplete-87c4b1e1.js";import"./Chip-15117b24.js";function yt(){var C;const u=q(),{id:l}=W(),{schoolSessionDispatch:d}=n.useContext(_),m=U(),[D,x]=n.useState(""),[g,y]=n.useState(""),[k,h]=n.useState(""),[b,j]=n.useState(""),[f,S]=n.useState(null),o=K({queryKey:["event",l],queryFn:()=>M(l),initialData:(C=u.getQueryData(["events",l]))==null?void 0:C.find(t=>(t==null?void 0:t._id)===l),enabled:!!l,onSuccess:t=>{y(t==null?void 0:t.title),x(t==null?void 0:t.type),h(t==null?void 0:t.caption),j(t==null?void 0:t.description),S(t==null?void 0:t.album)}}),{getRootProps:F,getInputProps:z,open:P}=st({noClick:!0,noKeyboard:!0,maxFiles:1,accept:{"image/*":[".jpeg",".png",".webp"]},maxSize:2e5,multiple:!1,onDrop:t=>{if(!et.isEmpty(t)){const e=new FileReader;e.onload=function(i){const r=i.target.result;S(r)},e.readAsDataURL(t[0])}}}),L={_id:l,type:D,title:g,description:b,album:f},{mutateAsync:V,isLoading:I}=O({mutationFn:at}),N=t=>{V(t,{onSettled:()=>{u.invalidateQueries(["events"])},onSuccess:e=>{d($(e)),m("/events")},onError:e=>{d(tt(e))}})};return a.jsxs(H,{children:[a.jsx(nt,{to:"/events",color:"primary.main"}),a.jsx(Y,{title:"New Events",subtitle:" Send single and bulk SMS to students and parents",color:"text.main",backColor:"#012e54"}),a.jsx(v,{initialValues:L,onSubmit:N,enableReinitialize:!0,validationSchema:G,children:({values:t,errors:e,touched:i,handleSubmit:r})=>{var E,T,B;return a.jsxs(p,{px:2,py:4,spacing:4,bgcolor:"#fff",children:[a.jsx(rt,{freeSolo:!0,fullWidth:!0,size:"small",options:lt,loadingText:"Please wait....",noOptionsText:"No Event available",getOptionLabel:s=>s||"",value:t==null?void 0:t.type,defaultValue:(E=o==null?void 0:o.data)==null?void 0:E.type,onChange:(s,Q)=>x(Q),renderInput:s=>a.jsx(c,{...s,label:"Select Event Type",fullWidth:!0,size:"small",error:!!(i.type&&e.type),helperText:i.type&&e.type})}),a.jsx(c,{label:"Event Title",fullWidth:!0,size:"small",row:3,maxRows:3,defaultValue:(T=o==null?void 0:o.data)==null?void 0:T.title,value:g,onChange:s=>y(s.target.value),error:!!(i.title&&e.title),helperText:i.title&&e.title}),a.jsx(c,{label:"Event Caption",fullWidth:!0,size:"small",row:3,maxRows:3,value:k,onChange:s=>h(s.target.value),error:!!(i.caption&&e.caption),helperText:i.caption&&e.caption}),a.jsxs("div",{style:{marginBottom:"32px"},children:[a.jsx(R,{style:{color:i.description&&e.description?"#B72136":"var(--primary)"},children:"Event Description"}),a.jsx(it,{theme:"snow",value:b,onChange:s=>j(s),defaultValue:(B=o==null?void 0:o.data)==null?void 0:B.description,placeholder:"Description here",style:{borderRadius:2,border:i.description&&e.description?"1px solid #B72136":"none"}}),i.description&&e.description&&a.jsx(w,{sx:{color:"#B72136"},children:e.description})]}),a.jsxs("div",{children:[a.jsx(R,{style:{color:i.album&&e.album?"#B72136":"var(--primary)"},children:"Event Photo/Album"}),a.jsxs(p,{...F({className:"dropzone"}),sx:{borderRadius:1,border:i.album&&e.album?"1px solid #B72136":"1px dotted lightgray",py:8,px:4},children:[a.jsx(J,{variant:"square",src:f,sx:{width:{xs:120,md:480},height:{xs:120,md:480},objectFit:"contain",alignSelf:"center"}}),a.jsx("input",{...z()}),a.jsx(X,{textAlign:"center",paragraph:!0,children:"Drag & drop your photo here"}),a.jsx(A,{variant:"outlined",onClick:P,startIcon:a.jsx(ot,{}),children:"Upload Image"})]}),i.album&&e.album&&a.jsx(w,{sx:{color:"#B72136"},children:e.album})]}),a.jsxs(p,{direction:"row",justifyContent:"flex-end",spacing:2,children:[a.jsx(A,{onClick:()=>m("/events"),children:"Cancel"}),a.jsx(Z,{loading:I,variant:"contained",color:"primary",onClick:r,children:"Save Changes"})]})]})}})]})}export{yt as default};
