import{c as Y,j as h,ay as le,az as U,r as x,aA as ce,_ as k,aB as J,k as ue,p as de,B as W,m as me,U as he,a0 as pe,f as fe,G as ge,v as Se,i as ve,C as Ie,aC as ye,S as xe,q as Ce,W as be,T as q,P as $,x as we}from"./index-bb65b4bf.js";import{R as ze}from"./index-19e2cbed.js";import{R as B}from"./Report-659f17c8.js";import{d as Te,e as Oe}from"./ExaminationAPI-b9866df6.js";import{C as Re}from"./CustomizedMaterialTable-266061d1.js";import{s as _e}from"./score_ico-e1082ac1.js";import{C as X}from"./CustomTitle-ed47c53b.js";import{B as je}from"./ButtonGroup-83f2640f.js";import"./ReportItemUnderline-31b969e7.js";import"./TabPanel-175e39ff.js";import"./Toolbar-36d77a55.js";import"./MenuItem-1edcf8db.js";import"./listItemTextClasses-35ff90f6.js";import"./Chip-fa36c3a1.js";import"./Autocomplete-95da27f3.js";import"./Skeleton-6cff8ea8.js";import"./ListItemText-33ae0292.js";import"./InputAdornment-321f8206.js";import"./CardContent-25ef3451.js";import"./ListItemSecondaryAction-c66bb893.js";import"./Grid-6a14669c.js";import"./useMediaQuery-5f0ec7e9.js";import"./ListItem-befde9c4.js";import"./listItemButtonClasses-9702db06.js";import"./ListItemButton-bf3e0355.js";import"./Check-7b95876f.js";import"./DeleteOutline-80e9f63f.js";import"./Delete-97505065.js";import"./Add-66663708.js";const Pe=Y(h.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),ke=Y(h.jsx("path",{d:"m22 10-6-6H4c-1.1 0-2 .9-2 2v12.01c0 1.1.9 1.99 2 1.99l16-.01c1.1 0 2-.89 2-1.99zm-7-4.5 5.5 5.5H15z"}),"Note");var H=Number.isNaN||function(t){return typeof t=="number"&&t!==t};function Ee(o,t){return!!(o===t||H(o)&&H(t))}function Me(o,t){if(o.length!==t.length)return!1;for(var r=0;r<o.length;r++)if(!Ee(o[r],t[r]))return!1;return!0}function M(o,t){t===void 0&&(t=Me);var r,c=[],u,I=!1;function C(){for(var m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];return I&&r===this&&t(m,c)||(u=o.apply(this,m),I=!0,r=this,c=m),u}return C}var Ne=typeof performance=="object"&&typeof performance.now=="function",G=Ne?function(){return performance.now()}:function(){return Date.now()};function V(o){cancelAnimationFrame(o.id)}function We(o,t){var r=G();function c(){G()-r>=t?o.call(null):u.id=requestAnimationFrame(c)}var u={id:requestAnimationFrame(c)};return u}var N=-1;function K(o){if(o===void 0&&(o=!1),N===-1||o){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),N=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return N}var _=null;function Q(o){if(o===void 0&&(o=!1),_===null||o){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var c=document.createElement("div"),u=c.style;return u.width="100px",u.height="100px",t.appendChild(c),document.body.appendChild(t),t.scrollLeft>0?_="positive-descending":(t.scrollLeft=1,t.scrollLeft===0?_="negative":_="positive-ascending"),document.body.removeChild(t),_}return _}var Le=150,Ae=function(t,r){return t};function Fe(o){var t,r=o.getItemOffset,c=o.getEstimatedTotalSize,u=o.getItemSize,I=o.getOffsetForIndexAndAlignment,C=o.getStartIndexForOffset,m=o.getStopIndexForStartIndex,v=o.initInstanceProps,z=o.shouldResetStyleCacheOnItemSizeChange,w=o.validateProps;return t=function(T){le(b,T);function b(p){var e;return e=T.call(this,p)||this,e._instanceProps=v(e.props,U(e)),e._outerRef=void 0,e._resetIsScrollingTimeoutId=null,e.state={instance:U(e),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof e.props.initialScrollOffset=="number"?e.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},e._callOnItemsRendered=void 0,e._callOnItemsRendered=M(function(n,s,i,d){return e.props.onItemsRendered({overscanStartIndex:n,overscanStopIndex:s,visibleStartIndex:i,visibleStopIndex:d})}),e._callOnScroll=void 0,e._callOnScroll=M(function(n,s,i){return e.props.onScroll({scrollDirection:n,scrollOffset:s,scrollUpdateWasRequested:i})}),e._getItemStyle=void 0,e._getItemStyle=function(n){var s=e.props,i=s.direction,d=s.itemSize,S=s.layout,a=e._getItemStyleCache(z&&d,z&&S,z&&i),g;if(a.hasOwnProperty(n))g=a[n];else{var l=r(e.props,n,e._instanceProps),y=u(e.props,n,e._instanceProps),O=i==="horizontal"||S==="horizontal",R=i==="rtl",P=O?l:0;a[n]=g={position:"absolute",left:R?void 0:P,right:R?P:void 0,top:O?0:l,height:O?"100%":y,width:O?y:"100%"}}return g},e._getItemStyleCache=void 0,e._getItemStyleCache=M(function(n,s,i){return{}}),e._onScrollHorizontal=function(n){var s=n.currentTarget,i=s.clientWidth,d=s.scrollLeft,S=s.scrollWidth;e.setState(function(a){if(a.scrollOffset===d)return null;var g=e.props.direction,l=d;if(g==="rtl")switch(Q()){case"negative":l=-d;break;case"positive-descending":l=S-i-d;break}return l=Math.max(0,Math.min(l,S-i)),{isScrolling:!0,scrollDirection:a.scrollOffset<l?"forward":"backward",scrollOffset:l,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._onScrollVertical=function(n){var s=n.currentTarget,i=s.clientHeight,d=s.scrollHeight,S=s.scrollTop;e.setState(function(a){if(a.scrollOffset===S)return null;var g=Math.max(0,Math.min(S,d-i));return{isScrolling:!0,scrollDirection:a.scrollOffset<g?"forward":"backward",scrollOffset:g,scrollUpdateWasRequested:!1}},e._resetIsScrollingDebounced)},e._outerRefSetter=function(n){var s=e.props.outerRef;e._outerRef=n,typeof s=="function"?s(n):s!=null&&typeof s=="object"&&s.hasOwnProperty("current")&&(s.current=n)},e._resetIsScrollingDebounced=function(){e._resetIsScrollingTimeoutId!==null&&V(e._resetIsScrollingTimeoutId),e._resetIsScrollingTimeoutId=We(e._resetIsScrolling,Le)},e._resetIsScrolling=function(){e._resetIsScrollingTimeoutId=null,e.setState({isScrolling:!1},function(){e._getItemStyleCache(-1,null)})},e}b.getDerivedStateFromProps=function(e,n){return De(e,n),w(e),null};var f=b.prototype;return f.scrollTo=function(e){e=Math.max(0,e),this.setState(function(n){return n.scrollOffset===e?null:{scrollDirection:n.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},f.scrollToItem=function(e,n){n===void 0&&(n="auto");var s=this.props,i=s.itemCount,d=s.layout,S=this.state.scrollOffset;e=Math.max(0,Math.min(e,i-1));var a=0;if(this._outerRef){var g=this._outerRef;d==="vertical"?a=g.scrollWidth>g.clientWidth?K():0:a=g.scrollHeight>g.clientHeight?K():0}this.scrollTo(I(this.props,e,n,S,this._instanceProps,a))},f.componentDidMount=function(){var e=this.props,n=e.direction,s=e.initialScrollOffset,i=e.layout;if(typeof s=="number"&&this._outerRef!=null){var d=this._outerRef;n==="horizontal"||i==="horizontal"?d.scrollLeft=s:d.scrollTop=s}this._callPropsCallbacks()},f.componentDidUpdate=function(){var e=this.props,n=e.direction,s=e.layout,i=this.state,d=i.scrollOffset,S=i.scrollUpdateWasRequested;if(S&&this._outerRef!=null){var a=this._outerRef;if(n==="horizontal"||s==="horizontal")if(n==="rtl")switch(Q()){case"negative":a.scrollLeft=-d;break;case"positive-ascending":a.scrollLeft=d;break;default:var g=a.clientWidth,l=a.scrollWidth;a.scrollLeft=l-g-d;break}else a.scrollLeft=d;else a.scrollTop=d}this._callPropsCallbacks()},f.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&V(this._resetIsScrollingTimeoutId)},f.render=function(){var e=this.props,n=e.children,s=e.className,i=e.direction,d=e.height,S=e.innerRef,a=e.innerElementType,g=e.innerTagName,l=e.itemCount,y=e.itemData,O=e.itemKey,R=O===void 0?Ae:O,P=e.layout,ee=e.outerElementType,te=e.outerTagName,re=e.style,oe=e.useIsScrolling,ne=e.width,L=this.state.isScrolling,E=i==="horizontal"||P==="horizontal",se=E?this._onScrollHorizontal:this._onScrollVertical,A=this._getRangeToRender(),ie=A[0],ae=A[1],F=[];if(l>0)for(var j=ie;j<=ae;j++)F.push(x.createElement(n,{data:y,key:R(j,y),index:j,isScrolling:oe?L:void 0,style:this._getItemStyle(j)}));var D=c(this.props,this._instanceProps);return x.createElement(ee||te||"div",{className:s,onScroll:se,ref:this._outerRefSetter,style:ce({position:"relative",height:d,width:ne,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:i},re)},x.createElement(a||g||"div",{children:F,ref:S,style:{height:E?"100%":D,pointerEvents:L?"none":void 0,width:E?D:"100%"}}))},f._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var e=this.props.itemCount;if(e>0){var n=this._getRangeToRender(),s=n[0],i=n[1],d=n[2],S=n[3];this._callOnItemsRendered(s,i,d,S)}}if(typeof this.props.onScroll=="function"){var a=this.state,g=a.scrollDirection,l=a.scrollOffset,y=a.scrollUpdateWasRequested;this._callOnScroll(g,l,y)}},f._getRangeToRender=function(){var e=this.props,n=e.itemCount,s=e.overscanCount,i=this.state,d=i.isScrolling,S=i.scrollDirection,a=i.scrollOffset;if(n===0)return[0,0,0,0];var g=C(this.props,a,this._instanceProps),l=m(this.props,g,a,this._instanceProps),y=!d||S==="backward"?Math.max(1,s):1,O=!d||S==="forward"?Math.max(1,s):1;return[Math.max(0,g-y),Math.max(0,Math.min(n-1,l+O)),g,l]},b}(x.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var De=function(t,r){t.children,t.direction,t.height,t.layout,t.innerTagName,t.outerTagName,t.width,r.instance},Ue=Fe({getItemOffset:function(t,r){var c=t.itemSize;return r*c},getItemSize:function(t,r){var c=t.itemSize;return c},getEstimatedTotalSize:function(t){var r=t.itemCount,c=t.itemSize;return c*r},getOffsetForIndexAndAlignment:function(t,r,c,u,I,C){var m=t.direction,v=t.height,z=t.itemCount,w=t.itemSize,T=t.layout,b=t.width,f=m==="horizontal"||T==="horizontal",p=f?b:v,e=Math.max(0,z*w-p),n=Math.min(e,r*w),s=Math.max(0,r*w-p+w+C);switch(c==="smart"&&(u>=s-p&&u<=n+p?c="auto":c="center"),c){case"start":return n;case"end":return s;case"center":{var i=Math.round(s+(n-s)/2);return i<Math.ceil(p/2)?0:i>e+Math.floor(p/2)?e:i}case"auto":default:return u>=s&&u<=n?u:u<s?s:n}},getStartIndexForOffset:function(t,r){var c=t.itemCount,u=t.itemSize;return Math.max(0,Math.min(c-1,Math.floor(r/u)))},getStopIndexForStartIndex:function(t,r,c){var u=t.direction,I=t.height,C=t.itemCount,m=t.itemSize,v=t.layout,z=t.width,w=u==="horizontal"||v==="horizontal",T=r*m,b=w?z:I,f=Math.ceil((b+c-T)/m);return Math.max(0,Math.min(C-1,r+f-1))},initInstanceProps:function(t){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(t){t.itemSize}});const qe=o=>{const t=o.map(r=>({title:r,field:k.camelCase(r)}));return[{title:"No",render:r=>r.tableData.id+1},{title:"Student Name",field:"fullName",cellStyle:{width:400,color:"blue",whiteSpace:"nowrap",minWidth:300}},...t,{title:"Overall Score",field:"overallScore",cellStyle:{color:"red",fontWeight:"bold"}},{title:"Grade",field:"grade",cellStyle:{color:"blue",fontWeight:"bold"}},{title:"Position",field:"position",cellStyle:{color:"green",fontWeight:"bold"}}]},$e=(o,t)=>{const r=t.map(u=>({[k.camelCase(u)]:0})),c=o.map(({fullName:u,scores:I,overallScore:C,grade:m,position:v})=>{const z=I.map(({subject:f,totalScore:p})=>({[k.camelCase(f)]:p})),w={};z.forEach(f=>{const p=Object.keys(f)[0];w[p]=f[p]});const T={};r.forEach(f=>{const p=Object.keys(f)[0];T[p]=f[p]});const b={...w};for(let f in T)b[f]===void 0&&(b[f]=T[f]);return{fullName:u,overallScore:C,grade:m,position:v,...b}});return k.orderBy(c,"overallScore","desc")},Be=({open:o,setOpen:t})=>{const{studentState:{studentReportDetails:r}}=x.useContext(J),[c,u]=x.useState([]),[I,C]=x.useState([]);x.useEffect(()=>{if(r!=null&&r.subjects){const v=qe(r.subjects);u(v)}if(r!=null&&r.results){const v=$e(r==null?void 0:r.results,r==null?void 0:r.subjects);C(v)}},[r]);const m=()=>{t(!1)};return h.jsxs(ue,{open:o,maxWidth:"lg",fullScreen:!0,children:[h.jsx(X,{title:"Score Sheet",subtitle:"Show details of student performance",color:"primary.main"}),h.jsx(de,{children:h.jsx(W,{onClick:m,children:"Close"})}),h.jsx(me,{children:h.jsx(Re,{icon:_e,title:"Exams Score Sheet",exportFileName:"Score Sheet",columns:c,data:I,actions:[],options:{pageSize:10}})})]})},Z=()=>{var p,e,n,s,i,d,S,a,g;const{userState:{session:o}}=x.useContext(pe),{studentDispatch:t}=x.useContext(J),{schoolSessionDispatch:r}=x.useContext(fe),[c,u]=x.useState(!1),{levelId:I}=ge(),C=x.useRef(),m=Se({queryKey:["exams-reports",I,o.sessionId,o.termId],queryFn:()=>Te({sessionId:o.sessionId,termId:o.termId,levelId:I}),enabled:!!I&&!!o.sessionId&&!!o.termId,onSuccess:l=>{t({type:"getReportDetails",payload:l})}}),{mutateAsync:v,isLoading:z}=ve({mutationFn:Oe}),w=()=>{var l,y;we.fire({title:"Publishing Reports",text:`You are about to publish the report of ${((y=(l=m==null?void 0:m.data)==null?void 0:l.results)==null?void 0:y.length)||"all "} students.Do you wish to continue?`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:O})=>{if(O){r({type:"openGeneralAlert",payload:{message:"Publishing reports.This might take a while please wait....",severity:"info"}});const R={sessionId:o.sessionId,termId:o.termId,levelId:I};v(R,{onSuccess:()=>{r({type:"openGeneralAlert",payload:{message:"Results have been published Successfully!!!",severity:"success"}})},onError:()=>{r({type:"openGeneralAlert",payload:{message:"An error has occured.Couldnt Generate Reports.Try again later",severity:"error"}})}})}})},T=x.memo(({data:l,index:y,isScrolling:O,style:R})=>h.jsx(B,{student:l[y],style:R},y)),b=x.useCallback(l=>h.jsx(B,{student:l},l==null?void 0:l._id),[(p=m==null?void 0:m.data)==null?void 0:p.results]),f=()=>u(!0);return h.jsxs(h.Fragment,{children:[h.jsxs(Ie,{children:[h.jsx(ye,{to:-1,children:h.jsx(Pe,{})}),h.jsx(X,{title:"Student Reports",subtitle:"Show details of student performance",color:"primary.main"}),h.jsx(xe,{py:2,direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",justifyContent:"center",children:h.jsxs(je,{variant:"contained",sx:{mb:4},children:[h.jsx(W,{onClick:f,color:"warning",children:"View Score Sheet"}),h.jsx(ze,{trigger:()=>h.jsx(W,{color:"info",children:"Print Reports"}),content:()=>C.current,documentTitle:"Report"}),h.jsx(Ce,{loading:z,loadingPosition:"start",startIcon:h.jsx(ke,{}),onClick:w,color:"success",children:z?"Please Wait":"Publish Reports"})]})})]}),m.isLoading&&h.jsx(be,{}),m.isError&&h.jsx(q,{children:"Error loading report info....."}),((e=m.data)==null?void 0:e.results)&&((s=(n=m.data)==null?void 0:n.results)==null?void 0:s.length)===0&&h.jsx(q,{children:"No Report Available....."}),h.jsx(Ue,{className:"report-container",height:1096,width:"215mm",itemSize:1200,itemCount:(d=(i=m.data)==null?void 0:i.results)==null?void 0:d.length,itemData:(S=m.data)==null?void 0:S.results,style:{marginInline:"auto"},children:T}),h.jsx("div",{ref:C,className:"print-container",children:(g=(a=m.data)==null?void 0:a.results)==null?void 0:g.map(l=>b(l))}),h.jsx(Be,{open:c,setOpen:u})]})};Z.propTypes={open:$.bool,setOpen:$.func};const yt=he.memo(Z);export{yt as default};
