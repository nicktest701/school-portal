import{Q as M,j as e,r as d,U as H,bO as k,Z as E,u as N,S as P,_,h as B,i as T,z as O,t as z,B as F,v as q,l as A,q as g,cj as R,ck as W,N as v,w as Y,x as $,R as Q,V as U,cl as C,a9 as f,g as V,cm as G,y as Z,C as J,a as l,p as K,L as X,aN as ee,a2 as b,O as te,bZ as se,cn as ae,M as ne,J as oe,a6 as ie,ak as re,a1 as le,G as ce}from"./index-e0c0d8c9.js";import{d as de}from"./School-0354f647.js";import{a as ue}from"./studentColumns-9e760bc6.js";import{b as pe}from"./studentAPI-fc20c9bb.js";const me=M(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History");function xe(){var S;const{userState:{session:a}}=d.useContext(H),{state:o}=k();E();const i=N(),[s,r]=d.useState([]),[t,c]=d.useState(!0),{schoolSessionState:x,schoolSessionDispatch:u}=d.useContext(P),n=x.fileData;d.useEffect(()=>{if(n.data.length>0){const p=n.columns.map(m=>({title:_.upperCase(m),field:m}));r(p)}c(!1)},[n]);const h=()=>{v.fire({title:"Exiting",text:"Do you want to exit?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:p})=>{p&&u({type:"closeFileDialog"})})},{mutateAsync:w}=B({mutationFn:pe}),I=()=>{c(!0);const p={students:n.data,session:{sessionId:a.sessionId,termId:a.termId,levelId:o.levelId},type:n.type};v.fire({title:"Importing students",text:"Do you want to import ?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:m})=>{m&&w(p,{onSettled:()=>{i.invalidateQueries(["current-students"]),c(!1)},onSuccess:y=>{u(Y(y))},onError:y=>{u($(y))}}),c(!1)})};return e.jsxs(T,{open:n.open,fullScreen:!0,fullWidth:!0,children:[e.jsx(O,{children:"Preview"}),e.jsxs(z,{sx:{paddingX:3},children:[e.jsx(F,{onClick:h,children:"Cancel"}),e.jsx(q,{variant:"contained",loading:t,onClick:I,children:"Save"})]}),e.jsx(A,{children:((S=n.data)==null?void 0:S.length)===0?e.jsx(g,{children:"No data available"}):e.jsx(R,{title:"Students",isLoading:t,icons:W,columns:s,data:n.data,options:{pageSize:10,pageSizeOptions:[10,20,30,50]}})})]})}var j={},he=U;Object.defineProperty(j,"__esModule",{value:!0});var D=j.default=void 0,ye=he(Q()),ge=e;D=j.default=(0,ye.default)((0,ge.jsx)("path",{d:"M15.59 3.59c-.38-.38-.89-.59-1.42-.59H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.41zM8 17c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m0-4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m0-4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m6 0V4.5l5.5 5.5H15c-.55 0-1-.45-1-1"}),"SummarizeRounded");function L({open:a,setOpen:o}){var r;const{id:i}=f(),s=V({queryKey:["attendance-history"],queryFn:()=>G(i),enabled:!!i});return e.jsxs(T,{open:a,fullWidth:!0,maxWidth:"md",TransitionComponent:Z,children:[e.jsx(J,{title:"Attendance History",onClose:()=>o(!1)}),e.jsxs(A,{children:[s.isLoading&&e.jsx(g,{children:"Loading...."}),e.jsx(l,{primary:`Attendance - ${(r=s==null?void 0:s.data)==null?void 0:r.length} days`,primaryTypographyProps:{fontSize:20,fontWeight:"bold",textAlign:"right"}}),e.jsxs(K,{sx:{maxHeight:600},children:[e.jsxs(X,{children:[e.jsx(l,{primary:"Date"}),e.jsx(l,{primary:"Present"}),e.jsx(l,{primary:"Absent"})]}),s.data&&s.data.map(t=>e.jsxs(ee,{divider:!0,children:[e.jsx(l,{primary:b(t.date).format("Do MMMM,YYYY"),secondary:b(t.date).format("dddd"),secondaryTypographyProps:{color:"primary.main",fontWeight:"bold"}}),e.jsx(l,{primary:t.present,primaryTypographyProps:{width:100}}),e.jsx(l,{primary:t.absent,primaryTypographyProps:{width:100}})]},t.date))]})]})]})}L.propTypes={open:C.PropTypes.bool,setOpen:C.PropTypes.func};const fe=()=>{const{id:a,type:o}=f(),i=te(),[s,r]=d.useState(!1),{students:t,rollNumber:c,levelLoading:x}=se(a),u=()=>{i("/student/new")},h=[{icon:()=>e.jsx(D,{}),position:"toolbar",tooltip:"New Attendance",onClick:()=>{i(`/level/attendance/${a}/${o}`)},isFreeAction:!0},{icon:()=>e.jsx(me,{}),position:"toolbar",tooltip:"Attendance History",onClick:()=>r(!0),isFreeAction:!0}];return e.jsxs(e.Fragment,{children:[(t==null?void 0:t.length)===0?e.jsx(ae,{img:ne.student,message:"ðŸ˜‘ No Student available.Add your first student to this level",buttonText:"New Student",onClick:u,showAddButton:!0}):e.jsx(oe,{search:!0,isLoading:x,title:o,subtitle:`${c} Students`,exportFileName:o||"",columns:ue,data:t,actions:[...h],icon:ie}),e.jsx(L,{open:s,setOpen:r}),e.jsx(xe,{})]})},be=()=>{const{type:a}=f();return e.jsxs(e.Fragment,{children:[e.jsx(re,{to:"/level",color:"primary.main"}),e.jsxs(le,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:{xs:"space-around",md:"space-between"},alignItems:"center",bgcolor:"#fff",mb:4,p:1},children:[e.jsx(ce,{title:"Current Level",subtitle:"Track,manage and control academic and class activities",icon:e.jsx(de,{color:"inherit",sx:{width:50,height:50}}),color:"primary.main"}),e.jsx(g,{variant:"h5",paragraph:!0,whiteSpace:"nowrap",children:a})]}),e.jsx(fe,{})]})};export{be as default};
