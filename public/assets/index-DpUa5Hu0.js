import{j as e,T as o,U as b,r as l,a0 as y,a as S,b as R,S as $,d as L,a1 as _,s as A,t as O,w as v,a2 as G,v as Q,k as m,A as T,l as E,B as W,y as V,g as w,h as C,C as P,e as M,E as q}from"./index-DrgqF6h7.js";import{C as j}from"./CustomFormControl-BOFleHo6.js";import{u as H}from"./sessionAPI-DOHoXMTi.js";import{C as N}from"./CustomImageChooser-B_xkuEqQ.js";import{D as J}from"./DialogActions-Cx2GHHEW.js";function i({label:s,value:p}){return e.jsx(o,{label:s,value:p,fullWidth:!0,inputProps:{style:{backgroundColor:"whitesmoke",color:"var(--primary)",fontWeight:"bold",textTransform:"capitalize"}},InputProps:{readOnly:!0}})}const B=()=>{const{user:s}=l.useContext(y),[p,u]=S(),x=R(),[d,U]=l.useState(""),[k,g]=l.useState(null),{schoolSessionDispatch:f}=l.useContext($);l.useEffect(()=>{g(`/images/users/${s==null?void 0:s.profile}`)},[s]);const{mutateAsync:z}=L(_),I=(a,r)=>{if(a.confirmPassword!==a.password){U("Passwords do not match"),r.setSubmitting(!1);return}a.fullname=`${a==null?void 0:a.firstname} ${a==null?void 0:a.lastname}`,delete a.profile,delete a.confirmPassword,a._id=s==null?void 0:s.id,z(a,{onSettled:()=>{x.invalidateQueries(["user"]),r.setSubmitting(!1)},onSuccess:t=>{f(w(t)),h()},onError:t=>{f(C(t))}})},D=async a=>{var n;const r=(n=a.target)==null?void 0:n.files[0],t={_id:s==null?void 0:s.id,profile:r,type:"users"};try{const c=await H(t);f(w(c)),g(URL.createObjectURL(r))}catch(c){f(C(c))}x.invalidateQueries(["user"])},h=()=>{u(a=>(a.delete("e_p"),a))};return e.jsxs(A,{open:p.get("e_p"),maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{title:"Edit User",onClose:h}),e.jsx(v,{initialValues:{password:"",confirmPassword:"",...s},onSubmit:I,enableReinitialize:!0,validationSchema:G,children:({values:a,errors:r,touched:t,handleChange:n,handleSubmit:c,isSubmitting:F})=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(m,{direction:{xs:"column",md:"row"},justifyContent:"center",columnGap:3,children:[e.jsx(m,{children:e.jsx(N,{handleImageUpload:D,children:e.jsx(T,{srcSet:k,sx:{width:100,height:100,alignSelf:"center"}})})}),e.jsxs(m,{padding:2,spacing:2,children:[e.jsx(E,{variant:"body2",color:"primary.main",sx:{fontWeight:"bold"},children:"Personal information"}),e.jsx(o,{label:"Firstname",type:"text",fullWidth:!0,size:"small",value:a.firstname||"",onChange:n("firstname"),error:!!(t.firstname&&r.firstname),helperText:t.firstname&&r.firstname}),e.jsx(o,{label:"Lastname",type:"text",fullWidth:!0,size:"small",value:a.lastname||"",onChange:n("lastname"),error:!!(t.lastname&&r.lastname),helperText:t.lastname&&r.lastname}),e.jsx(o,{label:"Username",fullWidth:!0,size:"small",value:a.username||"",onChange:n("username"),error:!!(t.username&&r.username),helperText:t.username&&r.username}),e.jsx(o,{label:"Email",fullWidth:!0,size:"small",row:3,maxRows:3,value:a.email||"",onChange:n("email"),error:!!(t.email&&r.email),helperText:t.email&&r.email}),e.jsx(o,{label:"Telephone No.",inputMode:"tel",type:"tel",fullWidth:!0,size:"small",value:a.phonenumber||"",onChange:n("phonenumber"),error:!!(t.phonenumber&&r.phonenumber),helperText:t.phonenumber&&r.phonenumber}),e.jsxs(j,{children:[e.jsx(o,{type:"password",label:"Password",fullWidth:!0,size:"small",value:a.password,onChange:n("password"),error:!!(t.password&&r.password),helperText:t.password&&r.password}),e.jsx(o,{type:"password",label:"Confirm Password",fullWidth:!0,size:"small",value:a.confirmPassword,onChange:n("confirmPassword"),error:!!(t.confirmPassword&&r.confirmPassword),helperText:d||t.confirmPassword&&r.confirmPassword,FormHelperTextProps:{color:"error.main"}})]})]})]})}),e.jsxs(J,{children:[e.jsx(W,{onClick:h,children:"Cancel"}),e.jsx(V,{loading:F,variant:"contained",color:"primary",sx:{minWidth:{xs:100,sm:150}},onClick:c,children:"Save Changes"})]})]})})]})};B.propTypes={open:b.bool,setOpen:b.func};function se(){const{user:s}=l.useContext(y),[p,u]=S(),x=()=>{u(d=>(d.set("e_p",!0),d))};return e.jsxs(P,{children:[e.jsx(M,{title:"Profile",subtitle:"View and update your personal information to keep your profile accurate and current.",color:"text.main",backColor:"#012e54"}),e.jsxs(P,{sx:{display:"flex",flexDirection:"column",alignItems:"start",py:4,gap:4,bgcolor:"#fff"},children:[e.jsx(W,{variant:"contained",startIcon:e.jsx(q,{}),onClick:x,sx:{alignSelf:"flex-end"},children:"Edit Profile"}),e.jsxs(m,{width:"100%",justifyContent:"center",alignItems:"center",rowGap:2,children:[e.jsx(m,{sx:{p:1,border:"1px solid lightgray",borderRadius:"50%"},children:e.jsx(T,{src:`/images/users/${s==null?void 0:s.profile}`,sx:{height:120,width:120}})}),e.jsx(E,{variant:"h6",color:"primary",sx:{paddingTop:2,textTransform:"capitalize"},children:s==null?void 0:s.fullname})]}),e.jsxs(m,{spacing:3,width:"100%",children:[e.jsxs(j,{children:[e.jsx(i,{label:"Firstname",value:s.firstname||""}),e.jsx(i,{label:"Lastname",value:s.lastname||""})]}),e.jsx(i,{label:"Username",value:s.username||""}),e.jsx(i,{label:"Email",value:s.email||""}),e.jsxs(j,{children:[e.jsx(i,{label:"Date of Birth",value:s.dob||""}),e.jsx(i,{label:"Gender",value:s.gender||""})]}),e.jsx(i,{label:"Role",value:s.role||""})]})]}),e.jsx(B,{})]})}export{se as default};
