import{r as y,U as Q,u as M,S as _,f as $,g as q,bI as Y,h as T,bZ as ie,j as e,i as B,C as R,F as G,b_ as W,l as z,m as I,n as C,b$ as U,T as b,c0 as K,t as H,v as J,_ as P,x as w,w as O,P as ae,Q as re,c1 as ce,c2 as de,c3 as ue,a as A,M as pe,c4 as me,$ as Z,G as he,J as xe,c5 as fe,c6 as ve,K as k,c7 as ye,e as V,E as ge,q as je,D as Le}from"./index-6e32062a.js";import{d as Se}from"./Class-ea9c2700.js";import{d as Ce}from"./Subject-9d3ad2b8.js";import{d as be}from"./Person3-2349fc04.js";import{l as we}from"./initialValues-163c372f.js";import{G as Ie}from"./GlobalSpinner-05ebe35d.js";import{D as N}from"./DashboardCard-19568663.js";const Ae=({open:a,setOpen:i})=>{const{userState:{session:x}}=y.useContext(Q),l=M(),{schoolSessionDispatch:c}=y.useContext(_),{levelsOption:f}=$(),L=q({queryKey:["teachers"],queryFn:()=>Y(),select:s=>s==null?void 0:s.map(o=>({_id:o==null?void 0:o._id,fullName:o==null?void 0:o.fullName}))}),{mutateAsync:S,isLoading:g}=T({mutationFn:ie}),j=(s,r)=>{const o=`${s.level}${s.type}`,v=f.find(({type:t})=>t===o.toUpperCase());if(!P.isEmpty(v)){c(w("Level already exists!!!")),r.setSubmitting(!1);return}const d={session:x.sessionId,term:x.termId,level:{name:s.level,type:s.type},teacher:s.teacher};S(d,{onSettled:()=>{r.setSubmitting(!1),l.invalidateQueries(["levels"])},onSuccess:t=>{c(O(t)),i(!1)},onError:t=>{c(w(t))}})};return e.jsxs(B,{open:a,onClose:()=>i(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(R,{title:"New Level",onClose:()=>i(!1)}),e.jsx(G,{initialValues:we,onSubmit:j,validationSchema:W,children:({values:s,errors:r,touched:o,handleSubmit:v,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{sx:{p:1},children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(C,{freeSolo:!0,options:U,getOptionLabel:t=>t||"",value:s.level,onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(b,{...t,label:"Select Level",size:"small",error:!!(o.level&&r.level),helperText:o.level&&r.level})}),e.jsx(C,{freeSolo:!0,options:K,getOptionLabel:t=>t||"",value:s.type,onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(b,{...t,label:"Select Type",size:"small"})}),e.jsx(C,{options:L.data,loading:L.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",value:s.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(b,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(H,{sx:{padding:2},children:e.jsx(J,{loading:g,variant:"contained",onClick:v,children:"Add Level"})})]})})]})},X="/assets/level_ico-a08a6fb9.svg";var F={},Te=re;Object.defineProperty(F,"__esModule",{value:!0});var ee=F.default=void 0,Oe=Te(ae()),_e=e;ee=F.default=(0,Oe.default)((0,_e.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");function Ee({viewProps:a,editProps:i,deleteProps:x,handleView:l,handleEdit:c,handleDelete:f}){return e.jsxs(I,{direction:"row",spacing:2,children:[l&&e.jsx(ce,{className:"ico",onClick:l,...a,sx:{color:"secondary.main !important"}}),c&&e.jsx(de,{className:"ico",onClick:c,...i}),f&&e.jsx(ee,{className:"ico",onClick:f,...x})]})}const De=()=>{const a=M(),{schoolSessionState:{editLevel:{open:i,data:x}},schoolSessionDispatch:l}=y.useContext(_),{levelsOption:c}=$(),f=q({queryKey:["teachers"],queryFn:()=>Y(),select:s=>s==null?void 0:s.map(o=>({_id:o==null?void 0:o._id,fullName:o==null?void 0:o.fullName}))}),{mutateAsync:L,isLoading:S}=T({mutationFn:ue}),g=(s,r)=>{const o=`${s.level}${s.type}`,v=c.find(({type:t})=>t===o.toUpperCase());if(!P.isEmpty(v)){l(w("Level already exists!!!")),r.setSubmitting(!1);return}const d={_id:s==null?void 0:s._id,level:{name:s.level,type:s.type},teacher:s.teacher};console.log(d),L(d,{onSettled:()=>{r.setSubmitting(!1),a.invalidateQueries(["levels"])},onSuccess:t=>{l(O(t)),j()},onError:t=>{l(w(t))}})},j=()=>{l({type:"editLevel",payload:{open:!1,data:{}}})};return e.jsxs(B,{open:i,onClose:j,fullWidth:!0,maxWidth:"xs",children:[e.jsx(R,{title:"Edit Level",onClose:j}),e.jsx(G,{initialValues:x,onSubmit:g,validationSchema:W,enableReinitialize:!0,children:({values:s,errors:r,touched:o,handleSubmit:v,setFieldValue:d})=>e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs(I,{spacing:2,paddingY:2,children:[e.jsx(C,{freeSolo:!0,options:U,getOptionLabel:t=>t||"",value:(s==null?void 0:s.level)||"",onInputChange:(t,p)=>d("level",p),renderInput:t=>e.jsx(b,{...t,label:"Level",size:"small",error:!!(o.level&&r.level),helperText:o.level&&r.level})}),e.jsx(C,{freeSolo:!0,options:K,getOptionLabel:t=>t||"",value:(s==null?void 0:s.type)||"",onInputChange:(t,p)=>d("type",p),renderInput:t=>e.jsx(b,{...t,label:"type",size:"small"})}),e.jsx(C,{options:f.data,loading:f.isLoading,getOptionLabel:t=>(t==null?void 0:t.fullName)||"",defaultValue:s==null?void 0:s.teacher,value:s==null?void 0:s.teacher,onChange:(t,p)=>d("teacher",p),renderInput:t=>e.jsx(b,{...t,label:"Assign Teacher",size:"small"})})]})}),e.jsx(H,{sx:{padding:2},children:e.jsx(J,{loading:S,variant:"contained",onClick:v,children:"Save Changes"})})]})})]})};function ke(){var c;const{schoolSessionState:{viewLevel:{open:a,data:i}},schoolSessionDispatch:x}=y.useContext(_),l=()=>{x({type:"viewLevel",payload:{open:!1,data:{}}})};return e.jsxs(B,{open:a,onClose:l,fullWidth:!0,maxWidth:"xs",children:[e.jsx(R,{title:"Basic 1A Information",onClose:l}),e.jsx(z,{children:e.jsxs(I,{spacing:2,children:[e.jsx(A,{secondary:"Level",primary:i==null?void 0:i.type}),e.jsx(A,{secondary:"Number Of Students",primary:i==null?void 0:i.noOfStudents}),e.jsx(A,{secondary:"Number of Courses ",primary:i==null?void 0:i.noOfSubjects}),e.jsx(A,{secondary:"Class Teacher",primary:((c=i==null?void 0:i.teacher)==null?void 0:c.fullName)||"Not Assigned Yet"})]})})]})}const Ne=()=>{const{schoolSessionDispatch:a}=y.useContext(_),[i,x]=y.useState([]),{userState:{session:l}}=y.useContext(Q),c=pe(),f=M(),[L,S]=y.useState(!1),g=q({queryKey:["levels",l.sessionId,l.termId],queryFn:()=>me(l.sessionId,l.termId),enabled:!!l.sessionId&&!!(l!=null&&l.termId),initialData:[],select:n=>n.map(({_id:m,level:u,students:E,subjects:D,teacher:oe})=>({_id:m,level:u,type:`${u==null?void 0:u.name}${u==null?void 0:u.type}`,noOfStudents:E==null?void 0:E.length,noOfSubjects:D==null?void 0:D.length,teacher:oe}))}),{mutateAsync:j,isLoading:s}=T({mutationFn:fe}),r=n=>{const h={id:n,sessionId:l==null?void 0:l.sessionId,termId:l==null?void 0:l.termId};k.fire({title:"Removing Level",html:` <div style='text-align:left;display:flex;flex-direction:column;gap:8px;'>
      <p>  You are about to delete a level. This action is irreversible and will permanently remove all associated data,including:</p>
        <ul style='padding-block:8px;'>
   <li style='font-weight:bold;'>Class schedules</li>
  <li style='font-weight:bold;'>Student enrollments</li>
  <li style='font-weight:bold;'>Attendance records</li>
  <li style='font-weight:bold;'>Grades and assignments</li>
  <li style='font-weight:bold;'>Academic reports and records</li>
  </ul>
  
           <p>   Please proceed with caution. If you are certain you want to delete
              this academic year, click &apos;Confirm.&apos; Otherwise, click
              &apos;Cancel&apos; to keep the academic year intact.</p>
            <p style='color:var(--secondary);font-weight:bold;'>Are you sure you want to delete this level?</p>
          </div>`,showCancelButton:!0,backdrop:!1}).then(({isConfirmed:m})=>{m&&(k.showLoading(),j(h,{onSettled:()=>{f.invalidateQueries(["levels"])},onSuccess:u=>{a(O(u))},onError:u=>{a(w(u))}}))})},o=n=>{x(n)},{mutateAsync:v,isLoading:d}=T({mutationFn:ve}),t=()=>{k.fire({title:"Removing Session",text:"You are about to remove the selected sessions. Removing session will delete all of its related content.Changes cannot be undone. Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:n})=>{const h=P.map(i,"termId");n&&v(h,{onSettled:()=>{f.invalidateQueries(["terms"])},onSuccess:m=>{a(O(m))},onError:m=>{a(w(m))}})})},p=n=>{var m,u;const h={_id:n==null?void 0:n._id,level:(m=n==null?void 0:n.level)==null?void 0:m.name,type:(u=n==null?void 0:n.level)==null?void 0:u.type,teacher:n==null?void 0:n.teacher};a({type:"editLevel",payload:{open:!0,data:h}})},te=({_id:n,type:h})=>{const m=encodeURIComponent(h);c(`/level/course?_id=${n}&type=${m}`)},se=({_id:n,type:h})=>{c(`/level/current/${n}/${h}`,{replace:!0,state:{levelId:n,levelName:h}})},ne=n=>{a({type:"viewLevel",payload:{open:!0,data:n}})},le=[...ye,{field:null,title:"Class",width:"40%",render:n=>e.jsxs(I,{direction:"row",spacing:5,children:[e.jsx(V,{sx:{cursor:"pointer"},onClick:()=>se(n),children:"Go to Class"}),e.jsx(V,{sx:{cursor:"pointer"},onClick:()=>te(n),children:"Add Subjects"})]})},{field:null,title:"Action",render:n=>e.jsx(Ee,{viewProps:{title:"View level information",titleAccess:"View level information"},editProps:{title:"Edit level information",titleAccess:"Edit level information"},deleteProps:{title:"Delete level information",titleAccess:"Delete level information"},handleView:()=>ne(n),handleEdit:()=>p(n),handleDelete:()=>r(n==null?void 0:n._id)})}];return e.jsxs(Z,{pt:2,children:[e.jsx(he,{title:"Levels",icon:X,search:!0,isLoading:g.isLoading,columns:le,data:g.data,actions:[],showAddButton:!0,addButtonText:"New Level",addButtonImg:xe.level,addButtonMessage:"ðŸ˜‘ Oops! It seems you don't have any level at the moment.Create a new one",onAddButtonClicked:()=>S(!0),handleRefresh:g.refetch,onSelectionChange:o,onDeleteClicked:t}),e.jsx(ke,{}),e.jsx(Ae,{open:L,setOpen:S}),e.jsx(De,{}),s||d&&e.jsx(Ie,{})]})},Fe=()=>{const{levelSummary:a}=$();return e.jsxs(e.Fragment,{children:[e.jsx(ge,{title:"School Levels & Subjects",subtitle:"Add and Track new Classes and Subjects",img:X,color:"primary.main"}),e.jsx(je,{variant:"h5",py:2,children:"Level Details"}),e.jsx(Le,{}),e.jsxs(Z,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:2,py:2},children:[e.jsx(N,{title:"Levels",value:a.noOfLevels,icon:e.jsx(Ce,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(N,{title:"Courses Offered",value:a.noOfSubjects,icon:e.jsx(Se,{sx:{width:30,height:30,color:"secondary.main"}})}),e.jsx(N,{title:"Assigned Teachers",value:a.noOfAssignedTeachers,icon:e.jsx(be,{sx:{width:30,height:30,color:"secondary.main"}})})]}),e.jsx(Ne,{})]})};export{Fe as default};
