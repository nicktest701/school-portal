import{g as B,r as m,f as R,G as _,a0 as k,v as P,i as D,j as e,T as b,L as Q,a7 as V,I as M,D as N,B as E,V as U,x as W,s as F,t as q,U as $,C as G,n as J,ab as K,J as Y,S as H,b as A,p as X,q as Z}from"./index-a08c4904.js";import{u as ee}from"./useLevel-30b3786a.js";import{C as te}from"./CustomTitle-d0e5d50c.js";import{B as se}from"./Back-26c0fe57.js";import{u as ie}from"./useLevelById-ba5e9072.js";import{g as re,d as ne,p as oe}from"./courseAPI-5dd2ee7f.js";import{L as ae,A as I}from"./Autocomplete-62a3dcdf.js";import{L as S}from"./ListItemText-de69415f.js";import{R as le}from"./RefreshRounded-6ed4a5e2.js";import{L as ce}from"./ListItem-559aef15.js";import{L as de}from"./ListItemSecondaryAction-33dcc31c.js";import"./ArrowBackRounded-b2e199d9.js";import"./Chip-a33d5899.js";import"./listItemTextClasses-cdd81f8c.js";import"./listItemButtonClasses-628cfd1a.js";function me(){var h,j;const p=B(),{schoolSessionDispatch:a}=m.useContext(R),{id:u}=_(),{userState:{session:l}}=m.useContext(k),i=P({queryKey:["courses",u],queryFn:()=>re({teacher:u,session:l==null?void 0:l.sessionId,term:l==null?void 0:l.termId})}),{mutateAsync:n}=D({mutationFn:ne}),C=s=>{W.fire({title:"Remove",text:"Do you want to revoke course from teacher?",showCancelButton:!0}).then(c=>{c.isConfirmed&&n(s,{onSettled:()=>{p.invalidateQueries(["courses",u])},onSuccess:x=>{a(F(x))},onError:x=>{a(q(x))}})})};return i.isLoading?e.jsx(b,{children:"Loading Courses"}):i.isError?e.jsx(b,{children:"An error has occurred!"}):e.jsx(Q,{subheader:e.jsxs(ae,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:4},children:[e.jsx(S,{primary:"Assign Courses",secondary:"List of assigned courses",primaryTypographyProps:{fontSize:18,color:"var(--secondary)"},sx:{py:2}}),e.jsx(V,{title:"Refresh Courses",children:e.jsx(M,{onClick:i.refetch,children:e.jsx(le,{})})}),e.jsx(N,{})]}),sx:{pt:4},children:((h=i==null?void 0:i.data)==null?void 0:h.length)>0?(j=i==null?void 0:i.data)==null?void 0:j.map(s=>e.jsxs(ce,{divider:!0,children:[e.jsx(S,{primary:s==null?void 0:s.level}),e.jsx(S,{primary:s==null?void 0:s.subject}),e.jsx(de,{children:e.jsx(E,{title:"Remove Course",color:"error",size:"small",endIcon:e.jsx(U,{}),onClick:()=>C(s==null?void 0:s._id),children:"   Remove"})})]},s==null?void 0:s._id)):e.jsx(b,{textAlign:"center",children:"No Course Available"})})}const ue=()=>{const{schoolSessionDispatch:p}=m.useContext(R),{userState:{session:a}}=m.useContext(k),u=B(),[l,i]=m.useState(""),[n,C]=m.useState({_id:"",type:""}),h={currentLevel:n,subject:l},{levelsOption:j,levelLoading:s}=ee(),{subjects:c,levelLoading:x}=ie(n==null?void 0:n._id),{id:y}=_(),{mutateAsync:w,isLoading:z}=D({mutationFn:oe}),O=(r,d)=>{var g;const f={session:a==null?void 0:a.sessionId,term:a==null?void 0:a.termId,teacher:y,level:(g=r==null?void 0:r.currentLevel)==null?void 0:g._id,subject:r==null?void 0:r.subject};w(f,{onSettled:()=>{u.invalidateQueries(["courses",y]),d.setSubmitting(!1)},onSuccess:t=>{p(F(t)),d.resetForm()},onError:t=>{p(q(t))}})};return e.jsxs(G,{children:[e.jsx(se,{to:`/teacher/${y}`,color:"primary.main"}),e.jsx(te,{title:"Course Allocation Management",subtitle:" Assign courses to teachers, ensuring that everyone is aware of their responsibilities and schedules.",color:"primary.main"}),e.jsx(J,{initialValues:h,validationSchema:K,onSubmit:O,enableReinitialize:!0,children:({errors:r,touched:d,handleSubmit:f,handleReset:g})=>e.jsx(e.Fragment,{children:e.jsxs(Y,{sx:{mt:4,py:4,px:2,border:"1px solid lightgray",bgcolor:"#fff"},children:[e.jsxs(H,{spacing:3,children:[e.jsx(I,{size:"small",options:j,loading:s,loadingText:"Loading levels.Please wait...",getOptionLabel:t=>(t==null?void 0:t.type)||"",isOptionEqualToValue:(t,o)=>o._id===void 0||o._id===""||o._id===t._id,value:n,onChange:(t,o)=>{C(o),i("")},renderInput:t=>{var o,L,v,T;return e.jsx(A,{...t,label:"Select a level",error:!!((o=d.currentLevel)!=null&&o.type&&((L=r.currentLevel)!=null&&L.type)),helperText:((v=d.currentLevel)==null?void 0:v.type)&&((T=r.currentLevel)==null?void 0:T.type)})},sx:{marginY:2}}),e.jsx(I,{freeSolo:!0,fullWidth:!0,noOptionsText:"No subject available",loading:x,loadingText:"Please Wait...",options:c||[],closeText:" ",getOptionLabel:t=>t||"",value:l,onChange:(t,o)=>i(o),renderInput:t=>e.jsx(A,{...t,label:"Select Subject",size:"small",error:!!(d.subject&&r.subject),helperText:d.subject&&r.subject})})]}),e.jsxs(X,{children:[e.jsx(E,{onClick:g,children:"Cancel"}),e.jsx(Z,{loading:z,variant:"contained",onClick:f,disabled:(n==null?void 0:n._id)===""&&(c==null?void 0:c.length)===0,children:"Assign Course"})]})]})})}),e.jsx(me,{})]})},Be=$.memo(ue);export{Be as default};
