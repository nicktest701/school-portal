import{r as i,S as O,u as B,a0 as j,h as v,j as e,i as L,y as R,C as z,F as P,l as Q,m as k,T as F,aX as D,q as G,D as V,t as _,v as q,w as T,x as A,aY as N,aB as W,aZ as $,aI as H,g as K,a2 as J,E as U,a_ as I,G as X,a$ as Z,J as ee,K as Y,_ as te}from"./index-6e32062a.js";import{p as se,a as ae,g as ne,d as oe,b as ie,c as le}from"./termAPI-33f1ff0a.js";import{s as re}from"./initialValues-163c372f.js";import{C as M}from"./CustomYearPicker-5cdaf113.js";import{G as de}from"./GlobalSpinner-05ebe35d.js";const ce=()=>{const{schoolSessionState:{editSession:{open:l,data:s}},schoolSessionDispatch:c}=i.useContext(O),x=B(),[d,u]=i.useState(null),[m,S]=i.useState(null),[g,h]=i.useState(null),[f,p]=i.useState(null);i.useEffect(()=>{u(j(new Date(s.from))),S(j(new Date(s.to))),h(j(new Date(s.vacationDate))),p(j(new Date(s.reOpeningDate)))},[s]);const y={id:s.termId,from:d,to:m,vacationDate:g,reOpeningDate:f,academicYear:s.academicYear,term:s.term,session:s.sessionId},{mutateAsync:C,isLoading:b}=v({mutationFn:se}),n=(t,o)=>{C(t,{onSettled:()=>{o.setSubmitting(!1),x.invalidateQueries(["terms"])},onSuccess:r=>{c(T(r)),a()},onError:r=>{c(A(r))}})},a=()=>{c({type:"editSession",payload:{open:!1,data:{}}})};return e.jsxs(L,{open:l,onClose:a,fullWidth:!0,maxWidth:"xs",TransitionComponent:R,children:[e.jsx(z,{title:"Edit Session",onClose:a}),e.jsx(P,{initialValues:y,onSubmit:n,enableReinitialize:!0,children:({values:t,touched:o,errors:r,handleChange:E,handleSubmit:w})=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(k,{spacing:2,paddingY:2,children:[e.jsx(F,{label:"Academic Year",InputProps:{readOnly:!0},value:t.academicYear,size:"small"}),e.jsx(D,{label:"Start of Academic Term",date:d,setDate:u,touched:o.from,error:r.from,readOnly:!0}),e.jsx(D,{label:"End of Academic Term",date:m,setDate:S,touched:o.to,error:r.to,readOnly:!0}),e.jsx(F,{label:"Term/Semester",size:"small",value:t.term,onChange:E("term"),InputProps:{readOnly:!0}}),e.jsx(G,{fontSize:13,children:"Vacation"}),e.jsx(D,{label:"Vacation Date",date:g,setDate:h}),e.jsx(D,{label:"Next Term Begins",date:f,setDate:p}),e.jsx(V,{})]})}),e.jsx(_,{sx:{padding:2},children:e.jsx(q,{loading:b,variant:"contained",onClick:w,children:b?"Please Wait..":"Save Changes"})})]})})]})},ue=()=>{const{schoolSessionState:l,schoolSessionDispatch:s}=i.useContext(O),c=B(),[x,d]=i.useState(j()),[u,m]=i.useState(j()),[S,g]=i.useState(""),[h,f]=i.useState(""),{mutateAsync:p,isLoading:y}=v({mutationFn:ae}),C=new Date().getFullYear(),b=(a,t)=>{a.academicYear=`${S||C}/${h||C}`,p(a,{onSettled:()=>{t.setSubmitting(!1),c.invalidateQueries(["terms"])},onSuccess:o=>{s(T(o)),n()},onError:o=>{s(A(o))}})};function n(){s({type:"displayAddSession",payload:!1})}return e.jsxs(L,{open:l.displayAddSession,fullWidth:!0,maxWidth:"xs",TransitionComponent:R,children:[e.jsx(z,{title:"Add Session",onClose:n}),e.jsx(P,{initialValues:{...re,from:x.format("l"),to:u.format("l")},onSubmit:b,validationSchema:N,enableReinitialize:!0,children:({values:a,errors:t,touched:o,handleChange:r,handleSubmit:E})=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs(k,{spacing:2,paddingY:2,children:[e.jsx(W,{sx:{fontSize:13},children:"Academic Year"}),e.jsxs(k,{direction:"row",columnGap:2,children:[e.jsx(M,{label:"From",year:S,setYear:g}),e.jsx(M,{label:"To",year:h,setYear:f})]}),e.jsx(D,{label:"Start of Academic Term/Semester",date:x,setDate:d,touched:o.from,error:t.from}),e.jsx(D,{label:"End of Academic Term/Semester",date:u,setDate:m,touched:o.to,error:t.to}),e.jsx(F,{select:!0,label:"Term/Semester",size:"small",value:a.term,onChange:r("term"),error:!!(o.term&&t.term),helperText:o.term&&t.term,children:$.map(w=>e.jsx(H,{value:w,children:w},w))}),e.jsx(V,{})]})}),e.jsx(_,{sx:{padding:2},children:e.jsx(q,{loading:y,variant:"contained",onClick:E,children:y?"Saving":"Save"})})]})})]})},ge=()=>{const{schoolSessionDispatch:l}=i.useContext(O),s=B(),[c,x]=i.useState([]),d=K({queryKey:["terms"],queryFn:()=>ne(),initialData:[]}),{mutateAsync:u}=v({mutationFn:oe}),m=n=>{Y.fire({title:"Removing Session",html:` <div style='text-align:left;display:flex;flex-direction:column;gap:8px;'>
    <p>  You are about to delete an entire academic term. This action is irreversible and will permanently remove all associated data,including:</p>
      <ul style='padding-block:8px;'>
 <li style='font-weight:bold;'>Class schedules</li>
<li style='font-weight:bold;'>Student enrollments</li>
<li style='font-weight:bold;'>Attendance records</li>
<li style='font-weight:bold;'>Grades and assignments</li>
</ul>

         <p>   Please proceed with caution. If you are certain you want to delete
            this academic year, click &apos;Confirm.&apos; Otherwise, click
            &apos;Cancel&apos; to keep the academic year intact.</p>
          <p style='color:var(--secondary);font-weight:bold;'>Are you sure you want to delete this academic term?</p>
        </div>`,showCancelButton:!0,backdrop:"rgba(0,0,0,0.2)"}).then(({isConfirmed:a})=>{a&&u(n,{onSettled:()=>{s.invalidateQueries(["terms"])},onSuccess:t=>{l(T(t))},onError:t=>{l(A(t))}})})},S=n=>{x(n)},{mutateAsync:g,isLoading:h}=v({mutationFn:ie}),f=()=>{Y.fire({title:"Removing Session",text:"You are about to remove the selected sessions. Removing session will delete all of its related content.Changes cannot be undone. Do you want to remove?",showCancelButton:!0,backdrop:!1}).then(({isConfirmed:n})=>{const a=te.map(c,"termId");n&&g(a,{onSettled:()=>{s.invalidateQueries(["terms"])},onSuccess:t=>{l(T(t))},onError:t=>{l(A(t))}})})},p=n=>{l({type:"editSession",payload:{open:!0,data:n}})},y=()=>{l({type:"displayAddSession",payload:!0})},{mutateAsync:C}=v({mutationFn:le}),b=({_id:n,active:a})=>{Y.fire({title:a?"Do you want to disable this session":"Do you want to enable this session",text:a?"Disabling Session":"Enabling Session",showCancelButton:!0,backdrop:!1}).then(t=>{t.isConfirmed&&C({_id:n,active:!a},{onSuccess:r=>{s.invalidateQueries(["terms"]),l(T(r))},onError:r=>{l(A(r))}})})};return e.jsxs(J,{children:[e.jsx(U,{title:"School Session",subtitle:"  Track,manage and control academic and class activities",img:I,color:"primary.main"}),e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Sessions",icon:I,isLoading:d.isLoading,columns:Z(b,p,m),data:d.data?d.data:[],actions:[],showRowShadow:!1,handleEdit:p,handleDelete:m,showAddButton:!0,addButtonImg:ee.session,addButtonMessage:"ðŸ˜‘ No School Session available!.Create a new one!",addButtonText:"New Session",onAddButtonClicked:y,handleRefresh:d.refetch,onSelectionChange:S,onDeleteClicked:f,options:{search:!0}}),e.jsx(ue,{}),e.jsx(ce,{}),h&&e.jsx(de,{})]})]})};export{ge as default};
