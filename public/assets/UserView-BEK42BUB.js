import{K as oe,j as a,i as K,b as J,r as j,S as X,d as D,ap as ie,s as le,t as de,w as re,aq as ce,v as xe,k as S,T as _,y as me,Q as Z,f as U,g as A,h as k,W as pe,u as he,c as ue,ar as fe,e as je,M as P,B as f,E as we,A as ge,D as G,m as ye,as as be,at as Ce}from"./index-DrgqF6h7.js";import{M as ve,P as s}from"./ProfileItem-C9ox4z6u.js";import{D as Pe}from"./DialogActions-Cx2GHHEW.js";import{B as De}from"./Back-CADpxW16.js";import{B as Se}from"./ButtonGroup-DQMwsk7A.js";import{C as H}from"./Chip-BcLQNplL.js";const ee=oe(a.jsx("path",{d:"M3 17h18c.55 0 1 .45 1 1s-.45 1-1 1H3c-.55 0-1-.45-1-1s.45-1 1-1m-.5-4.43c.36.21.82.08 1.03-.28l.47-.82.48.83c.21.36.67.48 1.03.28.36-.21.48-.66.28-1.02l-.49-.84h.95c.41 0 .75-.34.75-.75s-.34-.75-.75-.75H5.3l.47-.82c.21-.36.09-.82-.27-1.03-.36-.2-.82-.08-1.03.28L4 8.47l-.47-.82c-.21-.36-.67-.48-1.03-.28-.36.21-.48.67-.27 1.03l.47.82h-.95c-.41 0-.75.34-.75.75s.34.75.75.75h.95l-.48.83c-.2.36-.08.82.28 1.02m8 0c.36.21.82.08 1.03-.28l.47-.82.48.83c.21.36.67.48 1.03.28.36-.21.48-.66.28-1.02l-.48-.83h.95c.41 0 .75-.34.75-.75s-.34-.75-.75-.75h-.96l.47-.82c.21-.36.08-.82-.27-1.03-.36-.21-.82-.08-1.02.27l-.48.82-.47-.82c-.21-.36-.67-.48-1.02-.27-.36.21-.48.67-.27 1.03l.47.82h-.96c-.41-.01-.75.33-.75.74s.34.75.75.75h.95l-.48.83c-.2.36-.08.82.28 1.02M23 9.97c0-.41-.34-.75-.75-.75h-.95l.47-.82c.21-.36.08-.82-.27-1.03-.36-.21-.82-.08-1.02.27l-.48.83-.47-.82c-.21-.36-.67-.48-1.02-.27-.36.21-.48.67-.27 1.03l.47.82h-.95c-.42-.01-.76.33-.76.74s.34.75.75.75h.95l-.48.83c-.21.36-.08.82.28 1.02.36.21.82.08 1.03-.28l.47-.82.48.83c.21.36.67.48 1.03.28.36-.21.48-.66.28-1.02l-.48-.83h.95c.4-.01.74-.35.74-.76"}),"PasswordRounded");function Ue({open:c,setOpen:d}){const{id:w}=K(),b=J(),{schoolSessionDispatch:x}=j.useContext(X),C={id:w,password:"",confirmPassword:""},{mutateAsync:g,isLoading:n}=D({mutationFn:ie}),e=(r,o)=>{delete r.confirmPassword,U.fire({title:"Updating Password",text:"Do you wish to proceed?",showCancelButton:!0,allowOutsideClick:!1}).then(({isConfirmed:i,isDenied:m,isDismissed:p})=>{i&&g(r,{onSuccess:h=>{b.invalidateQueries(["user",w]),x(A(h)),o.setSubmitting(!1),y(),x({type:"viewUser",payload:{open:!1,data:{}}})},onError:h=>{x(k(h))}}),p&&o.setSubmitting(!1)})},y=()=>d(!1);return a.jsxs(le,{open:c,maxWidth:"xs",fullWidth:!0,children:[a.jsx(de,{title:"Password Reset",onClose:y}),a.jsx(re,{initialValues:C,onSubmit:e,enableReinitialize:!0,validationSchema:ce,children:({values:r,errors:o,touched:i,handleChange:m,handleSubmit:p})=>a.jsxs(a.Fragment,{children:[a.jsx(xe,{children:a.jsxs(S,{padding:2,spacing:1,children:[a.jsx(_,{type:"password",label:"Password",fullWidth:!0,size:"small",autoComplete:"no",value:r.password,onChange:m("password"),error:!!(i.password&&o.password),helperText:i.password&&o.password}),a.jsx(_,{type:"password",label:"Confirm Password",fullWidth:!0,size:"small",value:r.confirmPassword,onChange:m("confirmPassword"),error:!!(i.confirmPassword&&o.confirmPassword),helperText:i.confirmPassword&&o.confirmPassword})]})}),a.jsx(Pe,{children:a.jsx(me,{loading:n,variant:"contained",color:"primary",onClick:p,startIcon:a.jsx(ee,{}),children:"Update Password"})})]})}),n&&a.jsx(Z,{value:"Updating Password.Please wait..."})]})}const ae=()=>{var I,B,E,M,R,Q,F,T,L,O,W,$,q,V,Y;const c=J(),{id:d}=K(),w=he(),[b,x]=j.useState(null),[C,g]=j.useState(null),{schoolSessionDispatch:n}=j.useContext(X),e=ue({queryKey:["user",d],queryFn:()=>fe(d),initialData:(I=c.getQueryData(["users"]))==null?void 0:I.find(t=>(t==null?void 0:t._id)===d)});j.useEffect(()=>{var t;x(`/images/users/${(t=e==null?void 0:e.data)==null?void 0:t.profile}`)},[e==null?void 0:e.data]);const y=()=>{w(`/users/${d}/edit`)},{mutateAsync:r}=D({mutationFn:be}),o=()=>{var t,l;U.fire({title:(t=e==null?void 0:e.data)!=null&&t.active?"Do you want to disable this account?":"Do you want to enable this account?",text:(l=e==null?void 0:e.data)!=null&&l.active?"Disabling Account":"Enabling Account",showCancelButton:!0}).then(u=>{var N,z;if(u.isConfirmed){const ne={id:(N=e==null?void 0:e.data)==null?void 0:N._id,active:(z=e==null?void 0:e.data)!=null&&z.active?0:1};r(ne,{onSuccess:v=>{c.invalidateQueries(["users"]),c.invalidateQueries(["user",d]),n(A(v)),i()},onError:v=>{n(k(v))}})}})},i=()=>{n({type:"viewUser",payload:{open:!1,data:{}}})},{mutateAsync:m,isLoading:p}=D({mutationFn:Ce}),h=()=>{U.fire({title:"Deleting User",text:"Do you want to delete?",showCancelButton:!0}).then(t=>{var l;t.isConfirmed&&m((l=e==null?void 0:e.data)==null?void 0:l._id,{onSuccess:u=>{c.invalidateQueries(["users"]),n(A(u)),i()},onError:u=>{n(k(u))}})})},te=()=>{g(!0)},se=()=>{var t,l;n({type:"sendQuickMessage",payload:{open:!0,data:{email:(t=e==null?void 0:e.data)==null?void 0:t.email,phonenumber:(l=e==null?void 0:e.data)==null?void 0:l.phonenumber}}})};return a.jsxs(a.Fragment,{children:[a.jsxs(a.Fragment,{children:[a.jsx(De,{color:"#012e54"}),a.jsx(je,{title:"User Information",subtitle:"Track,manage and control courses assigned to you",color:"primary.main"}),a.jsxs(P,{children:[a.jsx(S,{width:"100%",justifyContent:"flex-end",alignItems:"flex-end",children:a.jsxs(Se,{children:[a.jsx(f,{endIcon:a.jsx(ee,{}),onClick:te,children:"Update Password"}),a.jsx(f,{endIcon:a.jsx(we,{}),onClick:y,children:"Edit"})]})}),a.jsxs(P,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",paddingY:2,gap:4,children:[a.jsx(P,{sx:{p:1,border:"1px solid lightgray",borderRadius:"50%"},children:a.jsx(ge,{srcSet:b,sx:{width:100,height:100}})}),a.jsx(f,{startIcon:a.jsx(ve,{}),onClick:se,children:"Send Message"})]}),a.jsx(G,{flexItem:!0,children:a.jsx(H,{label:"Personal Information",color:"primary"})}),a.jsx(s,{label:"Name",text:`${(B=e==null?void 0:e.data)==null?void 0:B.fullname}`}),a.jsx(s,{label:"Username",text:`${(E=e==null?void 0:e.data)==null?void 0:E.username}`}),a.jsx(s,{label:"Role",text:(M=e==null?void 0:e.data)==null?void 0:M.role}),a.jsx(s,{label:"Date Of Birth",tex:!0,text:ye(new Date((R=e==null?void 0:e.data)==null?void 0:R.dateofbirth)).format("Do MMMM, YYYY.")}),a.jsx(s,{label:"Gender",text:(Q=e==null?void 0:e.data)==null?void 0:Q.gender}),a.jsx(s,{label:"Email Address",text:(F=e==null?void 0:e.data)==null?void 0:F.email}),a.jsx(s,{label:"Telephone No.",text:(T=e==null?void 0:e.data)==null?void 0:T.phonenumber}),a.jsx(s,{label:"Address",text:(L=e==null?void 0:e.data)==null?void 0:L.address}),a.jsx(s,{label:"Residence",text:(O=e==null?void 0:e.data)==null?void 0:O.residence}),a.jsx(s,{label:"Nationality",text:(W=e==null?void 0:e.data)==null?void 0:W.nationality}),a.jsx(G,{flexItem:!0,children:a.jsx(H,{label:"Account Status",color:"primary"})}),a.jsx(s,{label:"Account",text:($=e==null?void 0:e.data)!=null&&$.active?"Active":"Disabled",valueStyle:{color:(q=e==null?void 0:e.data)!=null&&q.active?"green":"red"}}),a.jsxs(S,{direction:"row",spacing:2,flexWrap:"wrap",justifyContent:"flex-end",py:2,children:[a.jsx(f,{variant:"contained",color:(V=e==null?void 0:e.data)!=null&&V.active?"primary":"warning",onClick:o,children:(Y=e==null?void 0:e.data)!=null&&Y.active?"Disable Account":"Enable Account"}),a.jsx(f,{variant:"contained",color:"error",onClick:h,children:"Delete Account"})]})]})]}),a.jsx(Ue,{open:C,setOpen:g}),p&&a.jsx(Z,{value:"Removing user details"})]})};ae.propTypes={};const Re=pe.memo(ae);export{Re as default};
